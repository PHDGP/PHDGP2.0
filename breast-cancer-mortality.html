<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>8 Case Study 2: Breast Cancer Mortality in Massachusetts | Public Health Disparities Geocoding Project 2.0 Training Manual</title>
<meta name="author" content="Christian Testa, Jarvis T Chen, Enjoli Hall, Dena Javadi, Justin Morgan, Tamara Rushovich, Sudipta Saha, Pamela D Waterman, Nancy Krieger">
<meta name="description" content="By: Enjoli Hall  8.1 Overview Our outcome of interest is breast cancer mortality. We investigate disparities in breast cancer mortality by racialized/ethnic group and socioeconomic position. We...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="8 Case Study 2: Breast Cancer Mortality in Massachusetts | Public Health Disparities Geocoding Project 2.0 Training Manual">
<meta property="og:type" content="book">
<meta property="og:description" content="By: Enjoli Hall  8.1 Overview Our outcome of interest is breast cancer mortality. We investigate disparities in breast cancer mortality by racialized/ethnic group and socioeconomic position. We...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="8 Case Study 2: Breast Cancer Mortality in Massachusetts | Public Health Disparities Geocoding Project 2.0 Training Manual">
<meta name="twitter:description" content="By: Enjoli Hall  8.1 Overview Our outcome of interest is breast cancer mortality. We investigate disparities in breast cancer mortality by racialized/ethnic group and socioeconomic position. We...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="libs/HomeButton-0.0.1/home-button.js"></script><script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script><script src="libs/clipboard-0.0.1/setClipboardText.js"></script><link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-YD7D8SMHNP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-YD7D8SMHNP');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Public Health Disparities Geocoding Project 2.0 Training Manual</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Public Health Disparities Geocoding Project 2.0 Training Manual</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="background.html"><span class="header-section-number">1</span> Background and History of Analytic Methods</a></li>
<li><a class="" href="bios.html"><span class="header-section-number">2</span> Author Bios</a></li>
<li><a class="" href="getting-setup.html"><span class="header-section-number">3</span> Getting Setup with R and RStudio</a></li>
<li><a class="" href="getting-your-data.html"><span class="header-section-number">4</span> Getting your data</a></li>
<li><a class="" href="visualizing-your-data.html"><span class="header-section-number">5</span> Visualizing your data</a></li>
<li><a class="" href="analyzing-your-data.html"><span class="header-section-number">6</span> Analyzing your data</a></li>
<li><a class="" href="premature-mortality.html"><span class="header-section-number">7</span> Case Study 1: Premature Mortality in Massachusetts (2013 - 2017)</a></li>
<li><a class="active" href="breast-cancer-mortality.html"><span class="header-section-number">8</span> Case Study 2: Breast Cancer Mortality in Massachusetts</a></li>
<li><a class="" href="cook-county-covid.html"><span class="header-section-number">9</span> Case Study 3: COVID-19 Mortality in Cook County (March 2020 - March 2022)</a></li>
<li><a class="" href="temporal-health-insurance.html"><span class="header-section-number">10</span> Case Study 4: Case Study on Temporal Trends using American Community Survey (ACS) data (2012-2019)</a></li>
<li><a class="" href="health-insurance-comparison.html"><span class="header-section-number">11</span> Case Study 5: Case Study Comparing County Analyses of Inequities in Health Insurance using ACS vs. CDC PLACES data (2019)</a></li>
<li><a class="" href="conclusions.html"><span class="header-section-number">12</span> Conclusion</a></li>
<li><a class="" href="glossary.html"><span class="header-section-number">13</span> Glossary</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="breast-cancer-mortality" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Case Study 2: Breast Cancer Mortality in Massachusetts<a class="anchor" aria-label="anchor" href="#breast-cancer-mortality"><i class="fas fa-link"></i></a>
</h1>
<p><em>By: Enjoli Hall</em></p>
<div id="overview" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview"><i class="fas fa-link"></i></a>
</h2>
<p>Our outcome of interest is breast cancer mortality. We investigate disparities in breast cancer mortality by racialized/ethnic group and socioeconomic position. We primarily focus on comparisons of risk in Black non-Hispanic and White non-Hispanic populations, motivated by longstanding health inequities between these groups and sufficiently large population sizes in Massachusetts to support the analyses. We will be working with mortality data from the Massachusetts Registry of Vital Records and Statistics [<a href="https://www.mass.gov/lists/death-data" class="uri">https://www.mass.gov/lists/death-data</a>] for the years 2013-2017. Vital statistics and disease registries are how states (which submit their data to the federal government) keep an official enumeration of deaths (Friedman et al., 2005; Hetzel, 1997; Krieger, 2019); because the death certificates require data on residential address at time of death, they can be useful tools for monitoring trends in health and health equity. Having data on the residential address of each individual allows us to geocode each observation to the physical and social environment in which the person lived. Death records also typically include demographic information about the deceased, including categories for racialized groups that conform to the 1997 US Office of Management and Budget (OMB) standards for the classification of federal data on “race and ethnicity” (OMB, 1997). We will explore how social membership in racialized groups and area-based social metrics (ABSMs) might be associated with breast cancer mortality across Massachusetts. To do this, we will pair our mortality data with demographic and socioeconomic data from the U.S. Census Bureau’s 5-year American Community Survey (ACS) files.</p>
</div>
<div id="background-and-significance" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Background and Significance<a class="anchor" aria-label="anchor" href="#background-and-significance"><i class="fas fa-link"></i></a>
</h2>
<p>Breast cancer is the most commonly diagnosed cancer worldwide and is one of the leading causes of cancer death. In the United States, breast cancer incidence and mortality rates vary widely across geographic regions and racialized groups. For example, while breast cancer deaths in the United States have declined overall by 42 percent over the last 30 years, there is a persistent mortality gap between Black women and White women. Breast cancer incidence rates among Black and White women are close, but mortality rates are markedly different, with Black women having a 41 percent higher death rate from breast cancer compared to White women in the United States (Breast Cancer Research Foundation, 2022).</p>
<p>Nevertheless, the routine stratification and presentation of cancer data by “race” in the absence of socioeconomic data such as occupation, educational level, or income, perpetuates the view that “race”—wrongly construed as a biological variable—explains racialized inequities in breast cancer mortality and other cancer outcomes. Hidden from view are ways that economic forms of discrimination and inequality might drive “racial”/ethnic inequities in breast cancer mortality. Rather than taking an either/or approach to analyzing and interpreting cancer data by “race/ethnicity” and socioeconomic position, it is important for public health researchers to stratify cancer data by both “race/ethnicity” and socioeconomic position as neither by itself is sufficient to capture how membership in racialized groups and class relations, separately and together, affect the health of populations. However, U.S. public health surveillance systems typically do not include data relating health status to socioeconomic position for individual records. One possible solution to these gaps is to combine data from health surveillance systems with socioeconomic data derived from the U.S. Census to analyze breast cancer mortality in relation to area-based socioeconomic measures for domains of socioeconomic position such as income and poverty, thereby permitting calculation of population-based breast cancer mortality rates stratified by area-based socioeconomic position and making visible socioeconomic gradients in breast cancer mortality.</p>
<p>We can also monitor racialized and socioeconomic cancer and other health inequities using not only conventional individual- and area-level socioeconomic measures but also measures of racialized and economic segregation and polarization at the neighborhood, city or town, and regional levels; these latter measures bring into focus the full range of concentrations of privilege and deprivation in an area. Over 20 years ago, Williams and Collins (2001) explained how racial residential segregation acts as a fundamental cause of racial disparities in health by exposing Black communities to less healthy neighborhood and housing conditions, fewer economic and educational opportunities, and lower quality health care resources compared to White communities. Since that time, hundreds of empirical studies have examined segregation as a key driver of patterns of population health and health inequities, but relatively few studies have examined cancer outcomes. Together, these studies suggest that residential segregation can generate racialized economic inequities across the cancer continuum, in part through producing differential access to medical care and unequal exposures to social and environmental cancer risks.</p>
</div>
<div id="motivation-research-questions-and-learning-objectives-1" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Motivation, Research Questions, and Learning Objectives<a class="anchor" aria-label="anchor" href="#motivation-research-questions-and-learning-objectives-1"><i class="fas fa-link"></i></a>
</h2>
<p>The goal of this case study is to develop familiarity with methods of exploring and visualizing racialized and socioeconomic inequities in health. Our specific goals will be to:</p>
<ul>
<li><p>Download and merge different datasets for our analysis</p></li>
<li><p>Visualize and map estimates of area-based social metrics and breast cancer mortality</p></li>
<li><p>Identify relationships between racialized group, area-based social metrics, and breast cancer mortality</p></li>
<li><p>Model how space may impact inequities in breast cancer mortality</p></li>
</ul>
<p>The research questions we will seek to answer throughout this case study include:</p>
<ol style="list-style-type: decimal">
<li><p>What is the overall socioeconomic gradient in breast cancer mortality? (hint: we can visualize this with a spatial model)</p></li>
<li><p>What is the racialized disparity in breast cancer mortality overall? (hint: we can visualize this with stratified aggregate analyses)</p></li>
<li><p>How do area-based socioeconomic measures interact with individual-level membership in racialized groups to affect patterns of breast cancer mortality (i.e., interactions between socioeconomic position and racialized groups, not just socioeconomic inequities within racialized groups)? (hint: we can explore this with a Poisson model using an interaction term)</p></li>
</ol>
</div>
<div id="getting-and-wrangling-your-data" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Getting and Wrangling Your Data<a class="anchor" aria-label="anchor" href="#getting-and-wrangling-your-data"><i class="fas fa-link"></i></a>
</h2>
<p>We are providing datasets for you to use throughout these case studies that have been wrangled and reshaped for your use, and we also provide code to show how you could go through that process on your own. You can look at whole datasets in RStudio using the <code><a href="https://tibble.tidyverse.org/reference/view.html">view()</a></code> command, or look at summaries of the datasets by simply typing the dataset name into the console window. You can skip ahead to the “Approach” section and follow along with the case study without issue.</p>
<div id="running-rstudio-and-setting-up-your-working-directory" class="section level3" number="8.4.1">
<h3>
<span class="header-section-number">8.4.1</span> Running RStudio and Setting Up Your Working Directory<a class="anchor" aria-label="anchor" href="#running-rstudio-and-setting-up-your-working-directory"><i class="fas fa-link"></i></a>
</h3>
<p>Download the Breast Cancer Mortality project folder [<a href="https://hu-my.sharepoint.com/:f:/g/personal/denajavadi_g_harvard_edu/EpyUmRZB-hBGvdygLgRLTmMByYr_lmlP6pqY09f_bz8QBg?e=tDxIIg" class="uri">https://hu-my.sharepoint.com/:f:/g/personal/denajavadi_g_harvard_edu/EpyUmRZB-hBGvdygLgRLTmMByYr_lmlP6pqY09f_bz8QBg?e=tDxIIg</a>] that contains all of the data files and geographic shapefiles as well as maps and figures that we will use for this case study. Save the folder to your Desktop or another easily accessible location on your computer. Note: Do not edit or change any of the file names as our code corresponds to the file names in the folder.</p>
<p>Next, you will need to open RStudio and create a new R Project file to work on the case study. Create a new R Project file by selecting <code>File &gt; New Project…</code> from the menu bar. Select <code>New Directory</code> from the popup window. Next, select <code>New Project</code>. Pick a meaningful name for your project folder, i.e. the <code>Directory Name</code>. Ensure this project folder is created in the right place. You can change the <code>subdirectory</code> by clicking on <code>Browse…</code>. The subdirectory should be the place where the Breast Cancer Mortality folder and files that you just downloaded are saved on your computer. Lastly, tick <code>Open in new session</code>. This will open your R Project in a new RStudio window. Once you are happy with your choices, you can click <code>Create Project</code>. This will open a new R Session, and you can start working on the case study. To make sure all of your project files for the case study are properly loaded and to avoid potential errors when running the code, navigate to your project folder and files in the <code>Files/Plots/Packages/Help</code> window in the bottom-right corner of your RStudio window and go through and double-click each of the file names to open and run all of the files for this project.</p>
</div>
<div id="dependencies-1" class="section level3" number="8.4.2">
<h3>
<span class="header-section-number">8.4.2</span> Dependencies<a class="anchor" aria-label="anchor" href="#dependencies-1"><i class="fas fa-link"></i></a>
</h3>
<p>Run the lines of code below to load the R packages that you will need throughout the case study. If this code does not run for you, you may need to run <code>install.packages(“package_name”)</code>.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Libraries - if this code does not run for you, you may need to run install.package("package_name")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/">tidycensus</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/walkerke/tigris">tigris</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>tigris_use_cache <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/Hmisc/">Hmisc</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jacobkap/fastDummies">fastDummies</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/">lme4</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="health-surveillance-data" class="section level3" number="8.4.3">
<h3>
<span class="header-section-number">8.4.3</span> Health Surveillance Data<a class="anchor" aria-label="anchor" href="#health-surveillance-data"><i class="fas fa-link"></i></a>
</h3>
<p>Data on breast cancer deaths were obtained from the Massachusetts Department of Public Health. Each mortality record included data on the decedent’s age, gender, racialized group (using U.S. census categories), residential address at the time of death and coded cause of death following the International Classification of Diseases 10th Revision (ICD-10). We employed R software and Google Maps API to geocode the residential address of each case to its latitude and longitude, which were used to assign census tract and city/town geocodes.</p>
<p>The mortality data has been aggregated from individual observations into death counts by age, racialized group, census tract, and city/town. When you get unrestricted mortality files from government sources for research, you will likely receive files with one observation per death. After you have geocoded these observations, you will need to aggregate them up to the level of interest for your analysis. This requires aggregation not only up to the census tract level, but also age groups so we can do an appropriate age standardization, sex groups and racialized groups so we can stratify our analyses by these groups, and towns so we can explore a second areal level of analysis.</p>
<p>Below is some code (for example) to turn a raw mortality file into what has been provided to you, by merging census tracts and towns to the data, and then aggregating into groups. The vast majority of our area-based social metrics come from the U.S. Census, so the most detailed level for analysis available will be the census tract (however for this case study, because we are analyzing a health outcome with relatively small numbers of cases, we need to perform our analysis at a larger geography such as city/town instead of census tract to ensure that there are a sufficient number of cases, especially inclusive of different racialized groups, in our units of analysis). We can use the <code>tigris</code> package to download census tract geometries and the sf package to link our geocoded observations to the appropriate census tracts.</p>
<p>Ideally when performing an analysis that might include two or more levels the smaller level (e.g., census tracts) would be nested entirely within the larger level (e.g., towns). In Massachusetts though, there are many towns that have such small populations that they are smaller than census tracts. For these towns, we have created a crosswalk wherein small towns have been combined to create larger super towns. These super towns each make up one census tract, so that each super town in the analysis will now have at least one census tract nested within it. Please note that for this analysis we will be focusing on breast cancer mortality in women, designated as such in the MA cancer registry records.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the raw mortality data, with the geocoded coordinates converted into spatial feature (sf) data</span>
<span class="va">ma_mort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">read_rds</a></span><span class="op">(</span><span class="st">"data/08-breast-cancer-mortality/ma_mort_geo.RDS"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>,<span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4269</span><span class="op">)</span>

<span class="co"># Importing tract shapefile using tigris package</span>
<span class="va">tracts_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tigris/man/tracts.html">tracts</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"25"</span>, year <span class="op">=</span> <span class="st">"2010"</span><span class="op">)</span>

<span class="co"># Linking Census Tracts and Super Towns File</span>
<span class="va">supertowns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/08-breast-cancer-mortality/ma ct to supertinytowns.xlsx"</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span>, col_types <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>GEOID10 <span class="op">=</span> <span class="va">...1</span>,
            super_town <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="va">...2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>super_town <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">GEOID10</span>   <span class="op">==</span> <span class="st">"25023500101"</span> <span class="op">~</span> <span class="st">"hull"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt1"</span>       <span class="op">~</span> <span class="st">"Super Town 1"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt2"</span>       <span class="op">~</span> <span class="st">"Super Town 2"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt3"</span>       <span class="op">~</span> <span class="st">"Super Town 3"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt4"</span>       <span class="op">~</span> <span class="st">"Super Town 4"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt5"</span>       <span class="op">~</span> <span class="st">"Super Town 5"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt6"</span>       <span class="op">~</span> <span class="st">"Super Town 6"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt7"</span>       <span class="op">~</span> <span class="st">"Super Town 7"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt8"</span>       <span class="op">~</span> <span class="st">"Super Town 8"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt9"</span>       <span class="op">~</span> <span class="st">"Super Town 9"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt10"</span>      <span class="op">~</span> <span class="st">"Super Town 10"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt11"</span>      <span class="op">~</span> <span class="st">"Super Town 11"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt12"</span>      <span class="op">~</span> <span class="st">"Super Town 12"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt13"</span>      <span class="op">~</span> <span class="st">"Super Town 13"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt14"</span>      <span class="op">~</span> <span class="st">"Super Town 14"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt15"</span>      <span class="op">~</span> <span class="st">"Super Town 15"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt16"</span>      <span class="op">~</span> <span class="st">"Super Town 16"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt17"</span>      <span class="op">~</span> <span class="st">"Super Town 17"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt18"</span>      <span class="op">~</span> <span class="st">"Super Town 18"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt19"</span>      <span class="op">~</span> <span class="st">"Super Town 19"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt20"</span>      <span class="op">~</span> <span class="st">"Super Town 20"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt21"</span>      <span class="op">~</span> <span class="st">"Super Town 21"</span>,
                                <span class="cn">TRUE</span>                       <span class="op">~</span> <span class="va">super_town</span><span class="op">)</span><span class="op">)</span>



<span class="va">tracts_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">tracts_sf</span>,<span class="va">supertowns</span>, by <span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span>

<span class="co">#Creating a supertown-level map</span>
<span class="va">town_geometry</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"citytown_shp"</span>,
                         layer <span class="op">=</span> <span class="st">"TOWNSSURVEY_POLYM"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>town <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="va">TOWN</span><span class="op">)</span>,
            geometry <span class="op">=</span> <span class="va">geometry</span>,
            super_town <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"charlemont"</span>, <span class="st">"colrain"</span>, <span class="st">"hawley"</span>, <span class="st">"heath"</span>, <span class="st">"monroe"</span>, <span class="st">"rowe"</span><span class="op">)</span>            <span class="op">~</span> <span class="st">"Super Town 1"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cummington"</span>, <span class="st">"middlefield"</span>, <span class="st">"plainfield"</span>, <span class="st">"worthington"</span><span class="op">)</span>                <span class="op">~</span> <span class="st">"Super Town 2"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"monterey"</span>, <span class="st">"tyringham"</span><span class="op">)</span>                                                 <span class="op">~</span> <span class="st">"Super Town 3"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hardwick"</span>, <span class="st">"new braintree"</span><span class="op">)</span>                                             <span class="op">~</span> <span class="st">"Super Town 4"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bernardston"</span>, <span class="st">"gill"</span>, <span class="st">"leyden"</span><span class="op">)</span>                                         <span class="op">~</span> <span class="st">"Super Town 5"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blandford"</span>, <span class="st">"chester"</span>, <span class="st">"granville"</span>, <span class="st">"montgomery"</span>, <span class="st">"russell"</span>, <span class="st">"tolland"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Super Town 6"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sunderland"</span>, <span class="st">"whateley"</span><span class="op">)</span>                                                <span class="op">~</span> <span class="st">"Super Town 7"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"becket"</span>, <span class="st">"washington"</span><span class="op">)</span>                                                  <span class="op">~</span> <span class="st">"Super Town 8"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"holland"</span>, <span class="st">"wales"</span><span class="op">)</span>                                                      <span class="op">~</span> <span class="st">"Super Town 9"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"peru"</span>, <span class="st">"windsor"</span><span class="op">)</span>                                                       <span class="op">~</span> <span class="st">"Super Town 10"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"goshen"</span>, <span class="st">"williamsburg"</span><span class="op">)</span>                                                <span class="op">~</span> <span class="st">"Super Town 11"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hancock"</span>, <span class="st">"new ashford"</span>, <span class="st">"richmond"</span><span class="op">)</span>                                    <span class="op">~</span> <span class="st">"Super Town 12"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"leverett"</span>, <span class="st">"new salem"</span>, <span class="st">"shutesbury"</span><span class="op">)</span>                                   <span class="op">~</span> <span class="st">"Super Town 13"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sandisfield"</span>, <span class="st">"otis"</span><span class="op">)</span>                                                   <span class="op">~</span> <span class="st">"Super Town 14"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"erving"</span>, <span class="st">"warwick"</span>, <span class="st">"wendell"</span><span class="op">)</span>                                          <span class="op">~</span> <span class="st">"Super Town 15"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"buckland"</span>, <span class="st">"shelburne"</span><span class="op">)</span>                                                 <span class="op">~</span> <span class="st">"Super Town 16"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alford"</span>, <span class="st">"egremont"</span>, <span class="st">"mount washington"</span><span class="op">)</span>                                <span class="op">~</span> <span class="st">"Super Town 17"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ashfield"</span>, <span class="st">"conway"</span><span class="op">)</span>                                                    <span class="op">~</span> <span class="st">"Super Town 18"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"aquinnah"</span>, <span class="st">"chilmark"</span>, <span class="st">"gosnold"</span>, <span class="st">"west tisbury"</span><span class="op">)</span>                       <span class="op">~</span> <span class="st">"Super Town 19"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"petersham"</span>, <span class="st">"phillipston"</span><span class="op">)</span>                                              <span class="op">~</span> <span class="st">"Super Town 20"</span>,
                                   <span class="va">town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"florida"</span>, <span class="st">"savoy"</span><span class="op">)</span>                                                      <span class="op">~</span> <span class="st">"Super Town 21"</span>,
                                   <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">town</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">super_town</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_combine</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">super_town</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Merging to geocoded mortality and dropping geometries</span>
<span class="co"># The geometries of a shapefile can be very unweildy and slow data wrangling commands. Since we only need them to map, we will remove them for now</span>
<span class="va">ma_mort_ct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span><span class="va">tracts_sf</span>, <span class="va">ma_mort</span>, left <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">year</span>, <span class="va">date</span>,
         <span class="va">age</span>, <span class="va">sex</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"race"</span><span class="op">)</span>, <span class="va">hisp</span>, <span class="va">immigrant</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"educ"</span><span class="op">)</span>,
         <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"icd10"</span><span class="op">)</span>,
         <span class="va">address</span>, <span class="va">zip</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"geo"</span><span class="op">)</span>, <span class="va">super_town</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"type"</span><span class="op">)</span>, <span class="va">north</span>, <span class="va">south</span>, <span class="va">east</span>, <span class="va">west</span>,
         <span class="va">GEOID10</span><span class="op">)</span>

<span class="co"># Aggregating the data by our selected variables of interest</span>
<span class="co">#Filtering to only breast cancer deaths</span>
<span class="va">ma_mort_bc</span> <span class="op">&lt;-</span> <span class="va">ma_mort_ct</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">icd10</span>, <span class="st">"C50"</span><span class="op">)</span>,
         <span class="va">sex</span> <span class="op">==</span> <span class="st">"Female"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">age</span>,
                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">9</span>,<span class="fl">14</span>,<span class="fl">19</span>,<span class="fl">24</span>,<span class="fl">29</span>,<span class="fl">34</span>,<span class="fl">39</span>,<span class="fl">44</span>,<span class="fl">49</span>,<span class="fl">54</span>,<span class="fl">59</span>,<span class="fl">64</span>,<span class="fl">69</span>,<span class="fl">74</span>,<span class="fl">79</span>,<span class="fl">84</span>,<span class="fl">200</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>,  <span class="st">"5-9"</span>,  <span class="st">"10-14"</span>,<span class="st">"15-19"</span>,<span class="st">"20-24"</span>,
                                  <span class="st">"25-29"</span>,<span class="st">"30-34"</span>,<span class="st">"35-39"</span>,<span class="st">"40-44"</span>,<span class="st">"45-49"</span>,
                                  <span class="st">"50-54"</span>,<span class="st">"55-59"</span>,<span class="st">"60-64"</span>,<span class="st">"65-69"</span>,<span class="st">"70-74"</span>,
                                  <span class="st">"75-79"</span>,<span class="st">"80-84"</span>,<span class="st">"85+"</span><span class="op">)</span><span class="op">)</span>,
         race_group <span class="op">=</span> <span class="va">racegroup</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">race</span>, <span class="va">immigrant</span>, <span class="va">educ_years</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"icd10"</span><span class="op">)</span>,
            <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"address"</span><span class="op">)</span>, <span class="va">zip</span>, <span class="va">geo_town</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"type"</span><span class="op">)</span>,
            <span class="va">north</span>, <span class="va">south</span>, <span class="va">east</span>, <span class="va">west</span>, <span class="va">date</span>, <span class="va">hisp</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>,
           <span class="va">age_cat</span>,
           <span class="va">sex</span>,
           <span class="va">race_group</span>,
           <span class="va">super_town</span>,
           <span class="va">GEOID10</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>deaths <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> 

<span class="va">town_ma_mort_bc</span> <span class="op">&lt;-</span> <span class="va">ma_mort_bc</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">super_town</span>, <span class="va">year</span>, <span class="va">age_cat</span>, <span class="va">sex</span>, <span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   super_town  year age_cat sex    race_group         deaths
##   &lt;chr&gt;      &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt;  &lt;fct&gt;               &lt;int&gt;
## 1 abington    2013 70-74   Female Non-Hispanic White      1
## 2 abington    2014 75-79   Female Non-Hispanic White      1
## 3 abington    2016 40-44   Female Non-Hispanic White      2
## 4 abington    2016 50-54   Female Non-Hispanic White      1
## 5 abington    2016 85+     Female Non-Hispanic White      1
## 6 abington    2017 70-74   Female Non-Hispanic White      1</code></pre>
</div>
<div id="population-denominator-data-and-area-based-social-metric-data" class="section level3" number="8.4.4">
<h3>
<span class="header-section-number">8.4.4</span> Population Denominator Data and Area-Based Social Metric Data<a class="anchor" aria-label="anchor" href="#population-denominator-data-and-area-based-social-metric-data"><i class="fas fa-link"></i></a>
</h3>
<p>We download population data to use as denominators in our rates and area-based social metrics (ABSMs) from the U.S. Census Bureau using the <code>tidycensus</code> package. This requires registering with the U.S. Census for an API key. The key is redacted here, but you can get your own from <a href="https://api.census.gov/data/key_signup.html" class="uri">https://api.census.gov/data/key_signup.html</a>. For this case study, we are using the 2015-2019 American Community Survey (ACS) 5-year estimates counts for our population estimates and for constructing our ABSMs.</p>
<p>The ABSMs we will use for this analysis are the percentage of the population in poverty (for more information on how the Census Bureau measures poverty, see <a href="https://www.census.gov/topics/income-poverty/poverty/guidance/poverty-measures.html" class="uri">https://www.census.gov/topics/income-poverty/poverty/guidance/poverty-measures.html</a>) and the Index of Concentration at the Extremes (ICE) for racialized economic segregation (i.e., race/ethnicity + income), which measures the extent to which an area’s population is concentrated into extremes of deprivation and privilege. The ICE measure for racialized economic segregation is scaled from -1 to 1: a value of -1 means that 100% of the population is concentrated in the most deprived group (in this analysis, conceptualized as the Black non-Hispanic population in low-income households), and a value of 1 means that 100% of the population is concentrated into the most privileged group (in this analysis, conceptualized as the White non-Hispanic population in high-income households). For more information on the formula for the ICE measure and the construction of the specific ICE variables, see Krieger et al., 2016. Both of our area-based social metrics (poverty and racialized economic segregation) are calculated at the city/town level.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Population Denominators</span>
<span class="va">ma_demo_acs_bc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ma_demo_acs_bc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2013</span>,<span class="fl">2014</span>,<span class="fl">2015</span>,<span class="fl">2016</span>,<span class="fl">2017</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">nm</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ma_demo_acs_bc</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ma_demo_acs_bc</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"tract"</span>,
                               <span class="co"># These are the myriad variables that make up the variables we intend to use</span>
                               variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B01001_027"</span>,<span class="st">"B01001_028"</span>,<span class="st">"B01001_029"</span>,
                                             <span class="st">"B01001_030"</span>,<span class="st">"B01001_031"</span>,<span class="st">"B01001_032"</span>,<span class="st">"B01001_033"</span>,
                                             <span class="st">"B01001_034"</span>,<span class="st">"B01001_035"</span>,<span class="st">"B01001_036"</span>,<span class="st">"B01001_037"</span>,
                                             <span class="st">"B01001_038"</span>,<span class="st">"B01001_039"</span>,<span class="st">"B01001_040"</span>,<span class="st">"B01001_041"</span>,
                                             <span class="st">"B01001_042"</span>,<span class="st">"B01001_043"</span>,<span class="st">"B01001_044"</span>,<span class="st">"B01001_045"</span>,
                                             <span class="st">"B01001_046"</span>,<span class="st">"B01001_047"</span>, <span class="st">"B01001_048"</span>,<span class="st">"B01001_049"</span>,
                                             <span class="st">"B01001B_017"</span>,<span class="st">"B01001B_018"</span>,<span class="st">"B01001B_019"</span>,
                                             <span class="st">"B01001B_020"</span>,<span class="st">"B01001B_021"</span>,<span class="st">"B01001B_022"</span>,<span class="st">"B01001B_023"</span>,
                                             <span class="st">"B01001B_024"</span>,<span class="st">"B01001B_025"</span>,<span class="st">"B01001B_026"</span>,<span class="st">"B01001B_027"</span>,
                                             <span class="st">"B01001B_028"</span>,<span class="st">"B01001B_029"</span>,<span class="st">"B01001B_030"</span>,<span class="st">"B01001B_031"</span>,
                                             <span class="st">"B01001C_017"</span>,<span class="st">"B01001C_018"</span>,<span class="st">"B01001C_019"</span>,
                                             <span class="st">"B01001C_020"</span>,<span class="st">"B01001C_021"</span>,<span class="st">"B01001C_022"</span>,<span class="st">"B01001C_023"</span>,
                                             <span class="st">"B01001C_024"</span>,<span class="st">"B01001C_025"</span>,<span class="st">"B01001C_026"</span>,<span class="st">"B01001C_027"</span>,
                                             <span class="st">"B01001C_028"</span>,<span class="st">"B01001C_029"</span>,<span class="st">"B01001C_030"</span>,<span class="st">"B01001C_031"</span>,
                                             <span class="st">"B01001D_017"</span>,<span class="st">"B01001D_018"</span>,<span class="st">"B01001D_019"</span>,
                                             <span class="st">"B01001D_020"</span>,<span class="st">"B01001D_021"</span>,<span class="st">"B01001D_022"</span>,<span class="st">"B01001D_023"</span>,
                                             <span class="st">"B01001D_024"</span>,<span class="st">"B01001D_025"</span>,<span class="st">"B01001D_026"</span>,<span class="st">"B01001D_027"</span>,
                                             <span class="st">"B01001D_028"</span>,<span class="st">"B01001D_029"</span>,<span class="st">"B01001D_030"</span>,<span class="st">"B01001D_031"</span>,
                                             <span class="st">"B01001E_017"</span>,<span class="st">"B01001E_018"</span>,<span class="st">"B01001E_019"</span>,
                                             <span class="st">"B01001E_020"</span>,<span class="st">"B01001E_021"</span>,<span class="st">"B01001E_022"</span>,<span class="st">"B01001E_023"</span>,
                                             <span class="st">"B01001E_024"</span>,<span class="st">"B01001E_025"</span>,<span class="st">"B01001E_026"</span>,<span class="st">"B01001E_027"</span>,
                                             <span class="st">"B01001E_028"</span>,<span class="st">"B01001E_029"</span>,<span class="st">"B01001E_030"</span>,<span class="st">"B01001E_031"</span>,
                                             <span class="st">"B01001H_017"</span>,<span class="st">"B01001H_018"</span>,<span class="st">"B01001H_019"</span>,
                                             <span class="st">"B01001H_020"</span>,<span class="st">"B01001H_021"</span>,<span class="st">"B01001H_022"</span>,<span class="st">"B01001H_023"</span>,
                                             <span class="st">"B01001H_024"</span>,<span class="st">"B01001H_025"</span>,<span class="st">"B01001H_026"</span>,<span class="st">"B01001H_027"</span>,
                                             <span class="st">"B01001H_028"</span>,<span class="st">"B01001H_029"</span>,<span class="st">"B01001H_030"</span>,<span class="st">"B01001H_031"</span>,
                                             <span class="st">"B01001I_017"</span>,<span class="st">"B01001I_018"</span>,<span class="st">"B01001I_019"</span>,
                                             <span class="st">"B01001I_020"</span>,<span class="st">"B01001I_021"</span>,<span class="st">"B01001I_022"</span>,<span class="st">"B01001I_023"</span>,
                                             <span class="st">"B01001I_024"</span>,<span class="st">"B01001I_025"</span>,<span class="st">"B01001I_026"</span>,<span class="st">"B01001I_027"</span>,
                                             <span class="st">"B01001I_028"</span>,<span class="st">"B01001I_029"</span>,<span class="st">"B01001I_030"</span>,<span class="st">"B01001I_031"</span><span class="op">)</span>, 
                               year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>,
                               output <span class="op">=</span> <span class="st">"wide"</span>,
                               state <span class="op">=</span> <span class="st">"MA"</span>,
                               geometry <span class="op">=</span> <span class="cn">FALSE</span>,
                               moe_level <span class="op">=</span> <span class="fl">95</span>,
                               survey <span class="op">=</span> <span class="st">"acs5"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="co"># Here, we will transform those variables into variables that align better with our outcome data</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span>,
           GEOID10 <span class="op">=</span> <span class="va">GEOID</span>,
           <span class="co"># Total Female Age Groups</span>
           `total_00-04` <span class="op">=</span> <span class="va">B01001_027E</span>,
           `total_05-09` <span class="op">=</span> <span class="va">B01001_028E</span>,
           `total_10-14` <span class="op">=</span> <span class="va">B01001_029E</span>,
           `total_15-19` <span class="op">=</span> <span class="va">B01001_030E</span> <span class="op">+</span> <span class="va">B01001_031E</span>,
           `total_20-24` <span class="op">=</span> <span class="va">B01001_032E</span> <span class="op">+</span> <span class="va">B01001_033E</span> <span class="op">+</span> <span class="va">B01001_034E</span>,
           `total_25-29` <span class="op">=</span> <span class="va">B01001_035E</span>,
           `total_30-34` <span class="op">=</span> <span class="va">B01001_036E</span>,
           `total_35-39` <span class="op">=</span> <span class="va">B01001_037E</span>,
           `total_40-44` <span class="op">=</span> <span class="va">B01001_038E</span>,
           `total_45-49` <span class="op">=</span> <span class="va">B01001_039E</span>,
           `total_50-54` <span class="op">=</span> <span class="va">B01001_040E</span>,
           `total_55-59` <span class="op">=</span> <span class="va">B01001_041E</span>,
           `total_60-64` <span class="op">=</span> <span class="va">B01001_042E</span> <span class="op">+</span> <span class="va">B01001_043E</span>,
           `total_65-69` <span class="op">=</span> <span class="va">B01001_044E</span> <span class="op">+</span> <span class="va">B01001_045E</span>,
           `total_70-74` <span class="op">=</span> <span class="va">B01001_046E</span>,
           `total_75-79` <span class="op">=</span> <span class="va">B01001_047E</span>,
           `total_80-84` <span class="op">=</span> <span class="va">B01001_048E</span>,
           `total_85+`   <span class="op">=</span> <span class="va">B01001_049E</span>,
           total_total   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"total"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># Black Female Age Groups</span>
           `black_00-04` <span class="op">=</span> <span class="va">B01001B_018E</span>,
           `black_05-09` <span class="op">=</span> <span class="va">B01001B_019E</span>,
           `black_10-14` <span class="op">=</span> <span class="va">B01001B_020E</span>,
           `black_15-19` <span class="op">=</span> <span class="va">B01001B_021E</span> <span class="op">+</span> <span class="va">B01001B_022E</span>,
           `black_20-24` <span class="op">=</span> <span class="va">B01001B_023E</span>,
           `black_25-29` <span class="op">=</span> <span class="va">B01001B_024E</span>,
           `black_30-34` <span class="op">=</span> <span class="va">B01001B_025E</span>,
           `black_35-44` <span class="op">=</span> <span class="va">B01001B_026E</span>,
           `black_45-54` <span class="op">=</span> <span class="va">B01001B_027E</span>,
           `black_55-64` <span class="op">=</span> <span class="va">B01001B_028E</span>,
           `black_65-74` <span class="op">=</span> <span class="va">B01001B_029E</span>,
           `black_75-84` <span class="op">=</span> <span class="va">B01001B_030E</span>,
           `black_85+` <span class="op">=</span> <span class="va">B01001B_031E</span>,
           black_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"black"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># Native Female Age Groups</span>
           `native_00-04` <span class="op">=</span> <span class="va">B01001C_018E</span>,
           `native_05-09` <span class="op">=</span> <span class="va">B01001C_019E</span>,
           `native_10-14` <span class="op">=</span> <span class="va">B01001C_020E</span>,
           `native_15-19` <span class="op">=</span> <span class="va">B01001C_021E</span> <span class="op">+</span> <span class="va">B01001C_022E</span>,
           `native_20-24` <span class="op">=</span> <span class="va">B01001C_023E</span>,
           `native_25-29` <span class="op">=</span> <span class="va">B01001C_024E</span>,
           `native_30-34` <span class="op">=</span> <span class="va">B01001C_025E</span>,
           `native_35-44` <span class="op">=</span> <span class="va">B01001C_026E</span>,
           `native_45-54` <span class="op">=</span> <span class="va">B01001C_027E</span>,
           `native_55-64` <span class="op">=</span> <span class="va">B01001C_028E</span>,
           `native_65-74` <span class="op">=</span> <span class="va">B01001C_029E</span>,
           `native_75-84` <span class="op">=</span> <span class="va">B01001C_030E</span>,
           `native_85+` <span class="op">=</span> <span class="va">B01001C_031E</span>,
           native_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"native"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># Asian PI Female Age Groups</span>
           `asian_00-04` <span class="op">=</span> <span class="va">B01001D_018E</span>,
           `asian_05-09` <span class="op">=</span> <span class="va">B01001D_019E</span>,
           `asian_10-14` <span class="op">=</span> <span class="va">B01001D_020E</span>,
           `asian_15-19` <span class="op">=</span> <span class="va">B01001D_021E</span> <span class="op">+</span> <span class="va">B01001D_022E</span>,
           `asian_20-24` <span class="op">=</span> <span class="va">B01001D_023E</span>,
           `asian_25-29` <span class="op">=</span> <span class="va">B01001D_024E</span>,
           `asian_30-34` <span class="op">=</span> <span class="va">B01001D_025E</span>,
           `asian_35-44` <span class="op">=</span> <span class="va">B01001D_026E</span>,
           `asian_45-54` <span class="op">=</span> <span class="va">B01001D_027E</span>,
           `asian_55-64` <span class="op">=</span> <span class="va">B01001D_028E</span>,
           `asian_65-74` <span class="op">=</span> <span class="va">B01001D_029E</span>,
           `asian_75-84` <span class="op">=</span> <span class="va">B01001D_030E</span>,
           `asian_85+` <span class="op">=</span> <span class="va">B01001D_031E</span>,
           asian_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"asian"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># White Female Age Groups</span>
           `white_00-04` <span class="op">=</span> <span class="va">B01001H_018E</span>,
           `white_05-09` <span class="op">=</span> <span class="va">B01001H_019E</span>,
           `white_10-14` <span class="op">=</span> <span class="va">B01001H_020E</span>,
           `white_15-19` <span class="op">=</span> <span class="va">B01001H_021E</span> <span class="op">+</span> <span class="va">B01001H_022E</span>,
           `white_20-24` <span class="op">=</span> <span class="va">B01001H_023E</span>,
           `white_25-29` <span class="op">=</span> <span class="va">B01001H_024E</span>,
           `white_30-34` <span class="op">=</span> <span class="va">B01001H_025E</span>,
           `white_35-44` <span class="op">=</span> <span class="va">B01001H_026E</span>,
           `white_45-54` <span class="op">=</span> <span class="va">B01001H_027E</span>,
           `white_55-64` <span class="op">=</span> <span class="va">B01001H_028E</span>,
           `white_65-74` <span class="op">=</span> <span class="va">B01001H_029E</span>,
           `white_75-84` <span class="op">=</span> <span class="va">B01001H_030E</span>,
           `white_85+` <span class="op">=</span> <span class="va">B01001H_031E</span>,
           white_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"white"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># Hispanic Female Age Groups</span>
           `hisp_00-04` <span class="op">=</span> <span class="va">B01001I_018E</span>,
           `hisp_05-09` <span class="op">=</span> <span class="va">B01001I_019E</span>,
           `hisp_10-14` <span class="op">=</span> <span class="va">B01001I_020E</span>,
           `hisp_15-19` <span class="op">=</span> <span class="va">B01001I_021E</span> <span class="op">+</span> <span class="va">B01001I_022E</span>,
           `hisp_20-24` <span class="op">=</span> <span class="va">B01001I_023E</span>,
           `hisp_25-29` <span class="op">=</span> <span class="va">B01001I_024E</span>,
           `hisp_30-34` <span class="op">=</span> <span class="va">B01001I_025E</span>,
           `hisp_35-44` <span class="op">=</span> <span class="va">B01001I_026E</span>,
           `hisp_45-54` <span class="op">=</span> <span class="va">B01001I_027E</span>,
           `hisp_55-64` <span class="op">=</span> <span class="va">B01001I_028E</span>,
           `hisp_65-74` <span class="op">=</span> <span class="va">B01001I_029E</span>,
           `hisp_75-84` <span class="op">=</span> <span class="va">B01001I_030E</span>,
           `hisp_85+` <span class="op">=</span> <span class="va">B01001I_031E</span>,
           hisp_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"hisp"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"B0"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"total"</span><span class="op">)</span>,
                               <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"hisp"</span><span class="op">)</span>,
                               <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"black"</span><span class="op">)</span>,
                               <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"native"</span><span class="op">)</span>,
                               <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"white"</span><span class="op">)</span>,
                               <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"asian"</span><span class="op">)</span><span class="op">)</span>,
                 names_to  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"race_group"</span>, <span class="st">"age_cat"</span><span class="op">)</span>,
                 names_sep <span class="op">=</span> <span class="st">"_"</span>,
                 values_to <span class="op">=</span> <span class="st">"population"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_cat   <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">age_cat</span> <span class="op">==</span> <span class="st">"00-04"</span> <span class="op">~</span> <span class="st">"0-4"</span>,
                                 <span class="va">age_cat</span> <span class="op">==</span> <span class="st">"05-09"</span> <span class="op">~</span> <span class="st">"5-9"</span>,
                                 <span class="va">age_cat</span> <span class="op">==</span> <span class="st">"total"</span> <span class="op">~</span> <span class="st">"Total"</span>,
                                 <span class="cn">TRUE</span>               <span class="op">~</span> <span class="va">age_cat</span><span class="op">)</span>,
           sex       <span class="op">=</span> <span class="st">"Female"</span>,
           race_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="st">"white"</span>  <span class="op">~</span> <span class="st">"Non-Hispanic White"</span>,
                                 <span class="va">race_group</span> <span class="op">==</span> <span class="st">"black"</span>  <span class="op">~</span> <span class="st">"Non-Hispanic Black"</span>,
                                 <span class="va">race_group</span> <span class="op">==</span> <span class="st">"native"</span> <span class="op">~</span> <span class="st">"Non-Hispanic Native American, Alaskan Native, Other"</span>,
                                 <span class="va">race_group</span> <span class="op">==</span> <span class="st">"asian"</span>  <span class="op">~</span> <span class="st">"Non-Hispanic Asian or Pacific Islander"</span>,
                                 <span class="va">race_group</span> <span class="op">==</span> <span class="st">"hisp"</span>   <span class="op">~</span> <span class="st">"Hispanic"</span>,
                                 <span class="va">race_group</span> <span class="op">==</span> <span class="st">"total"</span>  <span class="op">~</span> <span class="st">"Total"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># Combining all 5 years into one dataset</span>
<span class="va">ma_demo_acs_bc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ma_demo_acs_bc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_demo_acs_bc</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_demo_acs_bc</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_demo_acs_bc</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_demo_acs_bc</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">GEOID10</span>, GEO_NAME <span class="op">=</span> <span class="va">NAME</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="va">GEOID</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ma_demo_acs_bc</span>, file <span class="op">=</span> <span class="st">"ma_demo_acs_bc.rds"</span><span class="op">)</span>

<span class="co">#Agreggating to Super Town level</span>
<span class="va">town_ma_demo_acs_bc</span> <span class="op">&lt;-</span> <span class="va">ma_demo_acs_bc</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">supertowns</span> , by <span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">super_town</span>, <span class="va">year</span>, <span class="va">age_cat</span>, <span class="va">sex</span>, <span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   super_town  year age_cat sex    race_group                                          population
##   &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;                                                    &lt;dbl&gt;
## 1 abington    2013 0-4     Female Hispanic                                                    45
## 2 abington    2013 0-4     Female Non-Hispanic Asian or Pacific Islander                       0
## 3 abington    2013 0-4     Female Non-Hispanic Black                                          45
## 4 abington    2013 0-4     Female Non-Hispanic Native American, Alaskan Native, Other          0
## 5 abington    2013 0-4     Female Non-Hispanic White                                         456
## 6 abington    2013 0-4     Female Total                                                      529</code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Area-Based Social Metrics</span>
<span class="va">ma_absm_acs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ma_absm_acs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2013</span>,<span class="fl">2014</span>,<span class="fl">2015</span>,<span class="fl">2016</span>,<span class="fl">2017</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">nm</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ma_absm_acs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ma_absm_acs</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"tract"</span>,
                               variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B01003_001E"</span>,<span class="st">"B02001_001E"</span>,<span class="st">"B02001_002E"</span>,<span class="st">"B02001_003E"</span>,
                                             <span class="st">"B02001_004E"</span>,<span class="st">"B02001_005E"</span>,<span class="st">"B02001_006E"</span>,<span class="st">"B02001_007E"</span>,
                                             <span class="st">"B02001_008E"</span>,<span class="st">"B02001_009E"</span>,<span class="st">"B02001_010E"</span>,<span class="st">"B03001_001E"</span>,
                                             <span class="st">"B03001_003"</span>,<span class="st">"B01001H_001E"</span><span class="op">)</span>, 
                               year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>,
                               output <span class="op">=</span> <span class="st">"wide"</span>,
                               state <span class="op">=</span> <span class="st">"MA"</span>,
                               geometry <span class="op">=</span> <span class="cn">FALSE</span>,
                               moe_level <span class="op">=</span> <span class="fl">95</span>,
                               survey <span class="op">=</span> <span class="st">"acs5"</span>,
                               cache_table <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="co"># Transforming ACS variables into the ABSMs we want to use for our dataset</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>GEOID10 <span class="op">=</span> <span class="va">GEOID</span>,
           percBlack <span class="op">=</span> <span class="va">B02001_003E</span><span class="op">/</span><span class="va">B02001_001E</span>,
           percHisp <span class="op">=</span> <span class="va">B03001_003E</span><span class="op">/</span><span class="va">B03001_001E</span>,
           pop_total <span class="op">=</span> <span class="va">B01003_001E</span>,
           pop_white <span class="op">=</span> <span class="va">B02001_002E</span>,
           pop_black <span class="op">=</span> <span class="va">B02001_003E</span>,
           pop_amind <span class="op">=</span> <span class="va">B02001_004E</span>,
           pop_api <span class="op">=</span> <span class="va">B02001_005E</span> <span class="op">+</span> <span class="va">B02001_006E</span>,
           pop_hisp <span class="op">=</span> <span class="va">B03001_003E</span>,
           pop_wnh <span class="op">=</span> <span class="va">B01001H_001E</span>,
           percColor <span class="op">=</span> <span class="op">(</span><span class="va">B01003_001E</span> <span class="op">-</span> <span class="va">B01001H_001E</span><span class="op">)</span><span class="op">/</span><span class="va">B01003_001E</span>,
           year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">percBlack</span>, <span class="va">percHisp</span>, <span class="va">percColor</span>, <span class="va">pop_total</span>,
           <span class="va">pop_white</span>, <span class="va">pop_black</span>, <span class="va">pop_amind</span>, <span class="va">pop_api</span>,
           <span class="va">pop_hisp</span>, <span class="va">pop_wnh</span>, <span class="va">year</span><span class="op">)</span>
  
  <span class="co"># Downloading tables from the ACS in addition to those variables</span>

    <span class="va">raw.white</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography<span class="op">=</span><span class="st">"tract"</span>, table<span class="op">=</span><span class="st">"B19001A"</span>, state<span class="op">=</span><span class="st">"MA"</span>, year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, 
                         output<span class="op">=</span><span class="st">"wide"</span>, cache_table<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">raw.black</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography<span class="op">=</span><span class="st">"tract"</span>, table<span class="op">=</span><span class="st">"B19001B"</span>, state<span class="op">=</span><span class="st">"MA"</span>, year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, 
                         output<span class="op">=</span><span class="st">"wide"</span>, cache_table<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">raw.all</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography<span class="op">=</span><span class="st">"tract"</span>, table<span class="op">=</span><span class="st">"B19001"</span>,  state<span class="op">=</span><span class="st">"MA"</span>, year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, 
                         output<span class="op">=</span><span class="st">"wide"</span>, cache_table<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">raw.pov</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography<span class="op">=</span><span class="st">"tract"</span>, table<span class="op">=</span><span class="st">"B17001"</span>,  state<span class="op">=</span><span class="st">"MA"</span>, year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, 
                         output<span class="op">=</span><span class="st">"wide"</span>, cache_table<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">raw.crowd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography<span class="op">=</span><span class="st">"tract"</span>, table<span class="op">=</span><span class="st">"B25014"</span>,  state<span class="op">=</span><span class="st">"MA"</span>, year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, 
                         output<span class="op">=</span><span class="st">"wide"</span>, cache_table<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">raw.wnh</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography<span class="op">=</span><span class="st">"tract"</span>, table<span class="op">=</span><span class="st">"B19001H"</span>, state<span class="op">=</span><span class="st">"MA"</span>, year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, 
                         output<span class="op">=</span><span class="st">"wide"</span>, cache_table<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    
    <span class="va">d.merge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">raw.white</span>, <span class="va">raw.black</span>, by<span class="op">=</span><span class="st">"GEOID"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">raw.wnh</span>, by<span class="op">=</span><span class="st">"GEOID"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">raw.all</span>, by<span class="op">=</span><span class="st">"GEOID"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">raw.pov</span>, by<span class="op">=</span><span class="st">"GEOID"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">raw.crowd</span>, by<span class="op">=</span><span class="st">"GEOID"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID"</span>,<span class="st">"B19001_001E"</span>,<span class="st">"B19001_002E"</span>,<span class="st">"B19001_003E"</span>,<span class="st">"B19001_004E"</span>,<span class="st">"B19001_005E"</span>,
               <span class="st">"B19001_014E"</span>,<span class="st">"B19001_015E"</span>,<span class="st">"B19001_016E"</span>,<span class="st">"B19001_017E"</span>,<span class="st">"B19001A_014E"</span>,
               <span class="st">"B19001A_015E"</span>,<span class="st">"B19001A_016E"</span>,<span class="st">"B19001A_017E"</span>,<span class="st">"B19001B_002E"</span>,<span class="st">"B19001B_003E"</span>,
               <span class="st">"B19001B_004E"</span>,<span class="st">"B19001B_005E"</span>,<span class="st">"B19001H_002E"</span>,<span class="st">"B19001H_003E"</span>,<span class="st">"B19001H_004E"</span>,
               <span class="st">"B19001H_005E"</span>,<span class="st">"B19001H_014E"</span>,<span class="st">"B19001H_015E"</span>,<span class="st">"B19001H_016E"</span>,<span class="st">"B19001H_017E"</span>,
               <span class="st">"B17001_001E"</span>,<span class="st">"B17001_002E"</span>,<span class="st">"B25014_001E"</span>, <span class="st">"B25014_005E"</span>,<span class="st">"B25014_006E"</span>,
               <span class="st">"B25014_007E"</span>,<span class="st">"B25014_011E"</span>,<span class="st">"B25014_012E"</span>,<span class="st">"B25014_013E"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ICEwbinc<span class="op">=</span><span class="op">(</span><span class="op">(</span><span class="va">B19001A_014E</span> <span class="op">+</span> <span class="va">B19001A_015E</span> <span class="op">+</span> <span class="va">B19001A_016E</span> <span class="op">+</span> <span class="va">B19001A_017E</span><span class="op">)</span> <span class="op">-</span>
                         <span class="op">(</span><span class="va">B19001B_002E</span> <span class="op">+</span> <span class="va">B19001B_003E</span> <span class="op">+</span> <span class="va">B19001B_004E</span> <span class="op">+</span> <span class="va">B19001B_005E</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">B19001_001E</span>,
             ICEwnhinc<span class="op">=</span><span class="op">(</span><span class="op">(</span><span class="va">B19001H_014E</span> <span class="op">+</span> <span class="va">B19001H_015E</span> <span class="op">+</span> <span class="va">B19001H_016E</span> <span class="op">+</span> <span class="va">B19001H_017E</span><span class="op">)</span> <span class="op">-</span>
                          <span class="op">(</span><span class="va">B19001_002E</span> <span class="op">+</span> <span class="va">B19001_003E</span> <span class="op">+</span> <span class="va">B19001_004E</span> <span class="op">+</span> <span class="va">B19001_005E</span> <span class="op">-</span>
                             <span class="va">B19001H_002E</span> <span class="op">-</span> <span class="va">B19001H_003E</span> <span class="op">-</span> <span class="va">B19001H_004E</span> <span class="op">-</span> <span class="va">B19001H_005E</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">B19001_001E</span>,
             ice_wnh_highinc<span class="op">=</span> <span class="op">(</span><span class="va">B19001H_014E</span> <span class="op">+</span> <span class="va">B19001H_015E</span> <span class="op">+</span> <span class="va">B19001H_016E</span> <span class="op">+</span> <span class="va">B19001H_017E</span><span class="op">)</span><span class="op">/</span><span class="va">B19001_001E</span>,
             ice_poc_lowinc <span class="op">=</span> <span class="op">(</span><span class="va">B19001_002E</span> <span class="op">+</span> <span class="va">B19001_003E</span> <span class="op">+</span> <span class="va">B19001_004E</span> <span class="op">+</span> <span class="va">B19001_005E</span> <span class="op">-</span>
                                 <span class="va">B19001H_002E</span> <span class="op">-</span> <span class="va">B19001H_003E</span> <span class="op">-</span> <span class="va">B19001H_004E</span> <span class="op">-</span> <span class="va">B19001H_005E</span><span class="op">)</span><span class="op">/</span><span class="va">B19001_001E</span>,
             ice_wnh_lowinc <span class="op">=</span> <span class="op">(</span><span class="va">B19001H_002E</span> <span class="op">+</span> <span class="va">B19001H_003E</span> <span class="op">+</span> <span class="va">B19001H_004E</span> <span class="op">+</span> <span class="va">B19001H_005E</span><span class="op">)</span><span class="op">/</span><span class="va">B19001_001E</span>,
             ice_poc_highinc <span class="op">=</span> <span class="op">(</span><span class="va">B19001_014E</span> <span class="op">+</span> <span class="va">B19001_015E</span> <span class="op">+</span> <span class="va">B19001_016E</span> <span class="op">+</span> <span class="va">B19001_017E</span> <span class="op">-</span>
                                  <span class="va">B19001H_014E</span> <span class="op">-</span> <span class="va">B19001H_015E</span> <span class="op">-</span> <span class="va">B19001H_016E</span> <span class="op">-</span> <span class="va">B19001H_017E</span><span class="op">)</span><span class="op">/</span><span class="va">B19001_001E</span>,
             tractPov <span class="op">=</span> <span class="va">B17001_002E</span><span class="op">/</span><span class="va">B17001_001E</span>,
             tractCrowd <span class="op">=</span> <span class="op">(</span><span class="va">B25014_005E</span> <span class="op">+</span> <span class="va">B25014_006E</span> <span class="op">+</span> <span class="va">B25014_007E</span> <span class="op">+</span>
                             <span class="va">B25014_011E</span> <span class="op">+</span> <span class="va">B25014_012E</span> <span class="op">+</span> <span class="va">B25014_013E</span><span class="op">)</span> <span class="op">/</span> <span class="va">B25014_001E</span>,
             tractSevereCrowd <span class="op">=</span> <span class="op">(</span><span class="va">B25014_006E</span> <span class="op">+</span> <span class="va">B25014_007E</span> <span class="op">+</span>
                                   <span class="va">B25014_012E</span> <span class="op">+</span> <span class="va">B25014_013E</span><span class="op">)</span> <span class="op">/</span> <span class="va">B25014_001E</span>,
             year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>GEOID10 <span class="op">=</span> <span class="va">GEOID</span>, <span class="va">ICEwbinc</span>, <span class="va">ICEwnhinc</span>, <span class="va">tractPov</span>, <span class="va">tractCrowd</span>, <span class="va">tractSevereCrowd</span>, <span class="va">year</span>,
            <span class="va">ice_wnh_highinc</span>, <span class="va">ice_wnh_lowinc</span>, <span class="va">ice_poc_lowinc</span>, <span class="va">ice_poc_highinc</span><span class="op">)</span>
    
    <span class="va">ma_absm_acs</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ma_absm_acs</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span>, <span class="va">d.merge</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID"</span>,<span class="st">"year"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">ma_absm_acs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ma_absm_acs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_absm_acs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_absm_acs</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_absm_acs</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_absm_acs</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">GEOID10</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Creating a dataset for visualization and analysis from the weighted ABSM over all 5 years</span>
<span class="va">ma_absm_sum</span> <span class="op">&lt;-</span> <span class="va">ma_absm_acs</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>wt <span class="op">=</span> <span class="va">pop_total</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pop_total</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>percBlack        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">percBlack</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            percHisp         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">percHisp</span>,  wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            percColor        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">percColor</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ICEwbinc         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ICEwbinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ICEwnhinc        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ICEwnhinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            tractPov         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tractPov</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            tractCrowd       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tractCrowd</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            tractSevereCrowd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tractSevereCrowd</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ice_wnh_highinc  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ice_wnh_highinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ice_wnh_lowinc   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ice_wnh_lowinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ice_poc_lowinc   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ice_poc_lowinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ice_poc_highinc  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ice_poc_highinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            pop_total        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pop_total</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pov_cat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="fl">0</span><span class="op">&lt;=</span><span class="va">tractPov</span>  <span class="op">&amp;</span> <span class="va">tractPov</span><span class="op">&lt;</span><span class="fl">0.05</span> <span class="op">~</span> <span class="st">"0-4.9%"</span>,
                                   <span class="fl">0.05</span><span class="op">&lt;=</span><span class="va">tractPov</span> <span class="op">&amp;</span> <span class="va">tractPov</span><span class="op">&lt;</span><span class="fl">0.10</span> <span class="op">~</span> <span class="st">"5-9.9%"</span>,
                                   <span class="fl">0.10</span><span class="op">&lt;=</span><span class="va">tractPov</span> <span class="op">&amp;</span> <span class="va">tractPov</span><span class="op">&lt;</span><span class="fl">0.2</span> <span class="op">~</span> <span class="st">"10-19.9%"</span>,
                                   <span class="fl">0.20</span><span class="op">&lt;=</span><span class="va">tractPov</span> <span class="op">&amp;</span> <span class="va">tractPov</span><span class="op">&lt;=</span><span class="fl">1</span> <span class="op">~</span> <span class="st">"20-100%"</span>,
                                   <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span>, 
                         levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4.9%"</span>,<span class="st">"5-9.9%"</span>,<span class="st">"10-19.9%"</span>,<span class="st">"20-100%"</span><span class="op">)</span><span class="op">)</span>,
         pov_qt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">tractPov</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">tractPov</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                            probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                     na.rm<span class="op">=</span><span class="cn">TRUE</span>, 
                     include.lowest<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
         ICE_qt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">ICEwnhinc</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">ICEwnhinc</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                                probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                        na.rm<span class="op">=</span><span class="cn">TRUE</span>, 
                        include.lowest<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
         perc_Color_qt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">percColor</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">percColor</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                                  probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                          na.rm<span class="op">=</span><span class="cn">TRUE</span>, 
                          include.lowest<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
         perc_BLACK_qt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">percBlack</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">percBlack</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                                  probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                          na.rm<span class="op">=</span><span class="cn">TRUE</span>, 
                          include.lowest<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>

<span class="va">town_ma_absm_sum</span> <span class="op">&lt;-</span> <span class="va">ma_absm_acs</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">supertowns</span> , by <span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">super_town</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>wt <span class="op">=</span> <span class="va">pop_total</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pop_total</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>percBlack        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">percBlack</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            percHisp         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">percHisp</span>,  wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            percColor        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">percColor</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ICEwbinc         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ICEwbinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ICEwnhinc        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ICEwnhinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            tractPov         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tractPov</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            tractCrowd       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tractCrowd</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            tractSevereCrowd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tractSevereCrowd</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ice_wnh_highinc  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ice_wnh_highinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ice_wnh_lowinc   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ice_wnh_lowinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ice_poc_lowinc   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ice_poc_lowinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ice_poc_highinc  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ice_poc_highinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            pop_total        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pop_total</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pov_cat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="fl">0</span><span class="op">&lt;=</span><span class="va">tractPov</span>  <span class="op">&amp;</span> <span class="va">tractPov</span><span class="op">&lt;</span><span class="fl">0.05</span> <span class="op">~</span> <span class="st">"0-4.9%"</span>,
                                   <span class="fl">0.05</span><span class="op">&lt;=</span><span class="va">tractPov</span> <span class="op">&amp;</span> <span class="va">tractPov</span><span class="op">&lt;</span><span class="fl">0.10</span> <span class="op">~</span> <span class="st">"5-9.9%"</span>,
                                   <span class="fl">0.10</span><span class="op">&lt;=</span><span class="va">tractPov</span> <span class="op">&amp;</span> <span class="va">tractPov</span><span class="op">&lt;</span><span class="fl">0.2</span> <span class="op">~</span> <span class="st">"10-19.9%"</span>,
                                   <span class="fl">0.20</span><span class="op">&lt;=</span><span class="va">tractPov</span> <span class="op">&amp;</span> <span class="va">tractPov</span><span class="op">&lt;=</span><span class="fl">1</span> <span class="op">~</span> <span class="st">"20-100%"</span>,
                                   <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span>, 
                         levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4.9%"</span>,<span class="st">"5-9.9%"</span>,<span class="st">"10-19.9%"</span>,<span class="st">"20-100%"</span><span class="op">)</span><span class="op">)</span>,
         pov_qt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">tractPov</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">tractPov</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                            probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                     na.rm<span class="op">=</span><span class="cn">TRUE</span>, 
                     include.lowest<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
         ICE_qt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">ICEwnhinc</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">ICEwnhinc</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                                probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                        na.rm<span class="op">=</span><span class="cn">TRUE</span>, 
                        include.lowest<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
         perc_Color_qt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">percColor</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">percColor</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                                  probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                          na.rm<span class="op">=</span><span class="cn">TRUE</span>, 
                          include.lowest<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
         perc_BLACK_qt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">percBlack</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">percBlack</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                                  probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                          na.rm<span class="op">=</span><span class="cn">TRUE</span>, 
                          include.lowest<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 19
##   super_town percBlack percHisp percColor ICEwbinc ICEwnhinc tractPov tractCrowd tractSevereCrowd
##   &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;            &lt;dbl&gt;
## 1 abington    0.0243     0.0232    0.101     0.378     0.373   0.0384    0.0120          0.00224 
## 2 acton       0.0155     0.0236    0.295     0.465     0.448   0.0307    0.00933         0.00130 
## 3 acushnet    0.000574   0.0331    0.0926    0.309     0.303   0.0546    0.0380          0.00675 
## 4 adams       0.00715    0.0121    0.0379    0.183     0.179   0.104     0.0103          0.00124 
## 5 agawam      0.0155     0.0609    0.117     0.300     0.271   0.0822    0.0126          0.00606 
## 6 amesbury    0.00675    0.0239    0.0668    0.368     0.356   0.0552    0.0111          0.000323
## # … with 10 more variables: ice_wnh_highinc &lt;dbl&gt;, ice_wnh_lowinc &lt;dbl&gt;, ice_poc_lowinc &lt;dbl&gt;,
## #   ice_poc_highinc &lt;dbl&gt;, pop_total &lt;dbl&gt;, pov_cat &lt;fct&gt;, pov_qt &lt;fct&gt;, ICE_qt &lt;fct&gt;, perc_Color_qt &lt;fct&gt;,
## #   perc_BLACK_qt &lt;fct&gt;</code></pre>
</div>
</div>
<div id="approach-1" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Approach<a class="anchor" aria-label="anchor" href="#approach-1"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we have our data, let’s revisit our questions of interest:
1. What is the overall socioeconomic gradient in breast cancer mortality?</p>
<ol start="2" style="list-style-type: decimal">
<li><p>What is the racialized disparity in breast cancer mortality overall?</p></li>
<li><p>How do area-based socioeconomic measures interact with individual-level membership in racialized groups to affect patterns of breast cancer mortality (i.e., interactions between socioeconomic position and racialized groups, not just socioeconomic inequities within racialized groups)?</p></li>
</ol>
<div id="question-1-what-is-the-overall-socioeconomic-gradient-in-breast-cancer-mortality" class="section level3" number="8.5.1">
<h3>
<span class="header-section-number">8.5.1</span> Question 1: What is the overall socioeconomic gradient in breast cancer mortality?<a class="anchor" aria-label="anchor" href="#question-1-what-is-the-overall-socioeconomic-gradient-in-breast-cancer-mortality"><i class="fas fa-link"></i></a>
</h3>
<p>First, let’s just look at the spatial distribution of the area-based socioeconomic measure of poverty that we constructed: the percentage of the city/town population below poverty. Here is a map of the percentage of population below poverty by Massachusetts city/town poverty quantile for years 2013-2017.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ma_poverty_map</span> <span class="op">&lt;-</span> <span class="va">town_ma_absm_sum</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">town_geometry</span>, by<span class="op">=</span> <span class="st">"super_town"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry<span class="op">=</span><span class="va">geometry</span>, 
                        fill<span class="op">=</span><span class="va">pov_qt</span><span class="op">)</span>,
          lwd <span class="op">=</span> <span class="fl">0.1</span>,
          color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Percentage of population below poverty"</span>, <span class="st">"by MA city/town, 2013-2017"</span><span class="op">)</span><span class="op">)</span>,
       caption <span class="op">=</span> <span class="st">"5-year ACS files from end-years 2015-2019"</span>,
       fill <span class="op">=</span> <span class="st">"Poverty quantile"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis labels</span>
        axis.ticks.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis ticks</span>
        axis.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co">#remove y axis labels</span>
        axis.ticks.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"ma_poverty_map.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/08-breast-cancer-mortality/ma_poverty_map.png" width="100%"></div>
<p>Now, let’s look at the spatial distribution of the other area-based socioeconomic measure that we constructed: the ICE measure for racialized economic segregation. Compare this map of city/town ICE (racialized group + income) quantile to the first map of city/town poverty quantile. Do you notice any differences? Do you find one of these area-based socioeconomic measures to be more visually clear and compelling than the other, and why or why not?</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ma_ice_map</span> <span class="op">&lt;-</span> <span class="va">town_ma_absm_sum</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">town_geometry</span>, by<span class="op">=</span> <span class="st">"super_town"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry<span class="op">=</span><span class="va">geometry</span>, 
                        fill<span class="op">=</span><span class="va">ICE_qt</span><span class="op">)</span>,
          lwd <span class="op">=</span> <span class="fl">0.1</span>,
          color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Index of Concentration at the Extremes for Racialized Economic Segregation"</span>, <span class="st">"by MA city/town, 2013-2017"</span><span class="op">)</span><span class="op">)</span>,
       caption <span class="op">=</span> <span class="st">"5-year ACS files from end-years 2015-2019"</span>,
       fill <span class="op">=</span> <span class="st">"ICE quantile"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis labels</span>
        axis.ticks.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis ticks</span>
        axis.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co">#remove y axis labels</span>
        axis.ticks.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"ma_ice_map.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/08-breast-cancer-mortality/ma_ice_map.png" width="100%"></div>
<p>Next, we will look at how breast cancer mortality varies across the ICE measure for racialized economic segregation. Using the 2015-2019 American Community Survey (ACS) 5-year estimates counts, we compute age- and sex-standardized 2013-2017 breast cancer mortality rates (per 1000) for each MA city/town ICE quantile using the direct method. This method will require a reference population, which we have downloaded (and wrangled) from the National Cancer Institute. (<a href="https://seer.cancer.gov/stdpopulations/" class="uri">https://seer.cancer.gov/stdpopulations/</a>).</p>
<pre><code>## # A tibble: 13 × 3
##    age_cat    pop     wt
##    &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1 0-4      69135 0.0691
##  2 10-14    73032 0.0730
##  3 15-19    72169 0.0722
##  4 20-24    66478 0.0665
##  5 25-29    64529 0.0645
##  6 30-34    71044 0.0710
##  7 35-44   162613 0.163 
##  8 45-54   134834 0.135 
##  9 5-9      72533 0.0725
## 10 55-64    87247 0.0872
## 11 65-74    66037 0.0660
## 12 75-84    44841 0.0448
## 13 85+      15508 0.0155</code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ma_mort_ice_qt</span> <span class="op">&lt;-</span> <span class="va">town_ma_mort_bc</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">town_ma_demo_acs_bc</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>,<span class="st">"super_town"</span>,<span class="st">"race_group"</span>,<span class="st">"sex"</span>,<span class="st">"age_cat"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">town_ma_absm_sum</span>, by<span class="op">=</span> <span class="st">"super_town"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ICE_qt</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>den <span class="op">=</span> <span class="va">den</span> <span class="op">+</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">seer_std</span>, by<span class="op">=</span><span class="st">"age_cat"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rate_i <span class="op">=</span> <span class="va">wt</span><span class="op">*</span><span class="va">num</span><span class="op">/</span><span class="va">den</span>,
         var_rate_i <span class="op">=</span> <span class="op">(</span><span class="va">num</span><span class="op">*</span><span class="va">wt</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">den</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ICE_qt</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">num</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">den</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rate_i</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            var_std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">var_rate_i</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            sumwt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">wt</span><span class="op">)</span>,
            sumwt2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">wt</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>std_rate <span class="op">=</span> <span class="va">std_rate</span> <span class="op">/</span> <span class="va">sumwt</span> <span class="op">*</span><span class="fl">1000</span>,
         var_std_rate <span class="op">=</span> <span class="va">var_std_rate</span> <span class="op">/</span> <span class="va">sumwt2</span> <span class="op">*</span><span class="fl">1000</span>,
         std_rate_lo95 <span class="op">=</span> <span class="va">std_rate</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_std_rate</span><span class="op">)</span>,
         std_rate_up95 <span class="op">=</span> <span class="va">std_rate</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">ICE_qt</span>, y<span class="op">=</span><span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, fill <span class="op">=</span> <span class="st">"limegreen"</span>,color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Age-standardized breast cancer mortality rate by MA city/town"</span>,<span class="st">"ICE for racialized group &amp; income quantile, 2013-2017"</span><span class="op">)</span><span class="op">)</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                   <span class="st">"5-year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Breast cancer mortality per 1000"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"ICE quantile"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>


<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"ma_mort_ice_qt.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/08-breast-cancer-mortality/ma_mort_ice_qt.png" width="100%"></div>
<p>We can see a clear socioeconomic gradient in breast cancer mortality rates at the city/town level in Massachusetts for years 2013-2017. How would you interpret this socioeconomic gradient? Is it what you expected, why or why not?</p>
</div>
<div id="question-2-what-is-the-racialized-disparity-in-breast-cancer-mortality-overall" class="section level3" number="8.5.2">
<h3>
<span class="header-section-number">8.5.2</span> Question 2: What is the racialized disparity in breast cancer mortality overall?<a class="anchor" aria-label="anchor" href="#question-2-what-is-the-racialized-disparity-in-breast-cancer-mortality-overall"><i class="fas fa-link"></i></a>
</h3>
<p>We can describe inequities by racialized groups much the same way we describe inequities by ABSMs: by aggregating death and population data. We’ve already got this data aggregated, so we can stratify our analysis to compare Black non-Hispanic and White non-Hispanic populations. Note: Throughout the case study we may refer to these groups as Black and White as a shorthand (see footnote in preface regarding capitalization conventions used throughout the manual).</p>
<p>As we did for the first question, we age-adjust our aggregated data by racialized group to compare standardized mortality rates for Black and White populations. We can see lots of variation here as the mortality rates increase - what is causing that?</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ma_mort_stratified</span> <span class="op">&lt;-</span> <span class="va">town_ma_mort_bc</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">town_ma_demo_acs_bc</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>,<span class="st">"super_town"</span>,<span class="st">"race_group"</span>,<span class="st">"sex"</span>,<span class="st">"age_cat"</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Hispanic White"</span>,<span class="st">"Non-Hispanic Black"</span><span class="op">)</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">super_town</span>, <span class="va">race_group</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>den <span class="op">=</span> <span class="va">den</span> <span class="op">+</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">seer_std</span>, by<span class="op">=</span><span class="st">"age_cat"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rate_i <span class="op">=</span> <span class="va">wt</span><span class="op">*</span><span class="va">num</span><span class="op">/</span><span class="va">den</span>,
         var_rate_i <span class="op">=</span> <span class="op">(</span><span class="va">num</span><span class="op">*</span><span class="va">wt</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">den</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">super_town</span>, <span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">num</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">den</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rate_i</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            var_std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">var_rate_i</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            sumwt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">wt</span><span class="op">)</span>,
            sumwt2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">wt</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>std_rate <span class="op">=</span> <span class="va">std_rate</span> <span class="op">/</span> <span class="va">sumwt</span> <span class="op">*</span><span class="fl">1000</span>,
         var_std_rate <span class="op">=</span> <span class="va">var_std_rate</span> <span class="op">/</span> <span class="va">sumwt2</span> <span class="op">*</span><span class="fl">1000</span>,
         std_rate_lo95 <span class="op">=</span> <span class="va">std_rate</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_std_rate</span><span class="op">)</span>,
         std_rate_up95 <span class="op">=</span> <span class="va">std_rate</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">bc_dotplot_agg_rates</span> <span class="op">&lt;-</span> <span class="va">ma_mort_stratified</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">std_rate</span><span class="op">)</span>,
         <span class="va">den</span> <span class="op">&gt;</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">super_town</span>,<span class="va">race_group</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"std_rate"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">std_rate</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">std_rate_lo95</span>, ymax<span class="op">=</span><span class="va">std_rate_up95</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Age-standardized breast cancer mortality rate"</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                   <span class="st">"5-year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"City/towns"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Mortality rates"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">race_group</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, 
          axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"bc_dotplot_agg_rates.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/08-breast-cancer-mortality/bc_dotplot_agg_rates.png" width="100%"></div>
<p>Before we explore that variation, as a reminder, we age-adjust our aggregated data by racialized group so we can compare standardized mortality rates, as differences in breast cancer mortality between the two groups may be due to differential distribution of ages by racialized group. We can see that the age distributions for each racialized group are quite different. How would you describe the differences?</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bc_tab_age_race</span> <span class="op">&lt;-</span> <span class="va">town_ma_demo_acs_bc</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Hispanic White"</span>,<span class="st">"Non-Hispanic Black"</span><span class="op">)</span>,
         <span class="va">sex</span> <span class="op">==</span> <span class="st">"Female"</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">super_town</span>, <span class="va">race_group</span>, <span class="va">sex</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">town_ma_absm_sum</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"super_town"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_cat_broad <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>,<span class="st">"5-9"</span>,<span class="st">"10-14"</span>,<span class="st">"15-19"</span>,<span class="st">"20-24"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"0-24"</span>,
                                   <span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"25-29"</span>,<span class="st">"30-34"</span>,<span class="st">"35-39"</span>,<span class="st">"35-44"</span>,<span class="st">"40-44"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"25-44"</span>,
                                   <span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"45-49"</span>,<span class="st">"45-54"</span>,<span class="st">"50-54"</span>,<span class="st">"55-59"</span>,<span class="st">"55-64"</span>,<span class="st">"60-64"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"45-64"</span>,
                                   <span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"65-69"</span>,<span class="st">"65-74"</span>,<span class="st">"70-74"</span>,<span class="st">"75-59"</span>,<span class="st">"75-84"</span>,<span class="st">"80-84"</span>,<span class="st">"85+"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"65+"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">race_group</span>, <span class="va">age_cat_broad</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pop</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>percentage <span class="op">=</span> <span class="va">pop</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">race_group</span>, y<span class="op">=</span><span class="va">percentage</span>, fill<span class="op">=</span> <span class="va">age_cat_broad</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position<span class="op">=</span><span class="st">"stack"</span>, stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span><span class="st">"Age distribution by racialized group"</span>,
         fill <span class="op">=</span> <span class="st">"Age category"</span>,
         caption <span class="op">=</span> <span class="st">"5-year ACS files from end-years 2015-2019"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percentage of population"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Racialized group"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>
    
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"bc_tab_age_race.png"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"images/08-breast-cancer-mortality/bc_tab_age_race.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/08-breast-cancer-mortality/bc_tab_age_race.png" width="100%"></div>
<p>Now, to return to this question of why we see lots of variation in mortality rates. As we might expect, these extremely variable mortality rates are occurring in small populations. What do these maps look like?</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plotlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">plotlist</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Hispanic White"</span>,<span class="st">"Non-Hispanic Black"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">plt</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">plotlist</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">map.state</span> <span class="op">&lt;-</span> <span class="va">ma_mort_stratified</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="va">plt</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">std_rate</span> <span class="op">&gt;</span> <span class="fl">10</span>, <span class="fl">10</span>, <span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">town_geometry</span>, by<span class="op">=</span> <span class="st">"super_town"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                            fill <span class="op">=</span> <span class="va">std_rate</span><span class="op">)</span>,
              lwd <span class="op">=</span> <span class="fl">0.1</span>,
              color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">plt</span>,
           fill <span class="op">=</span> <span class="st">"Age Standardized Mortality Rate"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis labels</span>
            axis.ticks.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis ticks</span>
            axis.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co">#remove y axis labels</span>
            axis.ticks.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
            legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
            legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">map.boston</span> <span class="op">&lt;-</span> <span class="va">ma_mort_stratified</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="va">plt</span>,
           <span class="va">super_town</span> <span class="op">==</span> <span class="st">"boston"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">std_rate</span> <span class="op">&gt;</span> <span class="fl">10</span>, <span class="fl">10</span>, <span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">town_geometry</span>, by<span class="op">=</span> <span class="st">"super_town"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                            fill <span class="op">=</span> <span class="va">std_rate</span><span class="op">)</span>,
              lwd <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boston"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
            legend.position <span class="op">=</span> <span class="st">"None"</span>,
            plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> 
  
  <span class="va">plotlist</span><span class="op">[[</span><span class="va">plt</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.state</span> , x <span class="op">=</span> <span class="fl">0.00</span>, y <span class="op">=</span> <span class="fl">0.00</span>, width <span class="op">=</span> <span class="fl">0.80</span>, height <span class="op">=</span> <span class="fl">1.00</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.boston</span>, x <span class="op">=</span> <span class="fl">0.65</span>, y <span class="op">=</span> <span class="fl">0.50</span>, width <span class="op">=</span> <span class="fl">0.30</span>, height <span class="op">=</span> <span class="fl">0.30</span><span class="op">)</span>
  
<span class="op">}</span>

<span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_label.html">draw_label</a></span><span class="op">(</span><span class="st">"Age-standardized breast cancer mortality rates"</span>, size <span class="op">=</span> <span class="fl">12</span>, fontface<span class="op">=</span><span class="st">'bold'</span>, hjust <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="va">caption1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_label.html">draw_label</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, size <span class="op">=</span> <span class="fl">8</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> 
<span class="va">caption2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_label.html">draw_label</a></span><span class="op">(</span><span class="st">"5-year ACS files from end-years 2015-2019"</span>, size <span class="op">=</span> <span class="fl">8</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> 
<span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">plotlist</span>,
                  ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">bc_byrace_std_rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">title</span>, <span class="va">plots</span>, <span class="va">caption1</span>, <span class="va">caption2</span>,
          rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">1.0</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span><span class="op">)</span>,
          ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>


<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"bc_byrace_std_rates.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/08-breast-cancer-mortality/bc_byrace_std_rates.png" width="100%"></div>
<p>We are seeing some really extreme rates in the Black population, where we have smaller overall sample sizes. We are also seeing many cities and towns with no recorded breast cancer deaths for both Black and White populations, but this is particularly the case for the Black population (it is likely that these are cities and towns with very small or no resident Black populations due to racialized economic segregation). What else do you observe?</p>
<p>We can also display these two maps as one, by calculating the rate difference, or the rate ratio. We will calculate and display the incidence rate ratio comparing the age-standardized mortality rates for the Black non-Hispanic and White non-Hispanic populations, as we visualized at the start of this section.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">irr_data</span> <span class="op">&lt;-</span> <span class="va">ma_mort_stratified</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">super_town</span>,<span class="va">race_group</span>, <span class="va">std_rate</span>, <span class="va">var_std_rate</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">super_town</span>,
              names_from <span class="op">=</span> <span class="va">race_group</span>,
              values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">std_rate</span>, <span class="va">var_std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>irr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">`std_rate_Non-Hispanic White`</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">NA_real_</span>, <span class="va">`std_rate_Non-Hispanic Black`</span> <span class="op">/</span> <span class="va">`std_rate_Non-Hispanic White`</span><span class="op">)</span>,
         irr_var <span class="op">=</span> <span class="va">`var_std_rate_Non-Hispanic Black`</span> <span class="op">+</span> <span class="va">`var_std_rate_Non-Hispanic White`</span>,
         irr_lo95 <span class="op">=</span> <span class="va">irr</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">irr_var</span><span class="op">)</span>,
         irr_up95 <span class="op">=</span> <span class="va">irr</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">irr_var</span><span class="op">)</span><span class="op">)</span> 

<span class="va">irr_plot</span> <span class="op">&lt;-</span> <span class="va">irr_data</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">irr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">irr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="va">irr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">irr_lo95</span>, ymax<span class="op">=</span><span class="va">irr_up95</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Incidence Rate Ratio Comparing Non-Hispanic Black"</span>, 
                                 <span class="st">"and Non Hispanic White Populations"</span><span class="op">)</span><span class="op">)</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>,
                                   <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Census Tracts"</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Incidence Rate Ratio"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> 
  
<span class="va">irr_plot</span></code></pre></div>
<p>We can also map this like the other maps.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map.irr.bc</span> <span class="op">&lt;-</span> <span class="va">irr_data</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>irr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">irr</span> <span class="op">&gt;</span> <span class="fl">4</span>  <span class="op">~</span> <span class="fl">4</span>,
                         <span class="cn">TRUE</span>     <span class="op">~</span> <span class="va">irr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">town_geometry</span>, by<span class="op">=</span> <span class="st">"super_town"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="va">irr</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span>,
                     trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                     breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>,
                     na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Incidence Rate Ratio Comparing Non-Hispanic Black"</span>, 
                                 <span class="st">"and Non Hispanic White Populations"</span><span class="op">)</span><span class="op">)</span>,
       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                 <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span>,
       fill <span class="op">=</span> <span class="st">"IRR"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
          legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,
          plot.subtitle   <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>

<span class="va">map.boston.irr</span> <span class="op">&lt;-</span> <span class="va">irr_data</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">super_town</span> <span class="op">==</span> <span class="st">"boston"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>irr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">irr</span> <span class="op">&gt;</span> <span class="fl">4</span>  <span class="op">~</span> <span class="fl">4</span>,
                         <span class="va">irr</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">0.0000001</span>,
                         <span class="cn">TRUE</span>     <span class="op">~</span> <span class="va">irr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">town_geometry</span>, by<span class="op">=</span> <span class="st">"super_town"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="va">irr</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span>,
                     trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                     breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>,
                     na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boston"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="st">"None"</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> 

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"map.irr.bc.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/08-breast-cancer-mortality/map.irr.bc.png" width="100%"></div>
<p>Note that the boundaries for some cities and towns are completely blank. These areas did not have any recorded breast cancer deaths for Black or White women so they don’t get visualized because there is literally no data. Cities and towns that are visualized, but are white or “empty,” only have data for White women. Again, we see that only a handful of cities and towns recorded breast cancer deaths for Black women, so these cities and towns get visualized as white or “empty” because an IRR can’t be calculated. Key is understanding that these rates are influenced by the small sample sizes and large potential errors we have previously visualized. It’s for researchers and communities to interpret how “real” the effects we see are.</p>
</div>
<div id="question-3-how-do-area-based-socioeconomic-measures-interact-with-individual-level-membership-in-racialized-groups-to-affect-patterns-of-breast-cancer-mortality-i.e.-interactions-between-socioeconomic-position-and-racialized-groups-not-just-socioeconomic-inequities-within-racialized-groups" class="section level3" number="8.5.3">
<h3>
<span class="header-section-number">8.5.3</span> Question 3: How do area-based socioeconomic measures interact with individual-level membership in racialized groups to affect patterns of breast cancer mortality (i.e., interactions between socioeconomic position and racialized groups, not just socioeconomic inequities within racialized groups)?<a class="anchor" aria-label="anchor" href="#question-3-how-do-area-based-socioeconomic-measures-interact-with-individual-level-membership-in-racialized-groups-to-affect-patterns-of-breast-cancer-mortality-i.e.-interactions-between-socioeconomic-position-and-racialized-groups-not-just-socioeconomic-inequities-within-racialized-groups"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">poisson_data</span> <span class="op">&lt;-</span> <span class="va">town_ma_mort_bc</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">town_ma_demo_acs_bc</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>,<span class="st">"super_town"</span>,<span class="st">"race_group"</span>,<span class="st">"sex"</span>,<span class="st">"age_cat"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Hispanic White"</span>,<span class="st">"Non-Hispanic Black"</span><span class="op">)</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">super_town</span>, <span class="va">race_group</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>den <span class="op">=</span> <span class="va">den</span> <span class="op">+</span> <span class="fl">0.001</span>,
         race_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">race_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">town_ma_absm_sum</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"super_town"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu">fastDummies</span><span class="fu">::</span><span class="fu"><a href="https://jacobkap.github.io/fastDummies/reference/dummy_cols.html">dummy_cols</a></span><span class="op">(</span>select_columns<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pov_cat"</span>, <span class="st">"ICE_qt"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>pov_cat_1 <span class="op">=</span> <span class="st">"pov_cat_0-4.9%"</span>,
         pov_cat_2 <span class="op">=</span> <span class="st">"pov_cat_5-9.9%"</span>,
         pov_cat_3 <span class="op">=</span> <span class="st">"pov_cat_10-19.9%"</span>,
         pov_cat_4 <span class="op">=</span> <span class="st">"pov_cat_20-100%"</span>,
         ICE_qt_1 <span class="op">=</span> <span class="st">"ICE_qt_[-0.272,0.0426]"</span>,
         ICE_qt_2 <span class="op">=</span> <span class="st">"ICE_qt_(0.0426,0.237]"</span> , 
         ICE_qt_3 <span class="op">=</span> <span class="st">"ICE_qt_(0.237,0.337]"</span> ,  
         ICE_qt_4 <span class="op">=</span> <span class="st">"ICE_qt_(0.337,0.45]"</span> ,  
         ICE_qt_5 <span class="op">=</span> <span class="st">"ICE_qt_(0.45,0.687]"</span><span class="op">)</span> 

<span class="co"># Null poisson model</span>
<span class="va">model0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">num</span> <span class="op">~</span> <span class="va">race_group</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">den</span><span class="op">)</span><span class="op">)</span>,
                        family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="va">log</span><span class="op">)</span>,
                        data<span class="op">=</span><span class="va">poisson_data</span><span class="op">)</span>

<span class="va">summary.model0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">summary.model0</span>, file <span class="op">=</span> <span class="st">"poisson0_bc.rds"</span><span class="op">)</span>


<span class="va">poisson_data</span><span class="op">$</span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>

<span class="va">poisson_irr</span> <span class="op">&lt;-</span> <span class="va">poisson_data</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">super_town</span>, <span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">fit</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">den</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fit_rate <span class="op">=</span> <span class="va">num</span><span class="op">/</span><span class="va">den</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">super_town</span>,
              names_from <span class="op">=</span> <span class="va">race_group</span>,
              values_from <span class="op">=</span> <span class="va">fit_rate</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fit_irr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">`Non-Hispanic White`</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">NA_real_</span>, <span class="va">`Non-Hispanic Black`</span> <span class="op">/</span> <span class="va">`Non-Hispanic White`</span><span class="op">)</span><span class="op">)</span>

<span class="va">poisson_irr_plot</span> <span class="op">&lt;-</span> <span class="va">poisson_irr</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">fit_irr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="va">fit_irr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Incidence Rate Ratio Comparing Non-Hispanic Black"</span>, 
                                 <span class="st">"and Non Hispanic White Populations"</span><span class="op">)</span><span class="op">)</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>,
                                   <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Census Tracts"</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"IRR"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> 

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"poisson_irr_plot_bc.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/08-breast-cancer-mortality/poisson_irr_plot_bc.png" width="100%"></div>
<p>And of course, now we can map that value as well.</p>
<div class="inline-figure"><img src="images/08-breast-cancer-mortality/map.p.irr_bc.png" width="100%"></div>
<p>An adjusted model would allow for us to see how poverty rates are impacting the incidence rate ratio.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Adjusted Poisson Model</span>
<span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">num</span> <span class="op">~</span> <span class="va">race_group</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">race_group</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">pov_cat</span>, exclude <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">den</span><span class="op">)</span><span class="op">)</span>,
                        family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="va">log</span><span class="op">)</span>,
                        data<span class="op">=</span><span class="va">poisson_data</span><span class="op">)</span>

<span class="va">summary.model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">summary.model1</span>, file <span class="op">=</span> <span class="st">"poisson1_bc.rds"</span><span class="op">)</span>

<span class="va">poisson_data</span><span class="op">$</span><span class="va">adj_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>adj_fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>

<span class="va">adj_poisson_irr</span> <span class="op">&lt;-</span> <span class="va">poisson_data</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">super_town</span>, <span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">adj_fit</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">den</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>adj_fit_rate <span class="op">=</span> <span class="va">num</span><span class="op">/</span><span class="va">den</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">super_town</span>,
              names_from <span class="op">=</span> <span class="va">race_group</span>,
              values_from <span class="op">=</span> <span class="va">adj_fit_rate</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>adj_fit_irr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">`Non-Hispanic White`</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">NA_real_</span>, <span class="va">`Non-Hispanic Black`</span> <span class="op">/</span> <span class="va">`Non-Hispanic White`</span><span class="op">)</span><span class="op">)</span>

<span class="va">adj_poisson_irr_plot</span> <span class="op">&lt;-</span> <span class="va">adj_poisson_irr</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">adj_fit_irr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="va">adj_fit_irr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Poverty Adjusted Incidence Rate Ratio"</span>, 
                                 <span class="st">"Comparing Non-Hispanic Black and Non Hispanic White Populations"</span><span class="op">)</span><span class="op">)</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>,
                                   <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Census Tracts"</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"IRR"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> 

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"adj_poisson_irr_plot_bc.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/08-breast-cancer-mortality/adj_poisson_irr_plot_bc.png" width="100%"></div>
<p>And now the map.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adj_map.state.p.irr</span> <span class="op">&lt;-</span> <span class="va">adj_poisson_irr</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>adj_fit_irr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">adj_fit_irr</span> <span class="op">&gt;</span> <span class="fl">4</span>  <span class="op">~</span> <span class="fl">4</span>,
                         <span class="cn">TRUE</span>     <span class="op">~</span> <span class="va">adj_fit_irr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">town_geometry</span>, by<span class="op">=</span> <span class="st">"super_town"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="va">adj_fit_irr</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span>,
                     trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                     breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>,
                     na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Poverty Adjusted Incidence Rate Ratio"</span>, 
                                 <span class="st">"Comparing Non-Hispanic Black and Non Hispanic White Populations"</span><span class="op">)</span><span class="op">)</span>,
       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                 <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span>,
       fill <span class="op">=</span> <span class="st">"IRR"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
          legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,
          plot.subtitle   <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"adj_map.p.irr_bc.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/08-breast-cancer-mortality/adj_map.p.irr_bc.png" width="100%"></div>
<p>To understand statistically how city/town poverty level is impacting the relationship between racialized groups and breast cancer mortality, we can compare the models with and without poverty. We can see the impact of social membership in racialized group is reduced with the presence of the city/town level poverty.</p>
<pre><code>## 
## Call:
## glm(formula = num ~ race_group + factor(age_cat) + offset(log(den)), 
##     family = poisson(link = log), data = poisson_data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.4188  -0.0709   0.7356   1.3605   7.0549  
## 
## Coefficients:
##                              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                   -6.1048     1.0000  -6.105 1.03e-09 ***
## race_groupNon-Hispanic Black   0.3307     0.1640   2.016   0.0438 *  
## factor(age_cat)25-29          -2.7375     1.0541  -2.597   0.0094 ** 
## factor(age_cat)30-34          -1.2184     1.0240  -1.190   0.2341    
## factor(age_cat)85+             0.2629     1.0006   0.263   0.7928    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 962.55  on 250  degrees of freedom
## Residual deviance: 649.01  on 246  degrees of freedom
## AIC: 1360.4
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<pre><code>## 
## Call:
## glm(formula = num ~ race_group + factor(age_cat) + (race_group * 
##     factor(pov_cat, exclude = NULL)) + offset(log(den)), family = poisson(link = log), 
##     data = poisson_data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -4.5916  -0.2185   0.4568   1.2308   7.0101  
## 
## Coefficients:
##                                                                      Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                                                          -6.00791    1.00397  -5.984 2.17e-09 ***
## race_groupNon-Hispanic Black                                          3.60000    0.74960   4.803 1.57e-06 ***
## factor(age_cat)25-29                                                 -2.21154    1.05829  -2.090 0.036641 *  
## factor(age_cat)30-34                                                 -1.13313    1.02978  -1.100 0.271174    
## factor(age_cat)85+                                                    0.42021    1.00158   0.420 0.674820    
## factor(pov_cat, exclude = NULL)5-9.9%                                -0.09688    0.08916  -1.087 0.277233    
## factor(pov_cat, exclude = NULL)10-19.9%                              -0.36987    0.10031  -3.687 0.000227 ***
## factor(pov_cat, exclude = NULL)20-100%                               -0.67203    0.11095  -6.057 1.39e-09 ***
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)5-9.9%    2.64245    0.84169   3.139 0.001692 ** 
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)10-19.9% -2.01362    0.80967  -2.487 0.012884 *  
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)20-100%  -3.30795    0.77136  -4.288 1.80e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 962.55  on 250  degrees of freedom
## Residual deviance: 505.50  on 240  degrees of freedom
## AIC: 1228.9
## 
## Number of Fisher Scoring iterations: 10</code></pre>
</div>
<div id="references-2" class="section level3" number="8.5.4">
<h3>
<span class="header-section-number">8.5.4</span> References<a class="anchor" aria-label="anchor" href="#references-2"><i class="fas fa-link"></i></a>
</h3>
<p>Breast Cancer Research Foundation. (2022). Black women and breast cancer: Why disparities persist and how to end them. <a href="https://www.bcrf.org/blog/black-women-and-breast-cancer-why-disparities-persist-and-how-end-them/" class="uri">https://www.bcrf.org/blog/black-women-and-breast-cancer-why-disparities-persist-and-how-end-them/</a>; accessed June 14, 2022.</p>
<p>Friedman D, Hunter E, Parrish R (eds). (2005). Health statistics. New York: Oxford University Press.</p>
<p>Hetzel AM. (1997). History and organization of vital statistics systems. Bethesda, MA: National Center for Health Statistics. <a href="https://www.cdc.gov/nchs/data/misc/usvss.pdf" class="uri">https://www.cdc.gov/nchs/data/misc/usvss.pdf</a>; accessed June 14, 2022.</p>
<p>Krieger N. (2019). The US Census and the People’s Health: Public Health Engagement From Enslavement and “Indians Not Taxed” to Census Tracts and Health Equity (1790-2018). Am J Public Health. 2019 Aug;109(8):1092-1100. doi: 10.2105/AJPH.2019.305017. Epub 2019 Jun 20.</p>
<p>Krieger N, Singh, N, Waterman, PD. (2016). Metrics for monitoring cancer inequities: residential segregation, the Index of Concentration at the Extremes (ICE), and breast cancer estrogen receptor status (USA, 1992-2012). Cancer Causes Control. 2016 Sep;27(9):1139-51. doi: 10.1007/s10552-016-0793-7. Epub 2016 Aug 8.</p>
<p>US Office of Management and Budget. Revisions to the Standards for the Classification of Federal Data on Race and Ethnicity. Federal Register 1997; 62(210):58782-58790. <a href="https://www.govinfo.gov/content/pkg/FR-1997-10-30/pdf/97-28653.pdf" class="uri">https://www.govinfo.gov/content/pkg/FR-1997-10-30/pdf/97-28653.pdf</a>; accessed June 14, 2022.</p>
<p>Williams DR, Collins C. (2001). Racial residential segregation: a fundamental cause of racial disparities in health. Public Health Rep. Sep-Oct 2001;116(5):404-16. doi: 10.1093/phr/116.5.404.</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="premature-mortality.html"><span class="header-section-number">7</span> Case Study 1: Premature Mortality in Massachusetts (2013 - 2017)</a></div>
<div class="next"><a href="cook-county-covid.html"><span class="header-section-number">9</span> Case Study 3: COVID-19 Mortality in Cook County (March 2020 - March 2022)</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#breast-cancer-mortality"><span class="header-section-number">8</span> Case Study 2: Breast Cancer Mortality in Massachusetts</a></li>
<li><a class="nav-link" href="#overview"><span class="header-section-number">8.1</span> Overview</a></li>
<li><a class="nav-link" href="#background-and-significance"><span class="header-section-number">8.2</span> Background and Significance</a></li>
<li><a class="nav-link" href="#motivation-research-questions-and-learning-objectives-1"><span class="header-section-number">8.3</span> Motivation, Research Questions, and Learning Objectives</a></li>
<li>
<a class="nav-link" href="#getting-and-wrangling-your-data"><span class="header-section-number">8.4</span> Getting and Wrangling Your Data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#running-rstudio-and-setting-up-your-working-directory"><span class="header-section-number">8.4.1</span> Running RStudio and Setting Up Your Working Directory</a></li>
<li><a class="nav-link" href="#dependencies-1"><span class="header-section-number">8.4.2</span> Dependencies</a></li>
<li><a class="nav-link" href="#health-surveillance-data"><span class="header-section-number">8.4.3</span> Health Surveillance Data</a></li>
<li><a class="nav-link" href="#population-denominator-data-and-area-based-social-metric-data"><span class="header-section-number">8.4.4</span> Population Denominator Data and Area-Based Social Metric Data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#approach-1"><span class="header-section-number">8.5</span> Approach</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#question-1-what-is-the-overall-socioeconomic-gradient-in-breast-cancer-mortality"><span class="header-section-number">8.5.1</span> Question 1: What is the overall socioeconomic gradient in breast cancer mortality?</a></li>
<li><a class="nav-link" href="#question-2-what-is-the-racialized-disparity-in-breast-cancer-mortality-overall"><span class="header-section-number">8.5.2</span> Question 2: What is the racialized disparity in breast cancer mortality overall?</a></li>
<li><a class="nav-link" href="#question-3-how-do-area-based-socioeconomic-measures-interact-with-individual-level-membership-in-racialized-groups-to-affect-patterns-of-breast-cancer-mortality-i.e.-interactions-between-socioeconomic-position-and-racialized-groups-not-just-socioeconomic-inequities-within-racialized-groups"><span class="header-section-number">8.5.3</span> Question 3: How do area-based socioeconomic measures interact with individual-level membership in racialized groups to affect patterns of breast cancer mortality (i.e., interactions between socioeconomic position and racialized groups, not just socioeconomic inequities within racialized groups)?</a></li>
<li><a class="nav-link" href="#references-2"><span class="header-section-number">8.5.4</span> References</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Public Health Disparities Geocoding Project 2.0 Training Manual</strong>" was written by Christian Testa, Jarvis T Chen, Enjoli Hall, Dena Javadi, Justin Morgan, Tamara Rushovich, Sudipta Saha, Pamela D Waterman, Nancy Krieger. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
