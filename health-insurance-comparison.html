<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>10 Case Study 5: Case Study Comparing County Analyses of Inequities in Health Insurance using ACS vs. CDC PLACES data (2019) | Public Health Disparities Geocoding Project 2.0 Training Manual</title>
<meta name="author" content="Christian Testa, Jarvis T Chen, Enjoli Hall, Dena Javadi, Justin Morgan, Tamara Rushovich, Sudipta (Shu) Saha, Pamela D Waterman, Nancy Krieger">
<meta name="description" content="10.1 Introduction The CDC PLACES dataset and American Community Survey (ACS) represent two distinct approaches to collecting and reporting on small area level data: the CDC PLACES uses a method...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="10 Case Study 5: Case Study Comparing County Analyses of Inequities in Health Insurance using ACS vs. CDC PLACES data (2019) | Public Health Disparities Geocoding Project 2.0 Training Manual">
<meta property="og:type" content="book">
<meta property="og:description" content="10.1 Introduction The CDC PLACES dataset and American Community Survey (ACS) represent two distinct approaches to collecting and reporting on small area level data: the CDC PLACES uses a method...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="10 Case Study 5: Case Study Comparing County Analyses of Inequities in Health Insurance using ACS vs. CDC PLACES data (2019) | Public Health Disparities Geocoding Project 2.0 Training Manual">
<meta name="twitter:description" content="10.1 Introduction The CDC PLACES dataset and American Community Survey (ACS) represent two distinct approaches to collecting and reporting on small area level data: the CDC PLACES uses a method...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="libs/HomeButton-0.0.1/home-button.js"></script><script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script><script src="libs/clipboard-0.0.1/setClipboardText.js"></script><link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-YD7D8SMHNP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-YD7D8SMHNP');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Public Health Disparities Geocoding Project 2.0 Training Manual</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Public Health Disparities Geocoding Project 2.0 Training Manual</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="background.html"><span class="header-section-number">1</span> Background and History of Analytic Methods</a></li>
<li><a class="" href="getting-setup.html"><span class="header-section-number">2</span> Getting Setup with R and RStudio</a></li>
<li><a class="" href="getting-your-data.html"><span class="header-section-number">3</span> Getting your data</a></li>
<li><a class="" href="visualizing-your-data.html"><span class="header-section-number">4</span> Visualizing your data</a></li>
<li><a class="" href="analyzing-your-data.html"><span class="header-section-number">5</span> Analyzing your data</a></li>
<li><a class="" href="premature-mortality.html"><span class="header-section-number">6</span> Case Study 1: Premature Mortality in Massachusetts</a></li>
<li><a class="" href="breast-cancer-mortality.html"><span class="header-section-number">7</span> Case Study 2: Breast Cancer Mortality in Massachusetts</a></li>
<li><a class="" href="cook-county-covid.html"><span class="header-section-number">8</span> Case Study 3: COVID-19 Mortality in Cook County (March 2020 - March 2022)</a></li>
<li><a class="" href="temporal-health-insurance.html"><span class="header-section-number">9</span> Case Study 4: Case Study on Temporal Trends using American Community Survey (ACS) data (2012-2019)</a></li>
<li><a class="active" href="health-insurance-comparison.html"><span class="header-section-number">10</span> Case Study 5: Case Study Comparing County Analyses of Inequities in Health Insurance using ACS vs. CDC PLACES data (2019)</a></li>
<li><a class="" href="conclusions.html"><span class="header-section-number">11</span> Conclusions</a></li>
<li><a class="" href="glossary.html"><span class="header-section-number">12</span> Glossary</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="health-insurance-comparison" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Case Study 5: Case Study Comparing County Analyses of Inequities in Health Insurance using ACS vs. CDC PLACES data (2019)<a class="anchor" aria-label="anchor" href="#health-insurance-comparison"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-3" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-3"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="https://www.cdc.gov/places/">CDC PLACES</a> dataset and <a href="https://www.census.gov/data/developers/data-sets/acs-5year.html">American Community Survey (ACS)</a>
represent two distinct approaches to collecting and reporting on small area
level data: the CDC PLACES uses a method called small area estimation (SAE)
to produce estimates at the Census tract level, while the ACS provides survey
based estimates directly at the Census tract level.</p>
<p>The <a href="https://www.cdc.gov/places/methodology/index.html">methodology page from CDC PLACES</a> provides
further explanation as to exactly how they implemented SAE.</p>
<p>In their article <a href="http://aje.oxfordjournals.org/content/179/8/1025.full.pdf?cited-by=yes&amp;legid=amjepid;179/8/1025"><em>Multilevel Regression and Postratification for Small-Area Estimation of Population Health Outcomes: A Case Study of Chronic Obstructive Pulmonary Disease Prevalence Using the Behavioral Risk Factor Surveillance System</em></a>, Zhang et al. describe how SAE was performed to estimate<br>
chronic obstructive pulmonary disease (COPD) in CDC PLACES.</p>
</div>
<div id="motivation-research-questions-and-learning-objectives-4" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Motivation, Research Questions, and Learning Objectives<a class="anchor" aria-label="anchor" href="#motivation-research-questions-and-learning-objectives-4"><i class="fas fa-link"></i></a>
</h2>
<p>The goal of this case study is to gain familiarity with the ACS and CDC’s
PLACES, understand how SAEs are created, and visualize comparisons between SAEs.
The outcome of interest in this case study is health insurance. The specific
learning objectives are to: Download specific ACS and CDC’s PLACES data
Visualize (plot) and map estimates Characterize trends in the estimates by area
based socioeconomic measures (ABSMs) Understand limitations of SAEs Explore
validity of model-based estimates Understand the effect of smoothing estimates
in very small areas Given that both CDC PLACES and the ACS provide estimates of
the Census tract prevalence of health insurance, we were interested in assessing
what difference there are between the two datasets and how that difference may
vary according to area based social metrics (ABSMs) and estimation of health
inequities.</p>
<p>Given that both CDC PLACES and the ACS provide estimates of the Census tract
prevalence of health insurance, we were interested in assessing what difference
there are between the two datasets and how that difference may vary according
to area based social measures (ABSMs).</p>
</div>
<div id="understanding-small-area-estimates" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Understanding Small Area Estimates<a class="anchor" aria-label="anchor" href="#understanding-small-area-estimates"><i class="fas fa-link"></i></a>
</h2>
<p><em><strong>What is Small Area Estimation?</strong></em></p>
<p>Goal: To provide finer geographic detail of published statistics for
various subpopulations.</p>
<p>Problem: Surveys generally do not provide large enough samples for
reliable direct estimates for small areas (counties, and especially
census tracts).</p>
<p>Challenges: model misspecification and failure to account for
informative sampling.</p>
<p>How valid and reliable are the PLACES county level estimates?</p>
<ul>
<li>Depends on quality of underlying data</li>
<li>Depends on assumptions and appropriateness of statistical models
used</li>
<li>smaller uncertainty ranges for model-based estimates as compared to
direct estimates</li>
<li>smoothing out of local geographic variation which results in
potentially underestimating small areas with high prevalence
estimates and overestimating small areas with lower prevalence
estimates</li>
<li>higher discrepancies for behavior indicators than for diagnosed
chronic diseases potentially due to different biases such as
self-report or recall bias</li>
</ul>
<p>Model based estimates are also not sensitive to local area interventions or
shocks, meaning that prevalence may be over or underestimated based on prior
trends without accounting for what local surveys may capture - such as a
targeted local intervention or a disaster event. An example of this can be seen
in Zhang et al’s study where model-based estimates of current smoking prevalence
for two adjacent counties in Missouri were 24.2% and 25.0% while direct survey
estimates from a local survey were 25.3% and 13.5% due to the latter county’s
local tobacco control initiative.</p>
<p><em><strong>What is Multilevel Regression and Post-stratification (MRP)?</strong></em></p>
<p>Multilevel statistical modeling framework linking geocoded health
surveys and high spatial resolution population demographic and
socioeconomic data</p>
<p>To conduct MRP, we need:</p>
<ul>
<li>Surveys with outcome of interest, demographic data, and geographic
indicator</li>
<li>The geographic and demographic data will be used as predictors in
the first stage model to define geographic and demographic levels
for the second stage</li>
<li>Continuous variables will need to be split into intervals to create
levels</li>
<li>Factors and levels must match those in the poststratification table
(so individual level demographic and geographic variables must match
population level variables)</li>
</ul>
<p><em><strong>What is a postratification table?</strong></em></p>
<ul>
<li>Representation of the combination of demographic and geographic
factors that correspond to the number of individuals in a population
of interest</li>
<li>The number of rows in a poststratification table would correspond to
the product of the number of options for each of the variables
included
<ul>
<li>I.e. 6 age groups * 3 gender categories * 8 racialized
categories * 50 states = 7200 rows</li>
</ul>
</li>
<li>First stage
<ul>
<li>Multilevel logistic regression model</li>
</ul>
</li>
<li>Second stage
<ul>
<li>Weight model predictions for each subgroup by population
estimated frequency of these subgroups</li>
<li>Considerations: missing variables for post-stratification table,
nonresponse, missing data, inclusion of interaction terms
(useful for studying demographic subgroups within geographic
levels) and use of structured priors to share information across
levels of a factor, violation of positivity assumption</li>
</ul>
</li>
</ul>
</div>
<div id="create-our-cleaned-dataset" class="section level2" number="10.4">
<h2>
<span class="header-section-number">10.4</span> Create our Cleaned Dataset<a class="anchor" aria-label="anchor" href="#create-our-cleaned-dataset"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># dependencies </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/">tidycensus</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>

<span class="co"># get our data from PLACES </span>
<span class="co"># download the county level data from https://chronicdata.cdc.gov/500-Cities-Places/PLACES-Local-Data-for-Better-Health-County-Data-20/swc5-untb </span>
<span class="co"># rename it to "places_2021_release_county_level.csv"</span>
<span class="va">places</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/11-health-insurance-comparison/places_2021_release_county_level.csv"</span><span class="op">)</span>


<span class="co"># filter for our measure of interest</span>
<span class="va">places</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Measure</span> <span class="op">==</span> <span class="st">"Current lack of health insurance among adults aged 18-64 years"</span><span class="op">)</span> 

<span class="co"># download ACS data</span>
<span class="co"># remember you can check the variable table here: </span>
<span class="co"># https://api.census.gov/data/2019/acs/acs5/variables.html  </span>
<span class="va">acs</span> <span class="op">&lt;-</span> <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>
  geography <span class="op">=</span> <span class="st">'county'</span>,
  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">'total_population'</span> <span class="op">=</span> <span class="st">'B18135_013E'</span>,
    <span class="st">'with_disability_no_insurance'</span> <span class="op">=</span> <span class="st">'B18135_018E'</span>,
    <span class="st">'no_disability_no_insurance'</span> <span class="op">=</span> <span class="st">'B18135_023E'</span>
  <span class="op">)</span>, 
  year <span class="op">=</span> <span class="fl">2019</span>,
  state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">state.abb</span>, <span class="st">'DC'</span><span class="op">)</span>,
  geometry <span class="op">=</span> <span class="cn">TRUE</span>,
  output <span class="op">=</span> <span class="st">'tidy'</span>,
  survey <span class="op">=</span> <span class="st">'acs5'</span><span class="op">)</span>

<span class="co"># recode the variable names</span>
<span class="va">acs_cleaned</span> <span class="op">&lt;-</span> <span class="va">acs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># as_tibble drops the geometry, which causes an error later with data manipulation</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID</span>, <span class="va">variable</span>, <span class="va">estimate</span>, <span class="va">moe</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    variable <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">variable</span>,
                      <span class="st">"B18135_013"</span> <span class="op">=</span> <span class="st">"total 19-64 population"</span>,
                      <span class="st">"B18135_018"</span> <span class="op">=</span> <span class="st">"uninsured 19-64 population, disabled"</span>,
                      <span class="st">"B18135_023"</span> <span class="op">=</span> <span class="st">"uninsured 19-64 population, not disabled"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># pivot wider so we can do arithmetic with the columns</span>
<span class="va">acs_cleaned</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>  <span class="co"># pivot into a wide format so we can do arithmetic with the columns</span>
    id_cols <span class="op">=</span> <span class="va">GEOID</span>,
    names_from <span class="op">=</span> <span class="va">variable</span>,
    values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">estimate</span>, <span class="va">moe</span><span class="op">)</span><span class="op">)</span> 

<span class="co"># calculate rates of uninsurance and corresponding margin of error</span>
<span class="va">acs_cleaned</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># rowwise is necessary for the tidycensus::moe_* functions to work correctly</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    <span class="co"># calculate uninsured numerator </span>
    uninsured_numerator <span class="op">=</span> <span class="op">(</span>
      <span class="va">estimate_uninsured_19_64_population_disabled</span> <span class="op">+</span> <span class="va">estimate_uninsured_19_64_population_not_disabled</span>
    <span class="op">)</span>,
    uninsured_numerator_moe <span class="op">=</span> <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/moe_sum.html">moe_sum</a></span><span class="op">(</span>
      moe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="va">moe_uninsured_19_64_population_disabled</span>,
        <span class="va">moe_uninsured_19_64_population_not_disabled</span>
      <span class="op">)</span>,
      estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="va">estimate_uninsured_19_64_population_disabled</span>,
        <span class="va">estimate_uninsured_19_64_population_not_disabled</span>
      <span class="op">)</span>
    <span class="op">)</span>,
    <span class="co"># calculate proportion uninsured</span>
    pct_uninsured_19_64_acs <span class="op">=</span> <span class="va">uninsured_numerator</span> <span class="op">/</span> <span class="va">estimate_total_19_64_population</span> <span class="op">*</span> <span class="fl">100</span>,
    <span class="co"># calculate moe for percent uninsured</span>
    pct_uninsured_19_64_acs_moe <span class="op">=</span>
      <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/moe_prop.html">moe_prop</a></span><span class="op">(</span>
        num <span class="op">=</span> <span class="va">uninsured_numerator</span>,
        denom <span class="op">=</span> <span class="va">estimate_total_19_64_population</span>,
        moe_num <span class="op">=</span> <span class="va">uninsured_numerator_moe</span>,
        moe_denom <span class="op">=</span> <span class="va">moe_total_19_64_population</span>
      <span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">geoid</span>, <span class="va">pct_uninsured_19_64_acs</span>, <span class="va">pct_uninsured_19_64_acs_moe</span>, <span class="va">estimate_total_19_64_population</span><span class="op">)</span> <span class="co"># select only the columns we need</span>

<span class="co"># select for the crude prevalence</span>
<span class="va">places</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Data_Value_Type</span> <span class="op">==</span> <span class="st">'Crude prevalence'</span><span class="op">)</span>

<span class="co"># join the places and acs datasets</span>
<span class="va">uninsurance</span> <span class="op">&lt;-</span> <span class="va">places</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">acs_cleaned</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LocationID"</span> <span class="op">=</span> <span class="st">"geoid"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># rename to geoid for consistency</span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>geoid <span class="op">=</span> <span class="va">LocationID</span><span class="op">)</span>

<span class="co"># extract the counties shapefile from what we downloaded from acs</span>
<span class="va">county_sf</span> <span class="op">&lt;-</span>
  <span class="va">acs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># it doesn't matter which variable is used here, we just have to make sure</span>
  <span class="co"># we only get one measure per census tract</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">variable</span> <span class="op">==</span> <span class="va">variable</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># select just the GEOID so we get the GEOID and geometry</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID</span><span class="op">)</span>
  
<span class="co"># join in the counties shapefile data</span>
<span class="va">uninsurance</span> <span class="op">&lt;-</span> 
  <span class="va">county_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    <span class="va">uninsurance</span>,
    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID"</span> <span class="op">=</span> <span class="st">'geoid'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># clean the column names</span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>
  <span class="va">GEOID</span>,
  <span class="va">Year</span>,
  <span class="va">StateAbbr</span>,
  <span class="va">StateDesc</span>,
  <span class="va">LocationName</span>,
  <span class="va">Data_Value</span>,
  <span class="va">Low_Confidence_Limit</span>,
  <span class="va">High_Confidence_Limit</span>,
  <span class="va">pct_uninsured_19_64_acs</span>,
  <span class="va">pct_uninsured_19_64_acs_moe</span>,
  <span class="va">estimate_total_19_64_population</span>
<span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>
    state_name <span class="op">=</span> <span class="va">state_desc</span>,
    county_name <span class="op">=</span> <span class="va">location_name</span>,
    pct_uninsured_18_64_places <span class="op">=</span> <span class="va">data_value</span>,
    pct_uninsured_18_64_places_ci_low <span class="op">=</span> <span class="va">low_confidence_limit</span>,
    pct_uninsured_18_64_places_ci_high <span class="op">=</span> <span class="va">high_confidence_limit</span>
  <span class="op">)</span>

<span class="co"># calculate confidence intervals for the percent uninsured </span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  pct_uninsured_19_64_acs_moe_95pct <span class="op">=</span> <span class="fl">1.96</span> <span class="op">/</span> <span class="fl">1.645</span> <span class="op">*</span> <span class="va">pct_uninsured_19_64_acs_moe</span>,
  pct_uninsured_18_64_acs_ci_low <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span>
    <span class="va">pct_uninsured_19_64_acs</span> <span class="op">-</span> <span class="va">pct_uninsured_19_64_acs_moe_95pct</span>,
    <span class="fl">0</span>
  <span class="op">)</span>,
  pct_uninsured_18_64_acs_ci_high <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span>
    <span class="va">pct_uninsured_19_64_acs</span> <span class="op">+</span> <span class="va">pct_uninsured_19_64_acs_moe_95pct</span>,
    <span class="fl">100</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="visualizing-the-data" class="section level2" number="10.5">
<h2>
<span class="header-section-number">10.5</span> Visualizing the Data<a class="anchor" aria-label="anchor" href="#visualizing-the-data"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load our cleaned dataset</span>
<span class="va">uninsurance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"data/11-health-insurance-comparison/county_uninsurance.rds"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># calculate the difference in the </span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  difference_in_acs_minus_places <span class="op">=</span> <span class="va">pct_uninsured_19_64_acs</span> <span class="op">-</span> <span class="va">pct_uninsured_18_64_places</span>
<span class="op">)</span>

<span class="co"># plot the distribution of difference in ACS vs. PLACES</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">uninsurance</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">difference_in_acs_minus_places</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count of County Observations"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"% Uninsured in ACS - % Uninsured in PLACES"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Difference Between ACS and PLACES County Estimates for % without Health Insurance"</span>,
      subtitle <span class="op">=</span> <span class="st">"American Community Survey 2015-2019 Data; PLACES 2021 data based on 2019 BRFSS"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="images/11-health-insurance-comparison/histogram.png" width="100%"></div>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">uninsurance</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pct_uninsured_19_64_acs</span>, y <span class="op">=</span> <span class="va">pct_uninsured_18_64_places</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span>, <span class="fl">10</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span>, <span class="fl">10</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"PLACES Estimate of % without Health Insurance"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"ACS Estimate of % without Health Insurance"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Comparing ACS vs. PLACES Estimate of % without Health Insurance by County"</span>,
    subtitle <span class="op">=</span> <span class="st">"American Community Survey 2015-2019 Data; PLACES 2021 data based on 2019 BRFSS"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-117"></span>
<img src="images/11-health-insurance-comparison/scatter.png" alt="A scatterplot of ACS vs. PLACES estimates for the % without health insurance. The solid line shoes the line with slope = 1 and intercept = 0, while the line in blue shows a linear model line of best fit." width="100%"><p class="caption">
Figure 10.1: A scatterplot of ACS vs. PLACES estimates for the % without health insurance. The solid line shoes the line with slope = 1 and intercept = 0, while the line in blue shows a linear model line of best fit.
</p>
</div>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">uninsurance</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate_total_19_64_population</span>, y <span class="op">=</span> <span class="va">difference_in_acs_minus_places</span> <span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1e4</span>,<span class="fl">1e5</span>,<span class="fl">1e7</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1,000"</span>, <span class="st">"100,000"</span>, <span class="st">"10m"</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"19-64 Population Size Estimate, ACS 2015-2019"</span>,
       y <span class="op">=</span> <span class="st">"ACS % Uninsured - PLACES % Uninsured"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Comparing ACS vs. PLACES Estimate of % without Health Insurance by County"</span>,
    subtitle <span class="op">=</span> <span class="st">"American Community Survey 2015-2019 Data; PLACES 2021 data based on 2019 BRFSS"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/11-health-insurance-comparison/population_size_vs_difference_scatter.png" width="100%"></div>
<div class="infobox interpretation">
<p>The last three figures help us to see the on-average differences between ACS and PLACES
estimates of health uninsurance rates. In the histogram figure, we can see that the
PLACES estimates of uninsurance are often higher than those in ACS, while the scatter-plot
figures show us how this relationship changes with population size.</p>
</div>
</div>
<div id="adding-absms-1" class="section level2" number="10.6">
<h2>
<span class="header-section-number">10.6</span> Adding ABSMs<a class="anchor" aria-label="anchor" href="#adding-absms-1"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">variables_dict</span> <span class="op">&lt;-</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span>
  <span class="co"># ICEraceinc</span>
  <span class="op">~</span><span class="va">var</span>, <span class="op">~</span><span class="va">varname</span>, <span class="op">~</span><span class="va">description</span>,
  <span class="co"># total population</span>
  <span class="st">"B01001_001"</span>,  <span class="st">"total_popsize"</span>, <span class="st">"total population estimate"</span>, 
  
  <span class="co"># racial composition </span>
  <span class="st">'B01003_001'</span>,  <span class="st">"race_ethnicity_total"</span>, <span class="st">"race_ethnicity_total"</span>,
  
  <span class="co"># ICEraceinc</span>
  <span class="st">"B19001_001"</span>,  <span class="st">'hhinc_total'</span>,   <span class="st">"total population for household income estimates"</span>,
  <span class="st">"B19001A_002"</span>, <span class="st">'hhinc_w_1'</span>,     <span class="st">"white n.h. pop with household income &lt;$10k"</span>,
  <span class="st">"B19001A_003"</span>, <span class="st">'hhinc_w_2'</span>,     <span class="st">"white n.h. pop with household income $10k-14 999k"</span>,
  <span class="st">"B19001A_004"</span>, <span class="st">'hhinc_w_3'</span>,     <span class="st">"white n.h. pop with household income $15k-19 999k"</span>,
  <span class="st">"B19001A_005"</span>, <span class="st">'hhinc_w_4'</span>,     <span class="st">"white n.h. pop with household income $20k-24 999k"</span>,
  <span class="st">"B19001A_014"</span>, <span class="st">'hhinc_w_5'</span>,     <span class="st">"white n.h. pop with household income $100 000 to $124 999"</span>,
  <span class="st">"B19001A_015"</span>, <span class="st">'hhinc_w_6'</span>,     <span class="st">"white n.h. pop with household income $125k-149 999k"</span>,
  <span class="st">"B19001A_016"</span>, <span class="st">'hhinc_w_7'</span>,     <span class="st">"white n.h. pop with household income $150k-199 999k"</span>,
  <span class="st">"B19001A_017"</span>, <span class="st">'hhinc_w_8'</span>,     <span class="st">"white n.h. pop with household income $196k+"</span>,
  <span class="st">"B19001_002"</span>,  <span class="st">'hhinc_total_1'</span>, <span class="st">"total pop with household income &lt;$10k"</span>,
  <span class="st">"B19001_003"</span>,  <span class="st">'hhinc_total_2'</span>, <span class="st">"total pop with household income $10k-14 999k"</span>,
  <span class="st">"B19001_004"</span>,  <span class="st">'hhinc_total_3'</span>, <span class="st">"total pop with household income $15k-19 999k"</span>,
  <span class="st">"B19001_005"</span>,  <span class="st">'hhinc_total_4'</span>, <span class="st">"total pop with household income $20k-24 999k"</span>,

  <span class="co"># poverty</span>
  <span class="st">"B05010_002"</span>,  <span class="st">'in_poverty'</span>,    <span class="st">"population with household income &lt; poverty line"</span>,
  <span class="st">"B05010_001"</span>,  <span class="st">'total_pop_for_poverty_estimates'</span>,  <span class="st">"total population for poverty estimates"</span>,

  <span class="co"># median income</span>
  <span class="st">"B06011_001"</span>,  <span class="st">'median_income'</span>,  <span class="st">"median income estimate for total population"</span>,
  
  <span class="co"># crowded housing</span>
  <span class="st">"B25014_005"</span>,  <span class="st">'owner_occupied_crowding1'</span>, <span class="st">'owner occupied, 1 to 1.5 per room'</span>,
  <span class="st">"B25014_006"</span>,  <span class="st">'owner_occupied_crowding2'</span>, <span class="st">'owner occupied, 1.51 to 2 per room'</span>,
  <span class="st">"B25014_007"</span>,  <span class="st">'owner_occupied_crowding3'</span>, <span class="st">'owner occupied, 2.01 or more per room'</span>,
  <span class="st">"B25014_011"</span>,  <span class="st">'renter_occupied_crowding1'</span>, <span class="st">'owner occupied, 1 to 1.5 per room'</span>,
  <span class="st">"B25014_012"</span>,  <span class="st">'renter_occupied_crowding2'</span>, <span class="st">'owner occupied, 1.51 to 2 per room'</span>,
  <span class="st">"B25014_013"</span>,  <span class="st">'renter_occupied_crowding3'</span>, <span class="st">'owner occupied, 2.01 or more per room'</span>,
  <span class="st">"B25014_001"</span>,  <span class="st">'crowding_total'</span>,            <span class="st">'total for crowding (occupants per room)'</span>,
  
  <span class="st">"B01001I_001"</span>,  <span class="st">'total_hispanic'</span>,           <span class="st">'total hispanic population estimate'</span>,
  <span class="st">"B01001B_001"</span>,  <span class="st">'total_black'</span>,              <span class="st">'total black, hispanic or non-hispanic estimate'</span>,
  <span class="st">"B01001H_001"</span>,  <span class="st">'total_white_nh'</span>,           <span class="st">'total white, non-hispanic population estimate'</span>
<span class="op">)</span>

<span class="co"># fetch the absms from the American Community Survey API </span>
<span class="va">absms</span> <span class="op">&lt;-</span> <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>
  geography <span class="op">=</span> <span class="st">'county'</span>,
  state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">state.abb</span>, <span class="st">'DC'</span><span class="op">)</span>,
  year <span class="op">=</span> <span class="fl">2019</span>,
  variables <span class="op">=</span> <span class="va">variables_dict</span><span class="op">$</span><span class="va">var</span><span class="op">)</span>


<span class="co"># pivot to a wide format for renaming, dropping the margin of error data</span>
<span class="va">absms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">moe</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">variable</span>, values_from <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span>

<span class="co"># rename the columns using our rename_vars</span>
<span class="co"># </span>
<span class="co"># first we create a named vector, rename_vars, which has elements that are the</span>
<span class="co"># acs variables we request and convenient, human readable names.</span>
<span class="co"># </span>
<span class="co"># then we use rename_vars with the rename function from dplyr. </span>
<span class="co"># typically the rename function takes a syntax as follows: </span>
<span class="co">#   data %&gt;% rename(oldname1 = newname1, oldname2 = newname2, ...)</span>
<span class="co"># but in our case, we already have a named vector (rename_vars) that we </span>
<span class="co"># want to use, and so to use the rename_vars named vector inside rename</span>
<span class="co"># we use the injection-operator `!!`.  you can learn more about the injection</span>
<span class="co"># operator by running ?`!!` in your R console. </span>
<span class="va">rename_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">variables_dict</span><span class="op">$</span><span class="va">var</span>, <span class="va">variables_dict</span><span class="op">$</span><span class="va">varname</span><span class="op">)</span>
<span class="va">absms</span> <span class="op">&lt;-</span> <span class="va">absms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">rename_vars</span><span class="op">)</span>

<span class="co"># calculate ABSMs</span>
<span class="va">absms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    <span class="co"># we calculate the people of color low income counts as the overall</span>
    <span class="co"># low income counts minus the white non-hispanic low income counts</span>
    people_of_color_low_income <span class="op">=</span>
      <span class="op">(</span><span class="va">hhinc_total_1</span> <span class="op">+</span> <span class="va">hhinc_total_2</span> <span class="op">+</span> <span class="va">hhinc_total_3</span> <span class="op">+</span> <span class="va">hhinc_total_4</span><span class="op">)</span> <span class="op">-</span>
      <span class="op">(</span><span class="va">hhinc_w_1</span> <span class="op">+</span> <span class="va">hhinc_w_2</span> <span class="op">+</span> <span class="va">hhinc_w_3</span> <span class="op">+</span> <span class="va">hhinc_w_4</span><span class="op">)</span>,
    <span class="co"># sum up the white non-hispanic high income counts</span>
    white_non_hispanic_high_income <span class="op">=</span>
      <span class="op">(</span><span class="va">hhinc_w_5</span> <span class="op">+</span> <span class="va">hhinc_w_6</span> <span class="op">+</span> <span class="va">hhinc_w_7</span> <span class="op">+</span> <span class="va">hhinc_w_8</span><span class="op">)</span>,
    <span class="co"># calculate the index of concentration at the extremes for racialized</span>
    <span class="co"># economic segregation (high income white non-hispanic vs. low income</span>
    <span class="co"># people of color)</span>
    ICEraceinc <span class="op">=</span>
      <span class="op">(</span><span class="va">white_non_hispanic_high_income</span> <span class="op">-</span> <span class="va">people_of_color_low_income</span><span class="op">)</span> <span class="op">/</span>
      <span class="va">hhinc_total</span>,

    prop_in_poverty <span class="op">=</span> <span class="va">in_poverty</span> <span class="op">/</span> <span class="va">total_pop_for_poverty_estimates</span>,
    
    crowding <span class="op">=</span> <span class="op">(</span>
      <span class="va">owner_occupied_crowding1</span> <span class="op">+</span> <span class="va">owner_occupied_crowding2</span> <span class="op">+</span> <span class="va">owner_occupied_crowding3</span> <span class="op">+</span>
        <span class="va">renter_occupied_crowding1</span> <span class="op">+</span> <span class="va">renter_occupied_crowding2</span> <span class="op">+</span> <span class="va">renter_occupied_crowding3</span>
    <span class="op">)</span> <span class="op">/</span> <span class="va">crowding_total</span>,
    
    prop_black <span class="op">=</span> <span class="va">total_black</span> <span class="op">/</span> <span class="va">total_popsize</span>,
    prop_hispanic <span class="op">=</span> <span class="va">total_hispanic</span> <span class="op">/</span> <span class="va">total_popsize</span>,
    prop_white_nh <span class="op">=</span> <span class="va">total_white_nh</span> <span class="op">/</span> <span class="va">total_popsize</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>
    <span class="va">GEOID</span>,
    <span class="va">ICEraceinc</span>,
    <span class="va">prop_in_poverty</span>,
    <span class="va">median_income</span>,
    <span class="va">crowding</span>,
    <span class="va">prop_black</span>,
    <span class="va">prop_hispanic</span>,
    <span class="va">prop_white_nh</span>
  <span class="op">)</span>

<span class="co"># join in the ABSMs data</span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>
    <span class="va">absms</span>,
    <span class="va">GEOID</span>,
    <span class="va">ICEraceinc</span>,
    <span class="va">prop_in_poverty</span>,
    <span class="va">median_income</span>,
    <span class="va">crowding</span>,
    <span class="va">prop_black</span>,
    <span class="va">prop_hispanic</span>,
    <span class="va">prop_white_nh</span>
  <span class="op">)</span>,
  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'geoid'</span> <span class="op">=</span> <span class="st">'GEOID'</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># add quantile cutpoints to ICEraceinc</span>
<span class="va">ICEraceinc_cutpoints</span> <span class="op">&lt;-</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">uninsurance</span><span class="op">$</span><span class="va">ICEraceinc</span>,
                                            weights <span class="op">=</span> <span class="va">uninsurance</span><span class="op">$</span><span class="va">estimate_total_19_64_population</span>,
                                            probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">.2</span><span class="op">)</span><span class="op">)</span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  ICEraceinc_cut <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">ICEraceinc</span>, <span class="va">ICEraceinc_cutpoints</span>, include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="co"># reverse the factor ordering so the most advantaged group is the reference category</span>
<span class="va">uninsurance</span><span class="op">$</span><span class="va">ICEraceinc_cut</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># add cutpoints to pct in poverty</span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  poverty_cut <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span>
    <span class="va">prop_in_poverty</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.05</span>,<span class="fl">.1</span>,<span class="fl">.15</span>,<span class="fl">.2</span>,<span class="fl">1</span><span class="op">)</span>,
    include.lowest<span class="op">=</span><span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="co"># add cutpoints to median income</span>
<span class="va">median_income_cutpoints</span> <span class="op">&lt;-</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">uninsurance</span><span class="op">$</span><span class="va">median_income</span>,
                                               weights <span class="op">=</span> <span class="va">uninsurance</span><span class="op">$</span><span class="va">total_popsize</span>,
                                               probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">.2</span><span class="op">)</span><span class="op">)</span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  median_income_cut <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span>
    <span class="va">median_income</span>, 
    <span class="va">median_income_cutpoints</span>,
    include.lowest<span class="op">=</span><span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="va">uninsurance</span><span class="op">$</span><span class="va">median_income_cut</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># add cutpoints to crowding</span>
<span class="va">crowding_cutpoints</span> <span class="op">&lt;-</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">uninsurance</span><span class="op">$</span><span class="va">crowding</span>,
                                               weights <span class="op">=</span> <span class="va">uninsurance</span><span class="op">$</span><span class="va">total_popsize</span>,
                                               probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">.2</span><span class="op">)</span><span class="op">)</span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  crowding_cut <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span>
    <span class="va">crowding</span>, 
    <span class="va">crowding_cutpoints</span>,
    include.lowest<span class="op">=</span><span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="op">)</span>


<span class="co"># add cutpoints to proportion black</span>
<span class="va">prop_black_cutpoints</span> <span class="op">&lt;-</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">uninsurance</span><span class="op">$</span><span class="va">prop_black</span>,
                                               weights <span class="op">=</span> <span class="va">uninsurance</span><span class="op">$</span><span class="va">total_popsize</span>,
                                               probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">.2</span><span class="op">)</span><span class="op">)</span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  prop_black_cut <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span>
    <span class="va">prop_black</span>, 
    <span class="va">prop_black_cutpoints</span>,
    include.lowest<span class="op">=</span><span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="co"># add cutpoints to proportion hispanic</span>
<span class="va">prop_hispanic_cutpoints</span> <span class="op">&lt;-</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">uninsurance</span><span class="op">$</span><span class="va">prop_hispanic</span>,
                                               weights <span class="op">=</span> <span class="va">uninsurance</span><span class="op">$</span><span class="va">total_popsize</span>,
                                               probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">.2</span><span class="op">)</span><span class="op">)</span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  prop_hispanic_cut <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span>
    <span class="va">prop_hispanic</span>, 
    <span class="va">prop_hispanic_cutpoints</span>,
    include.lowest<span class="op">=</span><span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="co"># add cutpoints to proportion white</span>
<span class="va">prop_white_nh_cutpoints</span> <span class="op">&lt;-</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">uninsurance</span><span class="op">$</span><span class="va">prop_white_nh</span>,
                                               weights <span class="op">=</span> <span class="va">uninsurance</span><span class="op">$</span><span class="va">total_popsize</span>,
                                               probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">.2</span><span class="op">)</span><span class="op">)</span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  prop_white_nh_cut <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span>
    <span class="va">prop_white_nh</span>, 
    <span class="va">prop_white_nh_cutpoints</span>,
    include.lowest<span class="op">=</span><span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># relationship between ICE and percent without insurance in PLACES</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>
  formula <span class="op">=</span> <span class="va">pct_uninsured_18_64_places</span> <span class="op">~</span> <span class="va">ICEraceinc_cut</span>,
  data <span class="op">=</span> <span class="va">uninsurance</span>
<span class="op">)</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   term                         estimate std.error statistic   p.value
##   &lt;chr&gt;                           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)                     13.3      0.371     35.9  4.82e-236
## 2 ICEraceinc_cut(0.207,0.276]      1.38     0.463      2.98 2.88e-  3
## 3 ICEraceinc_cut(0.144,0.207]      2.80     0.427      6.55 6.54e- 11
## 4 ICEraceinc_cut(0.106,0.144]      5.22     0.462     11.3  5.01e- 29
## 5 ICEraceinc_cut[-0.476,0.106]     8.07     0.422     19.1  3.79e- 77</code></pre>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># relationship between ICE and percent without insurance in ACS</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>
  formula <span class="op">=</span> <span class="va">pct_uninsured_19_64_acs</span> <span class="op">~</span> <span class="va">ICEraceinc_cut</span>,
  data <span class="op">=</span> <span class="va">uninsurance</span>
<span class="op">)</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   term                         estimate std.error statistic   p.value
##   &lt;chr&gt;                           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)                      9.11     0.386     23.6  1.17e-113
## 2 ICEraceinc_cut(0.207,0.276]      1.65     0.484      3.41 6.50e-  4
## 3 ICEraceinc_cut(0.144,0.207]      3.09     0.445      6.94 4.76e- 12
## 4 ICEraceinc_cut(0.106,0.144]      5.98     0.484     12.4  2.47e- 34
## 5 ICEraceinc_cut[-0.476,0.106]     9.60     0.441     21.8  3.60e- 98</code></pre>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># relationship between poverty and percent without insurance in ACS</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>
  formula <span class="op">=</span> <span class="va">pct_uninsured_19_64_acs</span> <span class="op">~</span> <span class="va">poverty_cut</span>,
  data <span class="op">=</span> <span class="va">uninsurance</span>
<span class="op">)</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   term                  estimate std.error statistic  p.value
##   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)             10.5       0.692    15.2   3.91e-50
## 2 poverty_cut(0.05,0.1]   -0.325     0.776    -0.419 6.75e- 1
## 3 poverty_cut(0.1,0.15]    0.731     0.747     0.978 3.28e- 1
## 4 poverty_cut(0.15,0.2]    2.90      0.740     3.91  9.28e- 5
## 5 poverty_cut(0.2,1]       6.67      0.716     9.32  2.22e-20</code></pre>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create a data frame with the names for each combination of the percent</span>
<span class="co"># uninsured in PLACES or ACS variables in one column and each of the categorical</span>
<span class="co"># exposure variables in another column</span>
<span class="va">model_formulae</span> <span class="op">&lt;-</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span><span class="op">(</span>
    exposure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'ICEraceinc_cut'</span>,
      <span class="st">'poverty_cut'</span>,
      <span class="st">'median_income_cut'</span>,
      <span class="st">'crowding_cut'</span>,
      <span class="st">'prop_black_cut'</span>,
      <span class="st">'prop_hispanic_cut'</span>,
      <span class="st">'prop_white_nh_cut'</span><span class="op">)</span>,
    outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'pct_uninsured_19_64_acs'</span>, <span class="st">'pct_uninsured_18_64_places'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># create a column that puts the uninsurance variables on the left-hand-side</span>
<span class="co"># and the exposure variables on the right hand side</span>
<span class="va">model_formulae</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="st">" ~ "</span>, <span class="va">exposure</span><span class="op">)</span><span class="op">)</span>

<span class="co"># fit regression models using the robust linear model rlm method from </span>
<span class="co"># the MASS package</span>
<span class="va">model_formulae</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="co"># note that you do need to have the MASS package installed;</span>
    <span class="co"># we aren't loading it with library() anywhere it because it causes</span>
    <span class="co"># conflicts with the dplyr::select function</span>
    <span class="fu">MASS</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/rlm.html">rlm.formula</a></span><span class="op">(</span>
      formula <span class="op">=</span> <span class="va">formula</span>,
      data <span class="op">=</span> <span class="va">uninsurance</span>,
      weights <span class="op">=</span> <span class="va">uninsurance</span><span class="op">$</span><span class="va">estimate_total_19_64_population</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  model_coefs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model</span>, conf.int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># extract the coefficient estimates on the exposure terms</span>
<span class="va">model_formulae</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model_coefs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">model_coefs</span>, <span class="va">term</span> <span class="op">!=</span> <span class="st">'(Intercept)'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># unnest the model coefficients data</span>
<span class="va">model_formulae</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">model_coefs</span><span class="op">)</span>

<span class="co"># create a plot showing the coefficient estimates from each model  - </span>
<span class="co"># </span>
<span class="co"># the visualization here is what's typically called a "forest plot" and shows</span>
<span class="co"># the point-estimates for the coefficients and their 95% confidence intervals</span>
<span class="co"># along with a dashed line at zero so we can see if the coefficients are</span>
<span class="co"># significantly different from the null hypothesis (the null hypothesis being</span>
<span class="co"># that the coefficient is zero).</span>
<span class="va">model_formulae</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    term <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">exposure</span><span class="op">)</span>, <span class="co"># remove the exposure string repeated in each term</span>
    term_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">term</span>, <span class="st">"[0-9\\-\\.e\\+]+"</span><span class="op">)</span><span class="op">)</span>, <span class="co"># get the numeric value of each term;</span>
    <span class="co"># e.g. if the term was originally poverty_cut[0,0.05) then this regular expression extracts the 0</span>
    term <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">term</span>, <span class="op">-</span><span class="va">term_size</span><span class="op">)</span>
    <span class="co"># using the term size, we order the terms so they appear in the correct order</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span>, xmin <span class="op">=</span> <span class="va">conf.low</span>, xmax <span class="op">=</span> <span class="va">conf.high</span>, y <span class="op">=</span> <span class="va">term</span>,
             shape <span class="op">=</span> <span class="va">outcome</span>, color <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype<span class="op">=</span><span class="st">'dashed'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_linerange</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">exposure</span>, scales<span class="op">=</span><span class="st">'free_y'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Additional Percentage Points of Uninsurance"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Modeled Effects Associated with Each ABSM"</span>,
          subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'Models were fit separately for each ABSM'</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/11-health-insurance-comparison/modeled_effects_for_each_absm.png" width="100%"></div>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># let's take a look at some specific states</span>

<span class="co"># extract the maximum uninsurance rate across both ACS and PLACES so that we can</span>
<span class="co"># use it in making the color palettes consistent between the two maps for ACS</span>
<span class="co"># and PLACES</span>
<span class="va">max_uninsurance_rate</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'TX'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">pct_uninsured_19_64_acs</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'TX'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">pct_uninsured_18_64_places</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># create a map showing the ACS direct estimates of uninsurance rates</span>
<span class="va">acs_figure</span> <span class="op">&lt;-</span> <span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'TX'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">pct_uninsured_19_64_acs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Percent Uninsured (19-64)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"ACS Percent Uninsurance Estimates"</span><span class="op">)</span>

<span class="co"># create a map showing the PLACES estimates of uninsurance rates</span>
<span class="va">places_figure</span> <span class="op">&lt;-</span> <span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'TX'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">pct_uninsured_18_64_places</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Percent Uninsured (18-64)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Places Percent Uninsurance Estimates"</span><span class="op">)</span>

<span class="co"># combine the two figures into one side-by-side figure</span>
<span class="va">acs_figure</span> <span class="op">+</span> <span class="va">places_figure</span>

<span class="co"># save the figure</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/11-health-insurance-comparison/texas_comparison.png"</span>,
       height <span class="op">=</span> <span class="fl">6</span>, width <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>

<span class="co"># create a scatter plot showing the ACS vs. PLACES relationship in Texas</span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'TX'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pct_uninsured_19_64_acs</span>, y <span class="op">=</span> <span class="va">pct_uninsured_18_64_places</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="co"># save the figure</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/11-health-insurance-comparison/texas_comparison_scatter.png"</span>,
       height <span class="op">=</span> <span class="fl">6</span>, width <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>


<span class="co"># florida --- </span>

<span class="co"># extract the maximum uninsurance rate across both ACS and PLACES so that we can</span>
<span class="co"># use it in making the color palettes consistent between the two maps for ACS</span>
<span class="co"># and PLACES</span>
<span class="va">max_uninsurance_rate</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'FL'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">pct_uninsured_19_64_acs</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'FL'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">pct_uninsured_18_64_places</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># create a map showing the ACS direct estimates of uninsurance rates</span>
<span class="va">acs_figure</span> <span class="op">&lt;-</span> <span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'FL'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">pct_uninsured_19_64_acs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Percent Uninsured (19-64)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"ACS Percent Uninsurance Estimates"</span><span class="op">)</span>

<span class="co"># create a map showing the PLACES estimates of uninsurance rates</span>
<span class="va">places_figure</span> <span class="op">&lt;-</span> <span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'FL'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">pct_uninsured_18_64_places</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Percent Uninsured (18-64)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Places Percent Uninsurance Estimates"</span><span class="op">)</span>

<span class="co"># combine the two figures into one side-by-side figure</span>
<span class="va">acs_figure</span> <span class="op">+</span> <span class="va">places_figure</span>

<span class="co"># save the figure</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/11-health-insurance-comparison/florida_comparison.png"</span>,
       height <span class="op">=</span> <span class="fl">6</span>, width <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>

<span class="co"># create a scatter plot showing the ACS vs. PLACES relationship in Florida</span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'FL'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pct_uninsured_19_64_acs</span>, y <span class="op">=</span> <span class="va">pct_uninsured_18_64_places</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/11-health-insurance-comparison/florida_comparison_scatter.png"</span>,
       height <span class="op">=</span> <span class="fl">6</span>, width <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>


<span class="co"># minnesota --- </span>

<span class="co"># follows the same approach as shown above for Texas and Florida </span>

<span class="va">max_uninsurance_rate</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'MN'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">pct_uninsured_19_64_acs</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'MN'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">pct_uninsured_18_64_places</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">acs_figure</span> <span class="op">&lt;-</span> <span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'MN'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">pct_uninsured_19_64_acs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Percent Uninsured (19-64)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"ACS Percent Uninsurance Estimates"</span><span class="op">)</span>

<span class="va">places_figure</span> <span class="op">&lt;-</span> <span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'MN'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">pct_uninsured_18_64_places</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Percent Uninsured (18-64)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Places Percent Uninsurance Estimates"</span><span class="op">)</span>

<span class="va">acs_figure</span> <span class="op">+</span> <span class="va">places_figure</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/11-health-insurance-comparison/minnesota_comparison.png"</span>,
       height <span class="op">=</span> <span class="fl">6</span>, width <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>

<span class="co"># wisconsin --- </span>

<span class="co"># follows the same approach as shown above for Texas and Florida </span>

<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'MN'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pct_uninsured_19_64_acs</span>, 
        xmin <span class="op">=</span> <span class="va">pct_uninsured_18_64_acs_ci_low</span>, 
        xmax <span class="op">=</span> <span class="va">pct_uninsured_18_64_acs_ci_high</span>,
        y <span class="op">=</span> <span class="va">pct_uninsured_18_64_places</span>, 
        ymin <span class="op">=</span> <span class="va">pct_uninsured_18_64_places_ci_low</span>,
        ymax <span class="op">=</span> <span class="va">pct_uninsured_18_64_places_ci_high</span>,
        size <span class="op">=</span> <span class="va">estimate_total_19_64_population</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html">geom_errorbarh</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">+</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">+</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">log10_trans</a></span><span class="op">(</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html">comma_format</a></span><span class="op">(</span><span class="op">)</span>,
                        range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Percent Without Health Insurance in Minnesota"</span>,
          <span class="st">"95% Margins of Error Shown for Each of PLACES and ACS"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/11-health-insurance-comparison/minnesota_comparison_scatter.png"</span>,
       height <span class="op">=</span> <span class="fl">6</span>, width <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>


<span class="co"># wisconsin --- </span>

<span class="co"># follows the same approach as above for Texas, Florida, Minnesota</span>

<span class="va">max_uninsurance_rate</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'WI'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">pct_uninsured_19_64_acs</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'WI'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">pct_uninsured_18_64_places</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">acs_figure</span> <span class="op">&lt;-</span> <span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'WI'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">pct_uninsured_19_64_acs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Percent Uninsured (19-64)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"ACS Percent Uninsurance Estimates"</span><span class="op">)</span>



<span class="va">places_figure</span> <span class="op">&lt;-</span> <span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'WI'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">pct_uninsured_18_64_places</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Percent Uninsured (18-64)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Places Percent Uninsurance Estimates"</span><span class="op">)</span>


<span class="va">acs_figure</span> <span class="op">+</span> <span class="va">places_figure</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/11-health-insurance-comparison/wisconsin_comparison.png"</span>,
       height <span class="op">=</span> <span class="fl">6</span>, width <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>

<span class="co"># this figure slightly differs from the above approach in that it includes error-bars</span>
<span class="va">uninsurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state_abbr</span> <span class="op">==</span> <span class="st">'WI'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pct_uninsured_19_64_acs</span>, 
        xmin <span class="op">=</span> <span class="va">pct_uninsured_18_64_acs_ci_low</span>, 
        xmax <span class="op">=</span> <span class="va">pct_uninsured_18_64_acs_ci_high</span>,
        y <span class="op">=</span> <span class="va">pct_uninsured_18_64_places</span>, 
        ymin <span class="op">=</span> <span class="va">pct_uninsured_18_64_places_ci_low</span>,
        ymax <span class="op">=</span> <span class="va">pct_uninsured_18_64_places_ci_high</span>,
        size <span class="op">=</span> <span class="va">estimate_total_19_64_population</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html">geom_errorbarh</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">+</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">max_uninsurance_rate</span><span class="op">+</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">log10_trans</a></span><span class="op">(</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html">comma_format</a></span><span class="op">(</span><span class="op">)</span>,
                        range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Percent Without Health Insurance in Wisconsin"</span>,
          <span class="st">"95% Margins of Error Shown for Each of PLACES and ACS"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/11-health-insurance-comparison/wisconsin_comparison_scatter.png"</span>,
       height <span class="op">=</span> <span class="fl">6</span>, width <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></code></pre></div>
<p><img src="images/11-health-insurance-comparison/texas_comparison.png" width="100%"><img src="images/11-health-insurance-comparison/texas_comparison_scatter.png" width="100%"><img src="images/11-health-insurance-comparison/florida_comparison.png" width="100%"><img src="images/11-health-insurance-comparison/florida_comparison_scatter.png" width="100%"><img src="images/11-health-insurance-comparison/minnesota_comparison.png" width="100%"><img src="images/11-health-insurance-comparison/minnesota_comparison_scatter.png" width="100%"><img src="images/11-health-insurance-comparison/wisconsin_comparison.png" width="100%"><img src="images/11-health-insurance-comparison/wisconsin_comparison_scatter.png" width="100%"></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="temporal-health-insurance.html"><span class="header-section-number">9</span> Case Study 4: Case Study on Temporal Trends using American Community Survey (ACS) data (2012-2019)</a></div>
<div class="next"><a href="conclusions.html"><span class="header-section-number">11</span> Conclusions</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#health-insurance-comparison"><span class="header-section-number">10</span> Case Study 5: Case Study Comparing County Analyses of Inequities in Health Insurance using ACS vs. CDC PLACES data (2019)</a></li>
<li><a class="nav-link" href="#introduction-3"><span class="header-section-number">10.1</span> Introduction</a></li>
<li><a class="nav-link" href="#motivation-research-questions-and-learning-objectives-4"><span class="header-section-number">10.2</span> Motivation, Research Questions, and Learning Objectives</a></li>
<li><a class="nav-link" href="#understanding-small-area-estimates"><span class="header-section-number">10.3</span> Understanding Small Area Estimates</a></li>
<li><a class="nav-link" href="#create-our-cleaned-dataset"><span class="header-section-number">10.4</span> Create our Cleaned Dataset</a></li>
<li><a class="nav-link" href="#visualizing-the-data"><span class="header-section-number">10.5</span> Visualizing the Data</a></li>
<li><a class="nav-link" href="#adding-absms-1"><span class="header-section-number">10.6</span> Adding ABSMs</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Public Health Disparities Geocoding Project 2.0 Training Manual</strong>" was written by Christian Testa, Jarvis T Chen, Enjoli Hall, Dena Javadi, Justin Morgan, Tamara Rushovich, Sudipta (Shu) Saha, Pamela D Waterman, Nancy Krieger. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
