<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>7 Case Study 1: Premature Mortality in Massachusetts (2013 - 2017) | Public Health Disparities Geocoding Project 2.0 Training Manual</title>
<meta name="author" content="Christian Testa, Jarvis T Chen, Enjoli Hall, Dena Javadi, Justin Morgan, Tamara Rushovich, Sudipta Saha, Pamela D Waterman, Nancy Krieger">
<meta name="description" content="By: Justin W. Morgan  7.1 Introduction In this case study, the outcome of interest is premature mortality (here defined as death occuring before age 65). This data, which was requested from the...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="7 Case Study 1: Premature Mortality in Massachusetts (2013 - 2017) | Public Health Disparities Geocoding Project 2.0 Training Manual">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/coverart.png">
<meta property="og:description" content="By: Justin W. Morgan  7.1 Introduction In this case study, the outcome of interest is premature mortality (here defined as death occuring before age 65). This data, which was requested from the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="7 Case Study 1: Premature Mortality in Massachusetts (2013 - 2017) | Public Health Disparities Geocoding Project 2.0 Training Manual">
<meta name="twitter:description" content="By: Justin W. Morgan  7.1 Introduction In this case study, the outcome of interest is premature mortality (here defined as death occuring before age 65). This data, which was requested from the...">
<meta name="twitter:image" content="/images/coverart.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="libs/HomeButton-0.0.1/home-button.js"></script><script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script><script src="libs/clipboard-0.0.1/setClipboardText.js"></script><link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-YD7D8SMHNP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-YD7D8SMHNP');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Public Health Disparities Geocoding Project 2.0 Training Manual</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Public Health Disparities Geocoding Project 2.0 Training Manual</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="background.html"><span class="header-section-number">1</span> Background and History of Analytic Methods</a></li>
<li><a class="" href="bios.html"><span class="header-section-number">2</span> Author Bios</a></li>
<li><a class="" href="getting-setup.html"><span class="header-section-number">3</span> Getting Setup with R and RStudio</a></li>
<li><a class="" href="getting-your-data.html"><span class="header-section-number">4</span> Getting your data</a></li>
<li><a class="" href="visualizing-your-data.html"><span class="header-section-number">5</span> Visualizing your data</a></li>
<li><a class="" href="analyzing-your-data.html"><span class="header-section-number">6</span> Analyzing your data</a></li>
<li><a class="active" href="premature-mortality.html"><span class="header-section-number">7</span> Case Study 1: Premature Mortality in Massachusetts (2013 - 2017)</a></li>
<li><a class="" href="breast-cancer-mortality.html"><span class="header-section-number">8</span> Case Study 2: Breast Cancer Mortality in Massachusetts</a></li>
<li><a class="" href="cook-county-covid.html"><span class="header-section-number">9</span> Case Study 3: COVID-19 Mortality in Cook County (March 2020 - March 2022)</a></li>
<li><a class="" href="temporal-health-insurance.html"><span class="header-section-number">10</span> Case Study 4: Case Study on Temporal Trends using American Community Survey (ACS) data (2012-2019)</a></li>
<li><a class="" href="health-insurance-comparison.html"><span class="header-section-number">11</span> Case Study 5: Case Study Comparing County Analyses of Inequities in Health Insurance using ACS vs. CDC PLACES data (2019)</a></li>
<li><a class="" href="conclusions.html"><span class="header-section-number">12</span> Conclusion</a></li>
<li><a class="" href="glossary.html"><span class="header-section-number">13</span> Glossary</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="premature-mortality" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Case Study 1: Premature Mortality in Massachusetts (2013 - 2017)<a class="anchor" aria-label="anchor" href="#premature-mortality"><i class="fas fa-link"></i></a>
</h1>
<p><em>By: Justin W. Morgan</em></p>
<div id="introduction" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"><i class="fas fa-link"></i></a>
</h2>
<p>In this case study, the outcome of interest is premature mortality (here defined as death occuring before age 65). This data, which was requested from the <a href="https://www.mass.gov/lists/death-data">Massachusetts Registry of Vital Records and Statistics</a> is for the years 2013-2017 and is merged with area-based social metrics (ABSMs) created from American Community Survey (ACS) 5-Year Estimates. For more information on how the ACA estimates these metrics from their survey, please visit <a href="https://www.census.gov/programs-surveys/acs/methodology/design-and-methodology.html">their website</a>. Vital Statistics registries require data on residential address at time of death, so they can be useful tools for monitoring health and health equity. These data were geocoded using the <a href="https://developers.google.com/maps">Google Maps API</a>.</p>
</div>
<div id="motivation-research-questions-and-learning-objectives" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Motivation, Research Questions, and Learning Objectives<a class="anchor" aria-label="anchor" href="#motivation-research-questions-and-learning-objectives"><i class="fas fa-link"></i></a>
</h2>
<p>The goal of this case study is to develop familiarity with methods of exploring and visualizing racial disparities in health data. Our specific goals will be to:</p>
<ul>
<li>Download and merge health outcome and ABSM data</li>
<li>Visualize and map estimates of ABSMs and premature mortality</li>
<li>Identify the relationships between racialized group, ABSMs, and premature mortality</li>
<li>Model the interaction effects between racialized group and ABSM.</li>
</ul>
<p>The research questions we will seek to answer throughout this case study include:</p>
<ol style="list-style-type: decimal">
<li>What is the overall socioeconomic gradient in premature mortality?</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li>What is the racialized disparity in premature mortality?</li>
<li>How does ABSM interact with individual level membership in racialized groups? (i.e., interactions between socioeconomic position and racialized groups, not just socioeconomic inequities within racialized groups)</li>
</ol>
</div>
<div id="downloading-and-wrangling-your-data" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Downloading and Wrangling Your Data<a class="anchor" aria-label="anchor" href="#downloading-and-wrangling-your-data"><i class="fas fa-link"></i></a>
</h2>
<div class="infobox dataWrangling">
<p>In this section, we will show you how to download ACS data by querying the census API and how to manipulate the data into the format we need for the rest of the analysis. This case study investigates a constructed variable: the Index of Concentration at the Extremes (for high-income Non-Hispanic White people vs low-income people of Color). See if you can replicate the analysis with a different ACS variable!</p>
<p>Note: Our outcome data cannot be shared due to privacy restrictions - for this case study, you will receive a pre-wrangled mortality dataset. Example code for how the wrangling could be done is included in this chapter’s appendix.</p>
</div>
<div id="dependencies" class="section level3" number="7.3.1">
<h3>
<span class="header-section-number">7.3.1</span> Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"><i class="fas fa-link"></i></a>
</h3>
<p>You will need these packages throughout our case study:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># "mission critical" packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>      <span class="co"># A collection of packages used for tidy data wrangling</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span>         <span class="co"># A package for easy loading of Excel files</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>        <span class="co"># The most popular and flexible visualization package in R</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/">tidycensus</a></span><span class="op">)</span>     <span class="co"># A package to download data from the U.S. Census Bureau API</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/walkerke/tigris">tigris</a></span><span class="op">)</span>         <span class="co"># A package to download shapefiles from the U.S. Census Bureau</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>             <span class="co"># A package with tools for simple (spatial) features</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span>           <span class="co"># A package that allows for bayesian inference</span>
<span class="fu"><a href="https://rdrr.io/pkg/INLA/man/options.html">inla.setOption</a></span><span class="op">(</span>inla.mode <span class="op">=</span> <span class="st">"experimental"</span><span class="op">)</span> <span class="co"># An option to use the experimental (beta version)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span>          <span class="co"># A package to allow for spatial weighting in analyses</span>
<span class="co"># "nice-to-have" packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span>        <span class="co"># A ggplot2 add-on that will allow us to add sub plots</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>tigris_use_cache <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># An option within `tigris` to save what you download</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span>        <span class="co"># A package including color-blind friendly color pallettes</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/Hmisc/">Hmisc</a></span><span class="op">)</span>          <span class="co"># A package containing useful functions for data analyses</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jacobkap/fastDummies">fastDummies</a></span><span class="op">)</span>    <span class="co"># A package that includes functions to create indicator variables</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview">mapview</a></span><span class="op">)</span>        <span class="co"># For interactive mapping, including topographical mapping</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>          <span class="co"># A programming toolkit for R</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span>         <span class="co"># An add-on package to help with scaling our maps appropriately</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>          <span class="co"># A package that allows for extraction and wrangling of model output</span>
<span class="co"># If this code does not run for you, you may need to run install.package("package_name")</span></code></pre></div>
</div>
<div id="your-health-outcome-data---premature-mortality" class="section level3" number="7.3.2">
<h3>
<span class="header-section-number">7.3.2</span> Your Health Outcome Data - Premature Mortality<a class="anchor" aria-label="anchor" href="#your-health-outcome-data---premature-mortality"><i class="fas fa-link"></i></a>
</h3>
<p>This data have been aggregated from individual observations into death counts by year, age, sex, racialized group, census tract, and town. When you receive unrestricted mortality files from government agencies for research, you will likely encounter files with one observation per death. After you have geocoded these individual-level observations, you will need to aggregate them up to the geographic level of interest for your analysis. The data we use is also aggregated into groups that correspond to common variables on the ACS, so that they can be aligned to population counts that will be used as denominators as rates are calculated. Aggregation to specific age groups and racial categorizations allows us to perform key aspects of our analysis, such as age-standardization of the data, and stratification of analysis by racialized group.</p>
<div class="infobox dataWrangling">
<p>NOTE: the variable for town refers to a constructed variable. Ideally when performing an analysis that might include two or more levels, the smaller level (here, census tracts) would be nested entirely within the larger level (towns). In Massachusetts though, there are several towns that have such small populations that they are smaller than census tracts. For these towns, we have created a crosswalk wherein neighboring small towns have been combined to create larger “super towns”. These super towns each make up one census tract, so that each super town in the analysis will now have at least one census tract “nested within it” in a multilevel analysis. If you are interested in attempting a multilevel analysis, this data may make good practice!</p>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ma_mort_ct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"your_file_path/ma_mort_ct.RDS"</span><span class="op">)</span></code></pre></div>
</div>
<div id="your-denominator-data-and-absm" class="section level3" number="7.3.3">
<h3>
<span class="header-section-number">7.3.3</span> Your Denominator Data and ABSM<a class="anchor" aria-label="anchor" href="#your-denominator-data-and-absm"><i class="fas fa-link"></i></a>
</h3>
<p>We download population data (to use as denominators to calculate mortality rates) and ABSMs from the U.S. Census Bureau API using the <code>tidycensus</code> package. This requires registering with the Bureau for an API key. The key is redacted here, but you can get your own <a href="https://api.census.gov/data/key_signup.html">from the Bureau</a>. The ABSM we will use for this analysis is the Index of Concentration at the Extremes for Racialized Economic Segregation (ICE), which quantifies how persons in a specified area are concentrated into the top vs bottom of a specified societal distribution. The distribution we will construct is comparing high-income Non-Hispanic White people to low-income people of Color.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Population Denominators</span>
<span class="va">ma_denominator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>     <span class="co"># Create an empty list to store our data in</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ma_denominator</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2013</span>,<span class="fl">2014</span>,<span class="fl">2015</span>,<span class="fl">2016</span>,<span class="fl">2017</span><span class="op">)</span>    <span class="co"># Name the indices of the list for the data years</span>
<span class="co"># The following code creates a loop, and then runs the tidycensus package get_acs() function to draw down population counts for a list of variables (using their Census Bureau designations). You can see the full list of variables at https://api.census.gov/data/2019/acs/acs5/variables.html.</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">nm</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ma_denominator</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>                   
  <span class="va">ma_denominator</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"tract"</span>,
                            variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B01001_003"</span>,<span class="st">"B01001_004"</span>,<span class="st">"B01001_005"</span>,<span class="st">"B01001_006"</span>,
                                          <span class="st">"B01001_007"</span>,<span class="st">"B01001_008"</span>,<span class="st">"B01001_009"</span>,<span class="st">"B01001_010"</span>,
                                          <span class="st">"B01001_011"</span>,<span class="st">"B01001_012"</span>,<span class="st">"B01001_013"</span>,<span class="st">"B01001_014"</span>,
                                          <span class="st">"B01001_015"</span>,<span class="st">"B01001_016"</span>,<span class="st">"B01001_017"</span>,<span class="st">"B01001_018"</span>,
                                          <span class="st">"B01001_019"</span>,<span class="st">"B01001_027"</span>,<span class="st">"B01001_028"</span>,<span class="st">"B01001_029"</span>,
                                          <span class="st">"B01001_030"</span>,<span class="st">"B01001_031"</span>,<span class="st">"B01001_032"</span>,<span class="st">"B01001_033"</span>,
                                          <span class="st">"B01001_034"</span>,<span class="st">"B01001_035"</span>,<span class="st">"B01001_036"</span>,<span class="st">"B01001_037"</span>,
                                          <span class="st">"B01001_038"</span>,<span class="st">"B01001_039"</span>,<span class="st">"B01001_040"</span>,<span class="st">"B01001_041"</span>,
                                          <span class="st">"B01001_042"</span>,<span class="st">"B01001_043"</span>,
                                          <span class="st">"B01001B_003"</span>,<span class="st">"B01001B_004"</span>,<span class="st">"B01001B_005"</span>,
                                          <span class="st">"B01001B_006"</span>,<span class="st">"B01001B_007"</span>,<span class="st">"B01001B_008"</span>,
                                          <span class="st">"B01001B_009"</span>,<span class="st">"B01001B_010"</span>,<span class="st">"B01001B_011"</span>,
                                          <span class="st">"B01001B_012"</span>,<span class="st">"B01001B_013"</span>,<span class="st">"B01001B_018"</span>,
                                          <span class="st">"B01001B_019"</span>,<span class="st">"B01001B_020"</span>,<span class="st">"B01001B_021"</span>,
                                          <span class="st">"B01001B_022"</span>,<span class="st">"B01001B_023"</span>,<span class="st">"B01001B_024"</span>,
                                          <span class="st">"B01001B_025"</span>,<span class="st">"B01001B_026"</span>,<span class="st">"B01001B_027"</span>,
                                          <span class="st">"B01001B_028"</span>,
                                          <span class="st">"B01001H_003"</span>,<span class="st">"B01001H_004"</span>,<span class="st">"B01001H_005"</span>,
                                          <span class="st">"B01001H_006"</span>,<span class="st">"B01001H_007"</span>,<span class="st">"B01001H_008"</span>,
                                          <span class="st">"B01001H_009"</span>,<span class="st">"B01001H_010"</span>,<span class="st">"B01001H_011"</span>,
                                          <span class="st">"B01001H_012"</span>,<span class="st">"B01001H_013"</span>,<span class="st">"B01001H_018"</span>,
                                          <span class="st">"B01001H_019"</span>,<span class="st">"B01001H_020"</span>,<span class="st">"B01001H_021"</span>,
                                          <span class="st">"B01001H_022"</span>,<span class="st">"B01001H_023"</span>,<span class="st">"B01001H_024"</span>,
                                          <span class="st">"B01001H_025"</span>,<span class="st">"B01001H_026"</span>,<span class="st">"B01001H_027"</span>,
                                          <span class="st">"B01001H_028"</span><span class="op">)</span>, 
                               year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>,
                               output <span class="op">=</span> <span class="st">"wide"</span>,
                               state <span class="op">=</span> <span class="st">"MA"</span>,
                               geometry <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># you can opt to download spatial information here</span>
                               key <span class="op">=</span> <span class="st">"your_key_here"</span>,
                               moe_level <span class="op">=</span> <span class="fl">95</span>,
                               survey <span class="op">=</span> <span class="st">"acs5"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="co"># Here, we will transform those variables into variables that align better with our outcome data</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span>,
           GEOID10 <span class="op">=</span> <span class="va">GEOID</span>,
           <span class="co"># Total Male Age Groups</span>
           `total_male_00-04` <span class="op">=</span> <span class="va">B01001_003E</span>,
           `total_male_05-09` <span class="op">=</span> <span class="va">B01001_004E</span>,
           `total_male_10-14` <span class="op">=</span> <span class="va">B01001_005E</span>,
           `total_male_15-19` <span class="op">=</span> <span class="va">B01001_006E</span> <span class="op">+</span> <span class="va">B01001_007E</span>,
           `total_male_20-24` <span class="op">=</span> <span class="va">B01001_008E</span> <span class="op">+</span> <span class="va">B01001_009E</span> <span class="op">+</span> <span class="va">B01001_010E</span>,
           `total_male_25-29` <span class="op">=</span> <span class="va">B01001_011E</span>,
           `total_male_30-34` <span class="op">=</span> <span class="va">B01001_012E</span>,
           `total_male_35-39` <span class="op">=</span> <span class="va">B01001_013E</span>,
           `total_male_40-44` <span class="op">=</span> <span class="va">B01001_014E</span>,
           `total_male_45-49` <span class="op">=</span> <span class="va">B01001_015E</span>,
           `total_male_50-54` <span class="op">=</span> <span class="va">B01001_016E</span>,
           `total_male_55-59` <span class="op">=</span> <span class="va">B01001_017E</span>,
           `total_male_60-64` <span class="op">=</span> <span class="va">B01001_018E</span> <span class="op">+</span> <span class="va">B01001_019E</span>,
           total_male_total  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"total_male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># Total Female Age Groups</span>
           `total_female_00-04` <span class="op">=</span> <span class="va">B01001_027E</span>,
           `total_female_05-09` <span class="op">=</span> <span class="va">B01001_028E</span>,
           `total_female_10-14` <span class="op">=</span> <span class="va">B01001_029E</span>,
           `total_female_15-19` <span class="op">=</span> <span class="va">B01001_030E</span> <span class="op">+</span> <span class="va">B01001_031E</span>,
           `total_female_20-24` <span class="op">=</span> <span class="va">B01001_032E</span> <span class="op">+</span> <span class="va">B01001_033E</span> <span class="op">+</span> <span class="va">B01001_034E</span>,
           `total_female_25-29` <span class="op">=</span> <span class="va">B01001_035E</span>,
           `total_female_30-34` <span class="op">=</span> <span class="va">B01001_036E</span>,
           `total_female_35-39` <span class="op">=</span> <span class="va">B01001_037E</span>,
           `total_female_40-44` <span class="op">=</span> <span class="va">B01001_038E</span>,
           `total_female_45-49` <span class="op">=</span> <span class="va">B01001_039E</span>,
           `total_female_50-54` <span class="op">=</span> <span class="va">B01001_040E</span>,
           `total_female_55-59` <span class="op">=</span> <span class="va">B01001_041E</span>,
           `total_female_60-64` <span class="op">=</span> <span class="va">B01001_042E</span> <span class="op">+</span> <span class="va">B01001_043E</span>,
           total_female_total  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"total_female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           total_total_total   <span class="op">=</span> <span class="va">total_male_total</span> <span class="op">+</span> <span class="va">total_female_total</span>,
           <span class="co"># Black Male Age Groups</span>
           `black_male_00-04` <span class="op">=</span> <span class="va">B01001B_003E</span>,
           `black_male_05-09` <span class="op">=</span> <span class="va">B01001B_004E</span>,
           `black_male_10-14` <span class="op">=</span> <span class="va">B01001B_005E</span>,
           `black_male_15-19` <span class="op">=</span> <span class="va">B01001B_006E</span> <span class="op">+</span> <span class="va">B01001B_007E</span>,
           `black_male_20-24` <span class="op">=</span> <span class="va">B01001B_008E</span>,
           `black_male_25-29` <span class="op">=</span> <span class="va">B01001B_009E</span>,
           `black_male_30-34` <span class="op">=</span> <span class="va">B01001B_010E</span>,
           `black_male_35-44` <span class="op">=</span> <span class="va">B01001B_011E</span>,
           `black_male_45-54` <span class="op">=</span> <span class="va">B01001B_012E</span>,
           `black_male_55-64` <span class="op">=</span> <span class="va">B01001B_013E</span>,
           black_male_total  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"black_male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># Black Female Age Groups</span>
           `black_female_00-04` <span class="op">=</span> <span class="va">B01001B_018E</span>,
           `black_female_05-09` <span class="op">=</span> <span class="va">B01001B_019E</span>,
           `black_female_10-14` <span class="op">=</span> <span class="va">B01001B_020E</span>,
           `black_female_15-19` <span class="op">=</span> <span class="va">B01001B_021E</span> <span class="op">+</span> <span class="va">B01001B_022E</span>,
           `black_female_20-24` <span class="op">=</span> <span class="va">B01001B_023E</span>,
           `black_female_25-29` <span class="op">=</span> <span class="va">B01001B_024E</span>,
           `black_female_30-34` <span class="op">=</span> <span class="va">B01001B_025E</span>,
           `black_female_35-44` <span class="op">=</span> <span class="va">B01001B_026E</span>,
           `black_female_45-54` <span class="op">=</span> <span class="va">B01001B_027E</span>,
           `black_female_55-64` <span class="op">=</span> <span class="va">B01001B_028E</span>,
           black_female_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"black_female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           black_total_total <span class="op">=</span> <span class="va">black_male_total</span> <span class="op">+</span> <span class="va">black_female_total</span>,
           <span class="co"># Non-Hispanic White Male Age Groups</span>
           `white_male_00-04` <span class="op">=</span> <span class="va">B01001H_003E</span>,
           `white_male_05-09` <span class="op">=</span> <span class="va">B01001H_004E</span>,
           `white_male_10-14` <span class="op">=</span> <span class="va">B01001H_005E</span>,
           `white_male_15-19` <span class="op">=</span> <span class="va">B01001H_006E</span> <span class="op">+</span> <span class="va">B01001H_007E</span>,
           `white_male_20-24` <span class="op">=</span> <span class="va">B01001H_008E</span>,
           `white_male_25-29` <span class="op">=</span> <span class="va">B01001H_009E</span>,
           `white_male_30-34` <span class="op">=</span> <span class="va">B01001H_010E</span>,
           `white_male_35-44` <span class="op">=</span> <span class="va">B01001H_011E</span>,
           `white_male_45-54` <span class="op">=</span> <span class="va">B01001H_012E</span>,
           `white_male_55-64` <span class="op">=</span> <span class="va">B01001H_013E</span>,
           white_male_total  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"white_male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># Non-Hispanic White Female Age Groups</span>
           `white_female_00-04` <span class="op">=</span> <span class="va">B01001H_018E</span>,
           `white_female_05-09` <span class="op">=</span> <span class="va">B01001H_019E</span>,
           `white_female_10-14` <span class="op">=</span> <span class="va">B01001H_020E</span>,
           `white_female_15-19` <span class="op">=</span> <span class="va">B01001H_021E</span> <span class="op">+</span> <span class="va">B01001H_022E</span>,
           `white_female_20-24` <span class="op">=</span> <span class="va">B01001H_023E</span>,
           `white_female_25-29` <span class="op">=</span> <span class="va">B01001H_024E</span>,
           `white_female_30-34` <span class="op">=</span> <span class="va">B01001H_025E</span>,
           `white_female_35-44` <span class="op">=</span> <span class="va">B01001H_026E</span>,
           `white_female_45-54` <span class="op">=</span> <span class="va">B01001H_027E</span>,
           `white_female_55-64` <span class="op">=</span> <span class="va">B01001H_028E</span>,
           white_female_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"white_female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           white_total_total <span class="op">=</span> <span class="va">white_male_total</span> <span class="op">+</span> <span class="va">white_female_total</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"B0"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"total"</span><span class="op">)</span>,
                          <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"black"</span><span class="op">)</span>,
                          <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"white"</span><span class="op">)</span><span class="op">)</span>,
                 names_to  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"race_group"</span>, <span class="st">"sex"</span>, <span class="st">"age_cat"</span><span class="op">)</span>,
                 names_sep <span class="op">=</span> <span class="st">"_"</span>,
                 values_to <span class="op">=</span> <span class="st">"population"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_cat   <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">age_cat</span> <span class="op">==</span> <span class="st">"00-04"</span> <span class="op">~</span> <span class="st">"0-4"</span>,
                                 <span class="va">age_cat</span> <span class="op">==</span> <span class="st">"05-09"</span> <span class="op">~</span> <span class="st">"5-9"</span>,
                                 <span class="va">age_cat</span> <span class="op">==</span> <span class="st">"total"</span> <span class="op">~</span> <span class="st">"Total"</span>,
                                 <span class="cn">TRUE</span>               <span class="op">~</span> <span class="va">age_cat</span><span class="op">)</span>,
           sex       <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>,
           race_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="st">"white"</span>  <span class="op">~</span> <span class="st">"Non-Hispanic White"</span>,
                                  <span class="va">race_group</span> <span class="op">==</span> <span class="st">"black"</span>  <span class="op">~</span> <span class="st">"Black"</span>,
                                  <span class="va">race_group</span> <span class="op">==</span> <span class="st">"total"</span>  <span class="op">~</span> <span class="st">"Total"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>           
<span class="co"># Combining all 5 years into one dataset</span>
<span class="va">ma_denominator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ma_denominator</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_denominator</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_denominator</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_denominator</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_denominator</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">GEOID10</span>, GEO_NAME <span class="op">=</span> <span class="va">NAME</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="va">GEOID</span><span class="op">)</span>
<span class="co"># saveRDS(ma_denominator, file = "ma_denominator.RDS")</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Area Based Social Metric</span>
<span class="va">ma_absm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ma_absm</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2013</span>,<span class="fl">2014</span>,<span class="fl">2015</span>,<span class="fl">2016</span>,<span class="fl">2017</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">nm</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ma_absm</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ma_absm</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"tract"</span>,
                           variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B01003_001E"</span>,
                                         <span class="st">"B19001_001E"</span>,
                                         <span class="st">"B19001_002E"</span>,<span class="st">"B19001_003E"</span>,<span class="st">"B19001_004E"</span>,<span class="st">"B19001_005E"</span>,
                                         <span class="st">"B19001_014E"</span>,<span class="st">"B19001_015E"</span>,<span class="st">"B19001_016E"</span>,<span class="st">"B19001_017E"</span>,
                                         <span class="st">"B19001H_002E"</span>,<span class="st">"B19001H_003E"</span>,<span class="st">"B19001H_004E"</span>,<span class="st">"B19001H_005E"</span>,
                                         <span class="st">"B19001H_014E"</span>,<span class="st">"B19001H_015E"</span>,<span class="st">"B19001H_016E"</span>,<span class="st">"B19001H_017E"</span><span class="op">)</span>, 
                           year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>,
                           output <span class="op">=</span> <span class="st">"wide"</span>,
                           state <span class="op">=</span> <span class="st">"MA"</span>,
                           geometry <span class="op">=</span> <span class="cn">FALSE</span>,
                           key <span class="op">=</span> <span class="st">"4407a63721e192545e1e2a2fc7f6920477b10108"</span>,
                           moe_level <span class="op">=</span> <span class="fl">95</span>,
                           survey <span class="op">=</span> <span class="st">"acs5"</span>,
                           cache_table <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="co"># Transforming ACS variables into the ABSM's we want to use for our dataset</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>GEOID10 <span class="op">=</span> <span class="va">GEOID</span>,
           pop_total <span class="op">=</span> <span class="va">B01003_001E</span>,
           ICEwnhinc <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="va">B19001H_014E</span> <span class="op">+</span> <span class="va">B19001H_015E</span> <span class="op">+</span> <span class="va">B19001H_016E</span> <span class="op">+</span> <span class="va">B19001H_017E</span><span class="op">)</span> <span class="op">-</span> 
                        <span class="op">(</span><span class="va">B19001_002E</span> <span class="op">+</span> <span class="va">B19001_003E</span> <span class="op">+</span> <span class="va">B19001_004E</span> <span class="op">+</span> <span class="va">B19001_005E</span> <span class="op">-</span> 
                         <span class="va">B19001H_002E</span> <span class="op">-</span> <span class="va">B19001H_003E</span> <span class="op">-</span> <span class="va">B19001H_004E</span> <span class="op">-</span> <span class="va">B19001H_005E</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">B19001_001E</span>,           year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">pop_total</span>, <span class="va">ICEwnhinc</span>, <span class="va">year</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">ma_absm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ma_absm</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
                 <span class="va">ma_absm</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,
                 <span class="va">ma_absm</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,
                 <span class="va">ma_absm</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,
                 <span class="va">ma_absm</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">GEOID10</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Weighting the ICE measure across all 5 years for visualization and analysis </span>
<span class="va">ma_absm_sum</span> <span class="op">&lt;-</span> <span class="va">ma_absm</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>wt <span class="op">=</span> <span class="va">pop_total</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pop_total</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>ICEwnhinc        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ICEwnhinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            pop_total        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pop_total</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ICE_qt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">ICEwnhinc</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">ICEwnhinc</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                                probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                        na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co"># saveRDS(ma_absm_sum, file = "ma_absm_sum.RDS")</span></code></pre></div>
</div>
</div>
<div id="approach" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Approach<a class="anchor" aria-label="anchor" href="#approach"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we have our data, let’s revisit our questions of interest:</p>
<ol style="list-style-type: decimal">
<li>What is the overall socioeconomic gradient in premature mortality?</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li>What is the racialized disparity in premature mortality?</li>
<li>How does ABSM interact with individual level membership in racialized groups? (i.e., interactions between socioeconomic position and racialized groups, not just socioeconomic inequities within racialized groups)</li>
</ol>
<p>Let’s first visualize the overall socioeconomic gradient in premature mortality.</p>
<div id="what-is-the-overall-socioeconomic-gradient-in-premature-mortality" class="section level3" number="7.4.1">
<h3>
<span class="header-section-number">7.4.1</span> What is the overall socioeconomic gradient in premature mortality?<a class="anchor" aria-label="anchor" href="#what-is-the-overall-socioeconomic-gradient-in-premature-mortality"><i class="fas fa-link"></i></a>
</h3>
<p>Before we try to see how our ABSM might impact premature mortality, let us first assess how the ICE measure is distributed across space in Massachusetts. We can visualize this using a map. In order to map our data, we will need to add geometries to our dataset. We will import a census tract shapefile produced by the government of <a href="https://www.mass.gov/info-details/massgis-data-municipalities">Massachusetts</a>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tract_geometry</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"CENSUS2010_BLK_BG_TRCT_SHP"</span>,
                       layer <span class="op">=</span> <span class="st">"CENSUS2010TRACTS_POLY"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id_order <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">id_order</span><span class="op">)</span></code></pre></div>
<p>This code adds the census tract geometries to our ICE data, and then creates a map. There are several lines, each referring to a different customization of the map. <code>ggplot2</code> has many such options, you can learn more about these <a href="https://ggplot2.tidyverse.org/">here</a></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map.ice</span> <span class="op">&lt;-</span> <span class="va">ma_absm_sum</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by <span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>, fill<span class="op">=</span><span class="va">ICE_qt</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>, size<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"Census Tract ICE"</span>, 
         x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span>, 
         title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Census Tract Level Index of Concentration at the Extremes"</span>,
                             <span class="st">"Massachusetts, 5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Oranges"</span>, direction<span class="op">=</span><span class="op">-</span><span class="fl">1</span>, na.value<span class="op">=</span><span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis labels</span>
          axis.ticks.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis ticks</span>
          axis.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co">#remove y axis labels</span>
          axis.ticks.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
          legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># ggsave("your_file_path/map.ice.png")</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/map.ice.png" width="100%"></div>
<div class="infobox interpretation">
<p>This map is showing us how the ICE measure is distributed across the state of Massachusetts. This particular iteration of ICE compares high-income Non-Hispanic White people with low-income people of Color. When ICE is low, those neighborhoods are concentrated with low-income people of Color. At 0, there is no extreme concentration (or, alternatively, the polarization is balanced). And when ICE is higher, there is a high concentration of high-income Non-Hispanic White people.</p>
</div>
<p>Next, we will visualize our premature mortality data, using spatial models. In order to do this, we will first utilize the indirect method to age-standardize the data. Once we have the data age-standardized we can calculate raw standardized mortality ratios (SMRs).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate reference rates by age for MA overall</span>
<span class="co"># This will give us overall totals, and remove the race specific information we arent interested in right now</span>
<span class="va">ma_total_pop</span> <span class="op">&lt;-</span> <span class="va">ma_denominator</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="st">"Total"</span><span class="op">)</span> 
<span class="co"># This will align the mortality counts with those denominators so we can create total population expected death rates for each age group</span>
<span class="va">reference_rates</span> <span class="op">&lt;-</span> <span class="va">ma_mort_ct</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="st">"Total"</span>,
         <span class="va">sex</span> <span class="op">!=</span> <span class="st">"Total"</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">year</span>, <span class="va">sex</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>deaths<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ma_total_pop</span>,
             by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID10"</span>, <span class="st">"year"</span>, <span class="st">"sex"</span>, <span class="st">"age_cat"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_cat <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"35-39"</span>,<span class="st">"40-44"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"35-44"</span>,
                             <span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"45-49"</span>,<span class="st">"50-54"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"45-54"</span>,
                             <span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"55-59"</span>,<span class="st">"60-64"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"55-64"</span>,
                             <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">age_cat</span><span class="op">)</span>,
         deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">deaths</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ref_rate <span class="op">=</span> <span class="va">num</span><span class="op">/</span><span class="va">den</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">age_cat</span>, <span class="va">ref_rate</span><span class="op">)</span>
<span class="va">ma_mort_istd</span> <span class="op">&lt;-</span> <span class="va">ma_mort_ct</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">!=</span> <span class="st">"Total"</span>,
         <span class="va">sex</span> <span class="op">!=</span> <span class="st">"Total"</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>race_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="st">"Non-Hispanic Black"</span>, <span class="st">"Black"</span>, <span class="va">race_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ma_denominator</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID10"</span>,<span class="st">"year"</span>,<span class="st">"age_cat"</span>,<span class="st">"race_group"</span>,<span class="st">"sex"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_cat <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"35-39"</span>,<span class="st">"40-44"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"35-44"</span>,
                             <span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"45-49"</span>,<span class="st">"50-54"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"45-54"</span>,
                             <span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"55-59"</span>,<span class="st">"60-64"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"55-64"</span>,
                             <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">age_cat</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">super_town</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">reference_rates</span>, by<span class="op">=</span><span class="st">"age_cat"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>expected <span class="op">=</span> <span class="va">ref_rate</span><span class="op">*</span><span class="va">population</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">super_town</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>O <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span>,
            E <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">expected</span><span class="op">)</span>,
            raw_smr <span class="op">=</span> <span class="va">O</span><span class="op">/</span><span class="va">E</span>,
            var_raw_smr <span class="op">=</span> <span class="va">O</span><span class="op">/</span><span class="va">E</span><span class="op">^</span><span class="fl">2</span>,
            raw_smr_lo95 <span class="op">=</span> <span class="va">raw_smr</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_raw_smr</span><span class="op">)</span>,
            raw_smr_up95 <span class="op">=</span> <span class="va">raw_smr</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_raw_smr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ma_absm_sum</span>, by <span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://jacobkap.github.io/fastDummies/reference/dummy_cols.html">dummy_cols</a></span><span class="op">(</span>select_columns <span class="op">=</span> <span class="st">"ICE_qt"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>ICE_qt_1  <span class="op">=</span> <span class="st">"ICE_qt_(-0.689,0.0607]"</span>,
         ICE_qt_2  <span class="op">=</span> <span class="st">"ICE_qt_(0.0607,0.245]"</span>, 
         ICE_qt_3  <span class="op">=</span> <span class="st">"ICE_qt_(0.245,0.362]"</span>,  
         ICE_qt_4  <span class="op">=</span> <span class="st">"ICE_qt_(0.362,0.465]"</span>,  
         ICE_qt_5  <span class="op">=</span> <span class="st">"ICE_qt_(0.465,0.727]"</span><span class="op">)</span> </code></pre></div>
<p>These ratios are susceptible to much of what is discussed in previous chapters with regards to infinity-magnitude rates, and smaller sample sizes inducing extreme results. But as we are going to eventually smooth this data with our model, we are not as concerned here about the state of the raw data. Here we can see our raw standardized mortality ratios extend from zero to infinity.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot.raw_smr</span> <span class="op">&lt;-</span>  <span class="va">ma_mort_istd</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">raw_smr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="va">raw_smr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">raw_smr_lo95</span>, ymax<span class="op">=</span><span class="va">raw_smr_up95</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, linetype<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Raw Standardized Mortality Ratio by Census Tract, with error"</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                 <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Census Tract"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"SMR"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># ggsave("your_file_path/plot.raw_smr.png")</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/plot.raw_smr.png" width="100%"></div>
<div class="infobox interpretation">
<p>The SMR shows us the ratio of mortality in a given census tract compared to what would be expected had that census tract had the same age_specific rates as the standard population. So an SMR greater than 1 means the area premature mortality is higher than expected. An SMR less than one means the opposite.</p>
</div>
<p>We can also map out this relationship:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Here you will see code for two maps. This block of code creates one state level map, and then a smaller, Boston area map to accompany it. This optional subsetting provides detail in an area of interest. The cowplot package combines the maps to display both in one space</span>
<span class="va">map.raw_smr_state</span> <span class="op">&lt;-</span> <span class="va">ma_mort_istd</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry<span class="op">=</span><span class="va">geometry</span>, 
                        fill<span class="op">=</span><span class="va">raw_smr</span><span class="op">)</span>,
          lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"BrBG"</span>,
                         trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                         limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                         breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, oob<span class="op">=</span><span class="va">squish</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Raw Standardized Mortality Ratios (SMR)"</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                   <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span>,
         fill <span class="op">=</span> <span class="st">"SMR"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis labels</span>
          axis.ticks.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis ticks</span>
          axis.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co">#remove y axis labels</span>
          axis.ticks.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
          legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>
<span class="va">map.raw_smr_boston</span> <span class="op">&lt;-</span> <span class="va">ma_mort_istd</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">super_town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"boston"</span>,<span class="st">"brookline"</span>,<span class="st">"chelsea"</span>,<span class="st">"cambridge"</span>,
                           <span class="st">"everett"</span>,<span class="st">"hull"</span>,<span class="st">"malden"</span>,<span class="st">"medford"</span>,<span class="st">"newton"</span>,
                           <span class="st">"somerville"</span>,<span class="st">"winthrop"</span>,<span class="st">"watertown"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="va">raw_smr</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"BrBG"</span>,
                         trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                         limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                         breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, oob<span class="op">=</span><span class="va">squish</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boston"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="st">"None"</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> 
<span class="va">map.raw_smr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.raw_smr_state</span> , x <span class="op">=</span> <span class="fl">0.00</span>, y <span class="op">=</span> <span class="fl">0.00</span>, width <span class="op">=</span> <span class="fl">0.80</span>, height <span class="op">=</span> <span class="fl">1.00</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.raw_smr_boston</span>, x <span class="op">=</span> <span class="fl">0.65</span>, y <span class="op">=</span> <span class="fl">0.50</span>, width <span class="op">=</span> <span class="fl">0.30</span>, height <span class="op">=</span> <span class="fl">0.30</span><span class="op">)</span>
<span class="co"># ggsave("your_file_path/map.raw_smr.png")</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/map.raw_smr.png" width="100%"></div>
<p>We can fit a spatial model using the <code>INLA</code> package which will “smooth” our results by fitting our data to a Besag York Mollié (BYM) model. As mentioned in previous chapters, a BYM model will adjust estimates based on the surrounding areas - instead of assuming neighboring geographies are independent, the model will assume they are similar. In order to implement this model in R, we first need to create an adjacency matrix, so that the package knows which census tracts are neighbors</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># We first want to make sure that our data file has our geometries in the same order as our shapefile - in other words, ensure that they are aligned. </span>
<span class="va">ma_mort_istd_ordered</span> <span class="op">&lt;-</span> <span class="va">ma_mort_istd</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span><span class="st">"GEOID10"</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">id_order</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">geometry</span><span class="op">)</span>
<span class="va">n.tracts</span> <span class="op">&lt;-</span> <span class="va">ma_mort_istd_ordered</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID10</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># THis code will calculate the adjacency matrix </span>
<span class="va">W.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">tract_geometry</span> , snap<span class="op">=</span><span class="fl">0.001</span><span class="op">)</span>
<span class="va">W.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">W.nb</span>, style<span class="op">=</span><span class="st">"B"</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># And this code will convert that matrix into a format INLA can understand</span>
<span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2INLA.html">nb2INLA</a></span><span class="op">(</span><span class="st">"INLA_adj_mat"</span>, <span class="va">W.nb</span><span class="op">)</span> <span class="co"># this saves a file in the working directory</span>
<span class="va">INLA_adj_mat</span> <span class="op">&lt;-</span> <span class="st">"INLA_adj_mat"</span>
<span class="co"># Intercept only ("null") BYM model </span>
<span class="va">model_form_0</span> <span class="op">&lt;-</span> <span class="va">O</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html">f</a></span><span class="op">(</span><span class="va">id_order</span>, model<span class="op">=</span><span class="st">"bym2"</span>, graph<span class="op">=</span><span class="va">INLA_adj_mat</span>, scale.model<span class="op">=</span><span class="cn">TRUE</span>, constr<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">model_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html">inla</a></span><span class="op">(</span><span class="va">model_form_0</span>, family<span class="op">=</span><span class="st">"poisson"</span>, 
                data<span class="op">=</span><span class="va">ma_mort_istd_ordered</span>, E<span class="op">=</span><span class="va">E</span>, <span class="co"># E points to the expected count field</span>
                control.predictor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>compute<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># computes transformed posterior marginals</span>
                control.compute<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dic<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># computes DIC for model fit</span>
<span class="co"># Extract posterior (meaning, after the model is accounted for) means of the area effects</span>
<span class="va">null_random</span> <span class="op">&lt;-</span> <span class="va">model_0</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">id_order</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n.tracts</span><span class="op">]</span>
<span class="co"># If we are interested in calculating the percentage of the variation that is spatially correlated, we have to do so empirically - if not, you can skip the next few lines. </span>
<span class="va">mat.marg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">n.tracts</span>, ncol<span class="op">=</span><span class="fl">100000</span><span class="op">)</span> <span class="co">#create empty matrix</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="va">model_0</span><span class="op">$</span><span class="va">marginals.random</span><span class="op">$</span><span class="va">id_order</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n.tracts</span><span class="op">)</span><span class="op">{</span>
  <span class="co">#the first block of the random effects matrix contains area-specific effects (u + v), </span>
  <span class="co">#and the second block contains spatially structured residuals (u). </span>
  <span class="co">#So this is extracting from the second block of rows</span>
  <span class="va">u</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">[[</span><span class="va">n.tracts</span><span class="op">+</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> 
  <span class="va">mat.marg</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html">inla.rmarginal</a></span><span class="op">(</span><span class="fl">100000</span>, <span class="va">u</span><span class="op">)</span> <span class="co">#randomly pick 100000 values from posterior distributions of area-specific spatially structures residuals</span>
<span class="op">}</span>
<span class="co">#Get empirical variance from 100000 obs</span>
<span class="va">var.u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">mat.marg</span>, <span class="fl">2</span>, <span class="va">var</span><span class="op">)</span> 
<span class="co">#Get unstructured variance</span>
<span class="va">var.v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html">inla.rmarginal</a></span><span class="op">(</span><span class="fl">100000</span>,
                        <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html">inla.tmarginal</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span><span class="op">/</span><span class="va">x</span>, <span class="va">model_0</span><span class="op">$</span><span class="va">marginals.hyperpar</span><span class="op">$</span><span class="va">`Precision for id_order`</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Calculate spatially structured variance percentage</span>
<span class="va">perc.var.u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">var.u</span><span class="op">/</span><span class="op">(</span><span class="va">var.u</span><span class="op">+</span><span class="va">var.v</span><span class="op">)</span><span class="op">)</span>
<span class="co"># In addition to computing the spatially structured variance, you can also compute a QR90, comparing the 95th to the 5th quantile of the random effects distribution</span>
<span class="va">qr90</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">null_random</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co"># We will append the estimated effects back onto our dataset so that we can plot and map them.</span>
<span class="va">ma_mort_istd_smoothed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>smooth_smr <span class="op">=</span> <span class="va">null_random</span>,
                                               smooth_smr_lo95 <span class="op">=</span> <span class="va">model_0</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">id_order</span><span class="op">$</span><span class="va">`0.025quant`</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n.tracts</span><span class="op">]</span>,
                                               smooth_smr_up95 <span class="op">=</span> <span class="va">model_0</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">id_order</span><span class="op">$</span><span class="va">`0.975quan`</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n.tracts</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id_order <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">ma_mort_istd_ordered</span>, by<span class="op">=</span><span class="st">"id_order"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>raw_smr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">O</span><span class="op">/</span><span class="va">E</span><span class="op">)</span><span class="op">+</span><span class="fl">0.046</span><span class="op">)</span></code></pre></div>
<p>Note the code above provides code to calculate the percentage of the variance in the data that is spatially correlated - in this case, about 45%.</p>
<p>We can now visualize our smoothed SMR. First, let’s look at a similar caterpillar plot to what we did with the raw SMR. The plot looks slightly flatter, and notably, the infinity and zero values have been pulled more towards the middle of the plot.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot.smr_smooth</span> <span class="op">&lt;-</span> <span class="va">ma_mort_istd_smoothed</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">smooth_smr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">smooth_smr</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">smooth_smr_lo95</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">smooth_smr_up95</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, linetype<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Smoothed Standardized Mortality Ratio by Census Tract"</span>,
         caption <span class="op">=</span> <span class="st">"Source: Massachusetts Mortality Data 2013-2017, 5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Census Tract"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Smoothed SMR"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">plot.comp_smr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">plot.raw_smr</span>, <span class="va">plot.smr_smooth</span>,
                           ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co"># ggsave("your_file_path/plot.comp_smr.png"</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/plot.comp_smr.png" width="100%"></div>
<p>And in the map, we can see some of the color of extreme values lighten.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map.smooth_smr_state</span> <span class="op">&lt;-</span> <span class="va">ma_mort_istd_smoothed</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry<span class="op">=</span><span class="va">geometry</span>, 
                        fill<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">smooth_smr</span><span class="op">)</span><span class="op">)</span>,
          lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"BrBG"</span>,
                         trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                         limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.01</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                         breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, oob<span class="op">=</span><span class="va">squish</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Smoothed Standardized Mortality Ratios (SMR)"</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                   <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span>,
         fill <span class="op">=</span> <span class="st">"Smoothed SMR"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis labels</span>
          axis.ticks.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis ticks</span>
          axis.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co">#remove y axis labels</span>
          axis.ticks.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
          legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>
<span class="va">map.smooth_smr_boston</span> <span class="op">&lt;-</span> <span class="va">ma_mort_istd_smoothed</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">super_town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"boston"</span>,<span class="st">"brookline"</span>,<span class="st">"chelsea"</span>,<span class="st">"cambridge"</span>,
                           <span class="st">"everett"</span>,<span class="st">"hull"</span>,<span class="st">"malden"</span>,<span class="st">"medford"</span>,<span class="st">"newton"</span>,
                           <span class="st">"somerville"</span>,<span class="st">"winthrop"</span>,<span class="st">"watertown"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">smooth_smr</span><span class="op">)</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"BrBG"</span>,
                         trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                         limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.01</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                         breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, oob<span class="op">=</span><span class="va">squish</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boston"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="st">"None"</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> 
<span class="va">map.smooth_smr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.smooth_smr_state</span> , x <span class="op">=</span> <span class="fl">0.00</span>, y <span class="op">=</span> <span class="fl">0.00</span>, width <span class="op">=</span> <span class="fl">0.80</span>, height <span class="op">=</span> <span class="fl">1.00</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.smooth_smr_boston</span>, x <span class="op">=</span> <span class="fl">0.65</span>, y <span class="op">=</span> <span class="fl">0.50</span>, width <span class="op">=</span> <span class="fl">0.30</span>, height <span class="op">=</span> <span class="fl">0.30</span><span class="op">)</span>
<span class="va">map.comp_smr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">map.raw_smr</span>, <span class="va">map.smooth_smr</span>,
                           ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co"># ggsave("your_file_path/map.comp_smr.png")</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/map.comp_smr.png" width="100%"></div>
<p>We can see from the plot and the map that while there is still variation in the spatially smoothed SMR - it is a bit less extreme in some areas than the raw SMR. To get a sense of how premature mortality varies with respect to ICE, we should look at a model that adjusts for our ICE data and see if there are any changes in variation.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Code to include our ABSM</span>
<span class="va">model_form_1</span> <span class="op">&lt;-</span> <span class="va">O</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html">f</a></span><span class="op">(</span><span class="va">id_order</span>, model<span class="op">=</span><span class="st">'bym2'</span>, graph<span class="op">=</span><span class="va">INLA_adj_mat</span>, scale.model<span class="op">=</span><span class="cn">TRUE</span>, constr<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="va">ICE_qt_2</span> <span class="op">+</span> <span class="va">ICE_qt_3</span> <span class="op">+</span> <span class="va">ICE_qt_4</span> <span class="op">+</span> <span class="va">ICE_qt_5</span> <span class="op">+</span> <span class="va">ICE_qt_NA</span>
<span class="va">model_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html">inla</a></span><span class="op">(</span><span class="va">model_form_1</span>, family<span class="op">=</span><span class="st">"poisson"</span>,
                data <span class="op">=</span> <span class="va">ma_mort_istd_ordered</span>,
                E<span class="op">=</span><span class="va">E</span>, <span class="co"># E points to the expected count field</span>
                control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>compute<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># computes transformed posterior marginals</span>
                control.compute   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dic<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># computes DIC for model fit</span>
<span class="co"># We can use this code to extract results of the model</span>
<span class="va">fixed_results</span> <span class="op">&lt;-</span> <span class="va">model_1</span><span class="op">$</span><span class="va">summary.fixed</span> 
<span class="va">dic_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_1</span><span class="op">$</span><span class="va">dic</span><span class="op">$</span><span class="va">dic</span><span class="op">)</span>
<span class="co"># the first block of the summary.random output are the area effects (u + v)</span>
<span class="va">random_results</span> <span class="op">&lt;-</span> <span class="va">model_1</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">id_order</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n.tracts</span><span class="op">]</span>
<span class="co"># and this code pulls out the residual results after adjusting for ICE</span>
<span class="va">risk_residuals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ice_residuals <span class="op">=</span> <span class="va">random_results</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id_order <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co"># append to dataset of other model effects</span>
<span class="va">ma_mort_istd_adj</span> <span class="op">&lt;-</span> <span class="va">ma_mort_istd_smoothed</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">risk_residuals</span>, by<span class="op">=</span><span class="st">"id_order"</span><span class="op">)</span>
<span class="co"># Visualize map after adjusting for ICE</span>
<span class="va">map.adj_smr_state</span> <span class="op">&lt;-</span> <span class="va">ma_mort_istd_adj</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID10"</span>,<span class="st">"id_order"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>, 
                        fill     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">ice_residuals</span><span class="op">)</span><span class="op">)</span>,
          lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"BrBG"</span>,
                         trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                         limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.01</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                         breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, oob<span class="op">=</span><span class="va">squish</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Residual Standardized Mortality Ratios after adjusting for ICE"</span>,
       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                 <span class="st">"5-Year ACS files from end-years 2015-2019"</span>,
                                 <span class="st">"National Air Toxin Assessment, 2017"</span><span class="op">)</span><span class="op">)</span>,
       fill <span class="op">=</span> <span class="st">"Adjusted SMR"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis labels</span>
        axis.ticks.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis ticks</span>
        axis.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co">#remove y axis labels</span>
        axis.ticks.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>
<span class="va">map.adj_smr_boston</span> <span class="op">&lt;-</span> <span class="va">ma_mort_istd_adj</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID10"</span>,<span class="st">"id_order"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">super_town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"boston"</span>,<span class="st">"brookline"</span>,<span class="st">"chelsea"</span>,<span class="st">"cambridge"</span>,
                           <span class="st">"everett"</span>,<span class="st">"hull"</span>,<span class="st">"malden"</span>,<span class="st">"medford"</span>,<span class="st">"newton"</span>,
                           <span class="st">"somerville"</span>,<span class="st">"winthrop"</span>,<span class="st">"watertown"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">ice_residuals</span><span class="op">)</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"BrBG"</span>,
                         trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                         limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.01</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                         breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, oob<span class="op">=</span><span class="va">squish</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boston"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="st">"None"</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> 
<span class="va">map.adj_smr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.adj_smr_state</span> , x <span class="op">=</span> <span class="fl">0.00</span>, y <span class="op">=</span> <span class="fl">0.00</span>, width <span class="op">=</span> <span class="fl">0.80</span>, height <span class="op">=</span> <span class="fl">1.00</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.adj_smr_boston</span>, x <span class="op">=</span> <span class="fl">0.65</span>, y <span class="op">=</span> <span class="fl">0.50</span>, width <span class="op">=</span> <span class="fl">0.30</span>, height <span class="op">=</span> <span class="fl">0.30</span><span class="op">)</span>
<span class="co"># ggsave("your_file_path/map.adj_smr.png")</span>
<span class="va">map.comp_smr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">map.smooth_smr</span>, <span class="va">map.adj_smr</span>,
                           ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co"># ggsave("your_file_path/map.comp_smr2.png")</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/map.comp_smr2.png" width="100%"></div>
<div class="infobox interpretation">
<p>Comparing the map adjusted for the ICE measure to the smoothed map reveals that concentration of polarized racial-economic populations did contribute to some of the impact. This is most clearly seen in the less pronounced SMRs (in both directions) after adjusting for ICE in areas of southern Boston.</p>
</div>
</div>
<div id="what-is-the-racialized-disparity-in-premature-mortality-overall" class="section level3" number="7.4.2">
<h3>
<span class="header-section-number">7.4.2</span> What is the racialized disparity in premature mortality overall?<a class="anchor" aria-label="anchor" href="#what-is-the-racialized-disparity-in-premature-mortality-overall"><i class="fas fa-link"></i></a>
</h3>
<p>We can describe inequities by racialized groups much the same way we describe inequities in ABSM - by aggregating death and population data. We already have these aggregated - now we can stratify our analysis to compare the White Non-Hispanic and Black populations. Throughout the example we may refer to these groups as White and Black as a shorthand.</p>
<div class="infobox dataWrangling">
<p>NOTE: You may have noticed that the description of the White population includes a “Non-Hispanic” designation, while the description of the Black population does not. This is a quirk of the ACS data - population counts are not readily available for the Black Non-Hispanic population. There is thus a slight mismatch in in the numerator from the mortality data (Non-Hispanic Black deaths) and denominator (Black population).</p>
</div>
<p>We will need to age-adjust our data here, as differences in premature mortality may be due to differential distribution of ages by racialized group seen here:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tab_age_race</span> <span class="op">&lt;-</span> <span class="va">ma_denominator</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Hispanic White"</span>,<span class="st">"Black"</span><span class="op">)</span>,
         <span class="va">sex</span> <span class="op">!=</span> <span class="st">"Total"</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">race_group</span>, <span class="va">sex</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">ma_absm_sum</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID10"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_cat_broad <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>,<span class="st">"5-9"</span>,<span class="st">"10-14"</span>,<span class="st">"15-19"</span>,<span class="st">"20-24"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"0-24%"</span>,
                                   <span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"25-29"</span>,<span class="st">"30-34"</span>,<span class="st">"35-39"</span>,<span class="st">"35-44"</span>,<span class="st">"40-44"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"25-44%"</span>,
                                   <span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"45-49"</span>,<span class="st">"45-54"</span>,<span class="st">"50-54"</span>,<span class="st">"55-59"</span>,<span class="st">"55-64"</span>,<span class="st">"60-64"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"45-64%"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">race_group</span>, <span class="va">age_cat_broad</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pop</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>percentage <span class="op">=</span> <span class="va">pop</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">race_group</span>, y<span class="op">=</span><span class="va">percentage</span>, fill<span class="op">=</span> <span class="va">age_cat_broad</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position<span class="op">=</span><span class="st">"stack"</span>, stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span><span class="st">"Age Distribution by Racialized Group"</span>,
         fill <span class="op">=</span> <span class="st">"Age Category"</span>,
         caption <span class="op">=</span> <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percentage of Population"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Racialized Group"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>
    
<span class="co"># ggsave("your_file_path/tab_age_race.png")</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/tab_age_race.png" width="100%"></div>
<p>We will, in this case, do a direct age adjustment to get standardized mortality ratios. This will require a reference population, which we have downloaded (and wrangled) from the National Cancer Institute (<a href="https://seer.cancer.gov/stdpopulations/" class="uri">https://seer.cancer.gov/stdpopulations/</a>). This is preferential to indirect age standardization, as the Non-Hispanic White population would drive the expected rates using that method.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">seer_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/07-premature-mortality/seer_std.RDS"</span><span class="op">)</span></code></pre></div>
<p>Let’s now age adjust our aggregated data by racialized group so we can compare standardized mortality rates.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ma_mort_dstd</span> <span class="op">&lt;-</span> <span class="va">ma_mort_ct</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>race_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="st">"Non-Hispanic Black"</span> <span class="op">~</span> <span class="st">"Black"</span>,
                                <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">race_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">ma_denominator</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>,<span class="st">"GEOID10"</span>,<span class="st">"race_group"</span>,<span class="st">"sex"</span>,<span class="st">"age_cat"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Hispanic White"</span>,<span class="st">"Black"</span><span class="op">)</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">super_town</span>, <span class="va">race_group</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">den</span> <span class="op">==</span> <span class="fl">0</span>, <span class="va">num</span>, <span class="va">den</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> <span class="co"># this line takes areas with population counts as zero, and provides the count as the number of deaths. This is an approach to resolve when population data does not align with the outcome data</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">seer_std</span>, by<span class="op">=</span><span class="st">"age_cat"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rate_i <span class="op">=</span> <span class="va">wt</span><span class="op">*</span><span class="va">num</span><span class="op">/</span><span class="va">den</span>,
         var_rate_i <span class="op">=</span> <span class="op">(</span><span class="va">num</span><span class="op">*</span><span class="va">wt</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">den</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">super_town</span>, <span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">num</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">den</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rate_i</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            var_std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">var_rate_i</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            sumwt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">wt</span><span class="op">)</span>,
            sumwt2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">wt</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>std_rate <span class="op">=</span> <span class="va">std_rate</span> <span class="op">/</span> <span class="va">sumwt</span> <span class="op">*</span><span class="fl">1000</span>,
         var_std_rate <span class="op">=</span> <span class="va">var_std_rate</span> <span class="op">/</span> <span class="va">sumwt2</span> <span class="op">*</span><span class="fl">1000</span>,
         std_rate_lo95 <span class="op">=</span> <span class="va">std_rate</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_std_rate</span><span class="op">)</span>,
         std_rate_up95 <span class="op">=</span> <span class="va">std_rate</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>
 <span class="va">plot.agg_rates</span> <span class="op">&lt;-</span> <span class="va">ma_mort_dstd</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">race_group</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"std_rate"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">std_rate</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">std_rate_lo95</span>, ymax<span class="op">=</span><span class="va">std_rate_up95</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Age-Standardized Premature Mortality Rate"</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                   <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Census Tracts"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Mortality Rates per 1000"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">race_group</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, 
          axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co"># ggsave("your_file_path/plot.agg_rates.png")</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/plot.agg_rates.png" width="100%"></div>
<p>As mortality rates increase, there also seems to be an increase in the variance of the estimates. This is because the more extreme rates we are seeing are really a product of having very small sample sizes in some districts. We can see that demonstrated by ordering the results by the population size of the census tract.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ordered.agg_rates</span> <span class="op">&lt;-</span> <span class="va">ma_mort_dstd</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">race_group</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"std_rate"</span><span class="op">)</span>, <span class="va">den</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">den</span>, y<span class="op">=</span><span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">std_rate_lo95</span>, ymax<span class="op">=</span><span class="va">std_rate_up95</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Age-Standardized Premature Mortality Rate"</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                   <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Size of Census Tract"</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Mortality Rates"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">race_group</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> 
<span class="co"># ggsave("your_file_path/ordered.agg_rates.png")</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/ordered.agg_rates.png" width="100%"></div>
<p>As we might expect, these extremely variable mortality rates are occurring in smaller populations. What do these maps look like?</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plotlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">plotlist</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Hispanic White"</span>,<span class="st">"Black"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">plt</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">plotlist</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># This loop allows us to make the same map twice, one for Non-Hispanic White, and one for Black</span>
  <span class="va">map.state</span> <span class="op">&lt;-</span> <span class="va">ma_mort_dstd</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="va">plt</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">std_rate</span> <span class="op">&gt;</span> <span class="fl">10</span>, <span class="fl">10</span>, <span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                            fill <span class="op">=</span> <span class="va">std_rate</span><span class="op">)</span>,
              lwd <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">'Blues'</span>, direction <span class="op">=</span> <span class="fl">1</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">plt</span>,
           fill <span class="op">=</span> <span class="st">"Age Standardized Mortality Rate"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis labels</span>
            axis.ticks.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis ticks</span>
            axis.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co">#remove y axis labels</span>
            axis.ticks.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
            legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
            legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">map.boston</span> <span class="op">&lt;-</span> <span class="va">ma_mort_dstd</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="va">plt</span>,
           <span class="va">super_town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"boston"</span>,<span class="st">"brookline"</span>,<span class="st">"chelsea"</span>,<span class="st">"cambridge"</span>,
                           <span class="st">"everett"</span>,<span class="st">"hull"</span>,<span class="st">"malden"</span>,<span class="st">"medford"</span>,<span class="st">"newton"</span>,
                           <span class="st">"somerville"</span>,<span class="st">"winthrop"</span>,<span class="st">"watertown"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">std_rate</span> <span class="op">&gt;</span> <span class="fl">10</span>, <span class="fl">10</span>, <span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                            fill <span class="op">=</span> <span class="va">std_rate</span><span class="op">)</span>,
              lwd <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">'Blues'</span>, direction <span class="op">=</span> <span class="fl">1</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boston"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
            legend.position <span class="op">=</span> <span class="st">"None"</span>,
            plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> 
  
  <span class="va">plotlist</span><span class="op">[[</span><span class="va">plt</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.state</span> , x <span class="op">=</span> <span class="fl">0.00</span>, y <span class="op">=</span> <span class="fl">0.00</span>, width <span class="op">=</span> <span class="fl">0.80</span>, height <span class="op">=</span> <span class="fl">1.00</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.boston</span>, x <span class="op">=</span> <span class="fl">0.65</span>, y <span class="op">=</span> <span class="fl">0.50</span>, width <span class="op">=</span> <span class="fl">0.30</span>, height <span class="op">=</span> <span class="fl">0.30</span><span class="op">)</span>
  
<span class="op">}</span>
<span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_label.html">draw_label</a></span><span class="op">(</span><span class="st">"Age Standardized Mortality Rates"</span>, size <span class="op">=</span> <span class="fl">12</span>, fontface<span class="op">=</span><span class="st">'bold'</span>, hjust <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="va">caption1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_label.html">draw_label</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, size <span class="op">=</span> <span class="fl">8</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> 
<span class="va">caption2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_label.html">draw_label</a></span><span class="op">(</span><span class="st">"5-Year ACS files from end-years 2015-2019"</span>, size <span class="op">=</span> <span class="fl">8</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> 
<span class="va">byrace_std_rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">plotlist</span>,
                              ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co"># ggsave("your_file_path/byrace_std_rates.png")</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/byrace_std_rates.png" width="100%"></div>
<p>We are seeing some really high rates in more census tracts in the Black population, where we have smaller overall sample sizes. We are also seeing many census tracts with no black population. We can also display these two maps as one, by calculating the Rate Difference, or the Rate Ratio. Here we will show the crude Rate Ratio of the Age Standardized rates. Key to interpreting this map is understanding that these rates are influenced by the small sample sizes and large potential errors we have previously visualized. It’s for researchers and communities to interpret how “real” the effects we see here are.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">irr_data</span> <span class="op">&lt;-</span> <span class="va">ma_mort_dstd</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">super_town</span>,<span class="va">race_group</span>, <span class="va">std_rate</span>, <span class="va">var_std_rate</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">super_town</span><span class="op">)</span>,
              names_from <span class="op">=</span> <span class="va">race_group</span>,
              values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">std_rate</span>, <span class="va">var_std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>irr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">`std_rate_Non-Hispanic White`</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">NA_real_</span>, <span class="va">`std_rate_Black`</span> <span class="op">/</span> <span class="va">`std_rate_Non-Hispanic White`</span><span class="op">)</span>,
         irr_var <span class="op">=</span> <span class="va">`var_std_rate_Black`</span> <span class="op">+</span> <span class="va">`var_std_rate_Non-Hispanic White`</span>,
         irr_lo95 <span class="op">=</span> <span class="va">irr</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">irr_var</span><span class="op">)</span>,
         irr_up95 <span class="op">=</span> <span class="va">irr</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">irr_var</span><span class="op">)</span><span class="op">)</span> 
<span class="va">irr_plot</span> <span class="op">&lt;-</span> <span class="va">irr_data</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">irr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="va">irr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">irr_lo95</span>, ymax<span class="op">=</span><span class="va">irr_up95</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Incidence Rate Ratio Comparing Black"</span>, 
                                 <span class="st">"and Non Hispanic White Populations"</span><span class="op">)</span><span class="op">)</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>,
                                   <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Census Tracts"</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"IRR"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> 
  
<span class="co"># ggsave("your_file_path/irr_plot.png")</span></code></pre></div>
<p>When we map the IRR, we can see the crude rate ratio between Black and Non-Hispanic White populations:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map.state.irr</span> <span class="op">&lt;-</span> <span class="va">irr_data</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>irr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">irr</span> <span class="op">&gt;</span> <span class="fl">4</span>  <span class="op">~</span> <span class="fl">4</span>,
                         <span class="va">std_rate_Black</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="cn">NA_real_</span>, <span class="co"># Setting as missing any areas with no black deaths</span>
                         <span class="cn">TRUE</span>     <span class="op">~</span> <span class="va">irr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="va">irr</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"BrBG"</span>,
                         trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                         limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                         breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, oob<span class="op">=</span><span class="va">squish</span>,
                         na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Incidence Rate Ratio Comparing Non-Hispanic Black"</span>, 
                                 <span class="st">"and Non Hispanic White Populations"</span><span class="op">)</span><span class="op">)</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>,
                                   <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span>,
         fill <span class="op">=</span> <span class="st">"IRR"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
          legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,
          plot.subtitle   <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="va">map.boston.irr</span> <span class="op">&lt;-</span> <span class="va">irr_data</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">super_town</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"boston"</span>,<span class="st">"brookline"</span>,<span class="st">"chelsea"</span>,<span class="st">"cambridge"</span>,
                           <span class="st">"everett"</span>,<span class="st">"hull"</span>,<span class="st">"malden"</span>,<span class="st">"medford"</span>,<span class="st">"newton"</span>,
                           <span class="st">"somerville"</span>,<span class="st">"winthrop"</span>,<span class="st">"watertown"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>irr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">irr</span> <span class="op">&gt;</span> <span class="fl">4</span>  <span class="op">~</span> <span class="fl">4</span>,
                         <span class="va">std_rate_Black</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="cn">NA_real_</span>,
                         <span class="cn">TRUE</span>     <span class="op">~</span> <span class="va">irr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="va">irr</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"BrBG"</span>,
                         trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                         limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                         breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, oob<span class="op">=</span><span class="va">squish</span>,
                         na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boston"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="st">"None"</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> 
<span class="va">map.irr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.state.irr</span> , x <span class="op">=</span> <span class="fl">0.00</span>, y <span class="op">=</span> <span class="fl">0.05</span>, width <span class="op">=</span> <span class="fl">0.80</span>, height <span class="op">=</span> <span class="fl">1.00</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.boston.irr</span>, x <span class="op">=</span> <span class="fl">0.65</span>, y <span class="op">=</span> <span class="fl">0.55</span>, width <span class="op">=</span> <span class="fl">0.30</span>, height <span class="op">=</span> <span class="fl">0.30</span><span class="op">)</span>
<span class="co">#ggsave("your_file_path/map.irr.png")</span></code></pre></div>
<p>So we can see from this crude map that, in areas where there were Black deaths, there was some variation in the IRR, and some very high, concerning IRR values.</p>
<div class="inline-figure"><img src="images/07-premature-mortality/map.irr.png" width="100%"></div>
</div>
<div id="what-are-the-associations-with-absm-by-racialized-group" class="section level3" number="7.4.3">
<h3>
<span class="header-section-number">7.4.3</span> What are the associations with ABSM by racialized group?<a class="anchor" aria-label="anchor" href="#what-are-the-associations-with-absm-by-racialized-group"><i class="fas fa-link"></i></a>
</h3>
<p>In order to visualize differences in how our ABSM - ICE - interacts with racialized group, we can use a poisson model for the mortality rates, and include an interaction term between racialized group and poverty. We can plot this using `INLA’ again or alternatively use a generalized linear model function. We will have to recreate our indirect standardization - this time by race, in order to include both variables in the model.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Indirect standardization to prepare the data for spatial models</span>
<span class="va">ma_mort_istd_byrace</span> <span class="op">&lt;-</span> <span class="va">ma_mort_ct</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">!=</span> <span class="st">"Total"</span>,
         <span class="va">sex</span> <span class="op">!=</span> <span class="st">"Total"</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>race_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="st">"Non-Hispanic Black"</span>, <span class="st">"Black"</span>, <span class="va">race_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Hispanic White"</span>,<span class="st">"Black"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ma_denominator</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID10"</span>,<span class="st">"year"</span>,<span class="st">"age_cat"</span>,<span class="st">"race_group"</span>,<span class="st">"sex"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_cat <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"35-39"</span>,<span class="st">"40-44"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"35-44"</span>,
                             <span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"45-49"</span>,<span class="st">"50-54"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"45-54"</span>,
                             <span class="va">age_cat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"55-59"</span>,<span class="st">"60-64"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"55-64"</span>,
                             <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">age_cat</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">super_town</span>, <span class="va">age_cat</span>, <span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">reference_rates</span>, by<span class="op">=</span><span class="st">"age_cat"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>expected <span class="op">=</span> <span class="va">ref_rate</span><span class="op">*</span><span class="va">population</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">super_town</span>, <span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>O <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span>,
            E <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">expected</span><span class="op">)</span>,
            raw_smr <span class="op">=</span> <span class="va">O</span><span class="op">/</span><span class="va">E</span>,
            var_raw_smr <span class="op">=</span> <span class="va">O</span><span class="op">/</span><span class="va">E</span><span class="op">^</span><span class="fl">2</span>,
            raw_smr_lo95 <span class="op">=</span> <span class="va">raw_smr</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_raw_smr</span><span class="op">)</span>,
            raw_smr_up95 <span class="op">=</span> <span class="va">raw_smr</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_raw_smr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ma_absm_sum</span>, by <span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu">fastDummies</span><span class="fu">::</span><span class="fu"><a href="https://jacobkap.github.io/fastDummies/reference/dummy_cols.html">dummy_cols</a></span><span class="op">(</span>select_columns<span class="op">=</span> <span class="st">"ICE_qt"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>ICE_qt_1  <span class="op">=</span> <span class="st">"ICE_qt_(-0.689,0.0607]"</span>,
         ICE_qt_2  <span class="op">=</span> <span class="st">"ICE_qt_(0.0607,0.245]"</span>, 
         ICE_qt_3  <span class="op">=</span> <span class="st">"ICE_qt_(0.245,0.362]"</span>,  
         ICE_qt_4  <span class="op">=</span> <span class="st">"ICE_qt_(0.362,0.465]"</span>,  
         ICE_qt_5  <span class="op">=</span> <span class="st">"ICE_qt_(0.465,0.727]"</span><span class="op">)</span> </code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make sure that the data file has areas in the same order as the shape file</span>
<span class="va">ma_mort_istd_byrace_ordered</span> <span class="op">&lt;-</span> <span class="va">ma_mort_istd_byrace</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">O</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">E</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span><span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">geometry</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">id_order</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>race_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">race_group</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Hispanic White"</span>, <span class="st">"Black"</span><span class="op">)</span><span class="op">)</span>,
         ICE_qt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ICE_qt</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"(0.465,0.727]"</span>,
                                          <span class="st">"(0.362,0.465]"</span>,
                                          <span class="st">"(0.245,0.362]"</span>,
                                          <span class="st">"(0.0607,0.245]"</span>,
                                          <span class="st">"(-0.689,0.0607]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># BYM model with ICE-race interaction</span>
<span class="va">model_form_2</span> <span class="op">&lt;-</span> <span class="va">O</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html">f</a></span><span class="op">(</span><span class="va">id_order</span>, model<span class="op">=</span><span class="st">'bym2'</span>, graph<span class="op">=</span><span class="va">INLA_adj_mat</span>, scale.model<span class="op">=</span><span class="cn">TRUE</span>, constr<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">race_group</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ICE_qt</span><span class="op">)</span>
<span class="co">#The following code outlines the linear combinations our model will make, so that we can calculate intersectional inequities</span>
<span class="va">linear_combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/lincomb.html">inla.make.lincombs</a></span><span class="op">(</span>
<span class="st">"factor(race_group)Black"</span>                       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,
<span class="st">"factor(ICE_qt)(0.362,0.465]"</span>                   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
<span class="st">"factor(ICE_qt)(0.245,0.362]"</span>                   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,  
<span class="st">"factor(ICE_qt)(0.0607,0.245]"</span>                  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,
<span class="st">"factor(ICE_qt)(-0.689,0.0607]"</span>                 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,
<span class="st">"factor(race_group)Black:factor(ICE_qt)(0.362,0.465]"</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
<span class="st">"factor(race_group)Black:factor(ICE_qt)(0.245,0.362]"</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
<span class="st">"factor(race_group)Black:factor(ICE_qt)(0.0607,0.245]"</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,
<span class="st">"factor(race_group)Black:factor(ICE_qt)(-0.689,0.0607]"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">model_results_lc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html">inla</a></span><span class="op">(</span><span class="va">model_form_2</span>, 
                         family<span class="op">=</span><span class="st">"poisson"</span>,
                         data<span class="op">=</span><span class="va">ma_mort_istd_byrace_ordered</span>, E<span class="op">=</span><span class="va">E</span>, 
                         control.predictor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>compute<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, 
                         control.compute<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dic<span class="op">=</span><span class="cn">TRUE</span>, waic<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,
                         lincomb <span class="op">=</span> <span class="va">linear_combinations</span><span class="op">)</span>
<span class="co"># Function to extract the fixed results</span>
<span class="va">tidy.inla.fixed</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># x = model_inla</span>
  <span class="va">term_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">)</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>terms <span class="op">=</span> <span class="va">term_names</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>term <span class="op">=</span> <span class="va">terms</span>,
                  estimate <span class="op">=</span> <span class="va">mean</span>,
                  conf.low <span class="op">=</span> <span class="va">`0.025quant`</span>, 
                  conf.high <span class="op">=</span> <span class="va">`0.975quant`</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">estimate</span>,
                  <span class="va">conf.low</span>, <span class="va">conf.high</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># Function to extract the linear combinations</span>
<span class="va">tidy.inla.lc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># x = model_inla</span>
  <span class="va">term_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">summary.lincomb.derived</span><span class="op">)</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">summary.lincomb.derived</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>terms <span class="op">=</span> <span class="va">term_names</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>term <span class="op">=</span> <span class="va">terms</span>,
                  estimate <span class="op">=</span> <span class="va">mean</span>,
                  conf.low <span class="op">=</span> <span class="va">`0.025quant`</span>, 
                  conf.high <span class="op">=</span> <span class="va">`0.975quant`</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">estimate</span>,
                  <span class="va">conf.low</span>, <span class="va">conf.high</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">tidy_fixed_results</span> <span class="op">&lt;-</span> <span class="fu">tidy.inla.fixed</span><span class="op">(</span><span class="va">model_results_lc</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">term</span><span class="op">==</span><span class="st">"(Intercept)"</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">term</span>, <span class="st">":"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col<span class="op">=</span><span class="va">term</span>, into<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pre1"</span>, <span class="st">"term"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">'\\)'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">pre1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>race_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">term</span><span class="op">==</span><span class="st">"Black"</span> <span class="op">~</span> <span class="st">"Black"</span>,
                                <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Non-Hispanic White"</span><span class="op">)</span>,
         qval <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="op">!</span><span class="va">term</span><span class="op">==</span><span class="st">"Black"</span> <span class="op">~</span> <span class="va">term</span><span class="op">)</span>,
         which <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">term</span><span class="op">==</span><span class="st">"Black"</span> <span class="op">~</span> <span class="st">"byICE_qt"</span>,
                           <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"byRace"</span><span class="op">)</span>,
         twoway <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">term</span><span class="op">==</span><span class="st">"Black"</span> <span class="op">~</span> <span class="fl">1</span>,
                            <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">tidy_lc_results</span> <span class="op">&lt;-</span>  <span class="fu">tidy.inla.lc</span><span class="op">(</span><span class="va">model_results_lc</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>race_group <span class="op">=</span> <span class="st">"Black"</span>,
         qval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">term</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lc01"</span>, <span class="st">"lc05"</span>, <span class="st">"lc09"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"(0.362,0.465]"</span>,
                                 <span class="va">term</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lc02"</span>, <span class="st">"lc06"</span>, <span class="st">"lc10"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"(0.245,0.362]"</span>,
                                 <span class="va">term</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lc03"</span>, <span class="st">"lc07"</span>, <span class="st">"lc11"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"(0.0607,0.245]"</span>,
                                 <span class="va">term</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lc04"</span>, <span class="st">"lc08"</span>, <span class="st">"lc12"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"(-0.689,0.0607]"</span><span class="op">)</span>,
                       levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">ma_mort_istd_byrace_ordered</span><span class="op">$</span><span class="va">ICE_qt</span><span class="op">)</span><span class="op">)</span>,
         which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">term</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lc01"</span>, <span class="st">"lc02"</span>, <span class="st">"lc03"</span>, <span class="st">"lc04"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"byICE_qt"</span>,
                                  <span class="va">term</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lc05"</span>, <span class="st">"lc06"</span>, <span class="st">"lc07"</span>, <span class="st">"lc08"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"byRace"</span><span class="op">)</span><span class="op">)</span>,
         twoway <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">term</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lc09"</span>, <span class="st">"lc10"</span>, <span class="st">"lc11"</span>, <span class="st">"lc12"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> ,
                            <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">interaction_effects_bym</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">tidy_fixed_results</span>, <span class="va">tidy_lc_results</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">which</span>, <span class="va">race_group</span>, <span class="va">qval</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>qval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">qval</span><span class="op">)</span>,<span class="st">"(0.465,0.727]"</span>,<span class="va">qval</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">term</span><span class="op">)</span></code></pre></div>
<p>We can look at some of these results in plots, to get a sense of the way that ICE is interacting with race to impact mortality in Massachusetts.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot black/white disparities within ICE categories</span>
<span class="va">race_effect_within_ICEqt</span> <span class="op">&lt;-</span> <span class="va">interaction_effects_bym</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">which</span> <span class="op">==</span> <span class="st">"byICE_qt"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">qval</span>, 
             y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>, 
             ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">conf.low</span><span class="op">)</span>, 
             ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">conf.high</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.2</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">1</span>, linetype<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Impact of Race on Premature Mortality, across levels of ICE"</span>,
       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                 <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span>,
       x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"IRR comparing Black to White population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span>, 
        axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">65</span>, hjust<span class="op">=</span><span class="fl">1</span>, vjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Plot ABSM disparities within racial/ethnic categories, for aggregated method and Poisson robust</span>
<span class="va">ICEqt_effect_within_race</span> <span class="op">&lt;-</span> <span class="va">interaction_effects_bym</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">which</span><span class="op">==</span><span class="st">"byRace"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">qval</span>, 
             y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>, 
             ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">conf.low</span><span class="op">)</span>, 
             ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">conf.high</span><span class="op">)</span>,
             color <span class="op">=</span> <span class="va">race_group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">1</span>, linetype<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Impact of ICE on Premature Mortality, across racial categorizations"</span>,
       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                 <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span>,
       x<span class="op">=</span><span class="st">""</span>, 
       y<span class="op">=</span><span class="st">"IRR comparing ICE category to reference"</span>, 
       color <span class="op">=</span> <span class="st">"race_group"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span>, 
        axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">65</span>, hjust<span class="op">=</span><span class="fl">1</span>, vjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">interaction_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">race_effect_within_ICEqt</span>, <span class="va">ICEqt_effect_within_race</span>,
                               ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#ggsave("your_file_path/interaction_plots.png")</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/interaction_plots.png" width="100%"></div>
<div class="infobox interpretation">
<p>We can see from these plots that as areas become more heavily concentrated with Non-Hispanic White, high-income individuals, the impact of racialized group on Premature Mortality increases. In populations that are heavily concentrated with low-income People of Color (POC), the mortality rates for Non-Hispanic White individuals is higher than that of Black individuals. At the other end of the spectrum the results are insignificant (possibly because Massachusetts has less census tracts in that category) but trend the other direction.</p>
<p>When we look at the impact of ICE within racial categories we actually see very little impact for the Black population, with the impact of ICE only significantly different in the most concentrated low-income POC category. But for the Non-Hispanic White population we see larger differences from the reference, and a clear pattern where in Non-Hispanic White individuals fare much worse in neighborhoods with more low-income POC.</p>
<p>Why would this be? What have we learned about the differential impact of neighborhood context by individual racialized group membership?</p>
</div>
</div>
</div>
<div id="appendix-wrangling-your-mortality-data" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Appendix: Wrangling Your Mortality Data<a class="anchor" aria-label="anchor" href="#appendix-wrangling-your-mortality-data"><i class="fas fa-link"></i></a>
</h2>
<p>Below is some code (for example) to turn a geocoded mortality file into what has been provided to you, by merging census tracts and towns to the data, and then aggregating into groups that align with the age and racialized groups that match your denominator data.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Importing the raw mortality data, with the geocoded coordinates, converted into spatial feature (sf) data</span>
<span class="va">ma_mort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">read_rds</a></span><span class="op">(</span><span class="st">"ma_mort_geo.RDS"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>,<span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4269</span><span class="op">)</span>
<span class="co"># Importing a MA tract-level shapefile using tigris package</span>
<span class="va">tracts_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tigris/man/tracts.html">tracts</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"25"</span>, year <span class="op">=</span> <span class="st">"2010"</span><span class="op">)</span>
<span class="co"># Merging the Census Tracts to our crosswalk of towns so we know which ones need to be combined</span>
<span class="va">supertowns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"ma ct to supertinytowns.xlsx"</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span>, col_types <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>GEOID10 <span class="op">=</span> <span class="va">...1</span>,
            super_town <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="va">...2</span><span class="op">)</span><span class="op">)</span>
<span class="va">tracts_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tracts_sf</span>,<span class="va">supertowns</span>, by <span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span>
<span class="co"># Merging to geocoded mortality and dropping geometries</span>
<span class="co"># The geometries (actual stored location information) of a shapefile can be very unwieldy and slow data wrangling commands. Since we only need them to visualize our maps, we will remove them for now</span>
<span class="va">ma_mort_agg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span><span class="va">tracts_sf</span>, <span class="va">ma_mort</span>, left <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>super_town <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt1"</span>   <span class="op">~</span> <span class="st">"Super Town 1"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt2"</span>   <span class="op">~</span> <span class="st">"Super Town 2"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt3"</span>   <span class="op">~</span> <span class="st">"Super Town 3"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt4"</span>   <span class="op">~</span> <span class="st">"Super Town 4"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt5"</span>   <span class="op">~</span> <span class="st">"Super Town 5"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt6"</span>   <span class="op">~</span> <span class="st">"Super Town 6"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt7"</span>   <span class="op">~</span> <span class="st">"Super Town 7"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt8"</span>   <span class="op">~</span> <span class="st">"Super Town 8"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt9"</span>   <span class="op">~</span> <span class="st">"Super Town 9"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt10"</span>  <span class="op">~</span> <span class="st">"Super Town 10"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt11"</span>  <span class="op">~</span> <span class="st">"Super Town 11"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt12"</span>  <span class="op">~</span> <span class="st">"Super Town 12"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt13"</span>  <span class="op">~</span> <span class="st">"Super Town 13"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt14"</span>  <span class="op">~</span> <span class="st">"Super Town 14"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt15"</span>  <span class="op">~</span> <span class="st">"Super Town 15"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt16"</span>  <span class="op">~</span> <span class="st">"Super Town 16"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt17"</span>  <span class="op">~</span> <span class="st">"Super Town 17"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt18"</span>  <span class="op">~</span> <span class="st">"Super Town 18"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt19"</span>  <span class="op">~</span> <span class="st">"Super Town 19"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt20"</span>  <span class="op">~</span> <span class="st">"Super Town 20"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt21"</span>  <span class="op">~</span> <span class="st">"Super Town 21"</span>,
                                <span class="va">geo_town</span> <span class="op">!=</span> <span class="va">super_town</span> <span class="op">~</span> <span class="va">super_town</span>,
                                <span class="cn">TRUE</span>                   <span class="op">~</span> <span class="va">geo_town</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">year</span>, <span class="va">date</span>,
         <span class="va">age</span>, <span class="va">sex</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"race"</span><span class="op">)</span>, <span class="va">hisp</span>, <span class="va">immigrant</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"educ"</span><span class="op">)</span>,
         <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"icd10"</span><span class="op">)</span>,
         <span class="va">address</span>, <span class="va">zip</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"geo"</span><span class="op">)</span>, <span class="va">super_town</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"type"</span><span class="op">)</span>, <span class="va">north</span>, <span class="va">south</span>, <span class="va">east</span>, <span class="va">west</span>,
         <span class="va">GEOID10</span><span class="op">)</span>
<span class="co"># Aggregating the data by census tract and our selected variables of interest</span>
<span class="co"># Dropping deaths that occurred after age 65</span>
<span class="co"># Creating Category Totals for each variable</span>
<span class="va">ma_mort_ct</span> <span class="op">&lt;-</span> <span class="va">ma_mort_agg</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">age</span>,
                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">9</span>,<span class="fl">14</span>,<span class="fl">19</span>,<span class="fl">24</span>,<span class="fl">29</span>,<span class="fl">34</span>,<span class="fl">39</span>,<span class="fl">44</span>,<span class="fl">49</span>,<span class="fl">54</span>,<span class="fl">59</span>,<span class="fl">64</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>,  <span class="st">"5-9"</span>,  <span class="st">"10-14"</span>,<span class="st">"15-19"</span>,<span class="st">"20-24"</span>,
                                  <span class="st">"25-29"</span>,<span class="st">"30-34"</span>,<span class="st">"35-39"</span>,<span class="st">"40-44"</span>,<span class="st">"45-49"</span>,
                                  <span class="st">"50-54"</span>,<span class="st">"55-59"</span>,<span class="st">"60-64"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&lt;</span> <span class="fl">65</span>,
           <span class="va">race_group</span> <span class="op">!=</span> <span class="st">"Other"</span>,
           <span class="va">sex</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Female"</span>,<span class="st">"Male"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">race</span>, <span class="va">immigrant</span>, <span class="va">educ_years</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"icd10"</span><span class="op">)</span>,
            <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"address"</span><span class="op">)</span>, <span class="va">zip</span>, <span class="va">geo_town</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"type"</span><span class="op">)</span>,
            <span class="va">north</span>, <span class="va">south</span>, <span class="va">east</span>, <span class="va">west</span>, <span class="va">date</span>, <span class="va">hisp</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>,
           <span class="va">age_cat</span>,
           <span class="va">sex</span>,
           <span class="va">race_group</span>,
           <span class="va">super_town</span>,
           <span class="va">GEOID10</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>deaths <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">GEOID10</span>, <span class="va">super_town</span><span class="op">)</span>,
              names_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"race_group"</span>,<span class="st">"sex"</span>,<span class="st">"age_cat"</span><span class="op">)</span>,
              values_from <span class="op">=</span> <span class="va">deaths</span>,
              names_sep <span class="op">=</span> <span class="st">"__"</span>,
              values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`Black__Male__35-44` <span class="op">=</span> <span class="va">`Black__Male__35-39`</span> <span class="op">+</span> <span class="va">`Black__Male__40-44`</span>,
         `Black__Male__45-54` <span class="op">=</span> <span class="va">`Black__Male__45-49`</span> <span class="op">+</span> <span class="va">`Black__Male__50-54`</span>,
         `Black__Male__55-64` <span class="op">=</span> <span class="va">`Black__Male__55-59`</span> <span class="op">+</span> <span class="va">`Black__Male__60-64`</span>,
         `Black__Female__35-44` <span class="op">=</span> <span class="va">`Black__Female__35-39`</span> <span class="op">+</span> <span class="va">`Black__Female__40-44`</span>,
         `Black__Female__45-54` <span class="op">=</span> <span class="va">`Black__Female__45-49`</span> <span class="op">+</span> <span class="va">`Black__Female__50-54`</span>,
         `Black__Female__55-64` <span class="op">=</span> <span class="va">`Black__Female__55-59`</span> <span class="op">+</span> <span class="va">`Black__Female__60-64`</span>,
         `Non-Hispanic White__Male__35-44` <span class="op">=</span> <span class="va">`Non-Hispanic White__Male__35-39`</span> <span class="op">+</span> <span class="va">`Non-Hispanic White__Male__40-44`</span>,
         `Non-Hispanic White__Male__45-54` <span class="op">=</span> <span class="va">`Non-Hispanic White__Male__45-49`</span> <span class="op">+</span> <span class="va">`Non-Hispanic White__Male__50-54`</span>,
         `Non-Hispanic White__Male__55-64` <span class="op">=</span> <span class="va">`Non-Hispanic White__Male__55-59`</span> <span class="op">+</span> <span class="va">`Non-Hispanic White__Male__60-64`</span>,
         `Non-Hispanic White__Female__35-44` <span class="op">=</span> <span class="va">`Non-Hispanic White__Female__35-39`</span> <span class="op">+</span> <span class="va">`Non-Hispanic White__Female__40-44`</span>,
         `Non-Hispanic White__Female__45-54` <span class="op">=</span> <span class="va">`Non-Hispanic White__Female__45-49`</span> <span class="op">+</span> <span class="va">`Non-Hispanic White__Female__50-54`</span>,
         `Non-Hispanic White__Female__55-64` <span class="op">=</span> <span class="va">`Non-Hispanic White__Female__55-59`</span> <span class="op">+</span> <span class="va">`Non-Hispanic White__Female__60-64`</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">`Black__Male__0-4`</span><span class="op">:</span><span class="va">`Non-Hispanic White__Female__55-64`</span>,
               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"race_group"</span>,<span class="st">"sex"</span>,<span class="st">"age_cat"</span><span class="op">)</span>,
               names_sep <span class="op">=</span> <span class="st">"__"</span>,
               values_to <span class="op">=</span> <span class="st">"deaths"</span><span class="op">)</span>
<span class="co"># saveRDS(ma_mort_ct, file = "ma_mort_ct.RDS")               </span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="analyzing-your-data.html"><span class="header-section-number">6</span> Analyzing your data</a></div>
<div class="next"><a href="breast-cancer-mortality.html"><span class="header-section-number">8</span> Case Study 2: Breast Cancer Mortality in Massachusetts</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#premature-mortality"><span class="header-section-number">7</span> Case Study 1: Premature Mortality in Massachusetts (2013 - 2017)</a></li>
<li><a class="nav-link" href="#introduction"><span class="header-section-number">7.1</span> Introduction</a></li>
<li><a class="nav-link" href="#motivation-research-questions-and-learning-objectives"><span class="header-section-number">7.2</span> Motivation, Research Questions, and Learning Objectives</a></li>
<li>
<a class="nav-link" href="#downloading-and-wrangling-your-data"><span class="header-section-number">7.3</span> Downloading and Wrangling Your Data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#dependencies"><span class="header-section-number">7.3.1</span> Dependencies</a></li>
<li><a class="nav-link" href="#your-health-outcome-data---premature-mortality"><span class="header-section-number">7.3.2</span> Your Health Outcome Data - Premature Mortality</a></li>
<li><a class="nav-link" href="#your-denominator-data-and-absm"><span class="header-section-number">7.3.3</span> Your Denominator Data and ABSM</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#approach"><span class="header-section-number">7.4</span> Approach</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#what-is-the-overall-socioeconomic-gradient-in-premature-mortality"><span class="header-section-number">7.4.1</span> What is the overall socioeconomic gradient in premature mortality?</a></li>
<li><a class="nav-link" href="#what-is-the-racialized-disparity-in-premature-mortality-overall"><span class="header-section-number">7.4.2</span> What is the racialized disparity in premature mortality overall?</a></li>
<li><a class="nav-link" href="#what-are-the-associations-with-absm-by-racialized-group"><span class="header-section-number">7.4.3</span> What are the associations with ABSM by racialized group?</a></li>
</ul>
</li>
<li><a class="nav-link" href="#appendix-wrangling-your-mortality-data"><span class="header-section-number">7.5</span> Appendix: Wrangling Your Mortality Data</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Public Health Disparities Geocoding Project 2.0 Training Manual</strong>" was written by Christian Testa, Jarvis T Chen, Enjoli Hall, Dena Javadi, Justin Morgan, Tamara Rushovich, Sudipta Saha, Pamela D Waterman, Nancy Krieger. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
