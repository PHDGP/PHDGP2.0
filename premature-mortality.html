<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>6 Case Study 1: Premature Mortality in Massachusetts | Public Health Disparities Geocoding Project 2.0 Training Manual</title>
<meta name="author" content="Christian Testa, Jarvis T Chen, Enjoli Hall, Dena Javadi, Justin Morgan, Tamara Rushovich, Sudipta (Shu) Saha, Pamela D Waterman, Nancy Krieger">
<meta name="description" content="6.1 Introduction For this case study, we will be working with mortality data from the Massachusetts Registry of Vital Records and Statistics [https://www.mass.gov/lists/death-data] for the years...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="6 Case Study 1: Premature Mortality in Massachusetts | Public Health Disparities Geocoding Project 2.0 Training Manual">
<meta property="og:type" content="book">
<meta property="og:description" content="6.1 Introduction For this case study, we will be working with mortality data from the Massachusetts Registry of Vital Records and Statistics [https://www.mass.gov/lists/death-data] for the years...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="6 Case Study 1: Premature Mortality in Massachusetts | Public Health Disparities Geocoding Project 2.0 Training Manual">
<meta name="twitter:description" content="6.1 Introduction For this case study, we will be working with mortality data from the Massachusetts Registry of Vital Records and Statistics [https://www.mass.gov/lists/death-data] for the years...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="libs/HomeButton-0.0.1/home-button.js"></script><script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script><script src="libs/clipboard-0.0.1/setClipboardText.js"></script><link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Public Health Disparities Geocoding Project 2.0 Training Manual</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Public Health Disparities Geocoding Project 2.0 Training Manual</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="background.html"><span class="header-section-number">1</span> Background and History of Analytic Methods</a></li>
<li><a class="" href="getting-setup.html"><span class="header-section-number">2</span> Getting Setup with R and RStudio</a></li>
<li><a class="" href="getting-your-data.html"><span class="header-section-number">3</span> Getting your data</a></li>
<li><a class="" href="visualizing-your-data.html"><span class="header-section-number">4</span> Visualizing your data</a></li>
<li><a class="" href="analyzing-your-data.html"><span class="header-section-number">5</span> Analyzing your data</a></li>
<li><a class="active" href="premature-mortality.html"><span class="header-section-number">6</span> Case Study 1: Premature Mortality in Massachusetts</a></li>
<li><a class="" href="breast-cancer-mortality.html"><span class="header-section-number">7</span> Case Study 2: Breast Cancer Mortality in Massachusetts</a></li>
<li><a class="" href="cook-county-covid.html"><span class="header-section-number">8</span> Case Study 3: COVID-19 Mortality in Cook County (March 2020 - March 2022)</a></li>
<li><a class="" href="temporal-health-insurance.html"><span class="header-section-number">9</span> Case Study 4: Case Study on Temporal Trends using American Community Survey (ACS) data (2012-2019)</a></li>
<li><a class="" href="health-insurance-comparison.html"><span class="header-section-number">10</span> Case Study 5: Case Study Comparing County Analyses of Inequities in Health Insurance using ACS vs. CDC PLACES data (2019)</a></li>
<li><a class="" href="conclusions.html"><span class="header-section-number">11</span> Conclusions</a></li>
<li><a class="" href="glossary.html"><span class="header-section-number">12</span> Glossary</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="premature-mortality" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Case Study 1: Premature Mortality in Massachusetts<a class="anchor" aria-label="anchor" href="#premature-mortality"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"><i class="fas fa-link"></i></a>
</h2>
<p>For this case study, we will be working with mortality data from the Massachusetts Registry of Vital Records and Statistics [<a href="https://www.mass.gov/lists/death-data" class="uri">https://www.mass.gov/lists/death-data</a>] for the years 2013-2017. Vital Statistics registries are how states (which submit their data to the federal government) keep an official enumeration of deaths<sup>1-3</sup>; because the death certificates require data on residential address at time of death, they can be useful tools for monitoring health and health equity. Having data on the residential address of each individual allows us to geocode each observation to the physical and social environment in which the person lived. Death records also typically include demographic information about the deceased, including categories for racialized groups that conform to the 1997 US Office of Management and Budget (OMB) standards for the classification of federal data on race and ethnicity<sup>4</sup>. We will explore how social membership in racialized groups, area-based social metrics (ABSMs), and local government spending might impact premature mortality (mortality before the age of 65) across Massachusetts. To do this, we will pair our mortality data with demographic and socioeconomic data from the Census Bureau’s 5-year American Community Survey (ACS) files, and utilize expenditure reports from the government of Massachusetts.</p>
</div>
<div id="motivation-research-questions-and-learning-objectives" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Motivation, Research Questions, and Learning Objectives<a class="anchor" aria-label="anchor" href="#motivation-research-questions-and-learning-objectives"><i class="fas fa-link"></i></a>
</h2>
<p>The goal of this case study is to develop familiarity with methods of exploring and visualizing racial disparities in health data. Our specific goals will be to:</p>
<ol style="list-style-type: decimal">
<li>Download and merge different datasets for our analysis</li>
<li>Visualize and map estimates of ABSMs and premature mortality</li>
<li>Identify the relationships between racialized group, ABSMs, and premature mortality</li>
<li>Model how space may impact disparities in premature mortality</li>
</ol>
<p>The research questions we will seek to answer throughout this case study include:</p>
<ol style="list-style-type: decimal">
<li>What is the overall socioeconomic gradient in premature mortality?
1a. We can visualize this with a spatial model</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li>What is the racialized disparity overall?
2a. We can visualize this with stratified aggregate analyses</li>
<li>What are the associations with ABSM by racialized group?/ How does ABSM interact with individual level membership in racialized groups? (i.e., interactions between socioeconomic position and racialized groups, not just socioeconomic inequities within racialized groups)
3a. We can observe this using a poisson model with and interaction term</li>
<li>How does the racialized disparity vary across space?
4a. We can observe this with a multilevel model with city/town level with a random slope for racialized group
4b. We can also control for city expenditures</li>
</ol>
</div>
<div id="getting-and-wrangling-your-data" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Getting and Wrangling Your Data<a class="anchor" aria-label="anchor" href="#getting-and-wrangling-your-data"><i class="fas fa-link"></i></a>
</h2>
<p>We are providing datasets for you to use throughout these case studies that have been wrangled and reshaped for your use, and we also provide code to show how you could go through that process on your own. Once you copy and run the code for your “Dependencies” you can skip ahead to the “Approach” section and follow along with the case study without issue.</p>
<p>You can look at whole datasets in RStudio using the <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> command, or look at summaries of the datasets by simply typing the dataset name into the console.</p>
<div id="dependencies" class="section level3" number="6.3.1">
<h3>
<span class="header-section-number">6.3.1</span> Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"><i class="fas fa-link"></i></a>
</h3>
<p>You will need these packages throughout our case study</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Libraries - if this code does not run for you, you may need to run install.package("package_name")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/">tidycensus</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/walkerke/tigris">tigris</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>tigris_use_cache <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/Hmisc/">Hmisc</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jacobkap/fastDummies">fastDummies</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/">lme4</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="your-health-outcome-data---premature-mortality" class="section level3" number="6.3.2">
<h3>
<span class="header-section-number">6.3.2</span> Your Health Outcome Data - Premature Mortality<a class="anchor" aria-label="anchor" href="#your-health-outcome-data---premature-mortality"><i class="fas fa-link"></i></a>
</h3>
<p>Your data have been aggregated from individual observations into death counts by age, racialized group, census tract, and town. When you get unrestricted mortality files from government sources for research, you will likely receive files with one observation per death. After you have geocoded these observations, you will need to aggregate them up to the level of interest for your analysis. This requires aggregation not only up to the census tract level, but also age groups so we can do an appropriate age standardization, racialized groups so we can stratify our analyses by these groups, and towns so we can explore a second areal level of analysis. Below is some code (for example) to turn a raw mortality file into what has been provided to you, by merging census tracts and towns to the data, and then aggregating into groups that align with the age and racialized groups that match your denominator data. The vast majority of our area-based social metrics come from the U.S. Census, so the most detailed level for analysis available will be the census tract (for which all the ABSMs are available, which is not the case for the census block group or census block). We can use the <code>tigris</code> package to download census tract geometries and the <code>sf</code> package to link our geocoded observations to the appropriate census tracts. Ideally when performing an analysis that might include two or more levels, the smaller level (here, census tracts) would be nested entirely within the larger level (towns). In Massachusetts though, there are several towns that have such small populations that they are smaller than census tracts. For these towns, we have created a crosswalk wherein small towns have been combined to create larger super towns. These super towns each make up one census tract, so that each super town in the analysis will now have at least one census tract nested within it for an eventual multilevel analysis</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the raw mortality data, with the geocoded coordinates converted into spatial feature (sf) data</span>
<span class="va">ma_mort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">read_rds</a></span><span class="op">(</span><span class="st">"ma_mort_geo.RDS"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>,<span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4269</span><span class="op">)</span>

<span class="co"># Importing tract shapefile using tigris package</span>
<span class="va">tracts_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tigris/man/tracts.html">tracts</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"25"</span>, year <span class="op">=</span> <span class="st">"2010"</span><span class="op">)</span>

<span class="co"># Linking Census Tracts and Tiny Towns File</span>
<span class="va">supertowns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"ma ct to supertinytowns.xlsx"</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span>, col_types <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>GEOID10 <span class="op">=</span> <span class="va">...1</span>,
            super_town <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="va">...2</span><span class="op">)</span><span class="op">)</span>

<span class="va">tracts_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">tracts_sf</span>,<span class="va">supertowns</span>, by <span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span>

<span class="co"># Merging to geocoded mortality and dropping geometries</span>
<span class="co"># The geometries of a shapefile can be very unweildy and slow data wrangling commands. Since we only need them to map, we will remove them for now</span>
<span class="va">ma_mort_ct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span><span class="va">tracts_sf</span>, <span class="va">ma_mort</span>, left <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>super_town <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">GEOID10</span>   <span class="op">==</span> <span class="st">"25023500101"</span> <span class="op">~</span> <span class="st">"hull"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt1"</span>       <span class="op">~</span> <span class="st">"charlemont-colrain-hawley-heath-monroe-rowe"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt2"</span>       <span class="op">~</span> <span class="st">"cummington-middlefield-plainfield-worthington"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt3"</span>       <span class="op">~</span> <span class="st">"monterey-tyringham"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt4"</span>       <span class="op">~</span> <span class="st">"hardwick-new braintree"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt5"</span>       <span class="op">~</span> <span class="st">"bernardston-gill-leyden"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt6"</span>       <span class="op">~</span> <span class="st">"blandford-chester-granville-montgomery-russell-tolland"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt7"</span>       <span class="op">~</span> <span class="st">"sunderland-whateley"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt8"</span>       <span class="op">~</span> <span class="st">"becket-washington"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt9"</span>       <span class="op">~</span> <span class="st">"holland-wales"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt10"</span>      <span class="op">~</span> <span class="st">"peru-windsor"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt11"</span>      <span class="op">~</span> <span class="st">"goshen-williamsburg"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt12"</span>      <span class="op">~</span> <span class="st">"hancock-new ashford-richmond"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt13"</span>      <span class="op">~</span> <span class="st">"leverett-new salem-shutesbury"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt14"</span>      <span class="op">~</span> <span class="st">"sandisfield-otis"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt15"</span>      <span class="op">~</span> <span class="st">"erving-warwick-wendell"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt16"</span>      <span class="op">~</span> <span class="st">"buckland-shelburne"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt17"</span>      <span class="op">~</span> <span class="st">"alford-egremont-mount washington"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt18"</span>      <span class="op">~</span> <span class="st">"ashfield-conway"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt19"</span>      <span class="op">~</span> <span class="st">"aquinnah-chilmark-gosnold-west tisbury"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt20"</span>      <span class="op">~</span> <span class="st">"petersham-phillipston"</span>,
                                <span class="va">super_town</span> <span class="op">==</span> <span class="st">"stt21"</span>      <span class="op">~</span> <span class="st">"florida-savoy"</span>,
                                <span class="va">geo_town</span> <span class="op">!=</span> <span class="va">super_town</span>     <span class="op">~</span> <span class="va">super_town</span>,
                                <span class="cn">TRUE</span>                       <span class="op">~</span> <span class="va">geo_town</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">year</span>, <span class="va">date</span>,
         <span class="va">age</span>, <span class="va">sex</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"race"</span><span class="op">)</span>, <span class="va">hisp</span>, <span class="va">immigrant</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"educ"</span><span class="op">)</span>,
         <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"icd10"</span><span class="op">)</span>,
         <span class="va">address</span>, <span class="va">zip</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"geo"</span><span class="op">)</span>, <span class="va">super_town</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"type"</span><span class="op">)</span>, <span class="va">north</span>, <span class="va">south</span>, <span class="va">east</span>, <span class="va">west</span>,
         <span class="va">GEOID10</span><span class="op">)</span>

<span class="co"># Aggregating the data by our selected variables of interest</span>
<span class="co"># Dropping deaths that occurred after age 65</span>
<span class="co"># Creating Category Totals foe each variable</span>
<span class="va">ma_mort_agg</span> <span class="op">&lt;-</span> <span class="va">ma_mort_ct</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&lt;</span> <span class="fl">65</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">age</span>,
                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">9</span>,<span class="fl">14</span>,<span class="fl">19</span>,<span class="fl">24</span>,<span class="fl">29</span>,<span class="fl">34</span>,<span class="fl">39</span>,<span class="fl">44</span>,<span class="fl">49</span>,<span class="fl">54</span>,<span class="fl">59</span>,<span class="fl">64</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>,  <span class="st">"5-9"</span>,  <span class="st">"10-14"</span>,<span class="st">"15-19"</span>,<span class="st">"20-24"</span>,
                                  <span class="st">"25-29"</span>,<span class="st">"30-34"</span>,<span class="st">"35-39"</span>,<span class="st">"40-44"</span>,<span class="st">"45-49"</span>,
                                  <span class="st">"50-54"</span>,<span class="st">"55-59"</span>,<span class="st">"60-64"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">race</span>, <span class="va">immigrant</span>, <span class="va">educ_years</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"icd10"</span><span class="op">)</span>,
            <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"address"</span><span class="op">)</span>, <span class="va">zip</span>, <span class="va">super_town</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"type"</span><span class="op">)</span>,
            <span class="va">north</span>, <span class="va">south</span>, <span class="va">east</span>, <span class="va">west</span>, <span class="va">date</span>, <span class="va">hisp</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>,
           <span class="va">age_cat</span>,
           <span class="va">sex</span>,
           <span class="va">race_group</span>,
           <span class="va">super_town</span>,
           <span class="va">GEOID10</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>deaths <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">GEOID10</span>, <span class="va">super_town</span><span class="op">)</span>,
              names_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"race_group"</span>,<span class="st">"sex"</span>,<span class="st">"age_cat"</span><span class="op">)</span>,
              values_from <span class="op">=</span> <span class="va">deaths</span>,
              names_sep <span class="op">=</span> <span class="st">"__"</span>,
              values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`Total__Male__0-4` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Male__0-4"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Male__5-9` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Male__5-9"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Male__10-14` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Male__10-14"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Male__15-19` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Male__15-19"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Male__20-24` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Male__20-24"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Male__25-29` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Male__25-29"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Male__30-34` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Male__30-34"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Male__35-39` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Male__35-39"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Male__40-44` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Male__40-44"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Male__45-49` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Male__45-49"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Male__50-54` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Male__50-54"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Male__55-59` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Male__55-59"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Male__60-64` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Male__60-64"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
          Total__Male__Total  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Total__Male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,

         `Total__Female__0-4` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Female__0-4"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Female__5-9` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Female__5-9"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Female__10-14` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Female__10-14"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Female__15-19` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Female__15-19"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Female__20-24` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Female__20-24"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Female__25-29` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Female__25-29"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Female__30-34` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Female__30-34"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Female__35-39` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Female__35-39"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Female__40-44` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Female__40-44"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Female__45-49` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Female__45-49"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Female__50-54` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Female__50-54"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Female__55-59` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Female__55-59"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Female__Total` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Total__Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Total__Female__60-64` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"__Female__60-64"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
          Total__Total__Total  <span class="op">=</span> <span class="va">`Total__Female__Total`</span> <span class="op">+</span> <span class="va">`Total__Male__Total`</span>,

         `Non-Hispanic Black__Male__35-44` <span class="op">=</span> <span class="va">`Non-Hispanic Black__Male__35-39`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Black__Male__40-44`</span>,
         `Non-Hispanic Black__Male__45-54` <span class="op">=</span> <span class="va">`Non-Hispanic Black__Male__45-49`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Black__Male__50-54`</span>,
         `Non-Hispanic Black__Male__55-64` <span class="op">=</span> <span class="va">`Non-Hispanic Black__Male__55-59`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Black__Male__60-64`</span>,
         `Non-Hispanic Black__Male__Total` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Non-Hispanic Black__Male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,

         `Non-Hispanic Black__Female__35-44` <span class="op">=</span> <span class="va">`Non-Hispanic Black__Female__35-39`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Black__Female__40-44`</span>,
         `Non-Hispanic Black__Female__45-54` <span class="op">=</span> <span class="va">`Non-Hispanic Black__Female__45-49`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Black__Female__50-54`</span>,
         `Non-Hispanic Black__Female__55-64` <span class="op">=</span> <span class="va">`Non-Hispanic Black__Female__55-59`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Black__Female__60-64`</span>,
         `Non-Hispanic Black__Female__Total` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Non-Hispanic Black__Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Non-Hispanic Black__Total__Total` <span class="op">=</span> <span class="va">`Non-Hispanic Black__Female__Total`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Black__Male__Total`</span>,

         `Non-Hispanic Native American, Alaskan Native, Other__Male__35-44` <span class="op">=</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Male__35-39`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Male__40-44`</span>,
         `Non-Hispanic Native American, Alaskan Native, Other__Male__45-54` <span class="op">=</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Male__45-49`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Male__50-54`</span>,
         `Non-Hispanic Native American, Alaskan Native, Other__Male__55-64` <span class="op">=</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Male__55-59`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Male__60-64`</span>,
         `Non-Hispanic Native American, Alaskan Native, Other__Male__Total` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Non-Hispanic Native American, Alaskan Native, Other__Male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,

         `Non-Hispanic Native American, Alaskan Native, Other__Female__35-44` <span class="op">=</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Female__35-39`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Female__40-44`</span>,
         `Non-Hispanic Native American, Alaskan Native, Other__Female__45-54` <span class="op">=</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Female__45-49`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Female__50-54`</span>,
         `Non-Hispanic Native American, Alaskan Native, Other__Female__55-64` <span class="op">=</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Female__55-59`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Female__60-64`</span>,
         `Non-Hispanic Native American, Alaskan Native, Other__Female__Total` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Non-Hispanic Native American, Alaskan Native, Other__Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Non-Hispanic Native American, Alaskan Native, Other__Total__Total` <span class="op">=</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Female__Total`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Native American, Alaskan Native, Other__Male__Total`</span>,

         `Non-Hispanic White__Male__35-44` <span class="op">=</span> <span class="va">`Non-Hispanic White__Male__35-39`</span> <span class="op">+</span> <span class="va">`Non-Hispanic White__Male__40-44`</span>,
         `Non-Hispanic White__Male__45-54` <span class="op">=</span> <span class="va">`Non-Hispanic White__Male__45-49`</span> <span class="op">+</span> <span class="va">`Non-Hispanic White__Male__50-54`</span>,
         `Non-Hispanic White__Male__55-64` <span class="op">=</span> <span class="va">`Non-Hispanic White__Male__55-59`</span> <span class="op">+</span> <span class="va">`Non-Hispanic White__Male__60-64`</span>,
         `Non-Hispanic White__Male__Total` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Non-Hispanic White__Male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,

         `Non-Hispanic White__Female__35-44` <span class="op">=</span> <span class="va">`Non-Hispanic White__Female__35-39`</span> <span class="op">+</span> <span class="va">`Non-Hispanic White__Female__40-44`</span>,
         `Non-Hispanic White__Female__45-54` <span class="op">=</span> <span class="va">`Non-Hispanic White__Female__45-49`</span> <span class="op">+</span> <span class="va">`Non-Hispanic White__Female__50-54`</span>,
         `Non-Hispanic White__Female__55-64` <span class="op">=</span> <span class="va">`Non-Hispanic White__Female__55-59`</span> <span class="op">+</span> <span class="va">`Non-Hispanic White__Female__60-64`</span>,
         `Non-Hispanic White__Female__Total` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Non-Hispanic White__Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Non-Hispanic White__Total__Total` <span class="op">=</span> <span class="va">`Non-Hispanic White__Female__Total`</span> <span class="op">+</span> <span class="va">`Non-Hispanic White__Male__Total`</span>,

         `Non-Hispanic Asian or Pacific Islander__Male__35-44` <span class="op">=</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Male__35-39`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Male__40-44`</span>,
         `Non-Hispanic Asian or Pacific Islander__Male__45-54` <span class="op">=</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Male__45-49`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Male__50-54`</span>,
         `Non-Hispanic Asian or Pacific Islander__Male__55-64` <span class="op">=</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Male__55-59`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Male__60-64`</span>,
         `Non-Hispanic Asian or Pacific Islander__Male__Total` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Non-Hispanic Asian or Pacific Islander__Male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,

         `Non-Hispanic Asian or Pacific Islander__Female__35-44` <span class="op">=</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Female__35-39`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Female__40-44`</span>,
         `Non-Hispanic Asian or Pacific Islander__Female__45-54` <span class="op">=</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Female__45-49`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Female__50-54`</span>,
         `Non-Hispanic Asian or Pacific Islander__Female__55-64` <span class="op">=</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Female__55-59`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Female__60-64`</span>,
         `Non-Hispanic Asian or Pacific Islander__Female__Total` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Non-Hispanic Asian or Pacific Islander__Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Non-Hispanic Asian or Pacific Islander__Female__Total__Total` <span class="op">=</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Female__Total`</span> <span class="op">+</span> <span class="va">`Non-Hispanic Asian or Pacific Islander__Male__Total`</span>,

         `Hispanic__Male__35-44` <span class="op">=</span> <span class="va">`Hispanic__Male__35-39`</span> <span class="op">+</span> <span class="va">`Hispanic__Male__40-44`</span>,
         `Hispanic__Male__45-54` <span class="op">=</span> <span class="va">`Hispanic__Male__45-49`</span> <span class="op">+</span> <span class="va">`Hispanic__Male__50-54`</span>,
         `Hispanic__Male__55-64` <span class="op">=</span> <span class="va">`Hispanic__Male__55-59`</span> <span class="op">+</span> <span class="va">`Hispanic__Male__60-64`</span>,
         `Hispanic__Male__Total` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Hispanic__Male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Hispanic__Female__35-44` <span class="op">=</span> <span class="va">`Hispanic__Female__35-39`</span> <span class="op">+</span> <span class="va">`Hispanic__Female__40-44`</span>,
         `Hispanic__Female__45-54` <span class="op">=</span> <span class="va">`Hispanic__Female__45-49`</span> <span class="op">+</span> <span class="va">`Hispanic__Female__50-54`</span>,
         `Hispanic__Female__55-64` <span class="op">=</span> <span class="va">`Hispanic__Female__55-59`</span> <span class="op">+</span> <span class="va">`Hispanic__Female__60-64`</span>,
         `Hispanic__Female__Total` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Hispanic__Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         `Hispanic__Total__Total` <span class="op">=</span> <span class="va">`Hispanic__Female__Total`</span> <span class="op">+</span> <span class="va">`Hispanic__Male__Total`</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">`Non-Hispanic White__Male__0-4`</span><span class="op">:</span><span class="va">`Hispanic__Total__Total`</span>,
               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"race_group"</span>,<span class="st">"sex"</span>,<span class="st">"age_cat"</span><span class="op">)</span>,
               names_sep <span class="op">=</span> <span class="st">"__"</span>,
               values_to <span class="op">=</span> <span class="st">"deaths"</span><span class="op">)</span>
               
<span class="va">ma_mort_agg</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##    year age_cat sex   race_group         super_town GEOID10     deaths
##   &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt; &lt;fct&gt;              &lt;chr&gt;      &lt;chr&gt;        &lt;int&gt;
## 1  2013 0-4     Male  Non-Hispanic White amesbury   25009266200      2
## 2  2013 0-4     Male  Non-Hispanic White amesbury   25009266400      1
## 3  2013 0-4     Male  Non-Hispanic White andover    25009254100      1
## 4  2013 0-4     Male  Non-Hispanic White andover    25009254301      1
## 5  2013 0-4     Male  Non-Hispanic White arlington  25017356602      1
## 6  2013 0-4     Male  Non-Hispanic White barnstable 25001015300      1</code></pre>
</div>
<div id="your-denominator-data-and-absms" class="section level3" number="6.3.3">
<h3>
<span class="header-section-number">6.3.3</span> Your Denominator Data and ABSM’s<a class="anchor" aria-label="anchor" href="#your-denominator-data-and-absms"><i class="fas fa-link"></i></a>
</h3>
<p>We download population data to use as denominators in our rates and ABSMs from the U.S. Census Bureau using the tidycensus package. This requires registering with the U.S. Census for an API key. The key is redacted here, but you can get your own from <a href="https://api.census.gov/data/key_signup.html" class="uri">https://api.census.gov/data/key_signup.html</a>. The ABSMs we will use for this analysis are percentage of the population in poverty, the Index of Concentration at the Extremes (ICE) which quantifies how persons in a specified area are concentrated into the top vs bottom of a specified societal distribution, and the ATSDR/CDC Social Vulnerability Index, which employs data on poverty, transportation access, crowded housing and other social variables to generate a measure of vulnerability for communities.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Population Denominators</span>
<span class="va">ma_demo_acs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ma_demo_acs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2013</span>,<span class="fl">2014</span>,<span class="fl">2015</span>,<span class="fl">2016</span>,<span class="fl">2017</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">nm</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ma_demo_acs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ma_demo_acs</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"tract"</span>,
                               <span class="co"># These are the myriad variables that make up the variables we intend to use</span>
                               variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B01001_003"</span>,<span class="st">"B01001_004"</span>,<span class="st">"B01001_005"</span>,<span class="st">"B01001_006"</span>,
                                             <span class="st">"B01001_007"</span>,<span class="st">"B01001_008"</span>,<span class="st">"B01001_009"</span>,<span class="st">"B01001_010"</span>,
                                             <span class="st">"B01001_011"</span>,<span class="st">"B01001_012"</span>,<span class="st">"B01001_013"</span>,<span class="st">"B01001_014"</span>,
                                             <span class="st">"B01001_015"</span>,<span class="st">"B01001_016"</span>,<span class="st">"B01001_017"</span>,<span class="st">"B01001_018"</span>,
                                             <span class="st">"B01001_019"</span>,<span class="st">"B01001_027"</span>,<span class="st">"B01001_028"</span>,<span class="st">"B01001_029"</span>,
                                             <span class="st">"B01001_030"</span>,<span class="st">"B01001_031"</span>,<span class="st">"B01001_032"</span>,<span class="st">"B01001_033"</span>,
                                             <span class="st">"B01001_034"</span>,<span class="st">"B01001_035"</span>,<span class="st">"B01001_036"</span>,<span class="st">"B01001_037"</span>,
                                             <span class="st">"B01001_038"</span>,<span class="st">"B01001_039"</span>,<span class="st">"B01001_040"</span>,<span class="st">"B01001_041"</span>,
                                             <span class="st">"B01001_042"</span>,<span class="st">"B01001_043"</span>, 
                                             <span class="st">"B01001B_003"</span>,<span class="st">"B01001B_004"</span>,<span class="st">"B01001B_005"</span>,<span class="st">"B01001B_006"</span>,
                                             <span class="st">"B01001B_007"</span>,<span class="st">"B01001B_008"</span>,<span class="st">"B01001B_009"</span>,<span class="st">"B01001B_010"</span>,
                                             <span class="st">"B01001B_011"</span>,<span class="st">"B01001B_012"</span>,<span class="st">"B01001B_013"</span>,<span class="st">"B01001B_018"</span>,
                                             <span class="st">"B01001B_019"</span>,<span class="st">"B01001B_020"</span>,<span class="st">"B01001B_021"</span>,<span class="st">"B01001B_022"</span>,
                                             <span class="st">"B01001B_023"</span>,<span class="st">"B01001B_024"</span>,<span class="st">"B01001B_025"</span>,<span class="st">"B01001B_026"</span>,
                                             <span class="st">"B01001B_027"</span>,<span class="st">"B01001B_028"</span>, 
                                             <span class="st">"B01001C_003"</span>,<span class="st">"B01001C_004"</span>,<span class="st">"B01001C_005"</span>,<span class="st">"B01001C_006"</span>,
                                             <span class="st">"B01001C_007"</span>,<span class="st">"B01001C_008"</span>,<span class="st">"B01001C_009"</span>,<span class="st">"B01001C_010"</span>,
                                             <span class="st">"B01001C_011"</span>,<span class="st">"B01001C_012"</span>,<span class="st">"B01001C_013"</span>,<span class="st">"B01001C_018"</span>,
                                             <span class="st">"B01001C_019"</span>,<span class="st">"B01001C_020"</span>,<span class="st">"B01001C_021"</span>,<span class="st">"B01001C_022"</span>,
                                             <span class="st">"B01001C_023"</span>,<span class="st">"B01001C_024"</span>,<span class="st">"B01001C_025"</span>,<span class="st">"B01001C_026"</span>,
                                             <span class="st">"B01001C_027"</span>,<span class="st">"B01001C_028"</span>, 
                                             <span class="st">"B01001D_003"</span>,<span class="st">"B01001D_004"</span>,<span class="st">"B01001D_005"</span>,<span class="st">"B01001D_006"</span>,
                                             <span class="st">"B01001D_007"</span>,<span class="st">"B01001D_008"</span>,<span class="st">"B01001D_009"</span>,<span class="st">"B01001D_010"</span>,
                                             <span class="st">"B01001D_011"</span>,<span class="st">"B01001D_012"</span>,<span class="st">"B01001D_013"</span>,<span class="st">"B01001D_018"</span>,
                                             <span class="st">"B01001D_019"</span>,<span class="st">"B01001D_020"</span>,<span class="st">"B01001D_021"</span>,<span class="st">"B01001D_022"</span>,
                                             <span class="st">"B01001D_023"</span>,<span class="st">"B01001D_024"</span>,<span class="st">"B01001D_025"</span>,<span class="st">"B01001D_026"</span>,
                                             <span class="st">"B01001D_027"</span>,<span class="st">"B01001D_028"</span>, 
                                             <span class="st">"B01001E_003"</span>,<span class="st">"B01001E_004"</span>,<span class="st">"B01001E_005"</span>,<span class="st">"B01001E_006"</span>,
                                             <span class="st">"B01001E_007"</span>,<span class="st">"B01001E_008"</span>,<span class="st">"B01001E_009"</span>,<span class="st">"B01001E_010"</span>,
                                             <span class="st">"B01001E_011"</span>,<span class="st">"B01001E_012"</span>,<span class="st">"B01001E_013"</span>,<span class="st">"B01001E_018"</span>,
                                             <span class="st">"B01001E_019"</span>,<span class="st">"B01001E_020"</span>,<span class="st">"B01001E_021"</span>,<span class="st">"B01001E_022"</span>,
                                             <span class="st">"B01001E_023"</span>,<span class="st">"B01001E_024"</span>,<span class="st">"B01001E_025"</span>,<span class="st">"B01001E_026"</span>,
                                             <span class="st">"B01001E_027"</span>,<span class="st">"B01001E_028"</span>, 
                                             <span class="st">"B01001H_003"</span>,<span class="st">"B01001H_004"</span>,<span class="st">"B01001H_005"</span>,<span class="st">"B01001H_006"</span>,
                                             <span class="st">"B01001H_007"</span>,<span class="st">"B01001H_008"</span>,<span class="st">"B01001H_009"</span>,<span class="st">"B01001H_010"</span>,
                                             <span class="st">"B01001H_011"</span>,<span class="st">"B01001H_012"</span>,<span class="st">"B01001H_013"</span>,<span class="st">"B01001H_018"</span>,
                                             <span class="st">"B01001H_019"</span>,<span class="st">"B01001H_020"</span>,<span class="st">"B01001H_021"</span>,<span class="st">"B01001H_022"</span>,
                                             <span class="st">"B01001H_023"</span>,<span class="st">"B01001H_024"</span>,<span class="st">"B01001H_025"</span>,<span class="st">"B01001H_026"</span>,
                                             <span class="st">"B01001H_027"</span>, <span class="st">"B01001H_028"</span>, 
                                             <span class="st">"B01001I_003"</span>,<span class="st">"B01001I_004"</span>,<span class="st">"B01001I_005"</span>,<span class="st">"B01001I_006"</span>,
                                             <span class="st">"B01001I_007"</span>,<span class="st">"B01001I_008"</span>,<span class="st">"B01001I_009"</span>,<span class="st">"B01001I_010"</span>,
                                             <span class="st">"B01001I_011"</span>,<span class="st">"B01001I_012"</span>,<span class="st">"B01001I_013"</span>,<span class="st">"B01001I_018"</span>,
                                             <span class="st">"B01001I_019"</span>,<span class="st">"B01001I_020"</span>,<span class="st">"B01001I_021"</span>,<span class="st">"B01001I_022"</span>,
                                             <span class="st">"B01001I_023"</span>,<span class="st">"B01001I_024"</span>,<span class="st">"B01001I_025"</span>,<span class="st">"B01001I_026"</span>,
                                             <span class="st">"B01001I_027"</span>,<span class="st">"B01001I_028"</span><span class="op">)</span>, 
                               year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>,
                               output <span class="op">=</span> <span class="st">"wide"</span>,
                               state <span class="op">=</span> <span class="st">"MA"</span>,
                               geometry <span class="op">=</span> <span class="cn">FALSE</span>,
                               moe_level <span class="op">=</span> <span class="fl">95</span>,
                               survey <span class="op">=</span> <span class="st">"acs5"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="co"># Here, we will transform those variables into variables that align better with our outcome data</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span>,
           GEOID10 <span class="op">=</span> <span class="va">GEOID</span>,
           <span class="co"># Total Male Age Groups</span>
           `total_male_00-04` <span class="op">=</span> <span class="va">B01001_003E</span>,
           `total_male_05-09` <span class="op">=</span> <span class="va">B01001_004E</span>,
           `total_male_10-14` <span class="op">=</span> <span class="va">B01001_005E</span>,
           `total_male_15-19` <span class="op">=</span> <span class="va">B01001_006E</span> <span class="op">+</span> <span class="va">B01001_007E</span>,
           `total_male_20-24` <span class="op">=</span> <span class="va">B01001_008E</span> <span class="op">+</span> <span class="va">B01001_009E</span> <span class="op">+</span> <span class="va">B01001_010E</span>,
           `total_male_25-29` <span class="op">=</span> <span class="va">B01001_011E</span>,
           `total_male_30-34` <span class="op">=</span> <span class="va">B01001_012E</span>,
           `total_male_35-39` <span class="op">=</span> <span class="va">B01001_013E</span>,
           `total_male_40-44` <span class="op">=</span> <span class="va">B01001_014E</span>,
           `total_male_45-49` <span class="op">=</span> <span class="va">B01001_015E</span>,
           `total_male_50-54` <span class="op">=</span> <span class="va">B01001_016E</span>,
           `total_male_55-59` <span class="op">=</span> <span class="va">B01001_017E</span>,
           `total_male_60-64` <span class="op">=</span> <span class="va">B01001_018E</span> <span class="op">+</span> <span class="va">B01001_019E</span>,
           total_male_total  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"total_male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># Total Female Age Groups</span>
           `total_female_00-04` <span class="op">=</span> <span class="va">B01001_027E</span>,
           `total_female_05-09` <span class="op">=</span> <span class="va">B01001_028E</span>,
           `total_female_10-14` <span class="op">=</span> <span class="va">B01001_029E</span>,
           `total_female_15-19` <span class="op">=</span> <span class="va">B01001_030E</span> <span class="op">+</span> <span class="va">B01001_031E</span>,
           `total_female_20-24` <span class="op">=</span> <span class="va">B01001_032E</span> <span class="op">+</span> <span class="va">B01001_033E</span> <span class="op">+</span> <span class="va">B01001_034E</span>,
           `total_female_25-29` <span class="op">=</span> <span class="va">B01001_035E</span>,
           `total_female_30-34` <span class="op">=</span> <span class="va">B01001_036E</span>,
           `total_female_35-39` <span class="op">=</span> <span class="va">B01001_037E</span>,
           `total_female_40-44` <span class="op">=</span> <span class="va">B01001_038E</span>,
           `total_female_45-49` <span class="op">=</span> <span class="va">B01001_039E</span>,
           `total_female_50-54` <span class="op">=</span> <span class="va">B01001_040E</span>,
           `total_female_55-59` <span class="op">=</span> <span class="va">B01001_041E</span>,
           `total_female_60-64` <span class="op">=</span> <span class="va">B01001_042E</span> <span class="op">+</span> <span class="va">B01001_043E</span>,
           total_female_total  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"total_female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           total_total_total   <span class="op">=</span> <span class="va">total_male_total</span> <span class="op">+</span> <span class="va">total_female_total</span>,
           <span class="co"># Black Male Age Groups</span>
           `black_male_00-04` <span class="op">=</span> <span class="va">B01001B_003E</span>,
           `black_male_05-09` <span class="op">=</span> <span class="va">B01001B_004E</span>,
           `black_male_10-14` <span class="op">=</span> <span class="va">B01001B_005E</span>,
           `black_male_15-19` <span class="op">=</span> <span class="va">B01001B_006E</span> <span class="op">+</span> <span class="va">B01001B_007E</span>,
           `black_male_20-24` <span class="op">=</span> <span class="va">B01001B_008E</span>,
           `black_male_25-29` <span class="op">=</span> <span class="va">B01001B_009E</span>,
           `black_male_30-34` <span class="op">=</span> <span class="va">B01001B_010E</span>,
           `black_male_35-44` <span class="op">=</span> <span class="va">B01001B_011E</span>,
           `black_male_45-54` <span class="op">=</span> <span class="va">B01001B_012E</span>,
           `black_male_55-64` <span class="op">=</span> <span class="va">B01001B_013E</span>,
           black_male_total  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"black_male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># Black Female Age Groups</span>
           `black_female_00-04` <span class="op">=</span> <span class="va">B01001B_018E</span>,
           `black_female_05-09` <span class="op">=</span> <span class="va">B01001B_019E</span>,
           `black_female_10-14` <span class="op">=</span> <span class="va">B01001B_020E</span>,
           `black_female_15-19` <span class="op">=</span> <span class="va">B01001B_021E</span> <span class="op">+</span> <span class="va">B01001B_022E</span>,
           `black_female_20-24` <span class="op">=</span> <span class="va">B01001B_023E</span>,
           `black_female_25-29` <span class="op">=</span> <span class="va">B01001B_024E</span>,
           `black_female_30-34` <span class="op">=</span> <span class="va">B01001B_025E</span>,
           `black_female_35-44` <span class="op">=</span> <span class="va">B01001B_026E</span>,
           `black_female_45-54` <span class="op">=</span> <span class="va">B01001B_027E</span>,
           `black_female_55-64` <span class="op">=</span> <span class="va">B01001B_028E</span>,
           black_female_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"black_female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           black_total_total <span class="op">=</span> <span class="va">black_male_total</span> <span class="op">+</span> <span class="va">black_female_total</span>,
           <span class="co"># native Male Age Groups</span>
           `native_male_00-04` <span class="op">=</span> <span class="va">B01001C_003E</span>,
           `native_male_05-09` <span class="op">=</span> <span class="va">B01001C_004E</span>,
           `native_male_10-14` <span class="op">=</span> <span class="va">B01001C_005E</span>,
           `native_male_15-19` <span class="op">=</span> <span class="va">B01001C_006E</span> <span class="op">+</span> <span class="va">B01001C_007E</span>,
           `native_male_20-24` <span class="op">=</span> <span class="va">B01001C_008E</span>,
           `native_male_25-29` <span class="op">=</span> <span class="va">B01001C_009E</span>,
           `native_male_30-34` <span class="op">=</span> <span class="va">B01001C_010E</span>,
           `native_male_35-44` <span class="op">=</span> <span class="va">B01001C_011E</span>,
           `native_male_45-54` <span class="op">=</span> <span class="va">B01001C_012E</span>,
           `native_male_55-64` <span class="op">=</span> <span class="va">B01001C_013E</span>,
           native_male_total  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"native_male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># native Female Age Groups</span>
           `native_female_00-04` <span class="op">=</span> <span class="va">B01001C_018E</span>,
           `native_female_05-09` <span class="op">=</span> <span class="va">B01001C_019E</span>,
           `native_female_10-14` <span class="op">=</span> <span class="va">B01001C_020E</span>,
           `native_female_15-19` <span class="op">=</span> <span class="va">B01001C_021E</span> <span class="op">+</span> <span class="va">B01001C_022E</span>,
           `native_female_20-24` <span class="op">=</span> <span class="va">B01001C_023E</span>,
           `native_female_25-29` <span class="op">=</span> <span class="va">B01001C_024E</span>,
           `native_female_30-34` <span class="op">=</span> <span class="va">B01001C_025E</span>,
           `native_female_35-44` <span class="op">=</span> <span class="va">B01001C_026E</span>,
           `native_female_45-54` <span class="op">=</span> <span class="va">B01001C_027E</span>,
           `native_female_55-64` <span class="op">=</span> <span class="va">B01001C_028E</span>,
           native_female_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"native_female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           native_total_total <span class="op">=</span> <span class="va">native_male_total</span> <span class="op">+</span> <span class="va">native_female_total</span>,
           <span class="co"># Asian PI Male Age Groups</span>
           `asian_male_00-04` <span class="op">=</span> <span class="va">B01001D_003E</span> <span class="op">+</span> <span class="va">B01001E_003E</span>,
           `asian_male_05-09` <span class="op">=</span> <span class="va">B01001D_004E</span> <span class="op">+</span> <span class="va">B01001E_004E</span>,
           `asian_male_10-14` <span class="op">=</span> <span class="va">B01001D_005E</span> <span class="op">+</span> <span class="va">B01001E_005E</span>,
           `asian_male_15-19` <span class="op">=</span> <span class="va">B01001D_006E</span> <span class="op">+</span> <span class="va">B01001E_006E</span> <span class="op">+</span> <span class="va">B01001D_007E</span> <span class="op">+</span> <span class="va">B01001E_007E</span>,
           `asian_male_20-24` <span class="op">=</span> <span class="va">B01001D_008E</span> <span class="op">+</span> <span class="va">B01001E_008E</span>,
           `asian_male_25-29` <span class="op">=</span> <span class="va">B01001D_009E</span> <span class="op">+</span> <span class="va">B01001E_009E</span>,
           `asian_male_30-34` <span class="op">=</span> <span class="va">B01001D_010E</span> <span class="op">+</span> <span class="va">B01001E_010E</span>,
           `asian_male_35-44` <span class="op">=</span> <span class="va">B01001D_011E</span> <span class="op">+</span> <span class="va">B01001E_011E</span>,
           `asian_male_45-54` <span class="op">=</span> <span class="va">B01001D_012E</span> <span class="op">+</span> <span class="va">B01001E_012E</span>,
           `asian_male_55-64` <span class="op">=</span> <span class="va">B01001D_013E</span> <span class="op">+</span> <span class="va">B01001E_013E</span>,
           asian_male_total  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"asian_male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># Asian PI Female Age Groups</span>
           `asian_female_00-04` <span class="op">=</span> <span class="va">B01001D_018E</span> <span class="op">+</span> <span class="va">B01001E_018E</span>,
           `asian_female_05-09` <span class="op">=</span> <span class="va">B01001D_019E</span> <span class="op">+</span> <span class="va">B01001E_019E</span>,
           `asian_female_10-14` <span class="op">=</span> <span class="va">B01001D_020E</span> <span class="op">+</span> <span class="va">B01001E_020E</span>,
           `asian_female_15-19` <span class="op">=</span> <span class="va">B01001D_021E</span> <span class="op">+</span> <span class="va">B01001E_021E</span> <span class="op">+</span> <span class="va">B01001D_022E</span> <span class="op">+</span> <span class="va">B01001E_022E</span>,
           `asian_female_20-24` <span class="op">=</span> <span class="va">B01001D_023E</span> <span class="op">+</span> <span class="va">B01001E_023E</span>,
           `asian_female_25-29` <span class="op">=</span> <span class="va">B01001D_024E</span> <span class="op">+</span> <span class="va">B01001E_024E</span>,
           `asian_female_30-34` <span class="op">=</span> <span class="va">B01001D_025E</span> <span class="op">+</span> <span class="va">B01001E_025E</span>,
           `asian_female_35-44` <span class="op">=</span> <span class="va">B01001D_026E</span> <span class="op">+</span> <span class="va">B01001E_026E</span>,
           `asian_female_45-54` <span class="op">=</span> <span class="va">B01001D_027E</span> <span class="op">+</span> <span class="va">B01001E_027E</span>,
           `asian_female_55-64` <span class="op">=</span> <span class="va">B01001D_028E</span> <span class="op">+</span> <span class="va">B01001E_028E</span>,
           asian_female_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"asian_female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           asian_total_total <span class="op">=</span> <span class="va">asian_male_total</span> <span class="op">+</span> <span class="va">asian_female_total</span>,
           <span class="co"># White Male Age Groups</span>
           `white_male_00-04` <span class="op">=</span> <span class="va">B01001H_003E</span>,
           `white_male_05-09` <span class="op">=</span> <span class="va">B01001H_004E</span>,
           `white_male_10-14` <span class="op">=</span> <span class="va">B01001H_005E</span>,
           `white_male_15-19` <span class="op">=</span> <span class="va">B01001H_006E</span> <span class="op">+</span> <span class="va">B01001H_007E</span>,
           `white_male_20-24` <span class="op">=</span> <span class="va">B01001H_008E</span>,
           `white_male_25-29` <span class="op">=</span> <span class="va">B01001H_009E</span>,
           `white_male_30-34` <span class="op">=</span> <span class="va">B01001H_010E</span>,
           `white_male_35-44` <span class="op">=</span> <span class="va">B01001H_011E</span>,
           `white_male_45-54` <span class="op">=</span> <span class="va">B01001H_012E</span>,
           `white_male_55-64` <span class="op">=</span> <span class="va">B01001H_013E</span>,
           white_male_total  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"white_male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># White Female Age Groups</span>
           `white_female_00-04` <span class="op">=</span> <span class="va">B01001H_018E</span>,
           `white_female_05-09` <span class="op">=</span> <span class="va">B01001H_019E</span>,
           `white_female_10-14` <span class="op">=</span> <span class="va">B01001H_020E</span>,
           `white_female_15-19` <span class="op">=</span> <span class="va">B01001H_021E</span> <span class="op">+</span> <span class="va">B01001H_022E</span>,
           `white_female_20-24` <span class="op">=</span> <span class="va">B01001H_023E</span>,
           `white_female_25-29` <span class="op">=</span> <span class="va">B01001H_024E</span>,
           `white_female_30-34` <span class="op">=</span> <span class="va">B01001H_025E</span>,
           `white_female_35-44` <span class="op">=</span> <span class="va">B01001H_026E</span>,
           `white_female_45-54` <span class="op">=</span> <span class="va">B01001H_027E</span>,
           `white_female_55-64` <span class="op">=</span> <span class="va">B01001H_028E</span>,
           white_female_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"white_female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           white_total_total <span class="op">=</span> <span class="va">white_male_total</span> <span class="op">+</span> <span class="va">white_female_total</span>,
           <span class="co"># Hispanic Male Age Groups</span>
           `hisp_male_00-04` <span class="op">=</span> <span class="va">B01001I_003E</span>,
           `hisp_male_05-09` <span class="op">=</span> <span class="va">B01001I_004E</span>,
           `hisp_male_10-14` <span class="op">=</span> <span class="va">B01001I_005E</span>,
           `hisp_male_15-19` <span class="op">=</span> <span class="va">B01001I_006E</span> <span class="op">+</span> <span class="va">B01001I_007E</span>,
           `hisp_male_20-24` <span class="op">=</span> <span class="va">B01001I_008E</span>,
           `hisp_male_25-29` <span class="op">=</span> <span class="va">B01001I_009E</span>,
           `hisp_male_30-34` <span class="op">=</span> <span class="va">B01001I_010E</span>,
           `hisp_male_35-44` <span class="op">=</span> <span class="va">B01001I_011E</span>,
           `hisp_male_45-54` <span class="op">=</span> <span class="va">B01001I_012E</span>,
           `hisp_male_55-64` <span class="op">=</span> <span class="va">B01001I_013E</span>,
           `hisp_male_total` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"hisp_male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           <span class="co"># HispaniI Female Age Groups</span>
           `hisp_female_00-04` <span class="op">=</span> <span class="va">B01001I_018E</span>,
           `hisp_female_05-09` <span class="op">=</span> <span class="va">B01001I_019E</span>,
           `hisp_female_10-14` <span class="op">=</span> <span class="va">B01001I_020E</span>,
           `hisp_female_15-19` <span class="op">=</span> <span class="va">B01001I_021E</span> <span class="op">+</span> <span class="va">B01001I_022E</span>,
           `hisp_female_20-24` <span class="op">=</span> <span class="va">B01001I_023E</span>,
           `hisp_female_25-29` <span class="op">=</span> <span class="va">B01001I_024E</span>,
           `hisp_female_30-34` <span class="op">=</span> <span class="va">B01001I_025E</span>,
           `hisp_female_35-44` <span class="op">=</span> <span class="va">B01001I_026E</span>,
           `hisp_female_45-54` <span class="op">=</span> <span class="va">B01001I_027E</span>,
           `hisp_female_55-64` <span class="op">=</span> <span class="va">B01001I_028E</span>,
           hisp_female_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"hisp_female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           hisp_total_total <span class="op">=</span> <span class="va">hisp_male_total</span> <span class="op">+</span> <span class="va">hisp_female_total</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"B0"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"total"</span><span class="op">)</span>,
                               <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"hisp"</span><span class="op">)</span>,
                               <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"black"</span><span class="op">)</span>,
                               <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"native"</span><span class="op">)</span>,
                               <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"white"</span><span class="op">)</span>,
                               <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"asian"</span><span class="op">)</span><span class="op">)</span>,
                 names_to  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"race_group"</span>, <span class="st">"sex"</span>, <span class="st">"age_cat"</span><span class="op">)</span>,
                 names_sep <span class="op">=</span> <span class="st">"_"</span>,
                 values_to <span class="op">=</span> <span class="st">"population"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_cat   <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">age_cat</span> <span class="op">==</span> <span class="st">"00-04"</span> <span class="op">~</span> <span class="st">"0-4"</span>,
                                 <span class="va">age_cat</span> <span class="op">==</span> <span class="st">"05-09"</span> <span class="op">~</span> <span class="st">"5-9"</span>,
                                 <span class="va">age_cat</span> <span class="op">==</span> <span class="st">"total"</span> <span class="op">~</span> <span class="st">"Total"</span>,
                                 <span class="cn">TRUE</span>               <span class="op">~</span> <span class="va">age_cat</span><span class="op">)</span>,
           sex       <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>,
           race_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="st">"white"</span>  <span class="op">~</span> <span class="st">"Non-Hispanic White"</span>,
                                  <span class="va">race_group</span> <span class="op">==</span> <span class="st">"black"</span>  <span class="op">~</span> <span class="st">"Non-Hispanic Black"</span>,
                                  <span class="va">race_group</span> <span class="op">==</span> <span class="st">"native"</span> <span class="op">~</span> <span class="st">"Non-Hispanic Native American, Alaskan Native, Other"</span>,
                                  <span class="va">race_group</span> <span class="op">==</span> <span class="st">"asian"</span>  <span class="op">~</span> <span class="st">"Non-Hispanic Asian or Pacific Islander"</span>,
                                  <span class="va">race_group</span> <span class="op">==</span> <span class="st">"hisp"</span>   <span class="op">~</span> <span class="st">"Hispanic"</span>,
                                  <span class="va">race_group</span> <span class="op">==</span> <span class="st">"total"</span>  <span class="op">~</span> <span class="st">"Total"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># Combining all 5 years into one dataset</span>
<span class="va">ma_demo_acs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ma_demo_acs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_demo_acs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_demo_acs</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_demo_acs</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_demo_acs</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">GEOID10</span>, GEO_NAME <span class="op">=</span> <span class="va">NAME</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="va">GEOID</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##    year GEOID10     race_group sex   age_cat population
##   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1  2013 25005646101 Total      Male  0-4            187
## 2  2013 25005646101 Total      Male  5-9            299
## 3  2013 25005646101 Total      Male  10-14          258
## 4  2013 25005646101 Total      Male  15-19          141
## 5  2013 25005646101 Total      Male  20-24          235
## 6  2013 25005646101 Total      Male  25-29          145</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Area Based Social Metrics</span>
<span class="va">ma_absm_acs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ma_absm_acs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2013</span>,<span class="fl">2014</span>,<span class="fl">2015</span>,<span class="fl">2016</span>,<span class="fl">2017</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">nm</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ma_absm_acs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ma_absm_acs</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"tract"</span>,
                               variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B01003_001E"</span>,<span class="st">"B02001_001E"</span>,<span class="st">"B02001_002E"</span>,<span class="st">"B02001_003E"</span>,
                                             <span class="st">"B02001_004E"</span>,<span class="st">"B02001_005E"</span>,<span class="st">"B02001_006E"</span>,<span class="st">"B02001_007E"</span>,
                                             <span class="st">"B02001_008E"</span>,<span class="st">"B02001_009E"</span>,<span class="st">"B02001_010E"</span>,<span class="st">"B03001_001E"</span>,
                                             <span class="st">"B03001_003"</span>,<span class="st">"B01001H_001E"</span><span class="op">)</span>, 
                               year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>,
                               output <span class="op">=</span> <span class="st">"wide"</span>,
                               state <span class="op">=</span> <span class="st">"MA"</span>,
                               geometry <span class="op">=</span> <span class="cn">FALSE</span>,
                               moe_level <span class="op">=</span> <span class="fl">95</span>,
                               survey <span class="op">=</span> <span class="st">"acs5"</span>,
                               cache_table <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="co"># Transforming ACS variables into the ABSM's we want to use for our dataset</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>GEOID10 <span class="op">=</span> <span class="va">GEOID</span>,
           percBlack <span class="op">=</span> <span class="va">B02001_003E</span><span class="op">/</span><span class="va">B02001_001E</span>,
           percHisp <span class="op">=</span> <span class="va">B03001_003E</span><span class="op">/</span><span class="va">B03001_001E</span>,
           pop_total <span class="op">=</span> <span class="va">B01003_001E</span>,
           pop_white <span class="op">=</span> <span class="va">B02001_002E</span>,
           pop_black <span class="op">=</span> <span class="va">B02001_003E</span>,
           pop_amind <span class="op">=</span> <span class="va">B02001_004E</span>,
           pop_api <span class="op">=</span> <span class="va">B02001_005E</span> <span class="op">+</span> <span class="va">B02001_006E</span>,
           pop_hisp <span class="op">=</span> <span class="va">B03001_003E</span>,
           pop_wnh <span class="op">=</span> <span class="va">B01001H_001E</span>,
           percColor <span class="op">=</span> <span class="op">(</span><span class="va">B01003_001E</span> <span class="op">-</span> <span class="va">B01001H_001E</span><span class="op">)</span><span class="op">/</span><span class="va">B01003_001E</span>,
           year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">percBlack</span>, <span class="va">percHisp</span>, <span class="va">percColor</span>, <span class="va">pop_total</span>,
           <span class="va">pop_white</span>, <span class="va">pop_black</span>, <span class="va">pop_amind</span>, <span class="va">pop_api</span>,
           <span class="va">pop_hisp</span>, <span class="va">pop_wnh</span>, <span class="va">year</span><span class="op">)</span>
  
  <span class="co"># Downloading tables from the ACS in addition to those variables</span>

    <span class="va">raw.white</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography<span class="op">=</span><span class="st">"tract"</span>, table<span class="op">=</span><span class="st">"B19001A"</span>, state<span class="op">=</span><span class="st">"MA"</span>, year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, 
                         output<span class="op">=</span><span class="st">"wide"</span>, cache_table<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">raw.black</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography<span class="op">=</span><span class="st">"tract"</span>, table<span class="op">=</span><span class="st">"B19001B"</span>, state<span class="op">=</span><span class="st">"MA"</span>, year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, 
                         output<span class="op">=</span><span class="st">"wide"</span>, cache_table<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">raw.all</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography<span class="op">=</span><span class="st">"tract"</span>, table<span class="op">=</span><span class="st">"B19001"</span>,  state<span class="op">=</span><span class="st">"MA"</span>, year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, 
                         output<span class="op">=</span><span class="st">"wide"</span>, cache_table<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">raw.pov</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography<span class="op">=</span><span class="st">"tract"</span>, table<span class="op">=</span><span class="st">"B17001"</span>,  state<span class="op">=</span><span class="st">"MA"</span>, year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, 
                         output<span class="op">=</span><span class="st">"wide"</span>, cache_table<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">raw.crowd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography<span class="op">=</span><span class="st">"tract"</span>, table<span class="op">=</span><span class="st">"B25014"</span>,  state<span class="op">=</span><span class="st">"MA"</span>, year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, 
                         output<span class="op">=</span><span class="st">"wide"</span>, cache_table<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">raw.wnh</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography<span class="op">=</span><span class="st">"tract"</span>, table<span class="op">=</span><span class="st">"B19001H"</span>, state<span class="op">=</span><span class="st">"MA"</span>, year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, 
                         output<span class="op">=</span><span class="st">"wide"</span>, cache_table<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    
    <span class="va">d.merge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">raw.white</span>, <span class="va">raw.black</span>, by<span class="op">=</span><span class="st">"GEOID"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">raw.wnh</span>, by<span class="op">=</span><span class="st">"GEOID"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">raw.all</span>, by<span class="op">=</span><span class="st">"GEOID"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">raw.pov</span>, by<span class="op">=</span><span class="st">"GEOID"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">raw.crowd</span>, by<span class="op">=</span><span class="st">"GEOID"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID"</span>,<span class="st">"B19001_001E"</span>,<span class="st">"B19001_002E"</span>,<span class="st">"B19001_003E"</span>,<span class="st">"B19001_004E"</span>,<span class="st">"B19001_005E"</span>,
               <span class="st">"B19001_014E"</span>,<span class="st">"B19001_015E"</span>,<span class="st">"B19001_016E"</span>,<span class="st">"B19001_017E"</span>,<span class="st">"B19001A_014E"</span>,
               <span class="st">"B19001A_015E"</span>,<span class="st">"B19001A_016E"</span>,<span class="st">"B19001A_017E"</span>,<span class="st">"B19001B_002E"</span>,<span class="st">"B19001B_003E"</span>,
               <span class="st">"B19001B_004E"</span>,<span class="st">"B19001B_005E"</span>,<span class="st">"B19001H_002E"</span>,<span class="st">"B19001H_003E"</span>,<span class="st">"B19001H_004E"</span>,
               <span class="st">"B19001H_005E"</span>,<span class="st">"B19001H_014E"</span>,<span class="st">"B19001H_015E"</span>,<span class="st">"B19001H_016E"</span>,<span class="st">"B19001H_017E"</span>,
               <span class="st">"B17001_001E"</span>,<span class="st">"B17001_002E"</span>,<span class="st">"B25014_001E"</span>, <span class="st">"B25014_005E"</span>,<span class="st">"B25014_006E"</span>,
               <span class="st">"B25014_007E"</span>,<span class="st">"B25014_011E"</span>,<span class="st">"B25014_012E"</span>,<span class="st">"B25014_013E"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ICEwbinc<span class="op">=</span><span class="op">(</span><span class="op">(</span><span class="va">B19001A_014E</span> <span class="op">+</span> <span class="va">B19001A_015E</span> <span class="op">+</span> <span class="va">B19001A_016E</span> <span class="op">+</span> <span class="va">B19001A_017E</span><span class="op">)</span> <span class="op">-</span>
                         <span class="op">(</span><span class="va">B19001B_002E</span> <span class="op">+</span> <span class="va">B19001B_003E</span> <span class="op">+</span> <span class="va">B19001B_004E</span> <span class="op">+</span> <span class="va">B19001B_005E</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">B19001_001E</span>,
             ICEwnhinc<span class="op">=</span><span class="op">(</span><span class="op">(</span><span class="va">B19001H_014E</span> <span class="op">+</span> <span class="va">B19001H_015E</span> <span class="op">+</span> <span class="va">B19001H_016E</span> <span class="op">+</span> <span class="va">B19001H_017E</span><span class="op">)</span> <span class="op">-</span>
                          <span class="op">(</span><span class="va">B19001_002E</span> <span class="op">+</span> <span class="va">B19001_003E</span> <span class="op">+</span> <span class="va">B19001_004E</span> <span class="op">+</span> <span class="va">B19001_005E</span> <span class="op">-</span>
                             <span class="va">B19001H_002E</span> <span class="op">-</span> <span class="va">B19001H_003E</span> <span class="op">-</span> <span class="va">B19001H_004E</span> <span class="op">-</span> <span class="va">B19001H_005E</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">B19001_001E</span>,
             ice_wnh_highinc<span class="op">=</span> <span class="op">(</span><span class="va">B19001H_014E</span> <span class="op">+</span> <span class="va">B19001H_015E</span> <span class="op">+</span> <span class="va">B19001H_016E</span> <span class="op">+</span> <span class="va">B19001H_017E</span><span class="op">)</span><span class="op">/</span><span class="va">B19001_001E</span>,
             ice_poc_lowinc <span class="op">=</span> <span class="op">(</span><span class="va">B19001_002E</span> <span class="op">+</span> <span class="va">B19001_003E</span> <span class="op">+</span> <span class="va">B19001_004E</span> <span class="op">+</span> <span class="va">B19001_005E</span> <span class="op">-</span>
                                 <span class="va">B19001H_002E</span> <span class="op">-</span> <span class="va">B19001H_003E</span> <span class="op">-</span> <span class="va">B19001H_004E</span> <span class="op">-</span> <span class="va">B19001H_005E</span><span class="op">)</span><span class="op">/</span><span class="va">B19001_001E</span>,
             ice_wnh_lowinc <span class="op">=</span> <span class="op">(</span><span class="va">B19001H_002E</span> <span class="op">+</span> <span class="va">B19001H_003E</span> <span class="op">+</span> <span class="va">B19001H_004E</span> <span class="op">+</span> <span class="va">B19001H_005E</span><span class="op">)</span><span class="op">/</span><span class="va">B19001_001E</span>,
             ice_poc_highinc <span class="op">=</span> <span class="op">(</span><span class="va">B19001_014E</span> <span class="op">+</span> <span class="va">B19001_015E</span> <span class="op">+</span> <span class="va">B19001_016E</span> <span class="op">+</span> <span class="va">B19001_017E</span> <span class="op">-</span>
                                  <span class="va">B19001H_014E</span> <span class="op">-</span> <span class="va">B19001H_015E</span> <span class="op">-</span> <span class="va">B19001H_016E</span> <span class="op">-</span> <span class="va">B19001H_017E</span><span class="op">)</span><span class="op">/</span><span class="va">B19001_001E</span>,
             tractPov <span class="op">=</span> <span class="va">B17001_002E</span><span class="op">/</span><span class="va">B17001_001E</span>,
             tractCrowd <span class="op">=</span> <span class="op">(</span><span class="va">B25014_005E</span> <span class="op">+</span> <span class="va">B25014_006E</span> <span class="op">+</span> <span class="va">B25014_007E</span> <span class="op">+</span>
                             <span class="va">B25014_011E</span> <span class="op">+</span> <span class="va">B25014_012E</span> <span class="op">+</span> <span class="va">B25014_013E</span><span class="op">)</span> <span class="op">/</span> <span class="va">B25014_001E</span>,
             tractSevereCrowd <span class="op">=</span> <span class="op">(</span><span class="va">B25014_006E</span> <span class="op">+</span> <span class="va">B25014_007E</span> <span class="op">+</span>
                                   <span class="va">B25014_012E</span> <span class="op">+</span> <span class="va">B25014_013E</span><span class="op">)</span> <span class="op">/</span> <span class="va">B25014_001E</span>,
             year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>GEOID10 <span class="op">=</span> <span class="va">GEOID</span>, <span class="va">ICEwbinc</span>, <span class="va">ICEwnhinc</span>, <span class="va">tractPov</span>, <span class="va">tractCrowd</span>, <span class="va">tractSevereCrowd</span>, <span class="va">year</span>,
            <span class="va">ice_wnh_highinc</span>, <span class="va">ice_wnh_lowinc</span>, <span class="va">ice_poc_lowinc</span>, <span class="va">ice_poc_highinc</span><span class="op">)</span>
    
    <span class="va">ma_absm_acs</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ma_absm_acs</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span>, <span class="va">d.merge</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID10"</span>,<span class="st">"year"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">ma_absm_acs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ma_absm_acs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_absm_acs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_absm_acs</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_absm_acs</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,
                     <span class="va">ma_absm_acs</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">GEOID10</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Downloading and formatting the SVI data</span>

<span class="va">svi.tract</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/07-premature-mortality/ma_svi.csv"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>GEOID10<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">FIPS</span><span class="op">&lt;</span><span class="fl">9999999999</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"0"</span>,<span class="va">FIPS</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">FIPS</span><span class="op">)</span><span class="op">)</span>,
         svi_themes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">RPL_THEMES</span><span class="op">==</span><span class="op">-</span><span class="fl">999</span>, <span class="cn">NA</span>, <span class="va">RPL_THEMES</span><span class="op">)</span>,
         svi_theme1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">RPL_THEME1</span><span class="op">==</span><span class="op">-</span><span class="fl">999</span>, <span class="cn">NA</span>, <span class="va">RPL_THEME1</span><span class="op">)</span>,
         svi_theme2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">RPL_THEME2</span><span class="op">==</span><span class="op">-</span><span class="fl">999</span>, <span class="cn">NA</span>, <span class="va">RPL_THEME2</span><span class="op">)</span>,
         svi_theme3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">RPL_THEME3</span><span class="op">==</span><span class="op">-</span><span class="fl">999</span>, <span class="cn">NA</span>, <span class="va">RPL_THEME3</span><span class="op">)</span>,
         svi_theme4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">RPL_THEME4</span><span class="op">==</span><span class="op">-</span><span class="fl">999</span>, <span class="cn">NA</span>, <span class="va">RPL_THEME4</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">svi_themes</span>, <span class="va">svi_theme1</span>, <span class="va">svi_theme2</span>, <span class="va">svi_theme3</span>, <span class="va">svi_theme4</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">==</span><span class="st">"25"</span><span class="op">)</span>


<span class="co"># Creating a dataset for visualization and analysis from the weighted ABSM over all 5 years</span>
<span class="va">ma_absm_sum</span> <span class="op">&lt;-</span> <span class="va">ma_absm_acs</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>wt <span class="op">=</span> <span class="va">pop_total</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pop_total</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>percBlack        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">percBlack</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            percHisp         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">percHisp</span>,  wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            percColor        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">percColor</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ICEwbinc         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ICEwbinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ICEwnhinc        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ICEwnhinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            tractPov         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tractPov</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            tractCrowd       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tractCrowd</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            tractSevereCrowd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tractSevereCrowd</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ice_wnh_highinc  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ice_wnh_highinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ice_wnh_lowinc   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ice_wnh_lowinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ice_poc_lowinc   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ice_poc_lowinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            ice_poc_highinc  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ice_poc_highinc</span>, wt <span class="op">=</span> <span class="va">wt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            pop_total        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pop_total</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">svi.tract</span>, by<span class="op">=</span><span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pov_cat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="fl">0</span><span class="op">&lt;=</span><span class="va">tractPov</span>  <span class="op">&amp;</span> <span class="va">tractPov</span><span class="op">&lt;</span><span class="fl">0.05</span> <span class="op">~</span> <span class="st">"0-4.9%"</span>,
                                   <span class="fl">0.05</span><span class="op">&lt;=</span><span class="va">tractPov</span> <span class="op">&amp;</span> <span class="va">tractPov</span><span class="op">&lt;</span><span class="fl">0.10</span> <span class="op">~</span> <span class="st">"5-9.9%"</span>,
                                   <span class="fl">0.10</span><span class="op">&lt;=</span><span class="va">tractPov</span> <span class="op">&amp;</span> <span class="va">tractPov</span><span class="op">&lt;</span><span class="fl">0.2</span> <span class="op">~</span> <span class="st">"10-19.9%"</span>,
                                   <span class="fl">0.20</span><span class="op">&lt;=</span><span class="va">tractPov</span> <span class="op">&amp;</span> <span class="va">tractPov</span><span class="op">&lt;=</span><span class="fl">1</span> <span class="op">~</span> <span class="st">"20-100%"</span>,
                                   <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span>, 
                         levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4.9%"</span>,<span class="st">"5-9.9%"</span>,<span class="st">"10-19.9%"</span>,<span class="st">"20-100%"</span><span class="op">)</span><span class="op">)</span>,
         pov_qt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">tractPov</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">tractPov</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                            probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                     na.rm<span class="op">=</span><span class="cn">TRUE</span>, 
                     include.lowest<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
         ICE_qt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">ICEwnhinc</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">ICEwnhinc</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                                probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                        na.rm<span class="op">=</span><span class="cn">TRUE</span>, 
                        include.lowest<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
         perc_Color_qt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">percColor</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">percColor</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                                  probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                          na.rm<span class="op">=</span><span class="cn">TRUE</span>, 
                          include.lowest<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
         perc_BLACK_qt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">percBlack</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">percBlack</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                                  probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                          na.rm<span class="op">=</span><span class="cn">TRUE</span>, 
                          include.lowest<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
         SVI_qt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">svi_themes</span>, <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html">wtd.quantile</a></span><span class="op">(</span><span class="va">svi_themes</span>, weights<span class="op">=</span><span class="va">pop_total</span>,
                                             probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                    na.rm<span class="op">=</span><span class="cn">TRUE</span>, 
                    include.lowest<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 25
##   GEOID10     percBlack percHisp percColor ICEwbinc ICEwnhinc tractPov tractCrowd
##   &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
## 1 25001010100   0.0232   0.0530     0.126     0.211     0.184   0.119     0.0168 
## 2 25001010206   0.0191   0.00477    0.0829    0.229     0.228   0.0999    0.0102 
## 3 25001010208   0.0150   0.0154     0.0365    0.216     0.216   0.0825    0      
## 4 25001010304   0.00587  0.00926    0.0550    0.328     0.328   0.0413    0.0111 
## 5 25001010306   0.0290   0.0141     0.0830    0.175     0.175   0.0879    0.0141 
## 6 25001010400   0.0549   0.0234     0.0902    0.234     0.223   0.0626    0.00864
## # … with 17 more variables: tractSevereCrowd &lt;dbl&gt;, ice_wnh_highinc &lt;dbl&gt;,
## #   ice_wnh_lowinc &lt;dbl&gt;, ice_poc_lowinc &lt;dbl&gt;, ice_poc_highinc &lt;dbl&gt;,
## #   pop_total &lt;dbl&gt;, svi_themes &lt;dbl&gt;, svi_theme1 &lt;dbl&gt;, svi_theme2 &lt;dbl&gt;,
## #   svi_theme3 &lt;dbl&gt;, svi_theme4 &lt;dbl&gt;, pov_cat &lt;fct&gt;, pov_qt &lt;fct&gt;,
## #   ICE_qt &lt;fct&gt;, perc_Color_qt &lt;fct&gt;, perc_BLACK_qt &lt;fct&gt;, SVI_qt &lt;fct&gt;</code></pre>
</div>
</div>
<div id="approach" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Approach<a class="anchor" aria-label="anchor" href="#approach"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we have our data, let’s revisit our questions of interest:</p>
<ol style="list-style-type: decimal">
<li>What is the overall socioeconomic gradient in premature mortality?</li>
<li>What is the racialized disparity overall?</li>
<li>What are the association with ABSM by racialized group?/ How does ABSM interact with individual level membership in racialized groups? (i.e., interactions between socioeconomic position and racialized groups, not just socioeconomic inequities within racialized groups)</li>
<li>How does the racialized disparity vary across space?</li>
</ol>
<p>Let’s first visualize the overall socioeconomic gradient in premature mortality.</p>
<div id="what-is-the-overall-socioeconomic-gradient-in-premature-mortality" class="section level3" number="6.4.1">
<h3>
<span class="header-section-number">6.4.1</span> What is the overall socioeconomic gradient in premature mortality?<a class="anchor" aria-label="anchor" href="#what-is-the-overall-socioeconomic-gradient-in-premature-mortality"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="images/07-premature-mortality/adj_smr_map.png" width="100%"></div>
<p>How exactly do we get from our data to this map visualizing how the standard mortality ratio for premature mortality varies across space?
We can visualize how premature mortality varies across space using spatial models. For our spatial models, we first need to utilize the indirect method to age-standardize our data and create reference rates for the population groups.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ref_pop</span> <span class="op">&lt;-</span> <span class="va">ma_demo_acs</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span><span class="st">"Total"</span>,
         <span class="va">sex</span> <span class="op">!=</span> <span class="st">"Total"</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">GEOID10</span>,<span class="va">GEO_NAME</span>,<span class="va">race_group</span>,<span class="va">sex</span><span class="op">)</span>,
              names_from <span class="op">=</span> <span class="va">age_cat</span>,
              values_from <span class="op">=</span> <span class="va">population</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`35-44` <span class="op">=</span> <span class="va">`35-39`</span> <span class="op">+</span> <span class="va">`40-44`</span>,
         `45-54` <span class="op">=</span> <span class="va">`45-49`</span> <span class="op">+</span> <span class="va">`50-54`</span>,
         `55-64` <span class="op">=</span> <span class="va">`55-59`</span> <span class="op">+</span> <span class="va">`60-64`</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">`0-4`</span><span class="op">:</span><span class="va">`55-64`</span>,
               names_to <span class="op">=</span> <span class="st">"age_cat"</span>,
               values_to <span class="op">=</span> <span class="st">"population"</span><span class="op">)</span>

<span class="va">ref_rates</span> <span class="op">&lt;-</span> <span class="va">ma_mort_agg</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span><span class="st">"Total"</span>,
         <span class="va">sex</span> <span class="op">!=</span> <span class="st">"Total"</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">GEOID10</span>,<span class="va">super_town</span>,<span class="va">sex</span>, <span class="va">race_group</span><span class="op">)</span>,
              names_from <span class="op">=</span> <span class="va">age_cat</span>,
              values_from <span class="op">=</span> <span class="va">deaths</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">`0-4`</span><span class="op">:</span><span class="va">`60-64`</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,<span class="fl">0</span>,<span class="va">.</span><span class="op">)</span><span class="op">)</span>,
         `35-44` <span class="op">=</span> <span class="va">`35-39`</span> <span class="op">+</span> <span class="va">`40-44`</span>,
         `45-54` <span class="op">=</span> <span class="va">`45-49`</span> <span class="op">+</span> <span class="va">`50-54`</span>,
         `55-64` <span class="op">=</span> <span class="va">`55-59`</span> <span class="op">+</span> <span class="va">`60-64`</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">`0-4`</span><span class="op">:</span><span class="va">`55-64`</span>,
               names_to <span class="op">=</span> <span class="st">"age_cat"</span>,
               values_to <span class="op">=</span> <span class="st">"deaths"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ref_pop</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>,<span class="st">"GEOID10"</span>,<span class="st">"sex"</span>,<span class="st">"age_cat"</span>,<span class="st">"race_group"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ref_rate <span class="op">=</span> <span class="va">num</span><span class="op">/</span><span class="va">den</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">age_cat</span>, <span class="va">ref_rate</span><span class="op">)</span></code></pre></div>
<p>Once we have the data age standardized we can calculate raw standardized mortality ratios. These ratios are susceptible to much of what is discussed in previous chapters with regards to infinity rates and small sample sizes leading to extreme results. But as we are going to eventually smooth this data with our model, we are not as concerned here about the state of the raw data. Here we can see our raw standardized mortality ratios extend from zero to infinity.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ma_mort_indirect</span> <span class="op">&lt;-</span> <span class="va">ma_mort_agg</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">ma_demo_acs</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>,<span class="st">"GEOID10"</span>,<span class="st">"race_group"</span>,<span class="st">"sex"</span>,<span class="st">"age_cat"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="st">"Total"</span>,
         <span class="va">sex</span> <span class="op">!=</span> <span class="st">"Total"</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ref_rates</span>, by<span class="op">=</span> <span class="st">"age_cat"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>expected <span class="op">=</span> <span class="va">ref_rate</span><span class="op">*</span><span class="va">population</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">super_town</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>O <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span>,
            E <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">expected</span><span class="op">)</span>,
            raw_smr <span class="op">=</span> <span class="va">O</span><span class="op">/</span><span class="va">E</span>,
            var_raw_smr <span class="op">=</span> <span class="va">O</span><span class="op">/</span><span class="va">E</span><span class="op">^</span><span class="fl">2</span>,
            raw_smr_lo95 <span class="op">=</span> <span class="va">raw_smr</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_raw_smr</span><span class="op">)</span>,
            raw_smr_up95 <span class="op">=</span> <span class="va">raw_smr</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_raw_smr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">ma_absm_sum</span>, by <span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu">fastDummies</span><span class="fu">::</span><span class="fu"><a href="https://jacobkap.github.io/fastDummies/reference/dummy_cols.html">dummy_cols</a></span><span class="op">(</span>select_columns<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pov_cat"</span>, <span class="st">"ICE_qt"</span>, <span class="st">"SVI_qt"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>pov_cat_1 <span class="op">=</span> <span class="st">"pov_cat_0-4.9%"</span>,
         pov_cat_2 <span class="op">=</span> <span class="st">"pov_cat_5-9.9%"</span>,
         pov_cat_3 <span class="op">=</span> <span class="st">"pov_cat_10-19.9%"</span>,
         pov_cat_4 <span class="op">=</span> <span class="st">"pov_cat_20-100%"</span>,
         ICE_qt_1 <span class="op">=</span> <span class="st">"ICE_qt_[-0.689,0.0607]"</span>,
         ICE_qt_2 <span class="op">=</span> <span class="st">"ICE_qt_(0.0607,0.245]"</span> , 
         ICE_qt_3 <span class="op">=</span> <span class="st">"ICE_qt_(0.245,0.362]"</span> ,  
         ICE_qt_4 <span class="op">=</span> <span class="st">"ICE_qt_(0.362,0.465]"</span> ,  
         ICE_qt_5 <span class="op">=</span> <span class="st">"ICE_qt_(0.465,0.727]"</span> ,
         SVI_qt_1 <span class="op">=</span> <span class="st">"SVI_qt_[0,0.195]"</span>,
         SVI_qt_2 <span class="op">=</span> <span class="st">"SVI_qt_(0.195,0.397]"</span>  ,
         SVI_qt_3 <span class="op">=</span> <span class="st">"SVI_qt_(0.397,0.583]"</span>,
         SVI_qt_4 <span class="op">=</span> <span class="st">"SVI_qt_(0.583,0.781]"</span>,
         SVI_qt_5 <span class="op">=</span> <span class="st">"SVI_qt_(0.781,1]"</span><span class="op">)</span> </code></pre></div>
<pre><code>## # A tibble: 6 × 50
##   GEOID10     super_town     O     E raw_smr var_raw_smr raw_smr_lo95 raw_smr_up95
##   &lt;chr&gt;       &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1 25001010100 provincet…    38  38.9   0.976      0.0251        0.666         1.29
## 2 25001010206 wellfleet     31  33.1   0.935      0.0282        0.606         1.26
## 3 25001010208 truro         19  15.5   1.22       0.0789        0.674         1.78
## 4 25001010304 eastham       25  21.7   1.15       0.0532        0.701         1.60
## 5 25001010306 eastham       35  26.8   1.31       0.0487        0.873         1.74
## 6 25001010400 orleans       29  31.3   0.925      0.0295        0.589         1.26
## # … with 42 more variables: percBlack &lt;dbl&gt;, percHisp &lt;dbl&gt;, percColor &lt;dbl&gt;,
## #   ICEwbinc &lt;dbl&gt;, ICEwnhinc &lt;dbl&gt;, tractPov &lt;dbl&gt;, tractCrowd &lt;dbl&gt;,
## #   tractSevereCrowd &lt;dbl&gt;, ice_wnh_highinc &lt;dbl&gt;, ice_wnh_lowinc &lt;dbl&gt;,
## #   ice_poc_lowinc &lt;dbl&gt;, ice_poc_highinc &lt;dbl&gt;, pop_total &lt;dbl&gt;,
## #   svi_themes &lt;dbl&gt;, svi_theme1 &lt;dbl&gt;, svi_theme2 &lt;dbl&gt;, svi_theme3 &lt;dbl&gt;,
## #   svi_theme4 &lt;dbl&gt;, pov_cat &lt;fct&gt;, pov_qt &lt;fct&gt;, ICE_qt &lt;fct&gt;,
## #   perc_Color_qt &lt;fct&gt;, perc_BLACK_qt &lt;fct&gt;, SVI_qt &lt;fct&gt;, id &lt;int&gt;, …</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raw_smr_dotplot</span> <span class="op">&lt;-</span> <span class="va">ma_mort_indirect</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">raw_smr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="va">raw_smr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">raw_smr_lo95</span>, ymax<span class="op">=</span><span class="va">raw_smr_up95</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, linetype<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Raw Standardized Mortality Ratio by Census Tract, with error"</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                 <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Census Tract"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"SMR"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"raw_smr_dotplot.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/raw_smr_dotplot.png" width="100%"></div>
<p>We can also produce a map of these relationships. To do so, we will import a map file produced by the State of Massachusetts [<a href="https://www.mass.gov/info-details/massgis-data-municipalities" class="uri">https://www.mass.gov/info-details/massgis-data-municipalities</a>].</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tract_geometry</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"CENSUS2010_BLK_BG_TRCT_SHP"</span>,
                       layer <span class="op">=</span> <span class="st">"CENSUS2010TRACTS_POLY"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id_order <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">id_order</span><span class="op">)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 2 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 224556.8 ymin: 883012.9 xmax: 242894.8 ymax: 890801.7
## Projected CRS: NAD83 / Massachusetts Mainland
##       GEOID10 id_order                       geometry
## 1 25021418003        1 MULTIPOLYGON (((240678.8 88...
## 2 25021417701        2 MULTIPOLYGON (((240969.7 89...
## 3 25021417702        3 MULTIPOLYGON (((242328.2 89...
## 4 25021418102        4 MULTIPOLYGON (((240372.7 88...
## 5 25021418004        5 MULTIPOLYGON (((240687.3 88...
## 6 25021412300        6 MULTIPOLYGON (((226244 8863...</code></pre>
<p>We will include a cut-out of Boston so we can see some census tracts in more detail:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raw_smr_map.state</span> <span class="op">&lt;-</span> <span class="va">ma_mort_indirect</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry<span class="op">=</span><span class="va">geometry</span>, 
                        fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">raw_smr</span><span class="op">)</span><span class="op">)</span>,
          lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span>,
                     trans  <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Raw Standardized Mortality Ratios (SMR)"</span>,
       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                 <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span>,
       fill <span class="op">=</span> <span class="st">"SMR"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis labels</span>
        axis.ticks.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis ticks</span>
        axis.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co">#remove y axis labels</span>
        axis.ticks.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>

<span class="va">raw_smr_map.boston</span> <span class="op">&lt;-</span> <span class="va">ma_mort_indirect</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">super_town</span> <span class="op">==</span> <span class="st">"boston"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">raw_smr</span><span class="op">)</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span>,
                     trans  <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boston"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="st">"None"</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> 

<span class="va">raw_smr_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">raw_smr_map.state</span> , x <span class="op">=</span> <span class="fl">0.00</span>, y <span class="op">=</span> <span class="fl">0.00</span>, width <span class="op">=</span> <span class="fl">0.80</span>, height <span class="op">=</span> <span class="fl">1.00</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">raw_smr_map.boston</span>, x <span class="op">=</span> <span class="fl">0.65</span>, y <span class="op">=</span> <span class="fl">0.50</span>, width <span class="op">=</span> <span class="fl">0.30</span>, height <span class="op">=</span> <span class="fl">0.30</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"raw_smr_map.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/raw_smr_map.png" width="100%"></div>
<p>We can fit a spatial model using the INLA package which will “smooth” our results by fitting our data to a BYM model that will adjust estimates based on the surrounding areas. We first need to be able to create an adjacency matrix, so that the package knows which census tracts are neighbors</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make sure that the data file has areas in the same order as the shape file</span>
<span class="va">ma_mort_indirect_ordered</span> <span class="op">&lt;-</span> <span class="va">ma_mort_indirect</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span><span class="st">"GEOID10"</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">id_order</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">geometry</span><span class="op">)</span>

<span class="va">numarea</span> <span class="op">&lt;-</span> <span class="va">ma_mort_indirect_ordered</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID10</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># calculate neighbors matrix</span>
<span class="va">W.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">tract_geometry</span> , snap<span class="op">=</span><span class="fl">0.001</span><span class="op">)</span>
<span class="va">W.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">W.nb</span>, style<span class="op">=</span><span class="st">"B"</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">#Make adjacency matrix in format INLA can understand</span>
<span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2INLA.html">nb2INLA</a></span><span class="op">(</span><span class="st">"INLA_adj_mat"</span>, <span class="va">W.nb</span><span class="op">)</span> <span class="co">#this saves a file in the working directory</span>
<span class="va">INLA_adj_mat</span> <span class="op">&lt;-</span> <span class="st">"INLA_adj_mat"</span>

<span class="co"># Intercept only BYM model </span>
<span class="va">model_form</span> <span class="op">&lt;-</span> <span class="va">O</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html">f</a></span><span class="op">(</span><span class="va">id_order</span>, model<span class="op">=</span><span class="st">"bym2"</span>, graph<span class="op">=</span><span class="va">INLA_adj_mat</span>, scale.model<span class="op">=</span><span class="cn">TRUE</span>, constr<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">model_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html">inla</a></span><span class="op">(</span><span class="va">model_form</span>, family<span class="op">=</span><span class="st">"poisson"</span>, 
                data<span class="op">=</span><span class="va">ma_mort_indirect_ordered</span>, E<span class="op">=</span><span class="va">E</span>, <span class="co"># E points to the expected count field</span>
                control.predictor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>compute<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># computes transformed posterior marginals</span>
                control.compute<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dic<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># computes DIC for model fit</span>

<span class="co"># Extract posterior means of the area effects</span>
<span class="va">null_random</span> <span class="op">&lt;-</span> <span class="va">model_0</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">id_order</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">numarea</span><span class="op">]</span>

<span class="co"># Percentage of spatial variation has to be calculated empirically</span>
<span class="va">mat.marg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">numarea</span>, ncol<span class="op">=</span><span class="fl">100000</span><span class="op">)</span> <span class="co">#create empty matrix</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="va">model_0</span><span class="op">$</span><span class="va">marginals.random</span><span class="op">$</span><span class="va">id_order</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numarea</span><span class="op">)</span><span class="op">{</span>
  <span class="co">#the first block of the random effects matrix contains area-specific effects (u + v), </span>
  <span class="co">#and the second block contains spatially structured residuals (u). </span>
  <span class="co">#So this is extracting from the second block of rows</span>
  <span class="va">u</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">[[</span><span class="va">numarea</span><span class="op">+</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> 
  <span class="va">mat.marg</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html">inla.rmarginal</a></span><span class="op">(</span><span class="fl">100000</span>, <span class="va">u</span><span class="op">)</span> <span class="co">#randomly pick 100000 values from posterior distributions of area-specific spatially structures residuals</span>
<span class="op">}</span>
<span class="co">#Get empirical variance from 100000 obs</span>
<span class="va">var.u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">mat.marg</span>, <span class="fl">2</span>, <span class="va">var</span><span class="op">)</span> 

<span class="co">#Get unstructured variance</span>
<span class="va">var.v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html">inla.rmarginal</a></span><span class="op">(</span><span class="fl">100000</span>,
                        <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html">inla.tmarginal</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span><span class="op">/</span><span class="va">x</span>, <span class="va">model_0</span><span class="op">$</span><span class="va">marginals.hyperpar</span><span class="op">$</span><span class="va">`Precision for id_order`</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Calculate spatially structured variance percentage</span>
<span class="va">perc.var.u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">var.u</span><span class="op">/</span><span class="op">(</span><span class="va">var.u</span><span class="op">+</span><span class="va">var.v</span><span class="op">)</span><span class="op">)</span>
<span class="co"># compute QR90 = comparing the 95th to the 5th quantile of the random effects distribution</span>
<span class="va">qr90</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">null_random</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># append estimated random effects ma_mort_indirect_ordered for mapping</span>
<span class="va">ma_mort_indirect_ordered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>smooth_smr <span class="op">=</span> <span class="va">null_random</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id_order <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">ma_mort_indirect_ordered</span>, by<span class="op">=</span><span class="st">"id_order"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>raw_smr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">O</span><span class="op">/</span><span class="va">E</span><span class="op">)</span><span class="op">+</span><span class="fl">0.046</span><span class="op">)</span></code></pre></div>
<p>Note the code above provides code to calculate the percentage of the variance in the data that is spatially correlated - in this case, about 80%.</p>
<p>We can now visualize our smoothed SMR. First, let’s look at a similar dot plot to what we did with the raw SMR:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smooth_smr_dotplot</span> <span class="op">&lt;-</span> <span class="va">ma_mort_indirect_ordered</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">smooth_smr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">smooth_smr</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, linetype<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Smoothed Standardized Mortality Ratio by Census Tract"</span>,
         caption <span class="op">=</span> <span class="st">"Source: Massachusetts Mortality Data 2013-2017, 5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Census Tract"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Smoothed SMR"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"smooth_smr_dotplot.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/smooth_smr_dotplot.png" width="100%"></div>
<p>And now we can visualize the smooth map</p>
<div class="inline-figure"><img src="images/07-premature-mortality/smooth_smr_map.png" width="100%"></div>
<p>We can see from the plot and the map that while there is still variation in the SMR - it is much less extreme than the raw SMR.
But to get a true sense of how premature mortality varies across the socioeconomic gradient, we should look at a model that adjusts for our ABSMs and see if there are any changes in variation. Let’s look at the SMR after we adjust for poverty, giving us the map we introduced this section with.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Code to include our ABSM</span>
<span class="va">these_variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pov_cat_2 + pov_cat_3 + pov_cat_4 + pov_cat_NA"</span>,
                     <span class="st">"ICE_qt_1 + ICE_qt_2 + ICE_qt_3 + ICE_qt_4 + ICE_qt_NA"</span>,
                     <span class="st">"SVI_qt_2 + SVI_qt_3 + SVI_qt_4 + SVI_qt_5 + SVI_qt_NA"</span><span class="op">)</span>

<span class="va">model_form_stem</span> <span class="op">&lt;-</span> <span class="st">"O ~ 1 + f(id_order, model='bym2', graph=INLA_adj_mat, scale.model=TRUE, constr=TRUE) + "</span>
<span class="va">model_form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">model_form_stem</span>, <span class="va">these_variables</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">as.formula</span><span class="op">)</span>

<span class="va">model_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># Run models with different ABSMs</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">formula_i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">model_form</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">model_results</span><span class="op">[[</span><span class="va">formula_i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html">inla</a></span><span class="op">(</span><span class="va">model_form</span><span class="op">[[</span><span class="va">formula_i</span><span class="op">]</span><span class="op">]</span>, family<span class="op">=</span><span class="st">"poisson"</span>, 
                                     data <span class="op">=</span> <span class="va">ma_mort_indirect_ordered</span>, E<span class="op">=</span><span class="va">E</span>, <span class="co"># E points to the expected count field</span>
                                     control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>compute<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># computes transformed posterior marginals</span>
                                     control.compute   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dic<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># computes DIC for model fit</span>
<span class="op">}</span>

<span class="co"># extract results</span>
<span class="va">fixed_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">model_results</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span> <span class="va">x</span><span class="op">$</span><span class="va">summary.fixed</span> <span class="op">}</span><span class="op">)</span>
<span class="va">dic_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">model_results</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">dic</span><span class="op">$</span><span class="va">dic</span><span class="op">}</span> <span class="op">)</span>

<span class="co"># the first block of the summary.random output are the area effects (u + v)</span>
<span class="va">random_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">model_results</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">id_order</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">numarea</span><span class="op">]</span><span class="op">}</span><span class="op">)</span>


<span class="va">absm_residuals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>pov_cat_residuals <span class="op">=</span> <span class="va">random_results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
                             ICE_qt_residuals <span class="op">=</span> <span class="va">random_results</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,
                             SVI_qt_residuals <span class="op">=</span> <span class="va">random_results</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id_order <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># append to ma_mort_indirect_ordered</span>
<span class="va">ma_mort_indirect_ordered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>smooth_SMR <span class="op">=</span> <span class="va">null_random</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id_order <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">ma_mort_indirect_ordered</span>, by<span class="op">=</span><span class="st">"id_order"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">absm_residuals</span>, by<span class="op">=</span><span class="st">"id_order"</span><span class="op">)</span>

<span class="co"># Visualize map after adjusting for poverty</span>
<span class="va">adj_smr_map.state</span> <span class="op">&lt;-</span> <span class="va">ma_mort_indirect_ordered</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID10"</span>,<span class="st">"id_order"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>, 
                        fill     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">pov_cat_residuals</span><span class="op">)</span><span class="op">)</span>,
          lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span>,
                     trans  <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Residual Standardized Mortality Ratios after adjusting for Poverty"</span>,
       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                 <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span>,
       fill <span class="op">=</span> <span class="st">"Adjusted SMR"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis labels</span>
        axis.ticks.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis ticks</span>
        axis.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co">#remove y axis labels</span>
        axis.ticks.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>

<span class="va">adj_smr_map.boston</span> <span class="op">&lt;-</span> <span class="va">ma_mort_indirect_ordered</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID10"</span>,<span class="st">"id_order"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">super_town</span> <span class="op">==</span> <span class="st">"boston"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">pov_cat_residuals</span><span class="op">)</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span>,
                     trans  <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boston"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="st">"None"</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> 

<span class="va">adj_smr_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">adj_smr_map.state</span> , x <span class="op">=</span> <span class="fl">0.00</span>, y <span class="op">=</span> <span class="fl">0.00</span>, width <span class="op">=</span> <span class="fl">0.80</span>, height <span class="op">=</span> <span class="fl">1.00</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">adj_smr_map.boston</span>, x <span class="op">=</span> <span class="fl">0.65</span>, y <span class="op">=</span> <span class="fl">0.50</span>, width <span class="op">=</span> <span class="fl">0.30</span>, height <span class="op">=</span> <span class="fl">0.30</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"adj_smr_map.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/adj_smr_map.png" width="100%"></div>
<p>In comparing the smoothed effect from our null model and the effects of our model adjusting for poverty, we can visualize the extent of the impact poverty has on the distribution of premature mortality</p>
<div class="inline-figure"><img src="images/07-premature-mortality/smooth_smr_map.png" width="100%"></div>
</div>
<div id="what-is-the-racialized-disparity-in-premature-mortality-overall" class="section level3" number="6.4.2">
<h3>
<span class="header-section-number">6.4.2</span> What is the racialized disparity in premature mortality overall?<a class="anchor" aria-label="anchor" href="#what-is-the-racialized-disparity-in-premature-mortality-overall"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"images/07-premature-mortality/map.irr.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/map.irr.png" width="100%"></div>
<p>We can describe inequities by racialized groups much the same way we describe inequities in ABSM - by aggregating death and population data. We already have these aggregated - we can stratify our analysis to compare the White Non-Hispanic and Black Non-Hispanic populations. Throughout the example we may refer to these groups as White and Black as a shorthand.</p>
<p>We will need to age-adjust our data here, as differences in premature mortality may be due to differential distribution of ages by racialized group:</p>
<div class="inline-figure"><img src="images/07-premature-mortality/tab_age_race.png" width="100%"></div>
<p>Direct age adjustment to get standardized mortality ratios will require a reference population, which we have downloaded (and wrangled) from the National Cancer Institute (<a href="https://seer.cancer.gov/stdpopulations/" class="uri">https://seer.cancer.gov/stdpopulations/</a>).</p>
<pre><code>## # A tibble: 13 × 3
##    age_cat    pop     wt
##    &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1 0-4      69135 0.0691
##  2 10-14    73032 0.0730
##  3 15-19    72169 0.0722
##  4 20-24    66478 0.0665
##  5 25-29    64529 0.0645
##  6 30-34    71044 0.0710
##  7 35-44   162613 0.163 
##  8 45-54   134834 0.135 
##  9 5-9      72533 0.0725
## 10 55-64    87247 0.0872
## 11 65-74    66037 0.0660
## 12 75-84    44841 0.0448
## 13 85+      15508 0.0155</code></pre>
<p>Let’s now age adjust our aggregated data by racialized group so we can compare standardized mortality rates.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ma_mort_direct</span> <span class="op">&lt;-</span> <span class="va">ma_mort_agg</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">ma_demo_acs</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>,<span class="st">"GEOID10"</span>,<span class="st">"race_group"</span>,<span class="st">"sex"</span>,<span class="st">"age_cat"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Hispanic White"</span>,<span class="st">"Non-Hispanic Black"</span><span class="op">)</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">super_town</span>, <span class="va">race_group</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>den <span class="op">=</span> <span class="va">den</span> <span class="op">+</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">seer_std</span>, by<span class="op">=</span><span class="st">"age_cat"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rate_i <span class="op">=</span> <span class="va">wt</span><span class="op">*</span><span class="va">num</span><span class="op">/</span><span class="va">den</span>,
         var_rate_i <span class="op">=</span> <span class="op">(</span><span class="va">num</span><span class="op">*</span><span class="va">wt</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">den</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>, <span class="va">super_town</span>, <span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">num</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">den</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rate_i</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            var_std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">var_rate_i</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            sumwt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">wt</span><span class="op">)</span>,
            sumwt2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">wt</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>std_rate <span class="op">=</span> <span class="va">std_rate</span> <span class="op">/</span> <span class="va">sumwt</span> <span class="op">*</span><span class="fl">1000</span>,
         var_std_rate <span class="op">=</span> <span class="va">var_std_rate</span> <span class="op">/</span> <span class="va">sumwt2</span> <span class="op">*</span><span class="fl">1000</span>,
         std_rate_lo95 <span class="op">=</span> <span class="va">std_rate</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_std_rate</span><span class="op">)</span>,
         std_rate_up95 <span class="op">=</span> <span class="va">std_rate</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">plot.agg_rates</span> <span class="op">&lt;-</span> <span class="va">ma_mort_direct</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">race_group</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"std_rate"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">std_rate</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">std_rate_lo95</span>, ymax<span class="op">=</span><span class="va">std_rate_up95</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Age-Standardized Premature Mortality Rate"</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                   <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Census Tracts"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Mortality Rates"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">race_group</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, 
          axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"plot.agg_rates.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure">
<img src="images/07-premature-mortality/plot.agg_rates.png" width="100%">
We can see lots of variation here as the mortality rates increase - what is causing that?</div>
<div class="inline-figure"><img src="images/07-premature-mortality/ordered.agg_rates.png" width="100%"></div>
<p>As we might expect, these extremely variable mortality rates are occurring in small populations. What do these maps look like?</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plotlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">plotlist</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Hispanic White"</span>,<span class="st">"Non-Hispanic Black"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">plt</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">plotlist</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">map.state</span> <span class="op">&lt;-</span> <span class="va">ma_mort_direct</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="va">plt</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">std_rate</span> <span class="op">&gt;</span> <span class="fl">10</span>, <span class="fl">10</span>, <span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                            fill <span class="op">=</span> <span class="va">std_rate</span><span class="op">)</span>,
              lwd <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">plt</span>,
           fill <span class="op">=</span> <span class="st">"Age Standardized Mortality Rate"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis labels</span>
            axis.ticks.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#remove x axis ticks</span>
            axis.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co">#remove y axis labels</span>
            axis.ticks.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
            legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
            legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">map.boston</span> <span class="op">&lt;-</span> <span class="va">ma_mort_direct</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op">==</span> <span class="va">plt</span>,
           <span class="va">super_town</span> <span class="op">==</span> <span class="st">"boston"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>std_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">std_rate</span> <span class="op">&gt;</span> <span class="fl">10</span>, <span class="fl">10</span>, <span class="va">std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                            fill <span class="op">=</span> <span class="va">std_rate</span><span class="op">)</span>,
              lwd <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boston"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
            legend.position <span class="op">=</span> <span class="st">"None"</span>,
            plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> 
  
  <span class="va">plotlist</span><span class="op">[[</span><span class="va">plt</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.state</span> , x <span class="op">=</span> <span class="fl">0.00</span>, y <span class="op">=</span> <span class="fl">0.00</span>, width <span class="op">=</span> <span class="fl">0.80</span>, height <span class="op">=</span> <span class="fl">1.00</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">map.boston</span>, x <span class="op">=</span> <span class="fl">0.65</span>, y <span class="op">=</span> <span class="fl">0.50</span>, width <span class="op">=</span> <span class="fl">0.30</span>, height <span class="op">=</span> <span class="fl">0.30</span><span class="op">)</span>
  
<span class="op">}</span>

<span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_label.html">draw_label</a></span><span class="op">(</span><span class="st">"Age Standardized Mortality Rates"</span>, size <span class="op">=</span> <span class="fl">12</span>, fontface<span class="op">=</span><span class="st">'bold'</span>, hjust <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="va">caption1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_label.html">draw_label</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, size <span class="op">=</span> <span class="fl">8</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> 
<span class="va">caption2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_label.html">draw_label</a></span><span class="op">(</span><span class="st">"5-Year ACS files from end-years 2015-2019"</span>, size <span class="op">=</span> <span class="fl">8</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> 
<span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">plotlist</span>,
                  ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">byrace_std_rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">title</span>, <span class="va">plots</span>, <span class="va">caption1</span>, <span class="va">caption2</span>,
          rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">1.0</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span><span class="op">)</span>,
          ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>


<span class="va">byrace_std_rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">plotlist</span>,
                              ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"byrace_std_rates.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/byrace_std_rates.png" width="100%"></div>
<p>We are seeing some really extreme rates in the Black population, where we have smaller overall sample sizes. We are also seeing many census tracts with no black population. We can also display these two maps as one, by calculating the Rate Difference, or the Rate Ratio. Here we will show the Rate Ratio of the Age Standardized rates, as we visualized at the start of this section. Key is understanding that these rates are influenced by the small sample sizes and large potential errors we have previously visualized. It’s for researchers and communities to interpret how “real” the effects we see are</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">irr_data</span> <span class="op">&lt;-</span> <span class="va">ma_mort_direct</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">super_town</span>,<span class="va">race_group</span>, <span class="va">std_rate</span>, <span class="va">var_std_rate</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">super_town</span><span class="op">)</span>,
              names_from <span class="op">=</span> <span class="va">race_group</span>,
              values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">std_rate</span>, <span class="va">var_std_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>irr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">`std_rate_Non-Hispanic White`</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">NA_real_</span>, <span class="va">`std_rate_Non-Hispanic Black`</span> <span class="op">/</span> <span class="va">`std_rate_Non-Hispanic White`</span><span class="op">)</span>,
         irr_var <span class="op">=</span> <span class="va">`var_std_rate_Non-Hispanic Black`</span> <span class="op">+</span> <span class="va">`var_std_rate_Non-Hispanic White`</span>,
         irr_lo95 <span class="op">=</span> <span class="va">irr</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">irr_var</span><span class="op">)</span>,
         irr_up95 <span class="op">=</span> <span class="va">irr</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">irr_var</span><span class="op">)</span><span class="op">)</span> 

<span class="va">irr_plot</span> <span class="op">&lt;-</span> <span class="va">irr_data</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">irr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="va">irr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">irr_lo95</span>, ymax<span class="op">=</span><span class="va">irr_up95</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Incidence Rate Ratio Comparing Non-Hispanic Black"</span>, 
                                 <span class="st">"and Non Hispanic White Populations"</span><span class="op">)</span><span class="op">)</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>,
                                   <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Census Tracts"</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"IRR"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> 
  
<span class="va">irr_plot</span></code></pre></div>
<p>When we map the IRR, we can see the crude rate ratio between Non-Hispanic Black and Non-Hispanic White populations:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map.state.irr</span> <span class="op">&lt;-</span> <span class="va">irr_data</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>irr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">irr</span> <span class="op">&gt;</span> <span class="fl">4</span>  <span class="op">~</span> <span class="fl">4</span>,
                         <span class="cn">TRUE</span>     <span class="op">~</span> <span class="va">irr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="va">irr</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span>,
                     trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                     breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>,
                     na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Incidence Rate Ratio Comparing Non-Hispanic Black"</span>, 
                                 <span class="st">"and Non Hispanic White Populations"</span><span class="op">)</span><span class="op">)</span>,
       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                 <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span>,
       fill <span class="op">=</span> <span class="st">"IRR"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
          legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,
          plot.subtitle   <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>

<span class="va">map.boston.irr</span> <span class="op">&lt;-</span> <span class="va">irr_data</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">super_town</span> <span class="op">==</span> <span class="st">"boston"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>irr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">irr</span> <span class="op">&gt;</span> <span class="fl">4</span>  <span class="op">~</span> <span class="fl">4</span>,
                         <span class="va">irr</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">0.0000001</span>,
                         <span class="cn">TRUE</span>     <span class="op">~</span> <span class="va">irr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="va">irr</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span>,
                     trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                     breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>,
                     na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boston"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="st">"None"</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> 

<span class="va">map.irr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">plot.state.irr</span> , x <span class="op">=</span> <span class="fl">0.00</span>, y <span class="op">=</span> <span class="fl">0.05</span>, width <span class="op">=</span> <span class="fl">0.80</span>, height <span class="op">=</span> <span class="fl">1.00</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">plot.boston.irr</span>, x <span class="op">=</span> <span class="fl">0.55</span>, y <span class="op">=</span> <span class="fl">0.55</span>, width <span class="op">=</span> <span class="fl">0.45</span>, height <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"map.irr.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/map.irr.png" width="100%"></div>
</div>
<div id="what-are-the-associations-with-absm-by-racialized-group" class="section level3" number="6.4.3">
<h3>
<span class="header-section-number">6.4.3</span> What are the associations with ABSM by racialized group?<a class="anchor" aria-label="anchor" href="#what-are-the-associations-with-absm-by-racialized-group"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="images/07-premature-mortality/adj_map.p.irr.png" width="100%"></div>
<p>In order to visualize differences in how an ABSM - we will use poverty - interacts with racialized group, we can use a poisson model for the mortality rates, and include an interaction term between racialized group and poverty.</p>
<p>Let’s first plot the IRR produced by a poisson model for the rates.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">poisson_data</span> <span class="op">&lt;-</span> <span class="va">ma_mort_agg</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">ma_demo_acs</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>,<span class="st">"GEOID10"</span>,<span class="st">"race_group"</span>,<span class="st">"sex"</span>,<span class="st">"age_cat"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Hispanic White"</span>,<span class="st">"Non-Hispanic Black"</span><span class="op">)</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">super_town</span>, <span class="va">race_group</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>den <span class="op">=</span> <span class="va">den</span> <span class="op">+</span> <span class="fl">0.001</span>,
         race_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">race_group</span><span class="op">)</span>,
         race_group <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op">(</span><span class="va">race_group</span>, ref <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">ma_absm_sum</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID10"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu">fastDummies</span><span class="fu">::</span><span class="fu"><a href="https://jacobkap.github.io/fastDummies/reference/dummy_cols.html">dummy_cols</a></span><span class="op">(</span>select_columns<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pov_cat"</span>, <span class="st">"ICE_qt"</span>, <span class="st">"SVI_qt"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>pov_cat_1 <span class="op">=</span> <span class="st">"pov_cat_0-4.9%"</span>,
         pov_cat_2 <span class="op">=</span> <span class="st">"pov_cat_5-9.9%"</span>,
         pov_cat_3 <span class="op">=</span> <span class="st">"pov_cat_10-19.9%"</span>,
         pov_cat_4 <span class="op">=</span> <span class="st">"pov_cat_20-100%"</span>,
         ICE_qt_1 <span class="op">=</span> <span class="st">"ICE_qt_[-0.689,0.0607]"</span>,
         ICE_qt_2 <span class="op">=</span> <span class="st">"ICE_qt_(0.0607,0.245]"</span> , 
         ICE_qt_3 <span class="op">=</span> <span class="st">"ICE_qt_(0.245,0.362]"</span> ,  
         ICE_qt_4 <span class="op">=</span> <span class="st">"ICE_qt_(0.362,0.465]"</span> ,  
         ICE_qt_5 <span class="op">=</span> <span class="st">"ICE_qt_(0.465,0.727]"</span> ,
         SVI_qt_1 <span class="op">=</span> <span class="st">"SVI_qt_[0,0.195]"</span>,
         SVI_qt_2 <span class="op">=</span> <span class="st">"SVI_qt_(0.195,0.397]"</span>  ,
         SVI_qt_3 <span class="op">=</span> <span class="st">"SVI_qt_(0.397,0.583]"</span>,
         SVI_qt_4 <span class="op">=</span> <span class="st">"SVI_qt_(0.583,0.781]"</span>,
         SVI_qt_5 <span class="op">=</span> <span class="st">"SVI_qt_(0.781,1]"</span><span class="op">)</span> 

<span class="co"># Null poisson model</span>
<span class="va">model0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">num</span> <span class="op">~</span> <span class="va">race_group</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">den</span><span class="op">)</span><span class="op">)</span>,
                        family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="va">log</span><span class="op">)</span>,
                        data<span class="op">=</span><span class="va">poisson_data</span><span class="op">)</span>

<span class="va">summary.model0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">summary.model0</span>, file <span class="op">=</span> <span class="st">"poisson0.rds"</span><span class="op">)</span>


<span class="va">poisson_data</span><span class="op">$</span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>

<span class="va">poisson_irr</span> <span class="op">&lt;-</span> <span class="va">poisson_data</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">super_town</span>, <span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">fit</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">den</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fit_rate <span class="op">=</span> <span class="va">num</span><span class="op">/</span><span class="va">den</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">super_town</span><span class="op">)</span>,
              names_from <span class="op">=</span> <span class="va">race_group</span>,
              values_from <span class="op">=</span> <span class="va">fit_rate</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fit_irr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">`Non-Hispanic White`</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">NA_real_</span>, <span class="va">`Non-Hispanic Black`</span> <span class="op">/</span> <span class="va">`Non-Hispanic White`</span><span class="op">)</span><span class="op">)</span>

<span class="va">poisson_irr_plot</span> <span class="op">&lt;-</span> <span class="va">poisson_irr</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">fit_irr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="va">fit_irr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Incidence Rate Ratio Comparing Non-Hispanic Black"</span>, 
                                 <span class="st">"and Non Hispanic White Populations"</span><span class="op">)</span><span class="op">)</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>,
                                   <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Census Tracts"</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"IRR"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> 

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"poisson_irr_plot.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/poisson_irr_plot.png" width="100%"></div>
<p>And of course, now we can map that value as well.</p>
<div class="inline-figure"><img src="images/07-premature-mortality/map.p.irr.png" width="100%"></div>
<p>An adjusted model would allow for us to see how poverty rates are impacting the IRR.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Adjusted Poisson Model</span>
<span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">num</span> <span class="op">~</span> <span class="va">race_group</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">race_group</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">pov_cat</span>, exclude <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">den</span><span class="op">)</span><span class="op">)</span>,
                        family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="va">log</span><span class="op">)</span>,
                        data<span class="op">=</span><span class="va">poisson_data</span><span class="op">)</span>

<span class="va">summary.model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">summary.model1</span>, file <span class="op">=</span> <span class="st">"poisson1.rds"</span><span class="op">)</span>

<span class="va">poisson_data</span><span class="op">$</span><span class="va">adj_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>adj_fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>

<span class="va">adj_poisson_irr</span> <span class="op">&lt;-</span> <span class="va">poisson_data</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">super_town</span>, <span class="va">race_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">adj_fit</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">den</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>adj_fit_rate <span class="op">=</span> <span class="va">num</span><span class="op">/</span><span class="va">den</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">super_town</span><span class="op">)</span>,
              names_from <span class="op">=</span> <span class="va">race_group</span>,
              values_from <span class="op">=</span> <span class="va">adj_fit_rate</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>adj_fit_irr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">`Non-Hispanic White`</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">NA_real_</span>, <span class="va">`Non-Hispanic Black`</span> <span class="op">/</span> <span class="va">`Non-Hispanic White`</span><span class="op">)</span><span class="op">)</span>

<span class="va">adj_poisson_irr_plot</span> <span class="op">&lt;-</span> <span class="va">adj_poisson_irr</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">adj_fit_irr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>orderID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">orderID</span>, y<span class="op">=</span><span class="va">adj_fit_irr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"limegreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Poverty Adjusted Incidence Rate Ratio"</span>, 
                                 <span class="st">"Comparing Non-Hispanic Black and Non Hispanic White Populations"</span><span class="op">)</span><span class="op">)</span>,
         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>,
                                   <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Census Tracts"</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"IRR"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> 

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"adj_poisson_irr_plot.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/adj_poisson_irr_plot.png" width="100%"></div>
<p>And now the map:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adj_map.state.p.irr</span> <span class="op">&lt;-</span> <span class="va">adj_poisson_irr</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>adj_fit_irr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">adj_fit_irr</span> <span class="op">&gt;</span> <span class="fl">4</span>  <span class="op">~</span> <span class="fl">4</span>,
                         <span class="cn">TRUE</span>     <span class="op">~</span> <span class="va">adj_fit_irr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="va">adj_fit_irr</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span>,
                     trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                     breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>,
                     na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Poverty Adjusted Incidence Rate Ratio"</span>, 
                                 <span class="st">"Comparing Non-Hispanic Black and Non Hispanic White Populations"</span><span class="op">)</span><span class="op">)</span>,
       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">atop</a></span><span class="op">(</span><span class="st">"Source: Massachusetts Mortality Data 2013-2017"</span>, 
                                 <span class="st">"5-Year ACS files from end-years 2015-2019"</span><span class="op">)</span><span class="op">)</span>,
       fill <span class="op">=</span> <span class="st">"IRR"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,
          legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,
          plot.subtitle   <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>

<span class="va">adj_map.boston.p.irr</span> <span class="op">&lt;-</span> <span class="va">adj_poisson_irr</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">super_town</span> <span class="op">==</span> <span class="st">"boston"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>adj_fit_irr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">adj_fit_irr</span> <span class="op">&gt;</span> <span class="fl">4</span>  <span class="op">~</span> <span class="fl">4</span>,
                         <span class="cn">TRUE</span>     <span class="op">~</span> <span class="va">adj_fit_irr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tract_geometry</span>, by<span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>,
                          fill <span class="op">=</span> <span class="va">adj_fit_irr</span><span class="op">)</span>,
            lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span>,
                     trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                     breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>,
                     na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boston"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="st">"None"</span>,
          plot.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> 

<span class="va">adj_map.p.irr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">adj_map.state.p.irr</span> , x <span class="op">=</span> <span class="fl">0.00</span>, y <span class="op">=</span> <span class="fl">0.00</span>, width <span class="op">=</span> <span class="fl">0.80</span>, height <span class="op">=</span> <span class="fl">1.00</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html">draw_plot</a></span><span class="op">(</span><span class="va">adj_map.boston.p.irr</span>, x <span class="op">=</span> <span class="fl">0.65</span>, y <span class="op">=</span> <span class="fl">0.50</span>, width <span class="op">=</span> <span class="fl">0.30</span>, height <span class="op">=</span> <span class="fl">0.30</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"adj_map.p.irr.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/07-premature-mortality/adj_map.p.irr.png" width="100%"></div>
<p>To understand statistically how poverty is impacting the relationship between racialized groups and premature mortality, we can compare the models with and without poverty. We can see the impact of membership in racialized groups is reduced with the presence of the census tract level poverty.</p>
<pre><code>## 
## Call:
## glm(formula = num ~ race_group + factor(age_cat) + offset(log(den)), 
##     family = poisson(link = log), data = poisson_data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -6.3040  -0.6129  -0.1812  -0.0004  11.1822  
## 
## Coefficients:
##                              Estimate Std. Error  z value Pr(&gt;|z|)    
## (Intercept)                  -7.05563    0.03047 -231.594  &lt; 2e-16 ***
## race_groupNon-Hispanic Black  0.09514    0.01530    6.219 5.01e-10 ***
## factor(age_cat)10-14         -2.18691    0.08870  -24.656  &lt; 2e-16 ***
## factor(age_cat)15-19         -1.11920    0.05527  -20.249  &lt; 2e-16 ***
## factor(age_cat)20-24         -0.19393    0.04140   -4.684 2.82e-06 ***
## factor(age_cat)25-29          0.25564    0.03762    6.795 1.09e-11 ***
## factor(age_cat)30-34          0.44410    0.03688   12.043  &lt; 2e-16 ***
## factor(age_cat)35-44          0.65834    0.03331   19.766  &lt; 2e-16 ***
## factor(age_cat)45-54          1.34503    0.03158   42.588  &lt; 2e-16 ***
## factor(age_cat)5-9           -2.39092    0.10219  -23.397  &lt; 2e-16 ***
## factor(age_cat)55-64          2.06871    0.03100   66.741  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 88819  on 29099  degrees of freedom
## Residual deviance: 41743  on 29089  degrees of freedom
## AIC: 71368
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<pre><code>## 
## Call:
## glm(formula = num ~ race_group + factor(age_cat) + (race_group * 
##     factor(pov_cat, exclude = NULL)) + offset(log(den)), family = poisson(link = log), 
##     data = poisson_data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -6.8369  -0.5866  -0.1800  -0.0004  10.8734  
## 
## Coefficients:
##                                                                       Estimate
## (Intercept)                                                           -7.39658
## race_groupNon-Hispanic Black                                           0.01658
## factor(age_cat)10-14                                                  -2.13835
## factor(age_cat)15-19                                                  -1.13248
## factor(age_cat)20-24                                                  -0.30065
## factor(age_cat)25-29                                                   0.15451
## factor(age_cat)30-34                                                   0.37691
## factor(age_cat)35-44                                                   0.65107
## factor(age_cat)45-54                                                   1.36318
## factor(age_cat)5-9                                                    -2.35873
## factor(age_cat)55-64                                                   2.07728
## factor(pov_cat, exclude = NULL)5-9.9%                                  0.30491
## factor(pov_cat, exclude = NULL)10-19.9%                                0.58791
## factor(pov_cat, exclude = NULL)20-100%                                 1.01350
## factor(pov_cat, exclude = NULL)NA                                     10.68220
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)5-9.9%    -0.13530
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)10-19.9%  -0.25783
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)20-100%   -0.36243
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)NA       -10.07881
##                                                                      Std. Error
## (Intercept)                                                             0.03134
## race_groupNon-Hispanic Black                                            0.05625
## factor(age_cat)10-14                                                    0.08870
## factor(age_cat)15-19                                                    0.05528
## factor(age_cat)20-24                                                    0.04145
## factor(age_cat)25-29                                                    0.03766
## factor(age_cat)30-34                                                    0.03690
## factor(age_cat)35-44                                                    0.03331
## factor(age_cat)45-54                                                    0.03159
## factor(age_cat)5-9                                                      0.10221
## factor(age_cat)55-64                                                    0.03100
## factor(pov_cat, exclude = NULL)5-9.9%                                   0.01160
## factor(pov_cat, exclude = NULL)10-19.9%                                 0.01274
## factor(pov_cat, exclude = NULL)20-100%                                  0.01482
## factor(pov_cat, exclude = NULL)NA                                       1.00004
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)5-9.9%      0.06805
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)10-19.9%    0.06380
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)20-100%     0.06092
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)NA         92.86749
##                                                                       z value
## (Intercept)                                                          -235.974
## race_groupNon-Hispanic Black                                            0.295
## factor(age_cat)10-14                                                  -24.108
## factor(age_cat)15-19                                                  -20.488
## factor(age_cat)20-24                                                   -7.254
## factor(age_cat)25-29                                                    4.103
## factor(age_cat)30-34                                                   10.216
## factor(age_cat)35-44                                                   19.546
## factor(age_cat)45-54                                                   43.159
## factor(age_cat)5-9                                                    -23.078
## factor(age_cat)55-64                                                   67.010
## factor(pov_cat, exclude = NULL)5-9.9%                                  26.278
## factor(pov_cat, exclude = NULL)10-19.9%                                46.129
## factor(pov_cat, exclude = NULL)20-100%                                 68.377
## factor(pov_cat, exclude = NULL)NA                                      10.682
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)5-9.9%     -1.988
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)10-19.9%   -4.041
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)20-100%    -5.949
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)NA         -0.109
##                                                                      Pr(&gt;|z|)    
## (Intercept)                                                           &lt; 2e-16 ***
## race_groupNon-Hispanic Black                                           0.7682    
## factor(age_cat)10-14                                                  &lt; 2e-16 ***
## factor(age_cat)15-19                                                  &lt; 2e-16 ***
## factor(age_cat)20-24                                                 4.05e-13 ***
## factor(age_cat)25-29                                                 4.08e-05 ***
## factor(age_cat)30-34                                                  &lt; 2e-16 ***
## factor(age_cat)35-44                                                  &lt; 2e-16 ***
## factor(age_cat)45-54                                                  &lt; 2e-16 ***
## factor(age_cat)5-9                                                    &lt; 2e-16 ***
## factor(age_cat)55-64                                                  &lt; 2e-16 ***
## factor(pov_cat, exclude = NULL)5-9.9%                                 &lt; 2e-16 ***
## factor(pov_cat, exclude = NULL)10-19.9%                               &lt; 2e-16 ***
## factor(pov_cat, exclude = NULL)20-100%                                &lt; 2e-16 ***
## factor(pov_cat, exclude = NULL)NA                                     &lt; 2e-16 ***
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)5-9.9%     0.0468 *  
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)10-19.9% 5.31e-05 ***
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)20-100%  2.70e-09 ***
## race_groupNon-Hispanic Black:factor(pov_cat, exclude = NULL)NA         0.9136    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 88819  on 29099  degrees of freedom
## Residual deviance: 36546  on 29081  degrees of freedom
## AIC: 66188
## 
## Number of Fisher Scoring iterations: 11</code></pre>
<p>The impact of membership in racialized groups becomes non-significant when poverty is included in the model. We could interpret this as poverty driving the relationship between racialized group and premature mortality. If this is the case, what conclusions could we draw about the need for appropriately contextualized maps</p>
</div>
<div id="how-does-the-racialized-disparity-vary-across-space" class="section level3" number="6.4.4">
<h3>
<span class="header-section-number">6.4.4</span> How does the racialized disparity vary across space?<a class="anchor" aria-label="anchor" href="#how-does-the-racialized-disparity-vary-across-space"><i class="fas fa-link"></i></a>
</h3>
<p>Although much of our data are at the census tract level, census tracts are not areas of political decision making. Political decisions in Massachusetts are made at the level of cities and towns. We would expect that cities and towns might be more important than census tracts in determining premature mortality, because it is at those boundaries that resources are distributed. We can fit a multilevel model to test this hypothesis.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Bringing in city expenditure data</span>
<span class="va">expenditures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"expenditures.RDS"</span><span class="op">)</span>

<span class="va">mlm_data</span> <span class="op">&lt;-</span> <span class="va">ma_mort_agg</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">ma_demo_acs</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>,<span class="st">"GEOID10"</span>,<span class="st">"race_group"</span>,<span class="st">"sex"</span>,<span class="st">"age_cat"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">race_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Hispanic White"</span>,<span class="st">"Non-Hispanic Black"</span><span class="op">)</span>,
         <span class="va">age_cat</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID10</span>,<span class="va">super_town</span>, <span class="va">race_group</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            den <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>den <span class="op">=</span> <span class="va">den</span> <span class="op">+</span> <span class="fl">0.001</span>,
         race_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">race_group</span><span class="op">)</span>,
         race_group <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op">(</span><span class="va">race_group</span>, ref <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">ma_absm_sum</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GEOID10"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu">fastDummies</span><span class="fu">::</span><span class="fu"><a href="https://jacobkap.github.io/fastDummies/reference/dummy_cols.html">dummy_cols</a></span><span class="op">(</span>select_columns<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pov_cat"</span>, <span class="st">"ICE_qt"</span>, <span class="st">"SVI_qt"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>pov_cat_1 <span class="op">=</span> <span class="st">"pov_cat_0-4.9%"</span>,
         pov_cat_2 <span class="op">=</span> <span class="st">"pov_cat_5-9.9%"</span>,
         pov_cat_3 <span class="op">=</span> <span class="st">"pov_cat_10-19.9%"</span>,
         pov_cat_4 <span class="op">=</span> <span class="st">"pov_cat_20-100%"</span>,
         ICE_qt_1 <span class="op">=</span> <span class="st">"ICE_qt_[-0.689,0.0607]"</span>,
         ICE_qt_2 <span class="op">=</span> <span class="st">"ICE_qt_(0.0607,0.245]"</span> , 
         ICE_qt_3 <span class="op">=</span> <span class="st">"ICE_qt_(0.245,0.362]"</span> ,  
         ICE_qt_4 <span class="op">=</span> <span class="st">"ICE_qt_(0.362,0.465]"</span> ,  
         ICE_qt_5 <span class="op">=</span> <span class="st">"ICE_qt_(0.465,0.727]"</span> ,
         SVI_qt_1 <span class="op">=</span> <span class="st">"SVI_qt_[0,0.195]"</span>,
         SVI_qt_2 <span class="op">=</span> <span class="st">"SVI_qt_(0.195,0.397]"</span>  ,
         SVI_qt_3 <span class="op">=</span> <span class="st">"SVI_qt_(0.397,0.583]"</span>,
         SVI_qt_4 <span class="op">=</span> <span class="st">"SVI_qt_(0.583,0.781]"</span>,
         SVI_qt_5 <span class="op">=</span> <span class="st">"SVI_qt_(0.781,1]"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">expenditures</span>, by <span class="op">=</span> <span class="st">"GEOID10"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tigris/man/tigris-exports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>social_exp_perc <span class="op">=</span> <span class="va">human_services</span> <span class="op">/</span> <span class="va">total_exp</span><span class="op">)</span>

<span class="co"># Multilevel Models</span>
<span class="va">mlm0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html">glmer</a></span><span class="op">(</span><span class="va">num</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">super_town</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">den</span><span class="op">)</span><span class="op">)</span>,
              family  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="va">log</span><span class="op">)</span>,
              data    <span class="op">=</span> <span class="va">mlm_data</span>,
              nAGQ    <span class="op">=</span> <span class="fl">0</span>, 
              control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmerControl.html">glmerControl</a></span><span class="op">(</span>optimizer<span class="op">=</span><span class="st">"Nelder_Mead"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mlm0</span><span class="op">)</span>
<span class="va">summary.mlm0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mlm0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">summary.mlm0</span>, file <span class="op">=</span> <span class="st">"mlm0.rds"</span><span class="op">)</span>

<span class="va">mlm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html">glmer</a></span><span class="op">(</span><span class="va">num</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">race_group</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">super_town</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">den</span><span class="op">)</span><span class="op">)</span>,
              family  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="va">log</span><span class="op">)</span>,
              data    <span class="op">=</span> <span class="va">mlm_data</span>,
              nAGQ    <span class="op">=</span> <span class="fl">0</span>, 
              control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmerControl.html">glmerControl</a></span><span class="op">(</span>optimizer<span class="op">=</span><span class="st">"Nelder_Mead"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mlm1</span><span class="op">)</span>
<span class="va">summary.mlm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mlm1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">summary.mlm1</span>, file <span class="op">=</span> <span class="st">"mlm1.rds"</span><span class="op">)</span>

<span class="va">mlm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html">glmer</a></span><span class="op">(</span><span class="va">num</span> <span class="op">~</span> <span class="fl">1</span>  <span class="op">+</span> <span class="va">race_group</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">race_group</span> <span class="op">|</span> <span class="va">super_town</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">den</span><span class="op">)</span><span class="op">)</span>,
              family  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="va">log</span><span class="op">)</span>,
              data    <span class="op">=</span> <span class="va">mlm_data</span>,
              nAGQ    <span class="op">=</span> <span class="fl">0</span>, 
              control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmerControl.html">glmerControl</a></span><span class="op">(</span>optimizer<span class="op">=</span><span class="st">"Nelder_Mead"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mlm2</span><span class="op">)</span>
<span class="va">summary.mlm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mlm2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">summary.mlm2</span>, file <span class="op">=</span> <span class="st">"mlm2.rds"</span><span class="op">)</span>

<span class="va">mlm3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html">glmer</a></span><span class="op">(</span><span class="va">num</span> <span class="op">~</span> <span class="fl">1</span>  <span class="op">+</span> <span class="va">race_group</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span>  <span class="op">+</span> <span class="va">social_exp_perc</span> <span class="op">+</span> <span class="op">(</span><span class="va">race_group</span>  <span class="op">+</span> <span class="va">social_exp_perc</span> <span class="op">|</span> <span class="va">super_town</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">den</span><span class="op">)</span><span class="op">)</span>,
              family  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="va">log</span><span class="op">)</span>,
              data    <span class="op">=</span> <span class="va">mlm_data</span>,
              nAGQ    <span class="op">=</span> <span class="fl">0</span>, 
              control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmerControl.html">glmerControl</a></span><span class="op">(</span>optimizer<span class="op">=</span><span class="st">"Nelder_Mead"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mlm3</span><span class="op">)</span>
<span class="va">summary.mlm3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mlm3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">summary.mlm3</span>, file <span class="op">=</span> <span class="st">"mlm3.rds"</span><span class="op">)</span></code></pre></div>
<p>So how do we interpret these models? What do they tell us about whether we should be mapping at the census tract level, or the city level? What can they tell us about what sorts of variables we should include in our analyses?</p>
<div id="null-model" class="section level4" number="6.4.4.1">
<h4>
<span class="header-section-number">6.4.4.1</span> Null Model<a class="anchor" aria-label="anchor" href="#null-model"><i class="fas fa-link"></i></a>
</h4>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Adaptive
##   Gauss-Hermite Quadrature, nAGQ = 0) [glmerMod]
##  Family: poisson  ( log )
## Formula: num ~ 1 + (1 | super_town) + offset(log(den))
##    Data: mlm_data
## Control: glmerControl(optimizer = "Nelder_Mead")
## 
##      AIC      BIC   logLik deviance df.resid 
## 112631.2 112647.7 -56313.6 112627.2    29098 
## 
## Scaled residuals: 
##    Min     1Q Median     3Q    Max 
##   -4.8   -1.0   -0.4    0.0 3384.5 
## 
## Random effects:
##  Groups     Name        Variance Std.Dev.
##  super_town (Intercept) 0.1275   0.357   
## Number of obs: 29100, groups:  super_town, 313
## 
## Fixed effects:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -6.1372     0.0214  -286.7   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div id="racialized-group-and-age-fixed-effects-model" class="section level4" number="6.4.4.2">
<h4>
<span class="header-section-number">6.4.4.2</span> Racialized group and Age Fixed Effects Model<a class="anchor" aria-label="anchor" href="#racialized-group-and-age-fixed-effects-model"><i class="fas fa-link"></i></a>
</h4>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Adaptive
##   Gauss-Hermite Quadrature, nAGQ = 0) [glmerMod]
##  Family: poisson  ( log )
## Formula: 
## num ~ 1 + race_group + factor(age_cat) + (1 | super_town) + offset(log(den))
##    Data: mlm_data
## Control: glmerControl(optimizer = "Nelder_Mead")
## 
##      AIC      BIC   logLik deviance df.resid 
##  65763.9  65863.3 -32870.0  65739.9    29088 
## 
## Scaled residuals: 
##    Min     1Q Median     3Q    Max 
##   -5.0   -0.4   -0.1    0.0 4332.1 
## 
## Random effects:
##  Groups     Name        Variance Std.Dev.
##  super_town (Intercept) 0.1214   0.3484  
## Number of obs: 29100, groups:  super_town, 313
## 
## Fixed effects:
##                              Estimate Std. Error  z value Pr(&gt;|z|)    
## (Intercept)                  -7.20570    0.03671 -196.268  &lt; 2e-16 ***
## race_groupNon-Hispanic Black -0.12074    0.01681   -7.183 6.84e-13 ***
## factor(age_cat)10-14         -2.13560    0.08871  -24.075  &lt; 2e-16 ***
## factor(age_cat)15-19         -1.08769    0.05529  -19.674  &lt; 2e-16 ***
## factor(age_cat)20-24         -0.22185    0.04146   -5.351 8.73e-08 ***
## factor(age_cat)25-29          0.19829    0.03771    5.259 1.45e-07 ***
## factor(age_cat)30-34          0.40059    0.03692   10.850  &lt; 2e-16 ***
## factor(age_cat)35-44          0.65204    0.03332   19.571  &lt; 2e-16 ***
## factor(age_cat)45-54          1.35551    0.03159   42.904  &lt; 2e-16 ***
## factor(age_cat)5-9           -2.35572    0.10221  -23.047  &lt; 2e-16 ***
## factor(age_cat)55-64          2.06535    0.03102   66.591  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr) r_N-HB f(_)10 f(_)15 f(_)20 f(_)25 f(_)30 f(_)35 f(_)45 f(_)5-
## rc_grpNn-HB -0.043                                                               
## fct(_)10-14 -0.285  0.001                                                        
## fct(_)15-19 -0.456  0.008  0.188                                                 
## fct(_)20-24 -0.606  0.019  0.251  0.403                                          
## fct(_)25-29 -0.665  0.030  0.275  0.443  0.593                                   
## fct(_)30-34 -0.680  0.029  0.281  0.452  0.605  0.666                            
## fct(_)35-44 -0.756  0.022  0.312  0.501  0.669  0.736  0.751                     
## fct(_)45-54 -0.799  0.030  0.330  0.529  0.705  0.775  0.792  0.877              
## fctr(g_)5-9 -0.246  0.000  0.102  0.163  0.218  0.239  0.244  0.271  0.286       
## fct(_)55-64 -0.815  0.041  0.336  0.539  0.718  0.790  0.807  0.894  0.944  0.291</code></pre>
</div>
<div id="racialized-group-random-effect-at-the-town-level" class="section level4" number="6.4.4.3">
<h4>
<span class="header-section-number">6.4.4.3</span> Racialized group Random Effect at the Town Level<a class="anchor" aria-label="anchor" href="#racialized-group-random-effect-at-the-town-level"><i class="fas fa-link"></i></a>
</h4>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Adaptive
##   Gauss-Hermite Quadrature, nAGQ = 0) [glmerMod]
##  Family: poisson  ( log )
## Formula: num ~ 1 + race_group + factor(age_cat) + (race_group | super_town) +  
##     offset(log(den))
##    Data: mlm_data
## Control: glmerControl(optimizer = "Nelder_Mead")
## 
##      AIC      BIC   logLik deviance df.resid 
##  65180.8  65296.7 -32576.4  65152.8    29086 
## 
## Scaled residuals: 
##    Min     1Q Median     3Q    Max 
##   -5.4   -0.4   -0.1    0.0 3519.2 
## 
## Random effects:
##  Groups     Name                         Variance Std.Dev. Corr 
##  super_town (Intercept)                  0.1293   0.3596        
##             race_groupNon-Hispanic Black 0.2394   0.4893   -0.47
## Number of obs: 29100, groups:  super_town, 313
## 
## Fixed effects:
##                              Estimate Std. Error  z value Pr(&gt;|z|)    
## (Intercept)                  -7.19990    0.03707 -194.213  &lt; 2e-16 ***
## race_groupNon-Hispanic Black  0.05925    0.04739    1.250    0.211    
## factor(age_cat)10-14         -2.14283    0.08871  -24.156  &lt; 2e-16 ***
## factor(age_cat)15-19         -1.09326    0.05529  -19.773  &lt; 2e-16 ***
## factor(age_cat)20-24         -0.22183    0.04146   -5.351 8.77e-08 ***
## factor(age_cat)25-29          0.20437    0.03771    5.419 5.99e-08 ***
## factor(age_cat)30-34          0.40271    0.03693   10.906  &lt; 2e-16 ***
## factor(age_cat)35-44          0.64883    0.03332   19.472  &lt; 2e-16 ***
## factor(age_cat)45-54          1.34784    0.03160   42.653  &lt; 2e-16 ***
## factor(age_cat)5-9           -2.36179    0.10221  -23.106  &lt; 2e-16 ***
## factor(age_cat)55-64          2.05635    0.03102   66.284  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr) r_N-HB f(_)10 f(_)15 f(_)20 f(_)25 f(_)30 f(_)35 f(_)45 f(_)5-
## rc_grpNn-HB -0.183                                                               
## fct(_)10-14 -0.282  0.000                                                        
## fct(_)15-19 -0.451  0.001  0.188                                                 
## fct(_)20-24 -0.600  0.001  0.251  0.403                                          
## fct(_)25-29 -0.658  0.003  0.275  0.443  0.593                                   
## fct(_)30-34 -0.673  0.002  0.281  0.452  0.604  0.666                            
## fct(_)35-44 -0.748  0.004  0.312  0.501  0.669  0.735  0.751                     
## fct(_)45-54 -0.791  0.011  0.330  0.529  0.705  0.775  0.791  0.877              
## fctr(g_)5-9 -0.244  0.001  0.102  0.163  0.218  0.239  0.244  0.271  0.286       
## fct(_)55-64 -0.807  0.015  0.336  0.539  0.718  0.789  0.806  0.894  0.944  0.291</code></pre>
</div>
<div id="town-level-spending-random-effect" class="section level4" number="6.4.4.4">
<h4>
<span class="header-section-number">6.4.4.4</span> Town Level Spending Random Effect<a class="anchor" aria-label="anchor" href="#town-level-spending-random-effect"><i class="fas fa-link"></i></a>
</h4>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Adaptive
##   Gauss-Hermite Quadrature, nAGQ = 0) [glmerMod]
##  Family: poisson  ( log )
## Formula: 
## num ~ 1 + race_group + factor(age_cat) + social_exp_perc + (race_group +  
##     social_exp_perc | super_town) + offset(log(den))
##    Data: mlm_data
## Control: glmerControl(optimizer = "Nelder_Mead")
## 
##      AIC      BIC   logLik deviance df.resid 
##  65174.1  65323.1 -32569.0  65138.1    29082 
## 
## Scaled residuals: 
##    Min     1Q Median     3Q    Max 
##   -5.4   -0.4   -0.1    0.0 3526.7 
## 
## Random effects:
##  Groups     Name                         Variance Std.Dev. Corr       
##  super_town (Intercept)                    0.1910  0.4371             
##             race_groupNon-Hispanic Black   0.2404  0.4903  -0.47      
##             social_exp_perc              125.4878 11.2021  -0.76  0.32
## Number of obs: 29100, groups:  super_town, 313
## 
## Fixed effects:
##                              Estimate Std. Error  z value Pr(&gt;|z|)    
## (Intercept)                  -7.31562    0.05260 -139.082  &lt; 2e-16 ***
## race_groupNon-Hispanic Black  0.05925    0.04755    1.246 0.212728    
## factor(age_cat)10-14         -2.14278    0.08871  -24.155  &lt; 2e-16 ***
## factor(age_cat)15-19         -1.09332    0.05529  -19.774  &lt; 2e-16 ***
## factor(age_cat)20-24         -0.22214    0.04146   -5.358 8.42e-08 ***
## factor(age_cat)25-29          0.20407    0.03771    5.411 6.27e-08 ***
## factor(age_cat)30-34          0.40247    0.03693   10.899  &lt; 2e-16 ***
## factor(age_cat)35-44          0.64873    0.03332   19.469  &lt; 2e-16 ***
## factor(age_cat)45-54          1.34776    0.03160   42.650  &lt; 2e-16 ***
## factor(age_cat)5-9           -2.36172    0.10221  -23.106  &lt; 2e-16 ***
## factor(age_cat)55-64          2.05622    0.03102   66.280  &lt; 2e-16 ***
## social_exp_perc               9.85832    2.83885    3.473 0.000515 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr) r_N-HB f(_)10 f(_)15 f(_)20 f(_)25 f(_)30 f(_)35 f(_)45 f(_)5-
## rc_grpNn-HB -0.156                                                               
## fct(_)10-14 -0.199  0.000                                                        
## fct(_)15-19 -0.318  0.001  0.188                                                 
## fct(_)20-24 -0.422  0.001  0.251  0.403                                          
## fct(_)25-29 -0.463  0.003  0.275  0.443  0.593                                   
## fct(_)30-34 -0.473  0.002  0.281  0.452  0.604  0.666                            
## fct(_)35-44 -0.527  0.004  0.312  0.501  0.669  0.735  0.751                     
## fct(_)45-54 -0.557  0.010  0.330  0.529  0.705  0.775  0.791  0.877              
## fctr(g_)5-9 -0.172  0.001  0.102  0.163  0.218  0.239  0.244  0.271  0.286       
## fct(_)55-64 -0.568  0.015  0.336  0.539  0.718  0.789  0.806  0.894  0.944  0.291
## socl_xp_prc -0.716  0.049  0.000  0.000 -0.001 -0.002 -0.002 -0.001  0.000  0.000
##             f(_)55
## rc_grpNn-HB       
## fct(_)10-14       
## fct(_)15-19       
## fct(_)20-24       
## fct(_)25-29       
## fct(_)30-34       
## fct(_)35-44       
## fct(_)45-54       
## fctr(g_)5-9       
## fct(_)55-64       
## socl_xp_prc -0.001</code></pre>
</div>
</div>
</div>
<div id="bibliography" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> Bibliography<a class="anchor" aria-label="anchor" href="#bibliography"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Friedman D, Hunter E, Parrish R (eds). (2005). Health statistics. New York: Oxford University Press.</p></li>
<li><p>Hetzel AM (1997). HIstory and organization of vital statistics systems. Bethesda, MA: National Center for Health Statistics. <a href="https://www.cdc.gov/nchs/data/misc/usvss.pdf" class="uri">https://www.cdc.gov/nchs/data/misc/usvss.pdf</a> ; accessed June 14, 2022.</p></li>
<li><p>Krieger N. The US Census and the People’s Health: Public Health Engagement From Enslavement and “Indians Not Taxed” to Census Tracts and Health Equity (1790-2018). Am J Public Health. 2019 Aug;109(8):1092-1100. doi: 10.2105/AJPH.2019.305017. Epub 2019 Jun 20.</p></li>
<li><p>US Office of Management and Budget. Revisions to the Standards for the Classification of Federal Data on Race and Ethnicity. Federal Register 1997; 62(210):58782-58790. <a href="https://www.govinfo.gov/content/pkg/FR-1997-10-30/pdf/97-28653.pdf" class="uri">https://www.govinfo.gov/content/pkg/FR-1997-10-30/pdf/97-28653.pdf</a> ; accessed June 14, 2022.</p></li>
</ol>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="analyzing-your-data.html"><span class="header-section-number">5</span> Analyzing your data</a></div>
<div class="next"><a href="breast-cancer-mortality.html"><span class="header-section-number">7</span> Case Study 2: Breast Cancer Mortality in Massachusetts</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#premature-mortality"><span class="header-section-number">6</span> Case Study 1: Premature Mortality in Massachusetts</a></li>
<li><a class="nav-link" href="#introduction"><span class="header-section-number">6.1</span> Introduction</a></li>
<li><a class="nav-link" href="#motivation-research-questions-and-learning-objectives"><span class="header-section-number">6.2</span> Motivation, Research Questions, and Learning Objectives</a></li>
<li>
<a class="nav-link" href="#getting-and-wrangling-your-data"><span class="header-section-number">6.3</span> Getting and Wrangling Your Data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#dependencies"><span class="header-section-number">6.3.1</span> Dependencies</a></li>
<li><a class="nav-link" href="#your-health-outcome-data---premature-mortality"><span class="header-section-number">6.3.2</span> Your Health Outcome Data - Premature Mortality</a></li>
<li><a class="nav-link" href="#your-denominator-data-and-absms"><span class="header-section-number">6.3.3</span> Your Denominator Data and ABSM’s</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#approach"><span class="header-section-number">6.4</span> Approach</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#what-is-the-overall-socioeconomic-gradient-in-premature-mortality"><span class="header-section-number">6.4.1</span> What is the overall socioeconomic gradient in premature mortality?</a></li>
<li><a class="nav-link" href="#what-is-the-racialized-disparity-in-premature-mortality-overall"><span class="header-section-number">6.4.2</span> What is the racialized disparity in premature mortality overall?</a></li>
<li><a class="nav-link" href="#what-are-the-associations-with-absm-by-racialized-group"><span class="header-section-number">6.4.3</span> What are the associations with ABSM by racialized group?</a></li>
<li><a class="nav-link" href="#how-does-the-racialized-disparity-vary-across-space"><span class="header-section-number">6.4.4</span> How does the racialized disparity vary across space?</a></li>
</ul>
</li>
<li><a class="nav-link" href="#bibliography"><span class="header-section-number">6.5</span> Bibliography</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Public Health Disparities Geocoding Project 2.0 Training Manual</strong>" was written by Christian Testa, Jarvis T Chen, Enjoli Hall, Dena Javadi, Justin Morgan, Tamara Rushovich, Sudipta (Shu) Saha, Pamela D Waterman, Nancy Krieger. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
