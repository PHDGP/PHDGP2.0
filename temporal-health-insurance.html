<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>10 Case Study 4: Case Study on Temporal Trends using American Community Survey (ACS) data (2012-2019) | Public Health Disparities Geocoding Project 2.0 Training Manual</title>
<meta name="author" content="Christian Testa, Jarvis T Chen, Enjoli Hall, Dena Javadi, Justin Morgan, Tamara Rushovich, Sudipta Saha, Pamela D Waterman, Nancy Krieger">
<meta name="description" content="By: Dena Javadi, Tamara Rushovich, Christian Testa  10.1 Introduction The American Community Survey (ACS), conducted by the U.S. census bureau is a yearly survey (monthly samples providing annual...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="10 Case Study 4: Case Study on Temporal Trends using American Community Survey (ACS) data (2012-2019) | Public Health Disparities Geocoding Project 2.0 Training Manual">
<meta property="og:type" content="book">
<meta property="og:description" content="By: Dena Javadi, Tamara Rushovich, Christian Testa  10.1 Introduction The American Community Survey (ACS), conducted by the U.S. census bureau is a yearly survey (monthly samples providing annual...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="10 Case Study 4: Case Study on Temporal Trends using American Community Survey (ACS) data (2012-2019) | Public Health Disparities Geocoding Project 2.0 Training Manual">
<meta name="twitter:description" content="By: Dena Javadi, Tamara Rushovich, Christian Testa  10.1 Introduction The American Community Survey (ACS), conducted by the U.S. census bureau is a yearly survey (monthly samples providing annual...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="libs/HomeButton-0.0.1/home-button.js"></script><script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script><script src="libs/clipboard-0.0.1/setClipboardText.js"></script><link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-YD7D8SMHNP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-YD7D8SMHNP');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Public Health Disparities Geocoding Project 2.0 Training Manual</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Public Health Disparities Geocoding Project 2.0 Training Manual</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="background.html"><span class="header-section-number">1</span> Background and History of Analytic Methods</a></li>
<li><a class="" href="bios.html"><span class="header-section-number">2</span> Author Bios</a></li>
<li><a class="" href="getting-setup.html"><span class="header-section-number">3</span> Getting Setup with R and RStudio</a></li>
<li><a class="" href="getting-your-data.html"><span class="header-section-number">4</span> Getting your data</a></li>
<li><a class="" href="visualizing-your-data.html"><span class="header-section-number">5</span> Visualizing your data</a></li>
<li><a class="" href="analyzing-your-data.html"><span class="header-section-number">6</span> Analyzing your data</a></li>
<li><a class="" href="premature-mortality.html"><span class="header-section-number">7</span> Case Study 1: Premature Mortality in Massachusetts (2013 - 2017)</a></li>
<li><a class="" href="breast-cancer-mortality.html"><span class="header-section-number">8</span> Case Study 2: Breast Cancer Mortality in Massachusetts</a></li>
<li><a class="" href="cook-county-covid.html"><span class="header-section-number">9</span> Case Study 3: COVID-19 Mortality in Cook County (March 2020 - March 2022)</a></li>
<li><a class="active" href="temporal-health-insurance.html"><span class="header-section-number">10</span> Case Study 4: Case Study on Temporal Trends using American Community Survey (ACS) data (2012-2019)</a></li>
<li><a class="" href="health-insurance-comparison.html"><span class="header-section-number">11</span> Case Study 5: Case Study Comparing County Analyses of Inequities in Health Insurance using ACS vs. CDC PLACES data (2019)</a></li>
<li><a class="" href="conclusions.html"><span class="header-section-number">12</span> Conclusion</a></li>
<li><a class="" href="glossary.html"><span class="header-section-number">13</span> Glossary</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="temporal-health-insurance" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Case Study 4: Case Study on Temporal Trends using American Community Survey (ACS) data (2012-2019)<a class="anchor" aria-label="anchor" href="#temporal-health-insurance"><i class="fas fa-link"></i></a>
</h1>
<p><em>By: Dena Javadi, Tamara Rushovich, Christian Testa</em></p>
<div id="introduction-2" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-2"><i class="fas fa-link"></i></a>
</h2>
<p>The American Community Survey (ACS), conducted by the U.S. census bureau is a yearly survey (monthly samples providing annual updates) that provides vital information on educational attainment, jobs, occupations, veterans, house ownership, disability, poverty status, demographics, <a href="https://www.census.gov/programs-surveys/acs/guidance/subjects.html">and more</a>.</p>
<p>To learn more about the survey methodology used, please visit the <a href="https://www.census.gov/programs-surveys/acs/methodology/design-and-methodology.html">ACS website</a>.</p>
</div>
<div id="motivation-research-questions-and-learning-objectives-3" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Motivation, Research Questions, and Learning Objectives<a class="anchor" aria-label="anchor" href="#motivation-research-questions-and-learning-objectives-3"><i class="fas fa-link"></i></a>
</h2>
<p>The goal of this case study is to gain familiarity with the ACS, visualize trends over time, model the effect of different Area-Based Social Metrics (ABSMs) on trends in a particular outcome.</p>
<p>The outcome of interest in this case study is health insurance. The specific learning objectives are to:</p>
<ul>
<li><p>Download health outcome and ABSM data from the ACS<br></p></li>
<li><p>Visualize (plot) and map data<br></p></li>
<li><p>Characterize trends in outcome of interest by ABSMs<br></p></li>
<li>
<p>Work with estimate uncertainty (margin of error) data to:</p>
<ul>
<li>Aggregate it up from stratified estimates (like aggregating private and public insurance rates together into overall insurance rates)</li>
<li>Visualize uncertainty for individual areal units over time</li>
<li>Model trends over time</li>
</ul>
</li>
</ul>
<p>Although this case study will follow insurance rates over time from specified counties, the skills learned should be generalizable to pulling other ACS variables at other geographic levels.</p>
<p>In this case study, we are particularly interested in observed differences in health insurance coverage across four US states (Massachusetts, California, Texas, and Florida) from 2012-2019. Our research questions are:</p>
<ol style="list-style-type: decimal">
<li>What are the trends in health insurance coverage from 2012-2019 in each state and what is the level of certainty in these trends?<br>
</li>
<li>How is county-level poverty associated with health insurance coverage from 2012-2019 in each state?<br>
</li>
<li>How is county-level racialized economic segregation as measured by the Index of Concentration at the Extremes (ICE) associated with health insurance coverage from 2012-2019 in each state?</li>
</ol>
<div class="infobox dataWrangling">
<p>In this next section, <strong>Downloading your Data</strong>, we will show you how to download ACS data by querying the census API and how to manipulate the data into the format we need for the rest of the analysis. This case study investigates the ACS variable of health insurance in four states. See if you can replicate the analysis with a different ACS variable or in different states!</p>
</div>
</div>
<div id="downloading-your-data" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Downloading your data<a class="anchor" aria-label="anchor" href="#downloading-your-data"><i class="fas fa-link"></i></a>
</h2>
<p>Explore the ACS data dictionary to identify the variables of interest and to create your own data dictionary. Here is an example of the <a href="https://api.census.gov/data/2016/acs/acs5/variables.html">2016 dictionary</a>.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># We need to load the following packages:</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/">tidycensus</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span> <span class="co"># magrittr defines the %&lt;&gt;% operator, read more here: https://magrittr.tidyverse.org/</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>

<span class="co"># build a data dictionary - based on ACS 2013</span>
<span class="va">data_dictionary</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">variable</span>,     <span class="op">~</span><span class="va">shortname</span>,                       <span class="op">~</span><span class="va">description</span>,
  <span class="st">"B18135_002"</span>,  <span class="st">'under18_denom'</span>,                   <span class="st">"Estimate!!Total!!Under 18 years"</span>,
  <span class="st">"B18135_004"</span>,  <span class="st">'under18_insured_with_disability'</span>, <span class="st">"Estimate!!Total!!Under 18 years!!With a disability!!With health insurance coverage"</span>,
  <span class="st">"B18135_009"</span>,  <span class="st">'under18_insured_no_disability'</span>,   <span class="st">"Estimate!!Total!!Under 18 years!!No disability!!With health insurance coverage"</span>,
  <span class="st">"B18135_013"</span>,  <span class="st">'adult_denom'</span>,                     <span class="st">"Estimate!!Total!!18 to 64 years"</span>,
  <span class="st">"B18135_015"</span>,  <span class="st">'adult_insured_with_disability'</span>,   <span class="st">"Estimate!!Total!!18 to 64 years!!With a disability!!With health insurance coverage"</span>,
  <span class="st">"B18135_020"</span>,  <span class="st">'adult_insured_no_disability'</span>,     <span class="st">"Estimate!!Total!!18 to 64 years!!No disability!!With health insurance coverage"</span>,
  <span class="co"># ICEraceinc variables</span>
  <span class="st">"B19001_001"</span>,  <span class="st">'hhinc_total'</span>,   <span class="st">"total population for household income estimates"</span>,
  <span class="st">"B19001A_002"</span>, <span class="st">'hhinc_w_1'</span>,     <span class="st">"white n.h. pop with household income &lt;$10k"</span>,
  <span class="st">"B19001A_003"</span>, <span class="st">'hhinc_w_2'</span>,     <span class="st">"white n.h. pop with household income $10k-14 999k"</span>,
  <span class="st">"B19001A_004"</span>, <span class="st">'hhinc_w_3'</span>,     <span class="st">"white n.h. pop with household income $15k-19 999k"</span>,
  <span class="st">"B19001A_005"</span>, <span class="st">'hhinc_w_4'</span>,     <span class="st">"white n.h. pop with household income $20k-24 999k"</span>,
  <span class="st">"B19001A_014"</span>, <span class="st">'hhinc_w_5'</span>,     <span class="st">"white n.h. pop with household income $100 000 to $124 999"</span>,
  <span class="st">"B19001A_015"</span>, <span class="st">'hhinc_w_6'</span>,     <span class="st">"white n.h. pop with household income $125k-149 999k"</span>,
  <span class="st">"B19001A_016"</span>, <span class="st">'hhinc_w_7'</span>,     <span class="st">"white n.h. pop with household income $150k-199 999k"</span>,
  <span class="st">"B19001A_017"</span>, <span class="st">'hhinc_w_8'</span>,     <span class="st">"white n.h. pop with household income $196k+"</span>,
  <span class="st">"B19001_002"</span>,  <span class="st">'hhinc_total_1'</span>, <span class="st">"total pop with household income &lt;$10k"</span>,
  <span class="st">"B19001_003"</span>,  <span class="st">'hhinc_total_2'</span>, <span class="st">"total pop with household income $10k-14 999k"</span>,
  <span class="st">"B19001_004"</span>,  <span class="st">'hhinc_total_3'</span>, <span class="st">"total pop with household income $15k-19 999k"</span>,
  <span class="st">"B19001_005"</span>,  <span class="st">'hhinc_total_4'</span>, <span class="st">"total pop with household income $20k-24 999k"</span>,
  <span class="st">"B05010_002"</span>,  <span class="st">'in_poverty'</span>,    <span class="st">"total pop in poverty"</span>,
  <span class="st">"B05010_001"</span>, <span class="st">'total_pop_for_poverty_estimates'</span>, 
                                  <span class="st">"denominator population for poverty estimates"</span>
<span class="op">)</span>

<span class="co"># another way to create a data dictionary is to use tidycensus to get the variables tables and filter it:</span>
<span class="va">acs2012variables</span> <span class="op">&lt;-</span> <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/load_variables.html">load_variables</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2012</span>, dataset <span class="op">=</span> <span class="st">'acs5'</span><span class="op">)</span>
<span class="va">acs2012variables</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span>
  <span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B18135_002"</span>, <span class="st">"B18135_004"</span>, <span class="st">"B18135_009"</span>, <span class="st">"B18135_013"</span>, <span class="st">"B18135_015"</span>, <span class="st">"B18135_020"</span><span class="op">)</span><span class="op">)</span> 
<span class="co"># then you could append `shortname` data if you'd like</span>

<span class="co"># write a function to help query county insurance rates by state</span>
<span class="va">get_county_health_insurance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span>, <span class="va">year</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>state <span class="op">=</span> <span class="va">state</span>, year <span class="op">=</span> <span class="va">year</span>, geography <span class="op">=</span> <span class="st">'county'</span>, variables <span class="op">=</span> <span class="va">data_dictionary</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># create a table shell for each year of data for each of texas, massachusetts, florida, and california</span>
<span class="va">health_insurance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'TX'</span>, <span class="st">'MA'</span>, <span class="st">'FL'</span>, <span class="st">'CA'</span><span class="op">)</span>, year <span class="op">=</span> <span class="fl">2012</span><span class="op">:</span><span class="fl">2019</span><span class="op">)</span>

<span class="co"># query the data from ACS</span>
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  acs_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">get_county_health_insurance</span><span class="op">(</span>state <span class="op">=</span> <span class="va">state</span>, year <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> 

<span class="co"># unnest our data</span>
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">acs_data</span><span class="op">)</span>

<span class="co"># recode variables to use friendlier shortnames</span>
<span class="co"># the !!! operator, sometimes called the splat operator, expands a named vector into named argumes for a function;</span>
<span class="co"># in this case, the output of setNames() is a named character vector with variable shortnames as the names and </span>
<span class="co"># variable codes as the values.  Passing these to !!! and then recode says "rename the variable codes to the </span>
<span class="co"># more human-readable, shortnames"</span>
<span class="va">health_insurance</span><span class="op">$</span><span class="va">variable</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span> <span class="op">!</span><span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">data_dictionary</span><span class="op">$</span><span class="va">shortname</span>, <span class="va">data_dictionary</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span>

<span class="co"># pivot into wide format</span>
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>
    id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'year'</span>, <span class="st">'state'</span>, <span class="st">'GEOID'</span>, <span class="st">'NAME'</span><span class="op">)</span>,
    names_from <span class="op">=</span> <span class="st">'variable'</span>,
    values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'estimate'</span>, <span class="st">'moe'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># calculate adult (18+ years), child, and 0-64 insurance rates by county and year </span>
<span class="co"># Below we are add the estimated number of insured adults with a disability and the number of insured adults without a disability </span>
<span class="co"># to get the total number of insured adults. We do the same for children and people aged 0-64 years.</span>
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  <span class="co"># calculate numerators</span>
  estimate_adult_insurance_numerator <span class="op">=</span> <span class="op">(</span><span class="va">estimate_adult_insured_with_disability</span> <span class="op">+</span> <span class="va">estimate_adult_insured_no_disability</span><span class="op">)</span>,
  estimate_under18_insurance_numerator <span class="op">=</span> <span class="op">(</span>
    <span class="va">estimate_under18_insured_with_disability</span> <span class="op">+</span> <span class="va">estimate_under18_insured_no_disability</span>
  <span class="op">)</span>,
  estimate_zero_to_64_insurance_numerator <span class="op">=</span> <span class="op">(</span>
    <span class="va">estimate_adult_insured_with_disability</span> <span class="op">+</span>
      <span class="va">estimate_adult_insured_no_disability</span> <span class="op">+</span>
      <span class="va">estimate_under18_insured_with_disability</span> <span class="op">+</span>
      <span class="va">estimate_under18_insured_no_disability</span>
  <span class="op">)</span>,
  <span class="co"># calculate denominator</span>
  estimate_zero_to_64_insurance_denom <span class="op">=</span> <span class="va">estimate_under18_denom</span> <span class="op">+</span> <span class="va">estimate_adult_denom</span>,
  <span class="co"># calculate proportions</span>
  estimate_adult_insurance_prop <span class="op">=</span> <span class="va">estimate_adult_insurance_numerator</span> <span class="op">/</span> <span class="va">estimate_adult_denom</span>,
  estimate_under18_insurance_prop <span class="op">=</span> <span class="va">estimate_under18_insurance_numerator</span> <span class="op">/</span> <span class="va">estimate_under18_denom</span>,
  estimate_zero_to_64_insurance_prop <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_numerator</span> <span class="op">/</span> <span class="op">(</span><span class="va">estimate_zero_to_64_insurance_denom</span><span class="op">)</span>,
  
  <span class="co"># calculate social metrics</span>
  poverty_prop <span class="op">=</span> <span class="va">estimate_in_poverty</span> <span class="op">/</span> <span class="va">estimate_total_pop_for_poverty_estimates</span>,
  
      <span class="co"># we calculate the people of color low income counts as the overall </span>
    <span class="co"># low income counts minus the White non-Hispanic low income counts</span>
    people_of_color_low_income <span class="op">=</span> 
      <span class="op">(</span><span class="va">estimate_hhinc_total_1</span> <span class="op">+</span> <span class="va">estimate_hhinc_total_2</span> <span class="op">+</span> <span class="va">estimate_hhinc_total_3</span> <span class="op">+</span> <span class="va">estimate_hhinc_total_4</span><span class="op">)</span> <span class="op">-</span> 
      <span class="op">(</span><span class="va">estimate_hhinc_w_1</span> <span class="op">+</span> <span class="va">estimate_hhinc_w_2</span> <span class="op">+</span> <span class="va">estimate_hhinc_w_3</span> <span class="op">+</span> <span class="va">estimate_hhinc_w_4</span><span class="op">)</span>,
    <span class="co"># sum up the White non-Hispanic high income counts</span>
    White_non_hispanic_high_income <span class="op">=</span> 
      <span class="op">(</span><span class="va">estimate_hhinc_w_5</span> <span class="op">+</span> <span class="va">estimate_hhinc_w_6</span> <span class="op">+</span> <span class="va">estimate_hhinc_w_7</span> <span class="op">+</span> <span class="va">estimate_hhinc_w_8</span><span class="op">)</span>,
    <span class="co"># calculate the index of concentration at the extremes for racialized </span>
    <span class="co"># economic segregation (high income White non-Hispanic vs. low income </span>
    <span class="co"># people of color)</span>
    ICEraceinc <span class="op">=</span> 
      <span class="op">(</span><span class="va">white_non_hispanic_high_income</span> <span class="op">-</span> <span class="va">people_of_color_low_income</span><span class="op">)</span> <span class="op">/</span> 
      <span class="va">estimate_hhinc_total</span>,
  <span class="op">)</span>

<span class="co"># use the moe_sum and moe_prop functions from tidycensus to create margin of error</span>
<span class="co"># for aggregated estimates and proportion variables</span>
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    <span class="co"># calculate moe for numerators</span>
  moe_adult_insurance_numerator <span class="op">=</span> <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/moe_sum.html">moe_sum</a></span><span class="op">(</span>
    moe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">moe_adult_insured_with_disability</span>, <span class="va">moe_adult_insured_no_disability</span><span class="op">)</span>,
    estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">estimate_adult_insured_with_disability</span>, <span class="va">estimate_adult_insured_no_disability</span><span class="op">)</span><span class="op">)</span>, 
  moe_under18_insurance_numerator <span class="op">=</span> <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/moe_sum.html">moe_sum</a></span><span class="op">(</span>
    moe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">moe_under18_insured_with_disability</span>, <span class="va">moe_under18_insured_no_disability</span><span class="op">)</span>,
    estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">estimate_under18_insured_with_disability</span>, <span class="va">estimate_under18_insured_no_disability</span><span class="op">)</span><span class="op">)</span>, 
  moe_zero_to_64_insurance_numerator <span class="op">=</span> <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/moe_sum.html">moe_sum</a></span><span class="op">(</span>
    moe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">moe_adult_insured_with_disability</span>,
      <span class="va">moe_adult_insured_no_disability</span>,
      <span class="va">moe_under18_insured_with_disability</span>,
      <span class="va">moe_under18_insured_no_disability</span><span class="op">)</span>,
    estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">estimate_adult_insured_with_disability</span>,
      <span class="va">estimate_adult_insured_no_disability</span>,
      <span class="va">estimate_under18_insured_with_disability</span>,
      <span class="va">estimate_under18_insured_no_disability</span><span class="op">)</span><span class="op">)</span>,
  <span class="co"># calculate moe for proportions</span>
  moe_adult_insurance_prop <span class="op">=</span> <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/moe_prop.html">moe_prop</a></span><span class="op">(</span>
    num <span class="op">=</span> <span class="va">estimate_adult_insurance_numerator</span>,
    denom <span class="op">=</span> <span class="va">estimate_adult_denom</span>,
    moe_num <span class="op">=</span> <span class="va">moe_adult_insurance_numerator</span>,
    moe_denom <span class="op">=</span> <span class="va">moe_adult_denom</span><span class="op">)</span>, 
  moe_under18_insurance_prop <span class="op">=</span> <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/moe_prop.html">moe_prop</a></span><span class="op">(</span>
    num <span class="op">=</span> <span class="va">estimate_under18_insurance_numerator</span>,
    denom <span class="op">=</span> <span class="va">estimate_under18_denom</span>,
    moe_num <span class="op">=</span> <span class="va">moe_under18_insurance_numerator</span>,
    moe_denom <span class="op">=</span> <span class="va">moe_under18_denom</span><span class="op">)</span>, 
  moe_zero_to_64_insurance_prop <span class="op">=</span> <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/moe_prop.html">moe_prop</a></span><span class="op">(</span>
    num <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_numerator</span>,
    denom <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_denom</span>,
    moe_num <span class="op">=</span> <span class="va">moe_zero_to_64_insurance_numerator</span>,
    moe_denom <span class="op">=</span> <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/moe_sum.html">moe_sum</a></span><span class="op">(</span>
      moe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">moe_under18_denom</span>, <span class="va">moe_adult_denom</span><span class="op">)</span>,
      estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">estimate_under18_denom</span>, <span class="va">estimate_adult_denom</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>

<span class="co"># use full state names</span>
<span class="va">health_insurance</span><span class="op">$</span><span class="va">state</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span>
  CA <span class="op">=</span> <span class="st">'California'</span>,
  FL <span class="op">=</span> <span class="st">'Florida'</span>,
  MA <span class="op">=</span> <span class="st">'Massachusetts'</span>,
  TX <span class="op">=</span> <span class="st">'Texas'</span><span class="op">)</span>

<span class="va">health_insurance</span><span class="op">$</span><span class="va">state</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'California'</span>, <span class="st">'Florida'</span>, <span class="st">'Massachusetts'</span>, <span class="st">'Texas'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># remove any unncessary variables going forward</span>
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>
  <span class="va">year</span>, <span class="va">state</span>, <span class="va">GEOID</span>, <span class="va">NAME</span>,
  <span class="va">estimate_adult_denom</span>,
  <span class="va">estimate_under18_denom</span>,
  <span class="va">estimate_zero_to_64_insurance_denom</span>,
  <span class="va">estimate_adult_insurance_numerator</span>,
  <span class="va">estimate_under18_insurance_numerator</span>,
  <span class="va">estimate_zero_to_64_insurance_numerator</span>,
  <span class="va">estimate_adult_insurance_prop</span>,
  <span class="va">estimate_under18_insurance_prop</span>,
  <span class="va">estimate_zero_to_64_insurance_prop</span>,
  <span class="va">moe_adult_insurance_prop</span>,
  <span class="va">moe_under18_insurance_prop</span>,
  <span class="va">moe_zero_to_64_insurance_prop</span>,
  <span class="va">poverty_prop</span>,
  <span class="va">ICEraceinc</span>
<span class="op">)</span>

<span class="co"># table the top few lines of our dataframe so we can check that everything is</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">health_insurance</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Congrats! You’ve downloaded your dataset!</p>
</div>
<div id="visualizing-your-data-2" class="section level2" number="10.4">
<h2>
<span class="header-section-number">10.4</span> Visualizing your Data<a class="anchor" aria-label="anchor" href="#visualizing-your-data-2"><i class="fas fa-link"></i></a>
</h2>
<p>Now on to visualizing estimates:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/clauswilke/colorblindr">colorblindr</a></span><span class="op">)</span>
<span class="co"># create plot of county level % with health insurance by year and smooth with geom_smooth method = 'loess' by year </span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">health_insurance</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_prop</span>, color <span class="op">=</span> <span class="va">state</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>, height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'loess'</span>, color <span class="op">=</span> <span class="st">'dimgrey'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">state</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">palette_OkabeIto</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span>,
                      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Texas'</span>, <span class="st">'Massachusetts'</span>, <span class="st">'Florida'</span>, <span class="st">'California'</span><span class="op">)</span><span class="op">)</span>
                      <span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">palette_OkabeIto</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span>,
                      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Texas'</span>, <span class="st">'Massachusetts'</span>, <span class="st">'Florida'</span>, <span class="st">'California'</span><span class="op">)</span><span class="op">)</span>
                      <span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percent with Health Insurance (age 0-64)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"% with Health Insurance by County and State"</span>, 
          <span class="st">"Each dot represents a county observation from ACS\nSmooth fit shows average county observation"</span><span class="op">)</span>

<span class="co"># here's a version using ggdist to plot quantile ribbons on top of the jittered points </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/">ggdist</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">health_insurance</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
         x <span class="op">=</span> <span class="va">year</span>,
         y <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_prop</span>,
         fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span>,
         color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span>
       <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_lineribbon.html">stat_lineribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill_ramp <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'black'</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">state</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">palette_OkabeIto</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span>,
                      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Texas'</span>, <span class="st">'Massachusetts'</span>, <span class="st">'Florida'</span>, <span class="st">'California'</span><span class="op">)</span><span class="op">)</span>
                      <span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">palette_OkabeIto</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span>,
                      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Texas'</span>, <span class="st">'Massachusetts'</span>, <span class="st">'Florida'</span>, <span class="st">'California'</span><span class="op">)</span><span class="op">)</span>
                      <span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percent with Health Insurance (ages 0-64)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"% with Health Insurance by County and State, Ages 0-64"</span>, 
          <span class="st">"Each dot represents a county observation from ACS\nSmoothed line represents median county estimate"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    fill_ramp <span class="op">=</span> <span class="st">'Quantile Range'</span>,
    color <span class="op">=</span> <span class="st">'State'</span>,
    fill <span class="op">=</span> <span class="st">'State'</span>,
    <span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/10-temporal-health-insurance/perc_with_health_insurance.png" width="80%"></div>
<div class="infobox dataWrangling">
<p>Now, we might want to map our quantities of interest!</p>
<p>Since we didn’t download the geometry with our queries to the Census API through
<code>tidycensus</code>, we can now download our county geometry from <code>tigris</code> and merge it
in.</p>
<p>We didn’t want to download the geometry data in our calls to <code>tidycensus</code> for two
reasons:</p>
<ol style="list-style-type: decimal">
<li><p>Because the <code>tidycensus</code> package returns tidy formatted data (one variable
and observation per row), our geometry data would be repeated many times taking
up more space than necessary; and</p></li>
<li><p>Because it’s easier to do our aggregation and data manipulation without the
spatial/geometry data and to add them in afterwards as some functions from
<code>dplyr</code> or the <code>tidyverse</code> may not work well with spatial data frames.</p></li>
</ol>
<p>When you look at the maps, make sure to note the scales presented in the legend because sometimes they
differ (i.e. pay attention to what the range in the legend represents)!</p>
</div>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">counties_sf</span> <span class="op">&lt;-</span> 
  <span class="fu">tigris</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tigris/man/counties.html">counties</a></span><span class="op">(</span>
    state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'CA'</span>, <span class="st">'FL'</span>, <span class="st">'MA'</span>, <span class="st">'TX'</span><span class="op">)</span>,
    cb <span class="op">=</span> <span class="cn">TRUE</span>,
    resolution <span class="op">=</span> <span class="st">'20m'</span><span class="op">)</span> <span class="co"># here we're downloading 1:20m resolution data </span>

<span class="co"># make sure to do an inner join since we have more than 1 row per county</span>
<span class="co"># for more information on different types of joins: https://statisticsglobe.com/r-dplyr-join-inner-left-right-full-semi-anti</span>
<span class="va">health_insurance_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span>
  <span class="va">counties_sf</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID</span>, <span class="va">STATE_NAME</span><span class="op">)</span>, <span class="co"># when joining spatial data in, put the spatial data argument first so</span>
  <span class="co"># the output inherits the spatial data class </span>
  <span class="va">health_insurance</span>,
  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'GEOID'</span> <span class="op">=</span> <span class="st">'GEOID'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Function to make maps for each of California, Florida, Massachusetts, Texas</span>
<span class="co"># counties over time</span>
<span class="va">map_health_insurance_over_time</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state_name</span>, <span class="va">outcome_var</span>,
                                           <span class="va">fill_label</span> <span class="op">=</span> <span class="st">'Percent with Health Insurance'</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">health_insurance_sf</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">STATE_NAME</span> <span class="op">==</span> <span class="va">state_name</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="op">{</span><span class="op">{</span> <span class="va">outcome_var</span> <span class="op">}</span><span class="op">}</span>, label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'white'</span>, size <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">'Blues'</span>, direction <span class="op">=</span> <span class="fl">1</span>, labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">fill_label</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span>,
          axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          legend.key.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="st">'cm'</span><span class="op">)</span>
          <span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Percent with Health Insurance by County over Time"</span>, <span class="va">state_name</span><span class="op">)</span> 
<span class="op">}</span>

<span class="co"># create choropleth maps over time for each measure</span>
<span class="fu">map_health_insurance_over_time</span><span class="op">(</span><span class="st">'California'</span>, <span class="va">estimate_zero_to_64_insurance_prop</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/10-temporal-health-insurance/california.png"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu">map_health_insurance_over_time</span><span class="op">(</span><span class="st">'Florida'</span>, <span class="va">estimate_zero_to_64_insurance_prop</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/10-temporal-health-insurance/florida.png"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu">map_health_insurance_over_time</span><span class="op">(</span><span class="st">'Massachusetts'</span>, <span class="va">estimate_zero_to_64_insurance_prop</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/10-temporal-health-insurance/massachusetts.png"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu">map_health_insurance_over_time</span><span class="op">(</span><span class="st">'Texas'</span>, <span class="va">estimate_zero_to_64_insurance_prop</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/10-temporal-health-insurance/texas.png"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="images/10-temporal-health-insurance/california.png" width="80%"><img src="images/10-temporal-health-insurance/florida.png" width="80%"><img src="images/10-temporal-health-insurance/massachusetts.png" width="80%"><img src="images/10-temporal-health-insurance/texas.png" width="80%"></p>
<div class="infobox interpretation">
<p>Notice, in Texas there is one county that seems to experience a decrease in insurance coverage over time. This seems strange! What do you think is the reason for this? Let’s investigate further.</p>
</div>
<div class="infobox dataWrangling">
<p>One way to identify which county in Texas appears to be decreasing is by using the R package plotly. The function ggplotly, produces a map that will allow you to hover your cursor over a county to see the name of the county and the percent with health insurance. This is how we can identify that the percent with health insurance in McCulloch County appears to be decreasing over time. Try it out below!</p>
</div>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com">plotly</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="fu">map_health_insurance_over_time</span><span class="op">(</span><span class="st">'Texas'</span>, <span class="va">estimate_zero_to_64_insurance_prop</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Now we can take a closer look at McCulloch County, TX and see that it has a large margin of error!</span>
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">'McCulloch County, Texas'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_prop</span>,
             ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">moe_zero_to_64_insurance_prop</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="va">estimate_zero_to_64_insurance_prop</span>, <span class="fl">1</span><span class="op">)</span>,
             ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="va">estimate_zero_to_64_insurance_prop</span> <span class="op">-</span> <span class="va">moe_zero_to_64_insurance_prop</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">'#3182BD'</span>, alpha <span class="op">=</span> <span class="fl">.8</span>, size <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percent with Health Insurance"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"% with Health Insurance, McCulloch County, Texas"</span>,
          <span class="st">"90% Margin of Error and Estimates Shown"</span><span class="op">)</span> 

<span class="co"># One reason that a county would have a large margin of error is if it has a small population size. Let's see what the population size is of McCulloch County, TX.</span>
<span class="co">#Here we see that the adult population of McCulloch county went from 4,649 in 2012 to 4,364 in 2019.</span>

<span class="va">McCulloch</span><span class="op">&lt;-</span><span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">==</span><span class="st">"McCulloch County, Texas"</span><span class="op">)</span>

<span class="va">McCulloch</span><span class="op">$</span><span class="va">estimate_adult_denom</span>

<span class="co">#Here we can see that the range of the adult population across all counties in the four states we are examining is 48 - 6,496,638. That means that that McCulloch county, with a population of around 4,500 falls in the bottom quantile, which likely explains the large margin of error.</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">health_insurance</span><span class="op">$</span><span class="va">estimate_adult_denom</span><span class="op">)</span></code></pre></div>
<div class="infobox dataWrangling">
<p>For more information on how the ACS calculates margin of error, see <a href="https://www.census.gov/data/academy/webinars/2020/calculating-margins-of-error-acs.html" class="uri">https://www.census.gov/data/academy/webinars/2020/calculating-margins-of-error-acs.html</a></p>
</div>
<div class="infobox communication">
<p>The margin of error is a measure of uncertainty of the estimate. Often the width of the margin of error has to do with the sample size, whereby very small sample sizes yield estimates with large margins of error. Why do you think it is important to communicate uncertainty in the data to the public?</p>
</div>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># visualize the margin of error data.</span>
<span class="fu">map_health_insurance_over_time</span><span class="op">(</span><span class="st">'Texas'</span>, outcome_var <span class="op">=</span> <span class="va">moe_zero_to_64_insurance_prop</span>,
                               fill_label <span class="op">=</span> <span class="st">'Margin of Error'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>
    palette <span class="op">=</span> <span class="st">'Greys'</span>,
    direction <span class="op">=</span> <span class="fl">1</span>,
    trans <span class="op">=</span> <span class="st">'log10'</span>,
    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/10-temporal-health-insurance/texasmoe.png"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="fu">map_health_insurance_over_time</span><span class="op">(</span><span class="st">'Massachusetts'</span>,
                               outcome_var <span class="op">=</span> <span class="va">moe_zero_to_64_insurance_prop</span>,
                               fill_label <span class="op">=</span> <span class="st">'Margin of Error'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>
    palette <span class="op">=</span> <span class="st">'Greys'</span>,
    direction <span class="op">=</span> <span class="fl">1</span>,
    trans <span class="op">=</span> <span class="st">'log10'</span>,
    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/10-temporal-health-insurance/massmoe.png"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="fu">map_health_insurance_over_time</span><span class="op">(</span><span class="st">'Florida'</span>, outcome_var <span class="op">=</span> <span class="va">moe_zero_to_64_insurance_prop</span>,
                               fill_label <span class="op">=</span> <span class="st">'Margin of Error'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>
    palette <span class="op">=</span> <span class="st">'Greys'</span>,
    direction <span class="op">=</span> <span class="fl">1</span>,
    trans <span class="op">=</span> <span class="st">'log10'</span>,
    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/10-temporal-health-insurance/floridamoe.png"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="images/10-temporal-health-insurance/massmoe.png" width="80%"><img src="images/10-temporal-health-insurance/floridamoe.png" width="80%"></p>
<p>Congrats! You can now visualize your estimates and uncertainty in plots and maps.</p>
</div>
<div id="adding-area-based-social-metrics" class="section level2" number="10.5">
<h2>
<span class="header-section-number">10.5</span> Adding Area Based Social Metrics<a class="anchor" aria-label="anchor" href="#adding-area-based-social-metrics"><i class="fas fa-link"></i></a>
</h2>
<p>Now let’s look at our ABSMs. We are going to assess the association between poverty and health insurance and between racialized economic segregation (as measured by the ICE) and health insurance.</p>
<p>First, we will assess the association between poverty and health insurance by plotting scatter plots of the county percent poverty and the county percent with health insurance. We will add a smoothed line to the scatter using linear regression. In plot 1, we will use unweighted data, and in plot 2, will use the inverse of the margin of error to weight the data. Can you see a difference when the inverse margin of error weights are included?</p>
<p>Next, we will plot the trend in heath insurance status by quintiles of poverty and ICE using loess smoothing.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># look at relationship between poverty and insurance proportion</span>
<span class="va">plt1</span> <span class="op">&lt;-</span> 
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">'Texas'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">poverty_prop</span>, y <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_prop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Percent in Poverty"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percent with Health Insurance"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Relationship Between Percent in Poverty and Percent with Health Insurance"</span>,
          <span class="st">"County Observations, Texas -- Unweighted"</span><span class="op">)</span> 

<span class="co"># the same as above, but with inverse margin of error weighting</span>
<span class="va">plt2</span> <span class="op">&lt;-</span> 
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">'Texas'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">poverty_prop</span>, y <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_prop</span>, weight <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">moe_zero_to_64_insurance_prop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Percent in Poverty"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percent with Health Insurance"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Relationship Between Percent in Poverty and Percent with Health Insurance"</span>,
          <span class="st">"County Observations, Texas -- Weighted by Inverse Margin of Error"</span><span class="op">)</span> 

<span class="co"># display plot 1 and 2 over each other</span>
<span class="va">plt1</span> <span class="op">/</span> <span class="va">plt2</span> 

<span class="co"># massachusetts poverty relationship unweighted</span>
<span class="va">plt1</span> <span class="op">&lt;-</span> 
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">'Massachusetts'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">poverty_prop</span>, y <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_prop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Percent in Poverty"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percent with Health Insurance"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="st">"Relationship Between Percent in Poverty and Percent with Health Insurance"</span>,width <span class="op">=</span><span class="fl">33</span>, indent<span class="op">=</span><span class="fl">0</span>, exdent<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,
       subtitle<span class="op">=</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="st">"County Observations, Massachusetts -- Unweighted"</span>,width <span class="op">=</span><span class="fl">42</span>, indent<span class="op">=</span><span class="fl">0</span>, exdent<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> 

<span class="co"># massachusetts poverty relationship weighted by inverse margin of error</span>
<span class="va">plt2</span> <span class="op">&lt;-</span> 
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">'Massachusetts'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">poverty_prop</span>, y <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_prop</span>, weight <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">moe_zero_to_64_insurance_prop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Percent in Poverty"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percent with Health Insurance"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="st">"Relationship Between Percent in Poverty and Percent with Health Insurance"</span>,width <span class="op">=</span><span class="fl">33</span>, indent<span class="op">=</span><span class="fl">0</span>, exdent<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,
       subtitle<span class="op">=</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="st">"County Observations, Massachusetts -- Weighted by Inverse Margin of Error"</span>,width <span class="op">=</span><span class="fl">42</span>, indent<span class="op">=</span><span class="fl">0</span>, exdent<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> 

<span class="co"># display plot 1 and 2 side by side</span>
<span class="va">plt1</span> <span class="op">+</span> <span class="va">plt2</span> </code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-84"></span>
<img src="images/10-temporal-health-insurance/povertycomparison.png" alt="County observations of adult (age 19-64) health insurance rates in California" width="80%"><p class="caption">
Figure 10.1: County observations of adult (age 19-64) health insurance rates in California
</p>
</div>
<p>Notice the difference in weighted vs unweighted estimates.</p>
<p>Now we will explore the relationships between ICE and health insurance, weighted by the inverse margin of error as well as poverty and health insurance, weighted by the inverse margin of error.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># look at the relationship with ICEraceinc and insurance, weighted by inverse margin of error</span>
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">'Texas'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ICEraceinc</span>, y <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_prop</span>, weight <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">moe_zero_to_64_insurance_prop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"ICEraceinc"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percent with Health Insurance"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Relationship Between ICE for Racialized Economic Segregation and \nPercent with Health Insurance"</span>,
          <span class="st">"County Observations, Texas -- Weighted by Inverse Margin of Error"</span><span class="op">)</span> </code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<div class="inline-figure"><img src="phdgp2_files/figure-html/unnamed-chunk-85-1.png" width="100%"></div>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># smoothed insurance relationship with ICEraceinc quantiles over time </span>
<span class="co"># using loess smoothing</span>
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">'Texas'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_prop</span>, 
             color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">ICEraceinc</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">ICEraceinc</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.2</span><span class="op">)</span><span class="op">)</span>, include.lowest <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
             fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">ICEraceinc</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">ICEraceinc</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.2</span><span class="op">)</span><span class="op">)</span>, include.lowest <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
             weight <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">moe_zero_to_64_insurance_prop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co"># geom_jitter(height = 0) + </span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">'RdYlBu'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">'RdYlBu'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percent with Health Insurance"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"ICEraceinc Quantile"</span>, color <span class="op">=</span> <span class="st">"ICEraceinc Quantile"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Relationship Between Percent with Health Insurance by ICE for Racialized \nEconomic Segregation over Time"</span>,
          <span class="st">"County Observations, Texas -- Weighted by Inverse Margin of Error"</span><span class="op">)</span> </code></pre></div>
<pre><code>## Warning: Duplicated aesthetics after name standardisation: alpha</code></pre>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'</code></pre>
<div class="inline-figure"><img src="phdgp2_files/figure-html/unnamed-chunk-85-2.png" width="100%"></div>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/10-temporal-health-insurance/healthinsurance_ICE_time.png"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'</code></pre>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># smoothed relationship between poverty (cut in quantiles) and insurance rates</span>
<span class="co"># using loess smoothing</span>
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">'Texas'</span>, <span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">poverty_prop</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_prop</span>, 
             color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">poverty_prop</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">poverty_prop</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.2</span><span class="op">)</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
                         include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
             fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/cut.html">cut</a></span><span class="op">(</span><span class="va">poverty_prop</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">poverty_prop</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.2</span><span class="op">)</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
                         include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
             weight <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">moe_zero_to_64_insurance_prop</span>
             <span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">'RdYlBu'</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">'RdYlBu'</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percent with Health Insurance"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Poverty Quantile"</span>, color <span class="op">=</span> <span class="st">"Poverty Quantile"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Relationship Between Percent with Health Insurance by Percent in Poverty \nover Time"</span>,
          <span class="st">"County Observations, Texas -- Weighted by Inverse Margin of Error"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'</code></pre>
<div class="inline-figure"><img src="phdgp2_files/figure-html/unnamed-chunk-85-3.png" width="100%"></div>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/10-temporal-health-insurance/healthinsurance_poverty_time.png"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'</code></pre>
<p>Now, we are going to use linear regression with inverse margin of error weighting to assess the trends in insurance coverage by county. We will categorize each county as increase, stable/uncertain, or decreasing. We will visualize these results with both maps and histograms.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># cleaning before modeling</span>
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>county <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>
<span class="va">health_insurance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year_centered <span class="op">=</span> <span class="va">year</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2012</span>, <span class="fl">2019</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># create linear models with inverse margin of error weighting for each county</span>
<span class="co"># regressing insurance rates on year</span>
<span class="va">model_df</span> <span class="op">&lt;-</span> 
  <span class="va">health_insurance</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nest_by.html">nest_by</a></span><span class="op">(</span><span class="va">GEOID</span>, <span class="va">county</span>, <span class="va">state</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    <span class="co"># for each county, fit a linear model and store it in a list column</span>
    model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>
        <span class="va">estimate_zero_to_64_insurance_prop</span> <span class="op">~</span> <span class="va">year_centered</span>,
        data <span class="op">=</span> <span class="va">data</span>,
        weights <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">data</span><span class="op">$</span><span class="va">moe_zero_to_64_insurance_prop</span>
      <span class="op">)</span>
    <span class="op">)</span>, 
    <span class="co"># use broom::tidy to extract coefficients</span>
    coefs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model</span>, conf.int<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>,
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="co"># extract coefficients on year for each model</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    coef_on_year <span class="op">=</span> <span class="va">coefs</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">'year_centered'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,
    coef_on_year_ci_low <span class="op">=</span> <span class="va">coefs</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">'year_centered'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">conf.low</span><span class="op">)</span>,
    coef_on_year_ci_high <span class="op">=</span> <span class="va">coefs</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">'year_centered'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">conf.high</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># plot coefficients distribution</span>
<span class="va">model_df</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">coef_on_year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">.5</span>, linetype <span class="op">=</span> <span class="st">'dashed'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Coefficient Estimates for Average Percentage Point Increase Each Year"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">state</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Estimates for County Change in Percent with Health Insurance"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/10-temporal-health-insurance/estimate_countychange.png"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="co"># classify into increasing, decreasing, or uncertain/stable</span>
<span class="va">model_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  change_over_time <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
    <span class="va">coef_on_year_ci_low</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">'increasing'</span>,
    <span class="va">coef_on_year_ci_high</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">'decreasing'</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">'stable/uncertain'</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="co"># make factor levels for change over time</span>
<span class="va">model_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>change_over_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span>
  <span class="va">change_over_time</span>,
  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'decreasing'</span>, <span class="st">'stable/uncertain'</span>, <span class="st">'increasing'</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span>

<span class="co"># plot distribution of change over time categories</span>
<span class="va">model_df</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">change_over_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">state</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">75</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># merge in spatial data and coefficients</span>
<span class="va">health_insurance_sf_w_model_coefs</span> <span class="op">&lt;-</span> 
  <span class="va">health_insurance</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="co"># nest by GEOID, county, and state so we can make interactive popup graphs by county </span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nest_by.html">nest_by</a></span><span class="op">(</span><span class="va">GEOID</span>, <span class="va">county</span>, <span class="va">state</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="co"># join in the change over time variables</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">model_df</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID</span>, <span class="va">coef_on_year</span>, <span class="va">change_over_time</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'GEOID'</span> <span class="op">=</span> <span class="st">'GEOID'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/exposition.html">%$%</a></span> 
  <span class="co"># join in the spatial data; </span>
  <span class="co"># we use %$% for this because when joining spatial data and tabular data, it is critical </span>
  <span class="co"># that the spatial data be passed as the first argument to the join function</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">health_insurance_sf</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID</span><span class="op">)</span>,
            <span class="va">.</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'GEOID'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot texas change over time </span>
<span class="va">health_insurance_sf_w_model_coefs</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">'Texas'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">change_over_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'white'</span>, size <span class="op">=</span> <span class="fl">.05</span>, alpha <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'increasing'</span> <span class="op">=</span> <span class="st">'#67A9CF'</span>, 
                                <span class="st">'stable/uncertain'</span> <span class="op">=</span> <span class="st">'#FFFFBF'</span>, 
                                <span class="st">'decreasing'</span> <span class="op">=</span> <span class="st">'#EF8A62'</span>
                               <span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">'Change over Time'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Change in Health Insurance Rates, 2012-2019, Texas"</span><span class="op">)</span>

<span class="va">health_insurance_sf_w_model_coefs</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">'Texas'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">coef_on_year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'white'</span>, size <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span>high <span class="op">=</span> <span class="st">'#0072B2'</span>,
                       mid <span class="op">=</span> <span class="st">'#FFFFBF'</span>,
                       low <span class="op">=</span> <span class="st">'#D55E00'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">'Change over Time'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Change in Health Insurance Rates, 2012-2019, Texas"</span><span class="op">)</span>


<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/">leaflet</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/leafpop">leafpop</a></span><span class="op">)</span>

<span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorFactor</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">'RdBu'</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, 
                   domain <span class="op">=</span> <span class="va">health_insurance_sf_w_model_coefs</span><span class="op">$</span><span class="va">change_over_time</span><span class="op">)</span>

<span class="va">tx_health_insurance_sf_w_model_coefs</span> <span class="op">&lt;-</span> 
  <span class="va">health_insurance_sf_w_model_coefs</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">'Texas'</span><span class="op">)</span>

<span class="va">tx_health_insurance_sf_w_model_coefs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  plot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">data</span>,
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">year</span>, 
      y <span class="op">=</span> <span class="va">estimate_zero_to_64_insurance_prop</span>, 
      ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="va">estimate_zero_to_64_insurance_prop</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1.96</span><span class="op">/</span><span class="fl">1.645</span><span class="op">)</span><span class="op">*</span><span class="va">moe_zero_to_64_insurance_prop</span>, <span class="fl">0</span><span class="op">)</span>,
      ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">estimate_zero_to_64_insurance_prop</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1.96</span><span class="op">/</span><span class="fl">1.645</span><span class="op">)</span><span class="op">*</span><span class="va">moe_zero_to_64_insurance_prop</span>, <span class="fl">1</span><span class="op">)</span>
      <span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_pointrange</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percent with Health Insurance\nAge 0-64"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">county</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">map</span> <span class="op">&lt;-</span> 
  <span class="va">tx_health_insurance_sf_w_model_coefs</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addPolygons</a></span><span class="op">(</span>color <span class="op">=</span> <span class="op">~</span><span class="fu">pal</span><span class="op">(</span><span class="va">change_over_time</span><span class="op">)</span>, 
              label <span class="op">=</span> <span class="op">~</span><span class="va">county</span>,
              popup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/leafpop/man/popup.html">popupGraph</a></span><span class="op">(</span><span class="va">tx_health_insurance_sf_w_model_coefs</span><span class="op">$</span><span class="va">plot</span>, type <span class="op">=</span> <span class="st">'png'</span>, width <span class="op">=</span> <span class="fl">400</span>, height <span class="op">=</span> <span class="fl">400</span><span class="op">)</span>,
              weight <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addLegend.html">addLegend</a></span><span class="op">(</span>
    position <span class="op">=</span> <span class="st">'topright'</span>,
    pal <span class="op">=</span> <span class="va">pal</span>,
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'increasing'</span>, <span class="st">'stable/uncertain'</span>, <span class="st">'decreasing'</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Increasing'</span>, <span class="st">'Stable/Uncertain'</span>, <span class="st">'Decreasing'</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># additional ways to map change in insurance coverage over time</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ramnathv/htmlwidgets">htmlwidgets</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmlwidgets/man/saveWidget.html">saveWidget</a></span><span class="op">(</span><span class="va">map</span>, <span class="st">"map.html"</span><span class="op">)</span>

<span class="va">health_insurance_sf</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">model_df</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID</span>, <span class="va">change_over_time</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'GEOID'</span> <span class="op">=</span> <span class="st">'GEOID'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">'Texas'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">change_over_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'white'</span>, size <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'increasing'</span> <span class="op">=</span> <span class="st">'#67A9CF'</span>, 
                                <span class="st">'uncertain/stable'</span> <span class="op">=</span> <span class="st">'#FFFFBF'</span>, 
                                <span class="st">'decreasing'</span> <span class="op">=</span> <span class="st">'#EF8A62'</span>
                               <span class="op">)</span><span class="op">)</span> 
  
<span class="va">health_insurance_sf</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">model_df</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID</span>, <span class="va">change_over_time</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'GEOID'</span> <span class="op">=</span> <span class="st">'GEOID'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">'Florida'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">change_over_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'white'</span>, size <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'increasing'</span> <span class="op">=</span> <span class="st">'#67A9CF'</span>, 
                                <span class="st">'uncertain/stable'</span> <span class="op">=</span> <span class="st">'#FFFFBF'</span>, 
                                <span class="st">'decreasing'</span> <span class="op">=</span> <span class="st">'#EF8A62'</span>
                               <span class="op">)</span><span class="op">)</span> 

<span class="va">health_insurance_sf</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">model_df</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">GEOID</span>, <span class="va">change_over_time</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'GEOID'</span> <span class="op">=</span> <span class="st">'GEOID'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">'California'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">change_over_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'white'</span>, size <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'increasing'</span> <span class="op">=</span> <span class="st">'#67A9CF'</span>, 
                                <span class="st">'uncertain/stable'</span> <span class="op">=</span> <span class="st">'#FFFFBF'</span>, 
                                <span class="st">'decreasing'</span> <span class="op">=</span> <span class="st">'#EF8A62'</span>
                               <span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-86"></span>
<img src="images/10-temporal-health-insurance/estimate_countychange.png" alt="County observations of adult (age 19-64) health insurance rates in California" width="80%"><p class="caption">
Figure 10.2: County observations of adult (age 19-64) health insurance rates in California
</p>
</div>
<p>What additional analyses might you be interested in?</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="cook-county-covid.html"><span class="header-section-number">9</span> Case Study 3: COVID-19 Mortality in Cook County (March 2020 - March 2022)</a></div>
<div class="next"><a href="health-insurance-comparison.html"><span class="header-section-number">11</span> Case Study 5: Case Study Comparing County Analyses of Inequities in Health Insurance using ACS vs. CDC PLACES data (2019)</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#temporal-health-insurance"><span class="header-section-number">10</span> Case Study 4: Case Study on Temporal Trends using American Community Survey (ACS) data (2012-2019)</a></li>
<li><a class="nav-link" href="#introduction-2"><span class="header-section-number">10.1</span> Introduction</a></li>
<li><a class="nav-link" href="#motivation-research-questions-and-learning-objectives-3"><span class="header-section-number">10.2</span> Motivation, Research Questions, and Learning Objectives</a></li>
<li><a class="nav-link" href="#downloading-your-data"><span class="header-section-number">10.3</span> Downloading your data</a></li>
<li><a class="nav-link" href="#visualizing-your-data-2"><span class="header-section-number">10.4</span> Visualizing your Data</a></li>
<li><a class="nav-link" href="#adding-area-based-social-metrics"><span class="header-section-number">10.5</span> Adding Area Based Social Metrics</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Public Health Disparities Geocoding Project 2.0 Training Manual</strong>" was written by Christian Testa, Jarvis T Chen, Enjoli Hall, Dena Javadi, Justin Morgan, Tamara Rushovich, Sudipta Saha, Pamela D Waterman, Nancy Krieger. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
